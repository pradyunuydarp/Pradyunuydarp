import{g as Gv}from"./react-dom-JRV-XSxP.js";var Xc={exports:{}},fo={},Qc={exports:{}},Le={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg;function iL(){if(vg)return Le;vg=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),d=Symbol.iterator;function m(M){return M===null||typeof M!="object"?null:(M=d&&M[d]||M["@@iterator"],typeof M=="function"?M:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,T={};function E(M,V,ne){this.props=M,this.context=V,this.refs=T,this.updater=ne||g}E.prototype.isReactComponent={},E.prototype.setState=function(M,V){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,V,"setState")},E.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function x(){}x.prototype=E.prototype;function R(M,V,ne){this.props=M,this.context=V,this.refs=T,this.updater=ne||g}var L=R.prototype=new x;L.constructor=R,y(L,E.prototype),L.isPureReactComponent=!0;var P=Array.isArray,I=Object.prototype.hasOwnProperty,C={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function w(M,V,ne){var re,oe={},fe=null,Te=null;if(V!=null)for(re in V.ref!==void 0&&(Te=V.ref),V.key!==void 0&&(fe=""+V.key),V)I.call(V,re)&&!D.hasOwnProperty(re)&&(oe[re]=V[re]);var Ie=arguments.length-2;if(Ie===1)oe.children=ne;else if(1<Ie){for(var we=Array(Ie),ut=0;ut<Ie;ut++)we[ut]=arguments[ut+2];oe.children=we}if(M&&M.defaultProps)for(re in Ie=M.defaultProps,Ie)oe[re]===void 0&&(oe[re]=Ie[re]);return{$$typeof:i,type:M,key:fe,ref:Te,props:oe,_owner:C.current}}function k(M,V){return{$$typeof:i,type:M.type,key:V,ref:M.ref,props:M.props,_owner:M._owner}}function O(M){return typeof M=="object"&&M!==null&&M.$$typeof===i}function W(M){var V={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(ne){return V[ne]})}var q=/\/+/g;function ie(M,V){return typeof M=="object"&&M!==null&&M.key!=null?W(""+M.key):V.toString(36)}function te(M,V,ne,re,oe){var fe=typeof M;(fe==="undefined"||fe==="boolean")&&(M=null);var Te=!1;if(M===null)Te=!0;else switch(fe){case"string":case"number":Te=!0;break;case"object":switch(M.$$typeof){case i:case e:Te=!0}}if(Te)return Te=M,oe=oe(Te),M=re===""?"."+ie(Te,0):re,P(oe)?(ne="",M!=null&&(ne=M.replace(q,"$&/")+"/"),te(oe,V,ne,"",function(ut){return ut})):oe!=null&&(O(oe)&&(oe=k(oe,ne+(!oe.key||Te&&Te.key===oe.key?"":(""+oe.key).replace(q,"$&/")+"/")+M)),V.push(oe)),1;if(Te=0,re=re===""?".":re+":",P(M))for(var Ie=0;Ie<M.length;Ie++){fe=M[Ie];var we=re+ie(fe,Ie);Te+=te(fe,V,ne,we,oe)}else if(we=m(M),typeof we=="function")for(M=we.call(M),Ie=0;!(fe=M.next()).done;)fe=fe.value,we=re+ie(fe,Ie++),Te+=te(fe,V,ne,we,oe);else if(fe==="object")throw V=String(M),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.");return Te}function J(M,V,ne){if(M==null)return M;var re=[],oe=0;return te(M,re,"","",function(fe){return V.call(ne,fe,oe++)}),re}function Z(M){if(M._status===-1){var V=M._result;V=V(),V.then(function(ne){(M._status===0||M._status===-1)&&(M._status=1,M._result=ne)},function(ne){(M._status===0||M._status===-1)&&(M._status=2,M._result=ne)}),M._status===-1&&(M._status=0,M._result=V)}if(M._status===1)return M._result.default;throw M._result}var Q={current:null},G={transition:null},K={ReactCurrentDispatcher:Q,ReactCurrentBatchConfig:G,ReactCurrentOwner:C};function z(){throw Error("act(...) is not supported in production builds of React.")}return Le.Children={map:J,forEach:function(M,V,ne){J(M,function(){V.apply(this,arguments)},ne)},count:function(M){var V=0;return J(M,function(){V++}),V},toArray:function(M){return J(M,function(V){return V})||[]},only:function(M){if(!O(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Le.Component=E,Le.Fragment=t,Le.Profiler=r,Le.PureComponent=R,Le.StrictMode=n,Le.Suspense=l,Le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K,Le.act=z,Le.cloneElement=function(M,V,ne){if(M==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+M+".");var re=y({},M.props),oe=M.key,fe=M.ref,Te=M._owner;if(V!=null){if(V.ref!==void 0&&(fe=V.ref,Te=C.current),V.key!==void 0&&(oe=""+V.key),M.type&&M.type.defaultProps)var Ie=M.type.defaultProps;for(we in V)I.call(V,we)&&!D.hasOwnProperty(we)&&(re[we]=V[we]===void 0&&Ie!==void 0?Ie[we]:V[we])}var we=arguments.length-2;if(we===1)re.children=ne;else if(1<we){Ie=Array(we);for(var ut=0;ut<we;ut++)Ie[ut]=arguments[ut+2];re.children=Ie}return{$$typeof:i,type:M.type,key:oe,ref:fe,props:re,_owner:Te}},Le.createContext=function(M){return M={$$typeof:o,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},M.Provider={$$typeof:s,_context:M},M.Consumer=M},Le.createElement=w,Le.createFactory=function(M){var V=w.bind(null,M);return V.type=M,V},Le.createRef=function(){return{current:null}},Le.forwardRef=function(M){return{$$typeof:a,render:M}},Le.isValidElement=O,Le.lazy=function(M){return{$$typeof:f,_payload:{_status:-1,_result:M},_init:Z}},Le.memo=function(M,V){return{$$typeof:u,type:M,compare:V===void 0?null:V}},Le.startTransition=function(M){var V=G.transition;G.transition={};try{M()}finally{G.transition=V}},Le.unstable_act=z,Le.useCallback=function(M,V){return Q.current.useCallback(M,V)},Le.useContext=function(M){return Q.current.useContext(M)},Le.useDebugValue=function(){},Le.useDeferredValue=function(M){return Q.current.useDeferredValue(M)},Le.useEffect=function(M,V){return Q.current.useEffect(M,V)},Le.useId=function(){return Q.current.useId()},Le.useImperativeHandle=function(M,V,ne){return Q.current.useImperativeHandle(M,V,ne)},Le.useInsertionEffect=function(M,V){return Q.current.useInsertionEffect(M,V)},Le.useLayoutEffect=function(M,V){return Q.current.useLayoutEffect(M,V)},Le.useMemo=function(M,V){return Q.current.useMemo(M,V)},Le.useReducer=function(M,V,ne){return Q.current.useReducer(M,V,ne)},Le.useRef=function(M){return Q.current.useRef(M)},Le.useState=function(M){return Q.current.useState(M)},Le.useSyncExternalStore=function(M,V,ne){return Q.current.useSyncExternalStore(M,V,ne)},Le.useTransition=function(){return Q.current.useTransition()},Le.version="18.3.1",Le}var Tg;function Zf(){return Tg||(Tg=1,Qc.exports=iL()),Qc.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eg;function rL(){if(Eg)return fo;Eg=1;var i=Zf(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var f,d={},m=null,g=null;u!==void 0&&(m=""+u),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(g=l.ref);for(f in l)n.call(l,f)&&!s.hasOwnProperty(f)&&(d[f]=l[f]);if(a&&a.defaultProps)for(f in l=a.defaultProps,l)d[f]===void 0&&(d[f]=l[f]);return{$$typeof:e,type:a,key:m,ref:g,props:d,_owner:r.current}}return fo.Fragment=t,fo.jsx=o,fo.jsxs=o,fo}var Sg;function sL(){return Sg||(Sg=1,Xc.exports=rL()),Xc.exports}var Xh=sL(),N=Zf();const Or=Gv(N);var Zc={exports:{}},ji={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xg;function oL(){return xg||(xg=1,ji.ConcurrentRoot=1,ji.ContinuousEventPriority=4,ji.DefaultEventPriority=16,ji.DiscreteEventPriority=1,ji.IdleEventPriority=536870912,ji.LegacyRoot=0),ji}var _g;function aL(){return _g||(_g=1,Zc.exports=oL()),Zc.exports}var iN=aL();const lL=i=>typeof i=="object"&&typeof i.then=="function",Cr=[];function Hv(i,e,t=(n,r)=>n===r){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let r=0;r<n;r++)if(!t(i[r],e[r]))return!1;return!0}function Kv(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const s of Cr)if(Hv(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:n.equal,remove:()=>{const s=Cr.indexOf(r);s!==-1&&Cr.splice(s,1)},promise:(lL(i)?i:i(...e)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(Cr.push(r),!t)throw r.promise}const rN=(i,e,t)=>Kv(i,e,!1,t),sN=(i,e,t)=>void Kv(i,e,!0,t),oN=i=>{if(i===void 0||i.length===0)Cr.splice(0,Cr.length);else{const e=Cr.find(t=>Hv(i,t.keys,t.equal));e&&e.remove()}};var Jc={exports:{}},eh={exports:{}},th={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ag;function uL(){return Ag||(Ag=1,function(i){function e(G,K){var z=G.length;G.push(K);e:for(;0<z;){var M=z-1>>>1,V=G[M];if(0<r(V,K))G[M]=K,G[z]=V,z=M;else break e}}function t(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var K=G[0],z=G.pop();if(z!==K){G[0]=z;e:for(var M=0,V=G.length,ne=V>>>1;M<ne;){var re=2*(M+1)-1,oe=G[re],fe=re+1,Te=G[fe];if(0>r(oe,z))fe<V&&0>r(Te,oe)?(G[M]=Te,G[fe]=z,M=fe):(G[M]=oe,G[re]=z,M=re);else if(fe<V&&0>r(Te,z))G[M]=Te,G[fe]=z,M=fe;else break e}}return K}function r(G,K){var z=G.sortIndex-K.sortIndex;return z!==0?z:G.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],u=[],f=1,d=null,m=3,g=!1,y=!1,T=!1,E=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(G){for(var K=t(u);K!==null;){if(K.callback===null)n(u);else if(K.startTime<=G)n(u),K.sortIndex=K.expirationTime,e(l,K);else break;K=t(u)}}function P(G){if(T=!1,L(G),!y)if(t(l)!==null)y=!0,Z(I);else{var K=t(u);K!==null&&Q(P,K.startTime-G)}}function I(G,K){y=!1,T&&(T=!1,x(w),w=-1),g=!0;var z=m;try{for(L(K),d=t(l);d!==null&&(!(d.expirationTime>K)||G&&!W());){var M=d.callback;if(typeof M=="function"){d.callback=null,m=d.priorityLevel;var V=M(d.expirationTime<=K);K=i.unstable_now(),typeof V=="function"?d.callback=V:d===t(l)&&n(l),L(K)}else n(l);d=t(l)}if(d!==null)var ne=!0;else{var re=t(u);re!==null&&Q(P,re.startTime-K),ne=!1}return ne}finally{d=null,m=z,g=!1}}var C=!1,D=null,w=-1,k=5,O=-1;function W(){return!(i.unstable_now()-O<k)}function q(){if(D!==null){var G=i.unstable_now();O=G;var K=!0;try{K=D(!0,G)}finally{K?ie():(C=!1,D=null)}}else C=!1}var ie;if(typeof R=="function")ie=function(){R(q)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,J=te.port2;te.port1.onmessage=q,ie=function(){J.postMessage(null)}}else ie=function(){E(q,0)};function Z(G){D=G,C||(C=!0,ie())}function Q(G,K){w=E(function(){G(i.unstable_now())},K)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(G){G.callback=null},i.unstable_continueExecution=function(){y||g||(y=!0,Z(I))},i.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<G?Math.floor(1e3/G):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(G){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var z=m;m=K;try{return G()}finally{m=z}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(G,K){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var z=m;m=G;try{return K()}finally{m=z}},i.unstable_scheduleCallback=function(G,K,z){var M=i.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?M+z:M):z=M,G){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=z+V,G={id:f++,callback:K,priorityLevel:G,startTime:z,expirationTime:V,sortIndex:-1},z>M?(G.sortIndex=z,e(u,G),t(l)===null&&G===t(u)&&(T?(x(w),w=-1):T=!0,Q(P,z-M))):(G.sortIndex=V,e(l,G),y||g||(y=!0,Z(I))),G},i.unstable_shouldYield=W,i.unstable_wrapCallback=function(G){var K=m;return function(){var z=m;m=K;try{return G.apply(this,arguments)}finally{m=z}}}}(th)),th}var Lg;function zv(){return Lg||(Lg=1,eh.exports=uL()),eh.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nh,Rg;function cL(){return Rg||(Rg=1,nh=function(e){var t={},n=Zf(),r=zv(),s=Object.assign;function o(c){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+c,p=1;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),y=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),I=Symbol.iterator;function C(c){return c===null||typeof c!="object"?null:(c=I&&c[I]||c["@@iterator"],typeof c=="function"?c:null)}function D(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case f:return"Fragment";case u:return"Portal";case m:return"Profiler";case d:return"StrictMode";case E:return"Suspense";case x:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case y:return(c.displayName||"Context")+".Consumer";case g:return(c._context.displayName||"Context")+".Provider";case T:var h=c.render;return c=c.displayName,c||(c=h.displayName||h.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case R:return h=c.displayName||null,h!==null?h:D(c.type)||"Memo";case L:h=c._payload,c=c._init;try{return D(c(h))}catch{}}return null}function w(c){var h=c.type;switch(c.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=h.render,c=c.displayName||c.name||"",h.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return D(h);case 8:return h===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function k(c){var h=c,p=c;if(c.alternate)for(;h.return;)h=h.return;else{c=h;do h=c,(h.flags&4098)!==0&&(p=h.return),c=h.return;while(c)}return h.tag===3?p:null}function O(c){if(k(c)!==c)throw Error(o(188))}function W(c){var h=c.alternate;if(!h){if(h=k(c),h===null)throw Error(o(188));return h!==c?null:c}for(var p=c,v=h;;){var S=p.return;if(S===null)break;var _=S.alternate;if(_===null){if(v=S.return,v!==null){p=v;continue}break}if(S.child===_.child){for(_=S.child;_;){if(_===p)return O(S),c;if(_===v)return O(S),h;_=_.sibling}throw Error(o(188))}if(p.return!==v.return)p=S,v=_;else{for(var b=!1,F=S.child;F;){if(F===p){b=!0,p=S,v=_;break}if(F===v){b=!0,v=S,p=_;break}F=F.sibling}if(!b){for(F=_.child;F;){if(F===p){b=!0,p=_,v=S;break}if(F===v){b=!0,v=_,p=S;break}F=F.sibling}if(!b)throw Error(o(189))}}if(p.alternate!==v)throw Error(o(190))}if(p.tag!==3)throw Error(o(188));return p.stateNode.current===p?c:h}function q(c){return c=W(c),c!==null?ie(c):null}function ie(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var h=ie(c);if(h!==null)return h;c=c.sibling}return null}function te(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){if(c.tag!==4){var h=te(c);if(h!==null)return h}c=c.sibling}return null}var J=Array.isArray,Z=e.getPublicInstance,Q=e.getRootHostContext,G=e.getChildHostContext,K=e.prepareForCommit,z=e.resetAfterCommit,M=e.createInstance,V=e.appendInitialChild,ne=e.finalizeInitialChildren,re=e.prepareUpdate,oe=e.shouldSetTextContent,fe=e.createTextInstance,Te=e.scheduleTimeout,Ie=e.cancelTimeout,we=e.noTimeout,ut=e.isPrimaryRenderer,tn=e.supportsMutation,qr=e.supportsPersistence,St=e.supportsHydration,Ks=e.getInstanceFromNode,Dm=e.preparePortalMount,Ce=e.getCurrentEventPriority,dt=e.detachDeletedInstance,Gt=e.supportsMicrotasks,hi=e.scheduleMicrotask,xt=e.supportsTestSelectors,Fi=e.findFiberRoot,fi=e.getBoundingRect,fa=e.getTextContent,$n=e.isHiddenSubtree,da=e.matchAccessibilityRole,hr=e.setFocusIfFocusable,ma=e.setupIntersectionObserver,$u=e.appendChild,pa=e.appendChildToContainer,ga=e.commitTextUpdate,fr=e.commitMount,F_=e.commitUpdate,N_=e.insertBefore,B_=e.insertInContainerBefore,U_=e.removeChild,$_=e.removeChildFromContainer,wm=e.resetTextContent,V_=e.hideInstance,G_=e.hideTextInstance,H_=e.unhideInstance,K_=e.unhideTextInstance,z_=e.clearContainer,W_=e.cloneInstance,Cm=e.createContainerChildSet,bm=e.appendChildToContainerChildSet,j_=e.finalizeContainerChildren,km=e.replaceContainerChildren,Om=e.cloneHiddenInstance,Mm=e.cloneHiddenTextInstance,Y_=e.canHydrateInstance,q_=e.canHydrateTextInstance,X_=e.canHydrateSuspenseInstance,Fm=e.isSuspenseInstancePending,Vu=e.isSuspenseInstanceFallback,Q_=e.registerSuspenseInstanceRetry,zs=e.getNextHydratableSibling,Z_=e.getFirstHydratableChild,J_=e.getFirstHydratableChildWithinContainer,eA=e.getFirstHydratableChildWithinSuspenseInstance,tA=e.hydrateInstance,nA=e.hydrateTextInstance,iA=e.hydrateSuspenseInstance,rA=e.getNextHydratableInstanceAfterSuspenseInstance,Nm=e.commitHydratedContainer,sA=e.commitHydratedSuspenseInstance,oA=e.clearSuspenseBoundary,aA=e.clearSuspenseBoundaryFromContainer,lA=e.shouldDeleteUnhydratedTailInstances,uA=e.didNotMatchHydratedContainerTextInstance,cA=e.didNotMatchHydratedTextInstance,Gu;function Ws(c){if(Gu===void 0)try{throw Error()}catch(p){var h=p.stack.trim().match(/\n( *(at )?)/);Gu=h&&h[1]||""}return`
`+Gu+c}var Hu=!1;function Ku(c,h){if(!c||Hu)return"";Hu=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(ee){var v=ee}Reflect.construct(c,[],h)}else{try{h.call()}catch(ee){v=ee}c.call(h.prototype)}else{try{throw Error()}catch(ee){v=ee}c()}}catch(ee){if(ee&&v&&typeof ee.stack=="string"){for(var S=ee.stack.split(`
`),_=v.stack.split(`
`),b=S.length-1,F=_.length-1;1<=b&&0<=F&&S[b]!==_[F];)F--;for(;1<=b&&0<=F;b--,F--)if(S[b]!==_[F]){if(b!==1||F!==1)do if(b--,F--,0>F||S[b]!==_[F]){var Y=`
`+S[b].replace(" at new "," at ");return c.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",c.displayName)),Y}while(1<=b&&0<=F);break}}}finally{Hu=!1,Error.prepareStackTrace=p}return(c=c?c.displayName||c.name:"")?Ws(c):""}var hA=Object.prototype.hasOwnProperty,zu=[],Xr=-1;function Ni(c){return{current:c}}function He(c){0>Xr||(c.current=zu[Xr],zu[Xr]=null,Xr--)}function Ge(c,h){Xr++,zu[Xr]=c.current,c.current=h}var Bi={},It=Ni(Bi),Ht=Ni(!1),dr=Bi;function Qr(c,h){var p=c.type.contextTypes;if(!p)return Bi;var v=c.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===h)return v.__reactInternalMemoizedMaskedChildContext;var S={},_;for(_ in p)S[_]=h[_];return v&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=h,c.__reactInternalMemoizedMaskedChildContext=S),S}function Kt(c){return c=c.childContextTypes,c!=null}function ya(){He(Ht),He(It)}function Bm(c,h,p){if(It.current!==Bi)throw Error(o(168));Ge(It,h),Ge(Ht,p)}function Um(c,h,p){var v=c.stateNode;if(h=h.childContextTypes,typeof v.getChildContext!="function")return p;v=v.getChildContext();for(var S in v)if(!(S in h))throw Error(o(108,w(c)||"Unknown",S));return s({},p,v)}function va(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||Bi,dr=It.current,Ge(It,c),Ge(Ht,Ht.current),!0}function $m(c,h,p){var v=c.stateNode;if(!v)throw Error(o(169));p?(c=Um(c,h,dr),v.__reactInternalMemoizedMergedChildContext=c,He(Ht),He(It),Ge(It,c)):He(Ht),Ge(Ht,p)}var bn=Math.clz32?Math.clz32:mA,fA=Math.log,dA=Math.LN2;function mA(c){return c>>>=0,c===0?32:31-(fA(c)/dA|0)|0}var Ta=64,Ea=4194304;function js(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function Sa(c,h){var p=c.pendingLanes;if(p===0)return 0;var v=0,S=c.suspendedLanes,_=c.pingedLanes,b=p&268435455;if(b!==0){var F=b&~S;F!==0?v=js(F):(_&=b,_!==0&&(v=js(_)))}else b=p&~S,b!==0?v=js(b):_!==0&&(v=js(_));if(v===0)return 0;if(h!==0&&h!==v&&(h&S)===0&&(S=v&-v,_=h&-h,S>=_||S===16&&(_&4194240)!==0))return h;if((v&4)!==0&&(v|=p&16),h=c.entangledLanes,h!==0)for(c=c.entanglements,h&=v;0<h;)p=31-bn(h),S=1<<p,v|=c[p],h&=~S;return v}function pA(c,h){switch(c){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gA(c,h){for(var p=c.suspendedLanes,v=c.pingedLanes,S=c.expirationTimes,_=c.pendingLanes;0<_;){var b=31-bn(_),F=1<<b,Y=S[b];Y===-1?((F&p)===0||(F&v)!==0)&&(S[b]=pA(F,h)):Y<=h&&(c.expiredLanes|=F),_&=~F}}function Wu(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function ju(c){for(var h=[],p=0;31>p;p++)h.push(c);return h}function Ys(c,h,p){c.pendingLanes|=h,h!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,h=31-bn(h),c[h]=p}function yA(c,h){var p=c.pendingLanes&~h;c.pendingLanes=h,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=h,c.mutableReadLanes&=h,c.entangledLanes&=h,h=c.entanglements;var v=c.eventTimes;for(c=c.expirationTimes;0<p;){var S=31-bn(p),_=1<<S;h[S]=0,v[S]=-1,c[S]=-1,p&=~_}}function Yu(c,h){var p=c.entangledLanes|=h;for(c=c.entanglements;p;){var v=31-bn(p),S=1<<v;S&h|c[v]&h&&(c[v]|=h),p&=~S}}var be=0;function Vm(c){return c&=-c,1<c?4<c?(c&268435455)!==0?16:536870912:4:1}var qu=r.unstable_scheduleCallback,Gm=r.unstable_cancelCallback,vA=r.unstable_shouldYield,TA=r.unstable_requestPaint,mt=r.unstable_now,Xu=r.unstable_ImmediatePriority,EA=r.unstable_UserBlockingPriority,Qu=r.unstable_NormalPriority,SA=r.unstable_IdlePriority,xa=null,Vn=null;function xA(c){if(Vn&&typeof Vn.onCommitFiberRoot=="function")try{Vn.onCommitFiberRoot(xa,c,void 0,(c.current.flags&128)===128)}catch{}}function _A(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var Gn=typeof Object.is=="function"?Object.is:_A,di=null,_a=!1,Zu=!1;function Hm(c){di===null?di=[c]:di.push(c)}function AA(c){_a=!0,Hm(c)}function Hn(){if(!Zu&&di!==null){Zu=!0;var c=0,h=be;try{var p=di;for(be=1;c<p.length;c++){var v=p[c];do v=v(!0);while(v!==null)}di=null,_a=!1}catch(S){throw di!==null&&(di=di.slice(c+1)),qu(Xu,Hn),S}finally{be=h,Zu=!1}}return null}var LA=a.ReactCurrentBatchConfig;function Aa(c,h){if(Gn(c,h))return!0;if(typeof c!="object"||c===null||typeof h!="object"||h===null)return!1;var p=Object.keys(c),v=Object.keys(h);if(p.length!==v.length)return!1;for(v=0;v<p.length;v++){var S=p[v];if(!hA.call(h,S)||!Gn(c[S],h[S]))return!1}return!0}function RA(c){switch(c.tag){case 5:return Ws(c.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 2:case 15:return c=Ku(c.type,!1),c;case 11:return c=Ku(c.type.render,!1),c;case 1:return c=Ku(c.type,!0),c;default:return""}}function kn(c,h){if(c&&c.defaultProps){h=s({},h),c=c.defaultProps;for(var p in c)h[p]===void 0&&(h[p]=c[p]);return h}return h}var La=Ni(null),Ra=null,Zr=null,Ju=null;function ec(){Ju=Zr=Ra=null}function Km(c,h,p){ut?(Ge(La,h._currentValue),h._currentValue=p):(Ge(La,h._currentValue2),h._currentValue2=p)}function tc(c){var h=La.current;He(La),ut?c._currentValue=h:c._currentValue2=h}function nc(c,h,p){for(;c!==null;){var v=c.alternate;if((c.childLanes&h)!==h?(c.childLanes|=h,v!==null&&(v.childLanes|=h)):v!==null&&(v.childLanes&h)!==h&&(v.childLanes|=h),c===p)break;c=c.return}}function Jr(c,h){Ra=c,Ju=Zr=null,c=c.dependencies,c!==null&&c.firstContext!==null&&((c.lanes&h)!==0&&(sn=!0),c.firstContext=null)}function pn(c){var h=ut?c._currentValue:c._currentValue2;if(Ju!==c)if(c={context:c,memoizedValue:h,next:null},Zr===null){if(Ra===null)throw Error(o(308));Zr=c,Ra.dependencies={lanes:0,firstContext:c}}else Zr=Zr.next=c;return h}var Kn=null,Ui=!1;function ic(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zm(c,h){c=c.updateQueue,h.updateQueue===c&&(h.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function mi(c,h){return{eventTime:c,lane:h,tag:0,payload:null,callback:null,next:null}}function $i(c,h){var p=c.updateQueue;p!==null&&(p=p.shared,st!==null&&(c.mode&1)!==0&&(Ae&2)===0?(c=p.interleaved,c===null?(h.next=h,Kn===null?Kn=[p]:Kn.push(p)):(h.next=c.next,c.next=h),p.interleaved=h):(c=p.pending,c===null?h.next=h:(h.next=c.next,c.next=h),p.pending=h))}function Ia(c,h,p){if(h=h.updateQueue,h!==null&&(h=h.shared,(p&4194240)!==0)){var v=h.lanes;v&=c.pendingLanes,p|=v,h.lanes=p,Yu(c,p)}}function Wm(c,h){var p=c.updateQueue,v=c.alternate;if(v!==null&&(v=v.updateQueue,p===v)){var S=null,_=null;if(p=p.firstBaseUpdate,p!==null){do{var b={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};_===null?S=_=b:_=_.next=b,p=p.next}while(p!==null);_===null?S=_=h:_=_.next=h}else S=_=h;p={baseState:v.baseState,firstBaseUpdate:S,lastBaseUpdate:_,shared:v.shared,effects:v.effects},c.updateQueue=p;return}c=p.lastBaseUpdate,c===null?p.firstBaseUpdate=h:c.next=h,p.lastBaseUpdate=h}function Pa(c,h,p,v){var S=c.updateQueue;Ui=!1;var _=S.firstBaseUpdate,b=S.lastBaseUpdate,F=S.shared.pending;if(F!==null){S.shared.pending=null;var Y=F,ee=Y.next;Y.next=null,b===null?_=ee:b.next=ee,b=Y;var ue=c.alternate;ue!==null&&(ue=ue.updateQueue,F=ue.lastBaseUpdate,F!==b&&(F===null?ue.firstBaseUpdate=ee:F.next=ee,ue.lastBaseUpdate=Y))}if(_!==null){var Ee=S.baseState;b=0,ue=ee=Y=null,F=_;do{var pe=F.lane,$e=F.eventTime;if((v&pe)===pe){ue!==null&&(ue=ue.next={eventTime:$e,lane:0,tag:F.tag,payload:F.payload,callback:F.callback,next:null});e:{var me=c,Ct=F;switch(pe=h,$e=p,Ct.tag){case 1:if(me=Ct.payload,typeof me=="function"){Ee=me.call($e,Ee,pe);break e}Ee=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Ct.payload,pe=typeof me=="function"?me.call($e,Ee,pe):me,pe==null)break e;Ee=s({},Ee,pe);break e;case 2:Ui=!0}}F.callback!==null&&F.lane!==0&&(c.flags|=64,pe=S.effects,pe===null?S.effects=[F]:pe.push(F))}else $e={eventTime:$e,lane:pe,tag:F.tag,payload:F.payload,callback:F.callback,next:null},ue===null?(ee=ue=$e,Y=Ee):ue=ue.next=$e,b|=pe;if(F=F.next,F===null){if(F=S.shared.pending,F===null)break;pe=F,F=pe.next,pe.next=null,S.lastBaseUpdate=pe,S.shared.pending=null}}while(!0);if(ue===null&&(Y=Ee),S.baseState=Y,S.firstBaseUpdate=ee,S.lastBaseUpdate=ue,h=S.shared.interleaved,h!==null){S=h;do b|=S.lane,S=S.next;while(S!==h)}else _===null&&(S.shared.lanes=0);ls|=b,c.lanes=b,c.memoizedState=Ee}}function jm(c,h,p){if(c=h.effects,h.effects=null,c!==null)for(h=0;h<c.length;h++){var v=c[h],S=v.callback;if(S!==null){if(v.callback=null,v=p,typeof S!="function")throw Error(o(191,S));S.call(v)}}}var Ym=new n.Component().refs;function rc(c,h,p,v){h=c.memoizedState,p=p(v,h),p=p==null?h:s({},h,p),c.memoizedState=p,c.lanes===0&&(c.updateQueue.baseState=p)}var Da={isMounted:function(c){return(c=c._reactInternals)?k(c)===c:!1},enqueueSetState:function(c,h,p){c=c._reactInternals;var v=Bt(),S=Hi(c),_=mi(v,S);_.payload=h,p!=null&&(_.callback=p),$i(c,_),h=En(c,S,v),h!==null&&Ia(h,c,S)},enqueueReplaceState:function(c,h,p){c=c._reactInternals;var v=Bt(),S=Hi(c),_=mi(v,S);_.tag=1,_.payload=h,p!=null&&(_.callback=p),$i(c,_),h=En(c,S,v),h!==null&&Ia(h,c,S)},enqueueForceUpdate:function(c,h){c=c._reactInternals;var p=Bt(),v=Hi(c),S=mi(p,v);S.tag=2,h!=null&&(S.callback=h),$i(c,S),h=En(c,v,p),h!==null&&Ia(h,c,v)}};function qm(c,h,p,v,S,_,b){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(v,_,b):h.prototype&&h.prototype.isPureReactComponent?!Aa(p,v)||!Aa(S,_):!0}function Xm(c,h,p){var v=!1,S=Bi,_=h.contextType;return typeof _=="object"&&_!==null?_=pn(_):(S=Kt(h)?dr:It.current,v=h.contextTypes,_=(v=v!=null)?Qr(c,S):Bi),h=new h(p,_),c.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Da,c.stateNode=h,h._reactInternals=c,v&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=S,c.__reactInternalMemoizedMaskedChildContext=_),h}function Qm(c,h,p,v){c=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(p,v),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(p,v),h.state!==c&&Da.enqueueReplaceState(h,h.state,null)}function sc(c,h,p,v){var S=c.stateNode;S.props=p,S.state=c.memoizedState,S.refs=Ym,ic(c);var _=h.contextType;typeof _=="object"&&_!==null?S.context=pn(_):(_=Kt(h)?dr:It.current,S.context=Qr(c,_)),S.state=c.memoizedState,_=h.getDerivedStateFromProps,typeof _=="function"&&(rc(c,h,_,p),S.state=c.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(h=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),h!==S.state&&Da.enqueueReplaceState(S,S.state,null),Pa(c,p,S,v),S.state=c.memoizedState),typeof S.componentDidMount=="function"&&(c.flags|=4194308)}var es=[],ts=0,wa=null,Ca=0,gn=[],yn=0,mr=null,pi=1,gi="";function pr(c,h){es[ts++]=Ca,es[ts++]=wa,wa=c,Ca=h}function Zm(c,h,p){gn[yn++]=pi,gn[yn++]=gi,gn[yn++]=mr,mr=c;var v=pi;c=gi;var S=32-bn(v)-1;v&=~(1<<S),p+=1;var _=32-bn(h)+S;if(30<_){var b=S-S%5;_=(v&(1<<b)-1).toString(32),v>>=b,S-=b,pi=1<<32-bn(h)+S|p<<S|v,gi=_+c}else pi=1<<_|p<<S|v,gi=c}function oc(c){c.return!==null&&(pr(c,1),Zm(c,1,0))}function ac(c){for(;c===wa;)wa=es[--ts],es[ts]=null,Ca=es[--ts],es[ts]=null;for(;c===mr;)mr=gn[--yn],gn[yn]=null,gi=gn[--yn],gn[yn]=null,pi=gn[--yn],gn[yn]=null}var nn=null,rn=null,Ke=!1,qs=!1,On=null;function Jm(c,h){var p=Sn(5,null,null,0);p.elementType="DELETED",p.stateNode=h,p.return=c,h=c.deletions,h===null?(c.deletions=[p],c.flags|=16):h.push(p)}function ep(c,h){switch(c.tag){case 5:return h=Y_(h,c.type,c.pendingProps),h!==null?(c.stateNode=h,nn=c,rn=Z_(h),!0):!1;case 6:return h=q_(h,c.pendingProps),h!==null?(c.stateNode=h,nn=c,rn=null,!0):!1;case 13:if(h=X_(h),h!==null){var p=mr!==null?{id:pi,overflow:gi}:null;return c.memoizedState={dehydrated:h,treeContext:p,retryLane:1073741824},p=Sn(18,null,null,0),p.stateNode=h,p.return=c,c.child=p,nn=c,rn=null,!0}return!1;default:return!1}}function lc(c){return(c.mode&1)!==0&&(c.flags&128)===0}function uc(c){if(Ke){var h=rn;if(h){var p=h;if(!ep(c,h)){if(lc(c))throw Error(o(418));h=zs(p);var v=nn;h&&ep(c,h)?Jm(v,p):(c.flags=c.flags&-4097|2,Ke=!1,nn=c)}}else{if(lc(c))throw Error(o(418));c.flags=c.flags&-4097|2,Ke=!1,nn=c}}}function tp(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;nn=c}function Xs(c){if(!St||c!==nn)return!1;if(!Ke)return tp(c),Ke=!0,!1;if(c.tag!==3&&(c.tag!==5||lA(c.type)&&!oe(c.type,c.memoizedProps))){var h=rn;if(h){if(lc(c)){for(c=rn;c;)c=zs(c);throw Error(o(418))}for(;h;)Jm(c,h),h=zs(h)}}if(tp(c),c.tag===13){if(!St)throw Error(o(316));if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));rn=rA(c)}else rn=nn?zs(c.stateNode):null;return!0}function ns(){St&&(rn=nn=null,qs=Ke=!1)}function cc(c){On===null?On=[c]:On.push(c)}function Qs(c,h,p){if(c=p.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(o(309));var v=p.stateNode}if(!v)throw Error(o(147,c));var S=v,_=""+c;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===_?h.ref:(h=function(b){var F=S.refs;F===Ym&&(F=S.refs={}),b===null?delete F[_]:F[_]=b},h._stringRef=_,h)}if(typeof c!="string")throw Error(o(284));if(!p._owner)throw Error(o(290,c))}return c}function ba(c,h){throw c=Object.prototype.toString.call(h),Error(o(31,c==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":c))}function np(c){var h=c._init;return h(c._payload)}function ip(c){function h(H,B){if(c){var j=H.deletions;j===null?(H.deletions=[B],H.flags|=16):j.push(B)}}function p(H,B){if(!c)return null;for(;B!==null;)h(H,B),B=B.sibling;return null}function v(H,B){for(H=new Map;B!==null;)B.key!==null?H.set(B.key,B):H.set(B.index,B),B=B.sibling;return H}function S(H,B){return H=zi(H,B),H.index=0,H.sibling=null,H}function _(H,B,j){return H.index=j,c?(j=H.alternate,j!==null?(j=j.index,j<B?(H.flags|=2,B):j):(H.flags|=2,B)):(H.flags|=1048576,B)}function b(H){return c&&H.alternate===null&&(H.flags|=2),H}function F(H,B,j,le){return B===null||B.tag!==6?(B=jc(j,H.mode,le),B.return=H,B):(B=S(B,j),B.return=H,B)}function Y(H,B,j,le){var de=j.type;return de===f?ue(H,B,j.props.children,le,j.key):B!==null&&(B.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===L&&np(de)===B.type)?(le=S(B,j.props),le.ref=Qs(H,B,j),le.return=H,le):(le=ul(j.type,j.key,j.props,null,H.mode,le),le.ref=Qs(H,B,j),le.return=H,le)}function ee(H,B,j,le){return B===null||B.tag!==4||B.stateNode.containerInfo!==j.containerInfo||B.stateNode.implementation!==j.implementation?(B=Yc(j,H.mode,le),B.return=H,B):(B=S(B,j.children||[]),B.return=H,B)}function ue(H,B,j,le,de){return B===null||B.tag!==7?(B=xr(j,H.mode,le,de),B.return=H,B):(B=S(B,j),B.return=H,B)}function Ee(H,B,j){if(typeof B=="string"&&B!==""||typeof B=="number")return B=jc(""+B,H.mode,j),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case l:return j=ul(B.type,B.key,B.props,null,H.mode,j),j.ref=Qs(H,null,B),j.return=H,j;case u:return B=Yc(B,H.mode,j),B.return=H,B;case L:var le=B._init;return Ee(H,le(B._payload),j)}if(J(B)||C(B))return B=xr(B,H.mode,j,null),B.return=H,B;ba(H,B)}return null}function pe(H,B,j,le){var de=B!==null?B.key:null;if(typeof j=="string"&&j!==""||typeof j=="number")return de!==null?null:F(H,B,""+j,le);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case l:return j.key===de?Y(H,B,j,le):null;case u:return j.key===de?ee(H,B,j,le):null;case L:return de=j._init,pe(H,B,de(j._payload),le)}if(J(j)||C(j))return de!==null?null:ue(H,B,j,le,null);ba(H,j)}return null}function $e(H,B,j,le,de){if(typeof le=="string"&&le!==""||typeof le=="number")return H=H.get(j)||null,F(B,H,""+le,de);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case l:return H=H.get(le.key===null?j:le.key)||null,Y(B,H,le,de);case u:return H=H.get(le.key===null?j:le.key)||null,ee(B,H,le,de);case L:var _e=le._init;return $e(H,B,j,_e(le._payload),de)}if(J(le)||C(le))return H=H.get(j)||null,ue(B,H,le,de,null);ba(B,le)}return null}function me(H,B,j,le){for(var de=null,_e=null,Se=B,ke=B=0,gt=null;Se!==null&&ke<j.length;ke++){Se.index>ke?(gt=Se,Se=null):gt=Se.sibling;var Oe=pe(H,Se,j[ke],le);if(Oe===null){Se===null&&(Se=gt);break}c&&Se&&Oe.alternate===null&&h(H,Se),B=_(Oe,B,ke),_e===null?de=Oe:_e.sibling=Oe,_e=Oe,Se=gt}if(ke===j.length)return p(H,Se),Ke&&pr(H,ke),de;if(Se===null){for(;ke<j.length;ke++)Se=Ee(H,j[ke],le),Se!==null&&(B=_(Se,B,ke),_e===null?de=Se:_e.sibling=Se,_e=Se);return Ke&&pr(H,ke),de}for(Se=v(H,Se);ke<j.length;ke++)gt=$e(Se,H,ke,j[ke],le),gt!==null&&(c&&gt.alternate!==null&&Se.delete(gt.key===null?ke:gt.key),B=_(gt,B,ke),_e===null?de=gt:_e.sibling=gt,_e=gt);return c&&Se.forEach(function(Wi){return h(H,Wi)}),Ke&&pr(H,ke),de}function Ct(H,B,j,le){var de=C(j);if(typeof de!="function")throw Error(o(150));if(j=de.call(j),j==null)throw Error(o(151));for(var _e=de=null,Se=B,ke=B=0,gt=null,Oe=j.next();Se!==null&&!Oe.done;ke++,Oe=j.next()){Se.index>ke?(gt=Se,Se=null):gt=Se.sibling;var Wi=pe(H,Se,Oe.value,le);if(Wi===null){Se===null&&(Se=gt);break}c&&Se&&Wi.alternate===null&&h(H,Se),B=_(Wi,B,ke),_e===null?de=Wi:_e.sibling=Wi,_e=Wi,Se=gt}if(Oe.done)return p(H,Se),Ke&&pr(H,ke),de;if(Se===null){for(;!Oe.done;ke++,Oe=j.next())Oe=Ee(H,Oe.value,le),Oe!==null&&(B=_(Oe,B,ke),_e===null?de=Oe:_e.sibling=Oe,_e=Oe);return Ke&&pr(H,ke),de}for(Se=v(H,Se);!Oe.done;ke++,Oe=j.next())Oe=$e(Se,H,ke,Oe.value,le),Oe!==null&&(c&&Oe.alternate!==null&&Se.delete(Oe.key===null?ke:Oe.key),B=_(Oe,B,ke),_e===null?de=Oe:_e.sibling=Oe,_e=Oe);return c&&Se.forEach(function(nL){return h(H,nL)}),Ke&&pr(H,ke),de}function xn(H,B,j,le){if(typeof j=="object"&&j!==null&&j.type===f&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case l:e:{for(var de=j.key,_e=B;_e!==null;){if(_e.key===de){if(de=j.type,de===f){if(_e.tag===7){p(H,_e.sibling),B=S(_e,j.props.children),B.return=H,H=B;break e}}else if(_e.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===L&&np(de)===_e.type){p(H,_e.sibling),B=S(_e,j.props),B.ref=Qs(H,_e,j),B.return=H,H=B;break e}p(H,_e);break}else h(H,_e);_e=_e.sibling}j.type===f?(B=xr(j.props.children,H.mode,le,j.key),B.return=H,H=B):(le=ul(j.type,j.key,j.props,null,H.mode,le),le.ref=Qs(H,B,j),le.return=H,H=le)}return b(H);case u:e:{for(_e=j.key;B!==null;){if(B.key===_e)if(B.tag===4&&B.stateNode.containerInfo===j.containerInfo&&B.stateNode.implementation===j.implementation){p(H,B.sibling),B=S(B,j.children||[]),B.return=H,H=B;break e}else{p(H,B);break}else h(H,B);B=B.sibling}B=Yc(j,H.mode,le),B.return=H,H=B}return b(H);case L:return _e=j._init,xn(H,B,_e(j._payload),le)}if(J(j))return me(H,B,j,le);if(C(j))return Ct(H,B,j,le);ba(H,j)}return typeof j=="string"&&j!==""||typeof j=="number"?(j=""+j,B!==null&&B.tag===6?(p(H,B.sibling),B=S(B,j),B.return=H,H=B):(p(H,B),B=jc(j,H.mode,le),B.return=H,H=B),b(H)):p(H,B)}return xn}var is=ip(!0),rp=ip(!1),Zs={},vn=Ni(Zs),Js=Ni(Zs),rs=Ni(Zs);function zn(c){if(c===Zs)throw Error(o(174));return c}function hc(c,h){Ge(rs,h),Ge(Js,c),Ge(vn,Zs),c=Q(h),He(vn),Ge(vn,c)}function ss(){He(vn),He(Js),He(rs)}function sp(c){var h=zn(rs.current),p=zn(vn.current);h=G(p,c.type,h),p!==h&&(Ge(Js,c),Ge(vn,h))}function fc(c){Js.current===c&&(He(vn),He(Js))}var Ye=Ni(0);function ka(c){for(var h=c;h!==null;){if(h.tag===13){var p=h.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||Fm(p)||Vu(p)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var dc=[];function mc(){for(var c=0;c<dc.length;c++){var h=dc[c];ut?h._workInProgressVersionPrimary=null:h._workInProgressVersionSecondary=null}dc.length=0}var Oa=a.ReactCurrentDispatcher,Tn=a.ReactCurrentBatchConfig,os=0,Je=null,Pt=null,pt=null,Ma=!1,eo=!1,to=0,IA=0;function Dt(){throw Error(o(321))}function pc(c,h){if(h===null)return!1;for(var p=0;p<h.length&&p<c.length;p++)if(!Gn(c[p],h[p]))return!1;return!0}function gc(c,h,p,v,S,_){if(os=_,Je=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Oa.current=c===null||c.memoizedState===null?CA:bA,c=p(v,S),eo){_=0;do{if(eo=!1,to=0,25<=_)throw Error(o(301));_+=1,pt=Pt=null,h.updateQueue=null,Oa.current=kA,c=p(v,S)}while(eo)}if(Oa.current=$a,h=Pt!==null&&Pt.next!==null,os=0,pt=Pt=Je=null,Ma=!1,h)throw Error(o(300));return c}function yc(){var c=to!==0;return to=0,c}function yi(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pt===null?Je.memoizedState=pt=c:pt=pt.next=c,pt}function Wn(){if(Pt===null){var c=Je.alternate;c=c!==null?c.memoizedState:null}else c=Pt.next;var h=pt===null?Je.memoizedState:pt.next;if(h!==null)pt=h,Pt=c;else{if(c===null)throw Error(o(310));Pt=c,c={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},pt===null?Je.memoizedState=pt=c:pt=pt.next=c}return pt}function gr(c,h){return typeof h=="function"?h(c):h}function Fa(c){var h=Wn(),p=h.queue;if(p===null)throw Error(o(311));p.lastRenderedReducer=c;var v=Pt,S=v.baseQueue,_=p.pending;if(_!==null){if(S!==null){var b=S.next;S.next=_.next,_.next=b}v.baseQueue=S=_,p.pending=null}if(S!==null){_=S.next,v=v.baseState;var F=b=null,Y=null,ee=_;do{var ue=ee.lane;if((os&ue)===ue)Y!==null&&(Y=Y.next={lane:0,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null}),v=ee.hasEagerState?ee.eagerState:c(v,ee.action);else{var Ee={lane:ue,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null};Y===null?(F=Y=Ee,b=v):Y=Y.next=Ee,Je.lanes|=ue,ls|=ue}ee=ee.next}while(ee!==null&&ee!==_);Y===null?b=v:Y.next=F,Gn(v,h.memoizedState)||(sn=!0),h.memoizedState=v,h.baseState=b,h.baseQueue=Y,p.lastRenderedState=v}if(c=p.interleaved,c!==null){S=c;do _=S.lane,Je.lanes|=_,ls|=_,S=S.next;while(S!==c)}else S===null&&(p.lanes=0);return[h.memoizedState,p.dispatch]}function Na(c){var h=Wn(),p=h.queue;if(p===null)throw Error(o(311));p.lastRenderedReducer=c;var v=p.dispatch,S=p.pending,_=h.memoizedState;if(S!==null){p.pending=null;var b=S=S.next;do _=c(_,b.action),b=b.next;while(b!==S);Gn(_,h.memoizedState)||(sn=!0),h.memoizedState=_,h.baseQueue===null&&(h.baseState=_),p.lastRenderedState=_}return[_,v]}function op(){}function ap(c,h){var p=Je,v=Wn(),S=h(),_=!Gn(v.memoizedState,S);if(_&&(v.memoizedState=S,sn=!0),v=v.queue,io(cp.bind(null,p,v,c),[c]),v.getSnapshot!==h||_||pt!==null&&pt.memoizedState.tag&1){if(p.flags|=2048,no(9,up.bind(null,p,v,S,h),void 0,null),st===null)throw Error(o(349));(os&30)!==0||lp(p,h,S)}return S}function lp(c,h,p){c.flags|=16384,c={getSnapshot:h,value:p},h=Je.updateQueue,h===null?(h={lastEffect:null,stores:null},Je.updateQueue=h,h.stores=[c]):(p=h.stores,p===null?h.stores=[c]:p.push(c))}function up(c,h,p,v){h.value=p,h.getSnapshot=v,hp(h)&&En(c,1,-1)}function cp(c,h,p){return p(function(){hp(h)&&En(c,1,-1)})}function hp(c){var h=c.getSnapshot;c=c.value;try{var p=h();return!Gn(c,p)}catch{return!0}}function vc(c){var h=yi();return typeof c=="function"&&(c=c()),h.memoizedState=h.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gr,lastRenderedState:c},h.queue=c,c=c.dispatch=wA.bind(null,Je,c),[h.memoizedState,c]}function no(c,h,p,v){return c={tag:c,create:h,destroy:p,deps:v,next:null},h=Je.updateQueue,h===null?(h={lastEffect:null,stores:null},Je.updateQueue=h,h.lastEffect=c.next=c):(p=h.lastEffect,p===null?h.lastEffect=c.next=c:(v=p.next,p.next=c,c.next=v,h.lastEffect=c)),c}function fp(){return Wn().memoizedState}function Ba(c,h,p,v){var S=yi();Je.flags|=c,S.memoizedState=no(1|h,p,void 0,v===void 0?null:v)}function Ua(c,h,p,v){var S=Wn();v=v===void 0?null:v;var _=void 0;if(Pt!==null){var b=Pt.memoizedState;if(_=b.destroy,v!==null&&pc(v,b.deps)){S.memoizedState=no(h,p,_,v);return}}Je.flags|=c,S.memoizedState=no(1|h,p,_,v)}function Tc(c,h){return Ba(8390656,8,c,h)}function io(c,h){return Ua(2048,8,c,h)}function dp(c,h){return Ua(4,2,c,h)}function mp(c,h){return Ua(4,4,c,h)}function pp(c,h){if(typeof h=="function")return c=c(),h(c),function(){h(null)};if(h!=null)return c=c(),h.current=c,function(){h.current=null}}function gp(c,h,p){return p=p!=null?p.concat([c]):null,Ua(4,4,pp.bind(null,h,c),p)}function Ec(){}function yp(c,h){var p=Wn();h=h===void 0?null:h;var v=p.memoizedState;return v!==null&&h!==null&&pc(h,v[1])?v[0]:(p.memoizedState=[c,h],c)}function vp(c,h){var p=Wn();h=h===void 0?null:h;var v=p.memoizedState;return v!==null&&h!==null&&pc(h,v[1])?v[0]:(c=c(),p.memoizedState=[c,h],c)}function PA(c,h){var p=be;be=p!==0&&4>p?p:4,c(!0);var v=Tn.transition;Tn.transition={};try{c(!1),h()}finally{be=p,Tn.transition=v}}function Tp(){return Wn().memoizedState}function DA(c,h,p){var v=Hi(c);p={lane:v,action:p,hasEagerState:!1,eagerState:null,next:null},Ep(c)?Sp(h,p):(xp(c,h,p),p=Bt(),c=En(c,v,p),c!==null&&_p(c,h,v))}function wA(c,h,p){var v=Hi(c),S={lane:v,action:p,hasEagerState:!1,eagerState:null,next:null};if(Ep(c))Sp(h,S);else{xp(c,h,S);var _=c.alternate;if(c.lanes===0&&(_===null||_.lanes===0)&&(_=h.lastRenderedReducer,_!==null))try{var b=h.lastRenderedState,F=_(b,p);if(S.hasEagerState=!0,S.eagerState=F,Gn(F,b))return}catch{}finally{}p=Bt(),c=En(c,v,p),c!==null&&_p(c,h,v)}}function Ep(c){var h=c.alternate;return c===Je||h!==null&&h===Je}function Sp(c,h){eo=Ma=!0;var p=c.pending;p===null?h.next=h:(h.next=p.next,p.next=h),c.pending=h}function xp(c,h,p){st!==null&&(c.mode&1)!==0&&(Ae&2)===0?(c=h.interleaved,c===null?(p.next=p,Kn===null?Kn=[h]:Kn.push(h)):(p.next=c.next,c.next=p),h.interleaved=p):(c=h.pending,c===null?p.next=p:(p.next=c.next,c.next=p),h.pending=p)}function _p(c,h,p){if((p&4194240)!==0){var v=h.lanes;v&=c.pendingLanes,p|=v,h.lanes=p,Yu(c,p)}}var $a={readContext:pn,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useInsertionEffect:Dt,useLayoutEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useMutableSource:Dt,useSyncExternalStore:Dt,useId:Dt,unstable_isNewReconciler:!1},CA={readContext:pn,useCallback:function(c,h){return yi().memoizedState=[c,h===void 0?null:h],c},useContext:pn,useEffect:Tc,useImperativeHandle:function(c,h,p){return p=p!=null?p.concat([c]):null,Ba(4194308,4,pp.bind(null,h,c),p)},useLayoutEffect:function(c,h){return Ba(4194308,4,c,h)},useInsertionEffect:function(c,h){return Ba(4,2,c,h)},useMemo:function(c,h){var p=yi();return h=h===void 0?null:h,c=c(),p.memoizedState=[c,h],c},useReducer:function(c,h,p){var v=yi();return h=p!==void 0?p(h):h,v.memoizedState=v.baseState=h,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:h},v.queue=c,c=c.dispatch=DA.bind(null,Je,c),[v.memoizedState,c]},useRef:function(c){var h=yi();return c={current:c},h.memoizedState=c},useState:vc,useDebugValue:Ec,useDeferredValue:function(c){var h=vc(c),p=h[0],v=h[1];return Tc(function(){var S=Tn.transition;Tn.transition={};try{v(c)}finally{Tn.transition=S}},[c]),p},useTransition:function(){var c=vc(!1),h=c[0];return c=PA.bind(null,c[1]),yi().memoizedState=c,[h,c]},useMutableSource:function(){},useSyncExternalStore:function(c,h,p){var v=Je,S=yi();if(Ke){if(p===void 0)throw Error(o(407));p=p()}else{if(p=h(),st===null)throw Error(o(349));(os&30)!==0||lp(v,h,p)}S.memoizedState=p;var _={value:p,getSnapshot:h};return S.queue=_,Tc(cp.bind(null,v,_,c),[c]),v.flags|=2048,no(9,up.bind(null,v,_,p,h),void 0,null),p},useId:function(){var c=yi(),h=st.identifierPrefix;if(Ke){var p=gi,v=pi;p=(v&~(1<<32-bn(v)-1)).toString(32)+p,h=":"+h+"R"+p,p=to++,0<p&&(h+="H"+p.toString(32)),h+=":"}else p=IA++,h=":"+h+"r"+p.toString(32)+":";return c.memoizedState=h},unstable_isNewReconciler:!1},bA={readContext:pn,useCallback:yp,useContext:pn,useEffect:io,useImperativeHandle:gp,useInsertionEffect:dp,useLayoutEffect:mp,useMemo:vp,useReducer:Fa,useRef:fp,useState:function(){return Fa(gr)},useDebugValue:Ec,useDeferredValue:function(c){var h=Fa(gr),p=h[0],v=h[1];return io(function(){var S=Tn.transition;Tn.transition={};try{v(c)}finally{Tn.transition=S}},[c]),p},useTransition:function(){var c=Fa(gr)[0],h=Wn().memoizedState;return[c,h]},useMutableSource:op,useSyncExternalStore:ap,useId:Tp,unstable_isNewReconciler:!1},kA={readContext:pn,useCallback:yp,useContext:pn,useEffect:io,useImperativeHandle:gp,useInsertionEffect:dp,useLayoutEffect:mp,useMemo:vp,useReducer:Na,useRef:fp,useState:function(){return Na(gr)},useDebugValue:Ec,useDeferredValue:function(c){var h=Na(gr),p=h[0],v=h[1];return io(function(){var S=Tn.transition;Tn.transition={};try{v(c)}finally{Tn.transition=S}},[c]),p},useTransition:function(){var c=Na(gr)[0],h=Wn().memoizedState;return[c,h]},useMutableSource:op,useSyncExternalStore:ap,useId:Tp,unstable_isNewReconciler:!1};function Sc(c,h){try{var p="",v=h;do p+=RA(v),v=v.return;while(v);var S=p}catch(_){S=`
Error generating stack: `+_.message+`
`+_.stack}return{value:c,source:h,stack:S}}function xc(c,h){try{console.error(h.value)}catch(p){setTimeout(function(){throw p})}}var OA=typeof WeakMap=="function"?WeakMap:Map;function Ap(c,h,p){p=mi(-1,p),p.tag=3,p.payload={element:null};var v=h.value;return p.callback=function(){nl||(nl=!0,$c=v),xc(c,h)},p}function Lp(c,h,p){p=mi(-1,p),p.tag=3;var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var S=h.value;p.payload=function(){return v(S)},p.callback=function(){xc(c,h)}}var _=c.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(p.callback=function(){xc(c,h),typeof v!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var b=h.stack;this.componentDidCatch(h.value,{componentStack:b!==null?b:""})}),p}function Rp(c,h,p){var v=c.pingCache;if(v===null){v=c.pingCache=new OA;var S=new Set;v.set(h,S)}else S=v.get(h),S===void 0&&(S=new Set,v.set(h,S));S.has(p)||(S.add(p),c=YA.bind(null,c,h,p),h.then(c,c))}function Ip(c){do{var h;if((h=c.tag===13)&&(h=c.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return c;c=c.return}while(c!==null);return null}function Pp(c,h,p,v,S){return(c.mode&1)===0?(c===h?c.flags|=65536:(c.flags|=128,p.flags|=131072,p.flags&=-52805,p.tag===1&&(p.alternate===null?p.tag=17:(h=mi(-1,1),h.tag=2,$i(p,h))),p.lanes|=1),c):(c.flags|=65536,c.lanes=S,c)}function jn(c){c.flags|=4}function Dp(c,h){if(c!==null&&c.child===h.child)return!0;if((h.flags&16)!==0)return!1;for(c=h.child;c!==null;){if((c.flags&12854)!==0||(c.subtreeFlags&12854)!==0)return!1;c=c.sibling}return!0}var ro,so,Va,Ga;if(tn)ro=function(c,h){for(var p=h.child;p!==null;){if(p.tag===5||p.tag===6)V(c,p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===h)break;for(;p.sibling===null;){if(p.return===null||p.return===h)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},so=function(){},Va=function(c,h,p,v,S){if(c=c.memoizedProps,c!==v){var _=h.stateNode,b=zn(vn.current);p=re(_,p,c,v,S,b),(h.updateQueue=p)&&jn(h)}},Ga=function(c,h,p,v){p!==v&&jn(h)};else if(qr){ro=function(c,h,p,v){for(var S=h.child;S!==null;){if(S.tag===5){var _=S.stateNode;p&&v&&(_=Om(_,S.type,S.memoizedProps,S)),V(c,_)}else if(S.tag===6)_=S.stateNode,p&&v&&(_=Mm(_,S.memoizedProps,S)),V(c,_);else if(S.tag!==4){if(S.tag===22&&S.memoizedState!==null)_=S.child,_!==null&&(_.return=S),ro(c,S,!0,!0);else if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===h)break;for(;S.sibling===null;){if(S.return===null||S.return===h)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};var wp=function(c,h,p,v){for(var S=h.child;S!==null;){if(S.tag===5){var _=S.stateNode;p&&v&&(_=Om(_,S.type,S.memoizedProps,S)),bm(c,_)}else if(S.tag===6)_=S.stateNode,p&&v&&(_=Mm(_,S.memoizedProps,S)),bm(c,_);else if(S.tag!==4){if(S.tag===22&&S.memoizedState!==null)_=S.child,_!==null&&(_.return=S),wp(c,S,!0,!0);else if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===h)break;for(;S.sibling===null;){if(S.return===null||S.return===h)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};so=function(c,h){var p=h.stateNode;if(!Dp(c,h)){c=p.containerInfo;var v=Cm(c);wp(v,h,!1,!1),p.pendingChildren=v,jn(h),j_(c,v)}},Va=function(c,h,p,v,S){var _=c.stateNode,b=c.memoizedProps;if((c=Dp(c,h))&&b===v)h.stateNode=_;else{var F=h.stateNode,Y=zn(vn.current),ee=null;b!==v&&(ee=re(F,p,b,v,S,Y)),c&&ee===null?h.stateNode=_:(_=W_(_,ee,p,b,v,h,c,F),ne(_,p,v,S,Y)&&jn(h),h.stateNode=_,c?jn(h):ro(_,h,!1,!1))}},Ga=function(c,h,p,v){p!==v?(c=zn(rs.current),p=zn(vn.current),h.stateNode=fe(v,c,p,h),jn(h)):h.stateNode=c.stateNode}}else so=function(){},Va=function(){},Ga=function(){};function oo(c,h){if(!Ke)switch(c.tailMode){case"hidden":h=c.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?c.tail=null:p.sibling=null;break;case"collapsed":p=c.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?h||c.tail===null?c.tail=null:c.tail.sibling=null:v.sibling=null}}function wt(c){var h=c.alternate!==null&&c.alternate.child===c.child,p=0,v=0;if(h)for(var S=c.child;S!==null;)p|=S.lanes|S.childLanes,v|=S.subtreeFlags&14680064,v|=S.flags&14680064,S.return=c,S=S.sibling;else for(S=c.child;S!==null;)p|=S.lanes|S.childLanes,v|=S.subtreeFlags,v|=S.flags,S.return=c,S=S.sibling;return c.subtreeFlags|=v,c.childLanes=p,h}function MA(c,h,p){var v=h.pendingProps;switch(ac(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(h),null;case 1:return Kt(h.type)&&ya(),wt(h),null;case 3:return v=h.stateNode,ss(),He(Ht),He(It),mc(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(c===null||c.child===null)&&(Xs(h)?jn(h):c===null||c.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,On!==null&&(Hc(On),On=null))),so(c,h),wt(h),null;case 5:fc(h),p=zn(rs.current);var S=h.type;if(c!==null&&h.stateNode!=null)Va(c,h,S,v,p),c.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!v){if(h.stateNode===null)throw Error(o(166));return wt(h),null}if(c=zn(vn.current),Xs(h)){if(!St)throw Error(o(175));c=tA(h.stateNode,h.type,h.memoizedProps,p,c,h,!qs),h.updateQueue=c,c!==null&&jn(h)}else{var _=M(S,v,p,c,h);ro(_,h,!1,!1),h.stateNode=_,ne(_,S,v,p,c)&&jn(h)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return wt(h),null;case 6:if(c&&h.stateNode!=null)Ga(c,h,c.memoizedProps,v);else{if(typeof v!="string"&&h.stateNode===null)throw Error(o(166));if(c=zn(rs.current),p=zn(vn.current),Xs(h)){if(!St)throw Error(o(176));if(c=h.stateNode,v=h.memoizedProps,(p=nA(c,v,h,!qs))&&(S=nn,S!==null))switch(_=(S.mode&1)!==0,S.tag){case 3:uA(S.stateNode.containerInfo,c,v,_);break;case 5:cA(S.type,S.memoizedProps,S.stateNode,c,v,_)}p&&jn(h)}else h.stateNode=fe(v,c,p,h)}return wt(h),null;case 13:if(He(Ye),v=h.memoizedState,Ke&&rn!==null&&(h.mode&1)!==0&&(h.flags&128)===0){for(c=rn;c;)c=zs(c);return ns(),h.flags|=98560,h}if(v!==null&&v.dehydrated!==null){if(v=Xs(h),c===null){if(!v)throw Error(o(318));if(!St)throw Error(o(344));if(c=h.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));iA(c,h)}else ns(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;return wt(h),null}return On!==null&&(Hc(On),On=null),(h.flags&128)!==0?(h.lanes=p,h):(v=v!==null,p=!1,c===null?Xs(h):p=c.memoizedState!==null,v&&!p&&(h.child.flags|=8192,(h.mode&1)!==0&&(c===null||(Ye.current&1)!==0?ct===0&&(ct=3):zc())),h.updateQueue!==null&&(h.flags|=4),wt(h),null);case 4:return ss(),so(c,h),c===null&&Dm(h.stateNode.containerInfo),wt(h),null;case 10:return tc(h.type._context),wt(h),null;case 17:return Kt(h.type)&&ya(),wt(h),null;case 19:if(He(Ye),S=h.memoizedState,S===null)return wt(h),null;if(v=(h.flags&128)!==0,_=S.rendering,_===null)if(v)oo(S,!1);else{if(ct!==0||c!==null&&(c.flags&128)!==0)for(c=h.child;c!==null;){if(_=ka(c),_!==null){for(h.flags|=128,oo(S,!1),c=_.updateQueue,c!==null&&(h.updateQueue=c,h.flags|=4),h.subtreeFlags=0,c=p,v=h.child;v!==null;)p=v,S=c,p.flags&=14680066,_=p.alternate,_===null?(p.childLanes=0,p.lanes=S,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=_.childLanes,p.lanes=_.lanes,p.child=_.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=_.memoizedProps,p.memoizedState=_.memoizedState,p.updateQueue=_.updateQueue,p.type=_.type,S=_.dependencies,p.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),v=v.sibling;return Ge(Ye,Ye.current&1|2),h.child}c=c.sibling}S.tail!==null&&mt()>Uc&&(h.flags|=128,v=!0,oo(S,!1),h.lanes=4194304)}else{if(!v)if(c=ka(_),c!==null){if(h.flags|=128,v=!0,c=c.updateQueue,c!==null&&(h.updateQueue=c,h.flags|=4),oo(S,!0),S.tail===null&&S.tailMode==="hidden"&&!_.alternate&&!Ke)return wt(h),null}else 2*mt()-S.renderingStartTime>Uc&&p!==1073741824&&(h.flags|=128,v=!0,oo(S,!1),h.lanes=4194304);S.isBackwards?(_.sibling=h.child,h.child=_):(c=S.last,c!==null?c.sibling=_:h.child=_,S.last=_)}return S.tail!==null?(h=S.tail,S.rendering=h,S.tail=h.sibling,S.renderingStartTime=mt(),h.sibling=null,c=Ye.current,Ge(Ye,v?c&1|2:c&1),h):(wt(h),null);case 22:case 23:return Kc(),v=h.memoizedState!==null,c!==null&&c.memoizedState!==null!==v&&(h.flags|=8192),v&&(h.mode&1)!==0?(on&1073741824)!==0&&(wt(h),tn&&h.subtreeFlags&6&&(h.flags|=8192)):wt(h),null;case 24:return null;case 25:return null}throw Error(o(156,h.tag))}var FA=a.ReactCurrentOwner,sn=!1;function Nt(c,h,p,v){h.child=c===null?rp(h,null,p,v):is(h,c.child,p,v)}function Cp(c,h,p,v,S){p=p.render;var _=h.ref;return Jr(h,S),v=gc(c,h,p,v,_,S),p=yc(),c!==null&&!sn?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~S,vi(c,h,S)):(Ke&&p&&oc(h),h.flags|=1,Nt(c,h,v,S),h.child)}function bp(c,h,p,v,S){if(c===null){var _=p.type;return typeof _=="function"&&!Wc(_)&&_.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(h.tag=15,h.type=_,kp(c,h,_,v,S)):(c=ul(p.type,null,v,h,h.mode,S),c.ref=h.ref,c.return=h,h.child=c)}if(_=c.child,(c.lanes&S)===0){var b=_.memoizedProps;if(p=p.compare,p=p!==null?p:Aa,p(b,v)&&c.ref===h.ref)return vi(c,h,S)}return h.flags|=1,c=zi(_,v),c.ref=h.ref,c.return=h,h.child=c}function kp(c,h,p,v,S){if(c!==null&&Aa(c.memoizedProps,v)&&c.ref===h.ref)if(sn=!1,(c.lanes&S)!==0)(c.flags&131072)!==0&&(sn=!0);else return h.lanes=c.lanes,vi(c,h,S);return _c(c,h,p,v,S)}function Op(c,h,p){var v=h.pendingProps,S=v.children,_=c!==null?c.memoizedState:null;if(v.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null},Ge(as,on),on|=p;else if((p&1073741824)!==0)h.memoizedState={baseLanes:0,cachePool:null},v=_!==null?_.baseLanes:p,Ge(as,on),on|=v;else return c=_!==null?_.baseLanes|p:p,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:c,cachePool:null},h.updateQueue=null,Ge(as,on),on|=c,null;else _!==null?(v=_.baseLanes|p,h.memoizedState=null):v=p,Ge(as,on),on|=v;return Nt(c,h,S,p),h.child}function Mp(c,h){var p=h.ref;(c===null&&p!==null||c!==null&&c.ref!==p)&&(h.flags|=512,h.flags|=2097152)}function _c(c,h,p,v,S){var _=Kt(p)?dr:It.current;return _=Qr(h,_),Jr(h,S),p=gc(c,h,p,v,_,S),v=yc(),c!==null&&!sn?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~S,vi(c,h,S)):(Ke&&v&&oc(h),h.flags|=1,Nt(c,h,p,S),h.child)}function Fp(c,h,p,v,S){if(Kt(p)){var _=!0;va(h)}else _=!1;if(Jr(h,S),h.stateNode===null)c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2),Xm(h,p,v),sc(h,p,v,S),v=!0;else if(c===null){var b=h.stateNode,F=h.memoizedProps;b.props=F;var Y=b.context,ee=p.contextType;typeof ee=="object"&&ee!==null?ee=pn(ee):(ee=Kt(p)?dr:It.current,ee=Qr(h,ee));var ue=p.getDerivedStateFromProps,Ee=typeof ue=="function"||typeof b.getSnapshotBeforeUpdate=="function";Ee||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(F!==v||Y!==ee)&&Qm(h,b,v,ee),Ui=!1;var pe=h.memoizedState;b.state=pe,Pa(h,v,b,S),Y=h.memoizedState,F!==v||pe!==Y||Ht.current||Ui?(typeof ue=="function"&&(rc(h,p,ue,v),Y=h.memoizedState),(F=Ui||qm(h,p,F,v,pe,Y,ee))?(Ee||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(h.flags|=4194308)):(typeof b.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=v,h.memoizedState=Y),b.props=v,b.state=Y,b.context=ee,v=F):(typeof b.componentDidMount=="function"&&(h.flags|=4194308),v=!1)}else{b=h.stateNode,zm(c,h),F=h.memoizedProps,ee=h.type===h.elementType?F:kn(h.type,F),b.props=ee,Ee=h.pendingProps,pe=b.context,Y=p.contextType,typeof Y=="object"&&Y!==null?Y=pn(Y):(Y=Kt(p)?dr:It.current,Y=Qr(h,Y));var $e=p.getDerivedStateFromProps;(ue=typeof $e=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(F!==Ee||pe!==Y)&&Qm(h,b,v,Y),Ui=!1,pe=h.memoizedState,b.state=pe,Pa(h,v,b,S);var me=h.memoizedState;F!==Ee||pe!==me||Ht.current||Ui?(typeof $e=="function"&&(rc(h,p,$e,v),me=h.memoizedState),(ee=Ui||qm(h,p,ee,v,pe,me,Y)||!1)?(ue||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(v,me,Y),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(v,me,Y)),typeof b.componentDidUpdate=="function"&&(h.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof b.componentDidUpdate!="function"||F===c.memoizedProps&&pe===c.memoizedState||(h.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||F===c.memoizedProps&&pe===c.memoizedState||(h.flags|=1024),h.memoizedProps=v,h.memoizedState=me),b.props=v,b.state=me,b.context=Y,v=ee):(typeof b.componentDidUpdate!="function"||F===c.memoizedProps&&pe===c.memoizedState||(h.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||F===c.memoizedProps&&pe===c.memoizedState||(h.flags|=1024),v=!1)}return Ac(c,h,p,v,_,S)}function Ac(c,h,p,v,S,_){Mp(c,h);var b=(h.flags&128)!==0;if(!v&&!b)return S&&$m(h,p,!1),vi(c,h,_);v=h.stateNode,FA.current=h;var F=b&&typeof p.getDerivedStateFromError!="function"?null:v.render();return h.flags|=1,c!==null&&b?(h.child=is(h,c.child,null,_),h.child=is(h,null,F,_)):Nt(c,h,F,_),h.memoizedState=v.state,S&&$m(h,p,!0),h.child}function Np(c){var h=c.stateNode;h.pendingContext?Bm(c,h.pendingContext,h.pendingContext!==h.context):h.context&&Bm(c,h.context,!1),hc(c,h.containerInfo)}function Bp(c,h,p,v,S){return ns(),cc(S),h.flags|=256,Nt(c,h,p,v),h.child}var Ha={dehydrated:null,treeContext:null,retryLane:0};function Ka(c){return{baseLanes:c,cachePool:null}}function Up(c,h,p){var v=h.pendingProps,S=Ye.current,_=!1,b=(h.flags&128)!==0,F;if((F=b)||(F=c!==null&&c.memoizedState===null?!1:(S&2)!==0),F?(_=!0,h.flags&=-129):(c===null||c.memoizedState!==null)&&(S|=1),Ge(Ye,S&1),c===null)return uc(h),c=h.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?((h.mode&1)===0?h.lanes=1:Vu(c)?h.lanes=8:h.lanes=1073741824,null):(S=v.children,c=v.fallback,_?(v=h.mode,_=h.child,S={mode:"hidden",children:S},(v&1)===0&&_!==null?(_.childLanes=0,_.pendingProps=S):_=cl(S,v,0,null),c=xr(c,v,p,null),_.return=h,c.return=h,_.sibling=c,h.child=_,h.child.memoizedState=Ka(p),h.memoizedState=Ha,c):Lc(h,S));if(S=c.memoizedState,S!==null){if(F=S.dehydrated,F!==null){if(b)return h.flags&256?(h.flags&=-257,za(c,h,p,Error(o(422)))):h.memoizedState!==null?(h.child=c.child,h.flags|=128,null):(_=v.fallback,S=h.mode,v=cl({mode:"visible",children:v.children},S,0,null),_=xr(_,S,p,null),_.flags|=2,v.return=h,_.return=h,v.sibling=_,h.child=v,(h.mode&1)!==0&&is(h,c.child,null,p),h.child.memoizedState=Ka(p),h.memoizedState=Ha,_);if((h.mode&1)===0)h=za(c,h,p,null);else if(Vu(F))h=za(c,h,p,Error(o(419)));else if(v=(p&c.childLanes)!==0,sn||v){if(v=st,v!==null){switch(p&-p){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}v=(_&(v.suspendedLanes|p))!==0?0:_,v!==0&&v!==S.retryLane&&(S.retryLane=v,En(c,v,-1))}zc(),h=za(c,h,p,Error(o(421)))}else Fm(F)?(h.flags|=128,h.child=c.child,h=qA.bind(null,c),Q_(F,h),h=null):(p=S.treeContext,St&&(rn=eA(F),nn=h,Ke=!0,On=null,qs=!1,p!==null&&(gn[yn++]=pi,gn[yn++]=gi,gn[yn++]=mr,pi=p.id,gi=p.overflow,mr=h)),h=Lc(h,h.pendingProps.children),h.flags|=4096);return h}return _?(v=Vp(c,h,v.children,v.fallback,p),_=h.child,S=c.child.memoizedState,_.memoizedState=S===null?Ka(p):{baseLanes:S.baseLanes|p,cachePool:null},_.childLanes=c.childLanes&~p,h.memoizedState=Ha,v):(p=$p(c,h,v.children,p),h.memoizedState=null,p)}return _?(v=Vp(c,h,v.children,v.fallback,p),_=h.child,S=c.child.memoizedState,_.memoizedState=S===null?Ka(p):{baseLanes:S.baseLanes|p,cachePool:null},_.childLanes=c.childLanes&~p,h.memoizedState=Ha,v):(p=$p(c,h,v.children,p),h.memoizedState=null,p)}function Lc(c,h){return h=cl({mode:"visible",children:h},c.mode,0,null),h.return=c,c.child=h}function $p(c,h,p,v){var S=c.child;return c=S.sibling,p=zi(S,{mode:"visible",children:p}),(h.mode&1)===0&&(p.lanes=v),p.return=h,p.sibling=null,c!==null&&(v=h.deletions,v===null?(h.deletions=[c],h.flags|=16):v.push(c)),h.child=p}function Vp(c,h,p,v,S){var _=h.mode;c=c.child;var b=c.sibling,F={mode:"hidden",children:p};return(_&1)===0&&h.child!==c?(p=h.child,p.childLanes=0,p.pendingProps=F,h.deletions=null):(p=zi(c,F),p.subtreeFlags=c.subtreeFlags&14680064),b!==null?v=zi(b,v):(v=xr(v,_,S,null),v.flags|=2),v.return=h,p.return=h,p.sibling=v,h.child=p,v}function za(c,h,p,v){return v!==null&&cc(v),is(h,c.child,null,p),c=Lc(h,h.pendingProps.children),c.flags|=2,h.memoizedState=null,c}function Gp(c,h,p){c.lanes|=h;var v=c.alternate;v!==null&&(v.lanes|=h),nc(c.return,h,p)}function Rc(c,h,p,v,S){var _=c.memoizedState;_===null?c.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:v,tail:p,tailMode:S}:(_.isBackwards=h,_.rendering=null,_.renderingStartTime=0,_.last=v,_.tail=p,_.tailMode=S)}function Hp(c,h,p){var v=h.pendingProps,S=v.revealOrder,_=v.tail;if(Nt(c,h,v.children,p),v=Ye.current,(v&2)!==0)v=v&1|2,h.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=h.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Gp(c,p,h);else if(c.tag===19)Gp(c,p,h);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===h)break e;for(;c.sibling===null;){if(c.return===null||c.return===h)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}v&=1}if(Ge(Ye,v),(h.mode&1)===0)h.memoizedState=null;else switch(S){case"forwards":for(p=h.child,S=null;p!==null;)c=p.alternate,c!==null&&ka(c)===null&&(S=p),p=p.sibling;p=S,p===null?(S=h.child,h.child=null):(S=p.sibling,p.sibling=null),Rc(h,!1,S,p,_);break;case"backwards":for(p=null,S=h.child,h.child=null;S!==null;){if(c=S.alternate,c!==null&&ka(c)===null){h.child=S;break}c=S.sibling,S.sibling=p,p=S,S=c}Rc(h,!0,p,null,_);break;case"together":Rc(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function vi(c,h,p){if(c!==null&&(h.dependencies=c.dependencies),ls|=h.lanes,(p&h.childLanes)===0)return null;if(c!==null&&h.child!==c.child)throw Error(o(153));if(h.child!==null){for(c=h.child,p=zi(c,c.pendingProps),h.child=p,p.return=h;c.sibling!==null;)c=c.sibling,p=p.sibling=zi(c,c.pendingProps),p.return=h;p.sibling=null}return h.child}function NA(c,h,p){switch(h.tag){case 3:Np(h),ns();break;case 5:sp(h);break;case 1:Kt(h.type)&&va(h);break;case 4:hc(h,h.stateNode.containerInfo);break;case 10:Km(h,h.type._context,h.memoizedProps.value);break;case 13:var v=h.memoizedState;if(v!==null)return v.dehydrated!==null?(Ge(Ye,Ye.current&1),h.flags|=128,null):(p&h.child.childLanes)!==0?Up(c,h,p):(Ge(Ye,Ye.current&1),c=vi(c,h,p),c!==null?c.sibling:null);Ge(Ye,Ye.current&1);break;case 19:if(v=(p&h.childLanes)!==0,(c.flags&128)!==0){if(v)return Hp(c,h,p);h.flags|=128}var S=h.memoizedState;if(S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),Ge(Ye,Ye.current),v)break;return null;case 22:case 23:return h.lanes=0,Op(c,h,p)}return vi(c,h,p)}function BA(c,h){switch(ac(h),h.tag){case 1:return Kt(h.type)&&ya(),c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 3:return ss(),He(Ht),He(It),mc(),c=h.flags,(c&65536)!==0&&(c&128)===0?(h.flags=c&-65537|128,h):null;case 5:return fc(h),null;case 13:if(He(Ye),c=h.memoizedState,c!==null&&c.dehydrated!==null){if(h.alternate===null)throw Error(o(340));ns()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 19:return He(Ye),null;case 4:return ss(),null;case 10:return tc(h.type._context),null;case 22:case 23:return Kc(),null;case 24:return null;default:return null}}var Wa=!1,yr=!1,UA=typeof WeakSet=="function"?WeakSet:Set,se=null;function ja(c,h){var p=c.ref;if(p!==null)if(typeof p=="function")try{p(null)}catch(v){jt(c,h,v)}else p.current=null}function Ic(c,h,p){try{p()}catch(v){jt(c,h,v)}}var Kp=!1;function $A(c,h){for(K(c.containerInfo),se=h;se!==null;)if(c=se,h=c.child,(c.subtreeFlags&1028)!==0&&h!==null)h.return=c,se=h;else for(;se!==null;){c=se;try{var p=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,S=p.memoizedState,_=c.stateNode,b=_.getSnapshotBeforeUpdate(c.elementType===c.type?v:kn(c.type,v),S);_.__reactInternalSnapshotBeforeUpdate=b}break;case 3:tn&&z_(c.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(F){jt(c,c.return,F)}if(h=c.sibling,h!==null){h.return=c.return,se=h;break}se=c.return}return p=Kp,Kp=!1,p}function vr(c,h,p){var v=h.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var S=v=v.next;do{if((S.tag&c)===c){var _=S.destroy;S.destroy=void 0,_!==void 0&&Ic(h,p,_)}S=S.next}while(S!==v)}}function ao(c,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&c)===c){var v=p.create;p.destroy=v()}p=p.next}while(p!==h)}}function Pc(c){var h=c.ref;if(h!==null){var p=c.stateNode;switch(c.tag){case 5:c=Z(p);break;default:c=p}typeof h=="function"?h(c):h.current=c}}function zp(c,h,p){if(Vn&&typeof Vn.onCommitFiberUnmount=="function")try{Vn.onCommitFiberUnmount(xa,h)}catch{}switch(h.tag){case 0:case 11:case 14:case 15:if(c=h.updateQueue,c!==null&&(c=c.lastEffect,c!==null)){var v=c=c.next;do{var S=v,_=S.destroy;S=S.tag,_!==void 0&&((S&2)!==0||(S&4)!==0)&&Ic(h,p,_),v=v.next}while(v!==c)}break;case 1:if(ja(h,p),c=h.stateNode,typeof c.componentWillUnmount=="function")try{c.props=h.memoizedProps,c.state=h.memoizedState,c.componentWillUnmount()}catch(b){jt(h,p,b)}break;case 5:ja(h,p);break;case 4:tn?Qp(c,h,p):qr&&qr&&(h=h.stateNode.containerInfo,p=Cm(h),km(h,p))}}function Wp(c,h,p){for(var v=h;;)if(zp(c,v,p),v.child===null||tn&&v.tag===4){if(v===h)break;for(;v.sibling===null;){if(v.return===null||v.return===h)return;v=v.return}v.sibling.return=v.return,v=v.sibling}else v.child.return=v,v=v.child}function jp(c){var h=c.alternate;h!==null&&(c.alternate=null,jp(h)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(h=c.stateNode,h!==null&&dt(h)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function Yp(c){return c.tag===5||c.tag===3||c.tag===4}function qp(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||Yp(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Xp(c){if(tn){e:{for(var h=c.return;h!==null;){if(Yp(h))break e;h=h.return}throw Error(o(160))}var p=h;switch(p.tag){case 5:h=p.stateNode,p.flags&32&&(wm(h),p.flags&=-33),p=qp(c),wc(c,p,h);break;case 3:case 4:h=p.stateNode.containerInfo,p=qp(c),Dc(c,p,h);break;default:throw Error(o(161))}}}function Dc(c,h,p){var v=c.tag;if(v===5||v===6)c=c.stateNode,h?B_(p,c,h):pa(p,c);else if(v!==4&&(c=c.child,c!==null))for(Dc(c,h,p),c=c.sibling;c!==null;)Dc(c,h,p),c=c.sibling}function wc(c,h,p){var v=c.tag;if(v===5||v===6)c=c.stateNode,h?N_(p,c,h):$u(p,c);else if(v!==4&&(c=c.child,c!==null))for(wc(c,h,p),c=c.sibling;c!==null;)wc(c,h,p),c=c.sibling}function Qp(c,h,p){for(var v=h,S=!1,_,b;;){if(!S){S=v.return;e:for(;;){if(S===null)throw Error(o(160));switch(_=S.stateNode,S.tag){case 5:b=!1;break e;case 3:_=_.containerInfo,b=!0;break e;case 4:_=_.containerInfo,b=!0;break e}S=S.return}S=!0}if(v.tag===5||v.tag===6)Wp(c,v,p),b?$_(_,v.stateNode):U_(_,v.stateNode);else if(v.tag===18)b?aA(_,v.stateNode):oA(_,v.stateNode);else if(v.tag===4){if(v.child!==null){_=v.stateNode.containerInfo,b=!0,v.child.return=v,v=v.child;continue}}else if(zp(c,v,p),v.child!==null){v.child.return=v,v=v.child;continue}if(v===h)break;for(;v.sibling===null;){if(v.return===null||v.return===h)return;v=v.return,v.tag===4&&(S=!1)}v.sibling.return=v.return,v=v.sibling}}function Cc(c,h){if(tn){switch(h.tag){case 0:case 11:case 14:case 15:vr(3,h,h.return),ao(3,h),vr(5,h,h.return);return;case 1:return;case 5:var p=h.stateNode;if(p!=null){var v=h.memoizedProps;c=c!==null?c.memoizedProps:v;var S=h.type,_=h.updateQueue;h.updateQueue=null,_!==null&&F_(p,_,S,c,v,h)}return;case 6:if(h.stateNode===null)throw Error(o(162));p=h.memoizedProps,ga(h.stateNode,c!==null?c.memoizedProps:p,p);return;case 3:St&&c!==null&&c.memoizedState.isDehydrated&&Nm(h.stateNode.containerInfo);return;case 12:return;case 13:Ya(h);return;case 19:Ya(h);return;case 17:return}throw Error(o(163))}switch(h.tag){case 0:case 11:case 14:case 15:vr(3,h,h.return),ao(3,h),vr(5,h,h.return);return;case 12:return;case 13:Ya(h);return;case 19:Ya(h);return;case 3:St&&c!==null&&c.memoizedState.isDehydrated&&Nm(h.stateNode.containerInfo);break;case 22:case 23:return}e:if(qr){switch(h.tag){case 1:case 5:case 6:break e;case 3:case 4:h=h.stateNode,km(h.containerInfo,h.pendingChildren);break e}throw Error(o(163))}}function Ya(c){var h=c.updateQueue;if(h!==null){c.updateQueue=null;var p=c.stateNode;p===null&&(p=c.stateNode=new UA),h.forEach(function(v){var S=XA.bind(null,c,v);p.has(v)||(p.add(v),v.then(S,S))})}}function VA(c,h){for(se=h;se!==null;){h=se;var p=h.deletions;if(p!==null)for(var v=0;v<p.length;v++){var S=p[v];try{var _=c;tn?Qp(_,S,h):Wp(_,S,h);var b=S.alternate;b!==null&&(b.return=null),S.return=null}catch(de){jt(S,h,de)}}if(p=h.child,(h.subtreeFlags&12854)!==0&&p!==null)p.return=h,se=p;else for(;se!==null;){h=se;try{var F=h.flags;if(F&32&&tn&&wm(h.stateNode),F&512){var Y=h.alternate;if(Y!==null){var ee=Y.ref;ee!==null&&(typeof ee=="function"?ee(null):ee.current=null)}}if(F&8192)switch(h.tag){case 13:if(h.memoizedState!==null){var ue=h.alternate;(ue===null||ue.memoizedState===null)&&(Bc=mt())}break;case 22:var Ee=h.memoizedState!==null,pe=h.alternate,$e=pe!==null&&pe.memoizedState!==null;if(p=h,tn){e:if(v=p,S=Ee,_=null,tn)for(var me=v;;){if(me.tag===5){if(_===null){_=me;var Ct=me.stateNode;S?V_(Ct):H_(me.stateNode,me.memoizedProps)}}else if(me.tag===6){if(_===null){var xn=me.stateNode;S?G_(xn):K_(xn,me.memoizedProps)}}else if((me.tag!==22&&me.tag!==23||me.memoizedState===null||me===v)&&me.child!==null){me.child.return=me,me=me.child;continue}if(me===v)break;for(;me.sibling===null;){if(me.return===null||me.return===v)break e;_===me&&(_=null),me=me.return}_===me&&(_=null),me.sibling.return=me.return,me=me.sibling}}if(Ee&&!$e&&(p.mode&1)!==0){se=p;for(var H=p.child;H!==null;){for(p=se=H;se!==null;){v=se;var B=v.child;switch(v.tag){case 0:case 11:case 14:case 15:vr(4,v,v.return);break;case 1:ja(v,v.return);var j=v.stateNode;if(typeof j.componentWillUnmount=="function"){var le=v.return;try{j.props=v.memoizedProps,j.state=v.memoizedState,j.componentWillUnmount()}catch(de){jt(v,le,de)}}break;case 5:ja(v,v.return);break;case 22:if(v.memoizedState!==null){eg(p);continue}}B!==null?(B.return=v,se=B):eg(p)}H=H.sibling}}}switch(F&4102){case 2:Xp(h),h.flags&=-3;break;case 6:Xp(h),h.flags&=-3,Cc(h.alternate,h);break;case 4096:h.flags&=-4097;break;case 4100:h.flags&=-4097,Cc(h.alternate,h);break;case 4:Cc(h.alternate,h)}}catch(de){jt(h,h.return,de)}if(p=h.sibling,p!==null){p.return=h.return,se=p;break}se=h.return}}}function GA(c,h,p){se=c,Zp(c)}function Zp(c,h,p){for(var v=(c.mode&1)!==0;se!==null;){var S=se,_=S.child;if(S.tag===22&&v){var b=S.memoizedState!==null||Wa;if(!b){var F=S.alternate,Y=F!==null&&F.memoizedState!==null||yr;F=Wa;var ee=yr;if(Wa=b,(yr=Y)&&!ee)for(se=S;se!==null;)b=se,Y=b.child,b.tag===22&&b.memoizedState!==null?tg(S):Y!==null?(Y.return=b,se=Y):tg(S);for(;_!==null;)se=_,Zp(_),_=_.sibling;se=S,Wa=F,yr=ee}Jp(c)}else(S.subtreeFlags&8772)!==0&&_!==null?(_.return=S,se=_):Jp(c)}}function Jp(c){for(;se!==null;){var h=se;if((h.flags&8772)!==0){var p=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:yr||ao(5,h);break;case 1:var v=h.stateNode;if(h.flags&4&&!yr)if(p===null)v.componentDidMount();else{var S=h.elementType===h.type?p.memoizedProps:kn(h.type,p.memoizedProps);v.componentDidUpdate(S,p.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var _=h.updateQueue;_!==null&&jm(h,_,v);break;case 3:var b=h.updateQueue;if(b!==null){if(p=null,h.child!==null)switch(h.child.tag){case 5:p=Z(h.child.stateNode);break;case 1:p=h.child.stateNode}jm(h,b,p)}break;case 5:var F=h.stateNode;p===null&&h.flags&4&&fr(F,h.type,h.memoizedProps,h);break;case 6:break;case 4:break;case 12:break;case 13:if(St&&h.memoizedState===null){var Y=h.alternate;if(Y!==null){var ee=Y.memoizedState;if(ee!==null){var ue=ee.dehydrated;ue!==null&&sA(ue)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}yr||h.flags&512&&Pc(h)}catch(Ee){jt(h,h.return,Ee)}}if(h===c){se=null;break}if(p=h.sibling,p!==null){p.return=h.return,se=p;break}se=h.return}}function eg(c){for(;se!==null;){var h=se;if(h===c){se=null;break}var p=h.sibling;if(p!==null){p.return=h.return,se=p;break}se=h.return}}function tg(c){for(;se!==null;){var h=se;try{switch(h.tag){case 0:case 11:case 15:var p=h.return;try{ao(4,h)}catch(Y){jt(h,p,Y)}break;case 1:var v=h.stateNode;if(typeof v.componentDidMount=="function"){var S=h.return;try{v.componentDidMount()}catch(Y){jt(h,S,Y)}}var _=h.return;try{Pc(h)}catch(Y){jt(h,_,Y)}break;case 5:var b=h.return;try{Pc(h)}catch(Y){jt(h,b,Y)}}}catch(Y){jt(h,h.return,Y)}if(h===c){se=null;break}var F=h.sibling;if(F!==null){F.return=h.return,se=F;break}se=h.return}}var qa=0,Xa=1,Qa=2,Za=3,Ja=4;if(typeof Symbol=="function"&&Symbol.for){var lo=Symbol.for;qa=lo("selector.component"),Xa=lo("selector.has_pseudo_class"),Qa=lo("selector.role"),Za=lo("selector.test_id"),Ja=lo("selector.text")}function bc(c){var h=Ks(c);if(h!=null){if(typeof h.memoizedProps["data-testname"]!="string")throw Error(o(364));return h}if(c=Fi(c),c===null)throw Error(o(362));return c.stateNode.current}function kc(c,h){switch(h.$$typeof){case qa:if(c.type===h.value)return!0;break;case Xa:e:{h=h.value,c=[c,0];for(var p=0;p<c.length;){var v=c[p++],S=c[p++],_=h[S];if(v.tag!==5||!$n(v)){for(;_!=null&&kc(v,_);)S++,_=h[S];if(S===h.length){h=!0;break e}else for(v=v.child;v!==null;)c.push(v,S),v=v.sibling}}h=!1}return h;case Qa:if(c.tag===5&&da(c.stateNode,h.value))return!0;break;case Ja:if((c.tag===5||c.tag===6)&&(c=fa(c),c!==null&&0<=c.indexOf(h.value)))return!0;break;case Za:if(c.tag===5&&(c=c.memoizedProps["data-testname"],typeof c=="string"&&c.toLowerCase()===h.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Oc(c){switch(c.$$typeof){case qa:return"<"+(D(c.value)||"Unknown")+">";case Xa:return":has("+(Oc(c)||"")+")";case Qa:return'[role="'+c.value+'"]';case Ja:return'"'+c.value+'"';case Za:return'[data-testname="'+c.value+'"]';default:throw Error(o(365))}}function ng(c,h){var p=[];c=[c,0];for(var v=0;v<c.length;){var S=c[v++],_=c[v++],b=h[_];if(S.tag!==5||!$n(S)){for(;b!=null&&kc(S,b);)_++,b=h[_];if(_===h.length)p.push(S);else for(S=S.child;S!==null;)c.push(S,_),S=S.sibling}}return p}function Mc(c,h){if(!xt)throw Error(o(363));c=bc(c),c=ng(c,h),h=[],c=Array.from(c);for(var p=0;p<c.length;){var v=c[p++];if(v.tag===5)$n(v)||h.push(v.stateNode);else for(v=v.child;v!==null;)c.push(v),v=v.sibling}return h}var HA=Math.ceil,el=a.ReactCurrentDispatcher,Fc=a.ReactCurrentOwner,nt=a.ReactCurrentBatchConfig,Ae=0,st=null,ot=null,_t=0,on=0,as=Ni(0),ct=0,uo=null,ls=0,tl=0,Nc=0,co=null,zt=null,Bc=0,Uc=1/0;function us(){Uc=mt()+500}var nl=!1,$c=null,Vi=null,il=!1,Gi=null,rl=0,ho=0,Vc=null,sl=-1,ol=0;function Bt(){return(Ae&6)!==0?mt():sl!==-1?sl:sl=mt()}function Hi(c){return(c.mode&1)===0?1:(Ae&2)!==0&&_t!==0?_t&-_t:LA.transition!==null?(ol===0&&(c=Ta,Ta<<=1,(Ta&4194240)===0&&(Ta=64),ol=c),ol):(c=be,c!==0?c:Ce())}function En(c,h,p){if(50<ho)throw ho=0,Vc=null,Error(o(185));var v=al(c,h);return v===null?null:(Ys(v,h,p),((Ae&2)===0||v!==st)&&(v===st&&((Ae&2)===0&&(tl|=h),ct===4&&Ki(v,_t)),Wt(v,p),h===1&&Ae===0&&(c.mode&1)===0&&(us(),_a&&Hn())),v)}function al(c,h){c.lanes|=h;var p=c.alternate;for(p!==null&&(p.lanes|=h),p=c,c=c.return;c!==null;)c.childLanes|=h,p=c.alternate,p!==null&&(p.childLanes|=h),p=c,c=c.return;return p.tag===3?p.stateNode:null}function Wt(c,h){var p=c.callbackNode;gA(c,h);var v=Sa(c,c===st?_t:0);if(v===0)p!==null&&Gm(p),c.callbackNode=null,c.callbackPriority=0;else if(h=v&-v,c.callbackPriority!==h){if(p!=null&&Gm(p),h===1)c.tag===0?AA(rg.bind(null,c)):Hm(rg.bind(null,c)),Gt?hi(function(){Ae===0&&Hn()}):qu(Xu,Hn),p=null;else{switch(Vm(v)){case 1:p=Xu;break;case 4:p=EA;break;case 16:p=Qu;break;case 536870912:p=SA;break;default:p=Qu}p=dg(p,ig.bind(null,c))}c.callbackPriority=h,c.callbackNode=p}}function ig(c,h){if(sl=-1,ol=0,(Ae&6)!==0)throw Error(o(327));var p=c.callbackNode;if(Sr()&&c.callbackNode!==p)return null;var v=Sa(c,c===st?_t:0);if(v===0)return null;if((v&30)!==0||(v&c.expiredLanes)!==0||h)h=ll(c,v);else{h=v;var S=Ae;Ae|=2;var _=ag();(st!==c||_t!==h)&&(us(),Tr(c,h));do try{WA();break}catch(F){og(c,F)}while(!0);ec(),el.current=_,Ae=S,ot!==null?h=0:(st=null,_t=0,h=ct)}if(h!==0){if(h===2&&(S=Wu(c),S!==0&&(v=S,h=Gc(c,S))),h===1)throw p=uo,Tr(c,0),Ki(c,v),Wt(c,mt()),p;if(h===6)Ki(c,v);else{if(S=c.current.alternate,(v&30)===0&&!KA(S)&&(h=ll(c,v),h===2&&(_=Wu(c),_!==0&&(v=_,h=Gc(c,_))),h===1))throw p=uo,Tr(c,0),Ki(c,v),Wt(c,mt()),p;switch(c.finishedWork=S,c.finishedLanes=v,h){case 0:case 1:throw Error(o(345));case 2:Er(c,zt);break;case 3:if(Ki(c,v),(v&130023424)===v&&(h=Bc+500-mt(),10<h)){if(Sa(c,0)!==0)break;if(S=c.suspendedLanes,(S&v)!==v){Bt(),c.pingedLanes|=c.suspendedLanes&S;break}c.timeoutHandle=Te(Er.bind(null,c,zt),h);break}Er(c,zt);break;case 4:if(Ki(c,v),(v&4194240)===v)break;for(h=c.eventTimes,S=-1;0<v;){var b=31-bn(v);_=1<<b,b=h[b],b>S&&(S=b),v&=~_}if(v=S,v=mt()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*HA(v/1960))-v,10<v){c.timeoutHandle=Te(Er.bind(null,c,zt),v);break}Er(c,zt);break;case 5:Er(c,zt);break;default:throw Error(o(329))}}}return Wt(c,mt()),c.callbackNode===p?ig.bind(null,c):null}function Gc(c,h){var p=co;return c.current.memoizedState.isDehydrated&&(Tr(c,h).flags|=256),c=ll(c,h),c!==2&&(h=zt,zt=p,h!==null&&Hc(h)),c}function Hc(c){zt===null?zt=c:zt.push.apply(zt,c)}function KA(c){for(var h=c;;){if(h.flags&16384){var p=h.updateQueue;if(p!==null&&(p=p.stores,p!==null))for(var v=0;v<p.length;v++){var S=p[v],_=S.getSnapshot;S=S.value;try{if(!Gn(_(),S))return!1}catch{return!1}}}if(p=h.child,h.subtreeFlags&16384&&p!==null)p.return=h,h=p;else{if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Ki(c,h){for(h&=~Nc,h&=~tl,c.suspendedLanes|=h,c.pingedLanes&=~h,c=c.expirationTimes;0<h;){var p=31-bn(h),v=1<<p;c[p]=-1,h&=~v}}function rg(c){if((Ae&6)!==0)throw Error(o(327));Sr();var h=Sa(c,0);if((h&1)===0)return Wt(c,mt()),null;var p=ll(c,h);if(c.tag!==0&&p===2){var v=Wu(c);v!==0&&(h=v,p=Gc(c,v))}if(p===1)throw p=uo,Tr(c,0),Ki(c,h),Wt(c,mt()),p;if(p===6)throw Error(o(345));return c.finishedWork=c.current.alternate,c.finishedLanes=h,Er(c,zt),Wt(c,mt()),null}function sg(c){Gi!==null&&Gi.tag===0&&(Ae&6)===0&&Sr();var h=Ae;Ae|=1;var p=nt.transition,v=be;try{if(nt.transition=null,be=1,c)return c()}finally{be=v,nt.transition=p,Ae=h,(Ae&6)===0&&Hn()}}function Kc(){on=as.current,He(as)}function Tr(c,h){c.finishedWork=null,c.finishedLanes=0;var p=c.timeoutHandle;if(p!==we&&(c.timeoutHandle=we,Ie(p)),ot!==null)for(p=ot.return;p!==null;){var v=p;switch(ac(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&ya();break;case 3:ss(),He(Ht),He(It),mc();break;case 5:fc(v);break;case 4:ss();break;case 13:He(Ye);break;case 19:He(Ye);break;case 10:tc(v.type._context);break;case 22:case 23:Kc()}p=p.return}if(st=c,ot=c=zi(c.current,null),_t=on=h,ct=0,uo=null,Nc=tl=ls=0,zt=co=null,Kn!==null){for(h=0;h<Kn.length;h++)if(p=Kn[h],v=p.interleaved,v!==null){p.interleaved=null;var S=v.next,_=p.pending;if(_!==null){var b=_.next;_.next=S,v.next=b}p.pending=v}Kn=null}return c}function og(c,h){do{var p=ot;try{if(ec(),Oa.current=$a,Ma){for(var v=Je.memoizedState;v!==null;){var S=v.queue;S!==null&&(S.pending=null),v=v.next}Ma=!1}if(os=0,pt=Pt=Je=null,eo=!1,to=0,Fc.current=null,p===null||p.return===null){ct=1,uo=h,ot=null;break}e:{var _=c,b=p.return,F=p,Y=h;if(h=_t,F.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var ee=Y,ue=F,Ee=ue.tag;if((ue.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var pe=ue.alternate;pe?(ue.updateQueue=pe.updateQueue,ue.memoizedState=pe.memoizedState,ue.lanes=pe.lanes):(ue.updateQueue=null,ue.memoizedState=null)}var $e=Ip(b);if($e!==null){$e.flags&=-257,Pp($e,b,F,_,h),$e.mode&1&&Rp(_,ee,h),h=$e,Y=ee;var me=h.updateQueue;if(me===null){var Ct=new Set;Ct.add(Y),h.updateQueue=Ct}else me.add(Y);break e}else{if((h&1)===0){Rp(_,ee,h),zc();break e}Y=Error(o(426))}}else if(Ke&&F.mode&1){var xn=Ip(b);if(xn!==null){(xn.flags&65536)===0&&(xn.flags|=256),Pp(xn,b,F,_,h),cc(Y);break e}}_=Y,ct!==4&&(ct=2),co===null?co=[_]:co.push(_),Y=Sc(Y,F),F=b;do{switch(F.tag){case 3:F.flags|=65536,h&=-h,F.lanes|=h;var H=Ap(F,Y,h);Wm(F,H);break e;case 1:_=Y;var B=F.type,j=F.stateNode;if((F.flags&128)===0&&(typeof B.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(Vi===null||!Vi.has(j)))){F.flags|=65536,h&=-h,F.lanes|=h;var le=Lp(F,_,h);Wm(F,le);break e}}F=F.return}while(F!==null)}ug(p)}catch(de){h=de,ot===p&&p!==null&&(ot=p=p.return);continue}break}while(!0)}function ag(){var c=el.current;return el.current=$a,c===null?$a:c}function zc(){(ct===0||ct===3||ct===2)&&(ct=4),st===null||(ls&268435455)===0&&(tl&268435455)===0||Ki(st,_t)}function ll(c,h){var p=Ae;Ae|=2;var v=ag();st===c&&_t===h||Tr(c,h);do try{zA();break}catch(S){og(c,S)}while(!0);if(ec(),Ae=p,el.current=v,ot!==null)throw Error(o(261));return st=null,_t=0,ct}function zA(){for(;ot!==null;)lg(ot)}function WA(){for(;ot!==null&&!vA();)lg(ot)}function lg(c){var h=fg(c.alternate,c,on);c.memoizedProps=c.pendingProps,h===null?ug(c):ot=h,Fc.current=null}function ug(c){var h=c;do{var p=h.alternate;if(c=h.return,(h.flags&32768)===0){if(p=MA(p,h,on),p!==null){ot=p;return}}else{if(p=BA(p,h),p!==null){p.flags&=32767,ot=p;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{ct=6,ot=null;return}}if(h=h.sibling,h!==null){ot=h;return}ot=h=c}while(h!==null);ct===0&&(ct=5)}function Er(c,h){var p=be,v=nt.transition;try{nt.transition=null,be=1,jA(c,h,p)}finally{nt.transition=v,be=p}return null}function jA(c,h,p){do Sr();while(Gi!==null);if((Ae&6)!==0)throw Error(o(327));var v=c.finishedWork,S=c.finishedLanes;if(v===null)return null;if(c.finishedWork=null,c.finishedLanes=0,v===c.current)throw Error(o(177));c.callbackNode=null,c.callbackPriority=0;var _=v.lanes|v.childLanes;if(yA(c,_),c===st&&(ot=st=null,_t=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||il||(il=!0,dg(Qu,function(){return Sr(),null})),_=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||_){_=nt.transition,nt.transition=null;var b=be;be=1;var F=Ae;Ae|=4,Fc.current=null,$A(c,v),VA(c,v),z(c.containerInfo),c.current=v,GA(v),TA(),Ae=F,be=b,nt.transition=_}else c.current=v;if(il&&(il=!1,Gi=c,rl=S),_=c.pendingLanes,_===0&&(Vi=null),xA(v.stateNode),Wt(c,mt()),h!==null)for(p=c.onRecoverableError,v=0;v<h.length;v++)p(h[v]);if(nl)throw nl=!1,c=$c,$c=null,c;return(rl&1)!==0&&c.tag!==0&&Sr(),_=c.pendingLanes,(_&1)!==0?c===Vc?ho++:(ho=0,Vc=c):ho=0,Hn(),null}function Sr(){if(Gi!==null){var c=Vm(rl),h=nt.transition,p=be;try{if(nt.transition=null,be=16>c?16:c,Gi===null)var v=!1;else{if(c=Gi,Gi=null,rl=0,(Ae&6)!==0)throw Error(o(331));var S=Ae;for(Ae|=4,se=c.current;se!==null;){var _=se,b=_.child;if((se.flags&16)!==0){var F=_.deletions;if(F!==null){for(var Y=0;Y<F.length;Y++){var ee=F[Y];for(se=ee;se!==null;){var ue=se;switch(ue.tag){case 0:case 11:case 15:vr(8,ue,_)}var Ee=ue.child;if(Ee!==null)Ee.return=ue,se=Ee;else for(;se!==null;){ue=se;var pe=ue.sibling,$e=ue.return;if(jp(ue),ue===ee){se=null;break}if(pe!==null){pe.return=$e,se=pe;break}se=$e}}}var me=_.alternate;if(me!==null){var Ct=me.child;if(Ct!==null){me.child=null;do{var xn=Ct.sibling;Ct.sibling=null,Ct=xn}while(Ct!==null)}}se=_}}if((_.subtreeFlags&2064)!==0&&b!==null)b.return=_,se=b;else e:for(;se!==null;){if(_=se,(_.flags&2048)!==0)switch(_.tag){case 0:case 11:case 15:vr(9,_,_.return)}var H=_.sibling;if(H!==null){H.return=_.return,se=H;break e}se=_.return}}var B=c.current;for(se=B;se!==null;){b=se;var j=b.child;if((b.subtreeFlags&2064)!==0&&j!==null)j.return=b,se=j;else e:for(b=B;se!==null;){if(F=se,(F.flags&2048)!==0)try{switch(F.tag){case 0:case 11:case 15:ao(9,F)}}catch(de){jt(F,F.return,de)}if(F===b){se=null;break e}var le=F.sibling;if(le!==null){le.return=F.return,se=le;break e}se=F.return}}if(Ae=S,Hn(),Vn&&typeof Vn.onPostCommitFiberRoot=="function")try{Vn.onPostCommitFiberRoot(xa,c)}catch{}v=!0}return v}finally{be=p,nt.transition=h}}return!1}function cg(c,h,p){h=Sc(p,h),h=Ap(c,h,1),$i(c,h),h=Bt(),c=al(c,1),c!==null&&(Ys(c,1,h),Wt(c,h))}function jt(c,h,p){if(c.tag===3)cg(c,c,p);else for(;h!==null;){if(h.tag===3){cg(h,c,p);break}else if(h.tag===1){var v=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Vi===null||!Vi.has(v))){c=Sc(p,c),c=Lp(h,c,1),$i(h,c),c=Bt(),h=al(h,1),h!==null&&(Ys(h,1,c),Wt(h,c));break}}h=h.return}}function YA(c,h,p){var v=c.pingCache;v!==null&&v.delete(h),h=Bt(),c.pingedLanes|=c.suspendedLanes&p,st===c&&(_t&p)===p&&(ct===4||ct===3&&(_t&130023424)===_t&&500>mt()-Bc?Tr(c,0):Nc|=p),Wt(c,h)}function hg(c,h){h===0&&((c.mode&1)===0?h=1:(h=Ea,Ea<<=1,(Ea&130023424)===0&&(Ea=4194304)));var p=Bt();c=al(c,h),c!==null&&(Ys(c,h,p),Wt(c,p))}function qA(c){var h=c.memoizedState,p=0;h!==null&&(p=h.retryLane),hg(c,p)}function XA(c,h){var p=0;switch(c.tag){case 13:var v=c.stateNode,S=c.memoizedState;S!==null&&(p=S.retryLane);break;case 19:v=c.stateNode;break;default:throw Error(o(314))}v!==null&&v.delete(h),hg(c,p)}var fg;fg=function(c,h,p){if(c!==null)if(c.memoizedProps!==h.pendingProps||Ht.current)sn=!0;else{if((c.lanes&p)===0&&(h.flags&128)===0)return sn=!1,NA(c,h,p);sn=(c.flags&131072)!==0}else sn=!1,Ke&&(h.flags&1048576)!==0&&Zm(h,Ca,h.index);switch(h.lanes=0,h.tag){case 2:var v=h.type;c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2),c=h.pendingProps;var S=Qr(h,It.current);Jr(h,p),S=gc(null,h,v,c,S,p);var _=yc();return h.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Kt(v)?(_=!0,va(h)):_=!1,h.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,ic(h),S.updater=Da,h.stateNode=S,S._reactInternals=h,sc(h,v,c,p),h=Ac(null,h,v,!0,_,p)):(h.tag=0,Ke&&_&&oc(h),Nt(null,h,S,p),h=h.child),h;case 16:v=h.elementType;e:{switch(c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2),c=h.pendingProps,S=v._init,v=S(v._payload),h.type=v,S=h.tag=ZA(v),c=kn(v,c),S){case 0:h=_c(null,h,v,c,p);break e;case 1:h=Fp(null,h,v,c,p);break e;case 11:h=Cp(null,h,v,c,p);break e;case 14:h=bp(null,h,v,kn(v.type,c),p);break e}throw Error(o(306,v,""))}return h;case 0:return v=h.type,S=h.pendingProps,S=h.elementType===v?S:kn(v,S),_c(c,h,v,S,p);case 1:return v=h.type,S=h.pendingProps,S=h.elementType===v?S:kn(v,S),Fp(c,h,v,S,p);case 3:e:{if(Np(h),c===null)throw Error(o(387));v=h.pendingProps,_=h.memoizedState,S=_.element,zm(c,h),Pa(h,v,null,p);var b=h.memoizedState;if(v=b.element,St&&_.isDehydrated)if(_={element:v,isDehydrated:!1,cache:b.cache,transitions:b.transitions},h.updateQueue.baseState=_,h.memoizedState=_,h.flags&256){S=Error(o(423)),h=Bp(c,h,v,p,S);break e}else if(v!==S){S=Error(o(424)),h=Bp(c,h,v,p,S);break e}else for(St&&(rn=J_(h.stateNode.containerInfo),nn=h,Ke=!0,On=null,qs=!1),p=rp(h,null,v,p),h.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(ns(),v===S){h=vi(c,h,p);break e}Nt(c,h,v,p)}h=h.child}return h;case 5:return sp(h),c===null&&uc(h),v=h.type,S=h.pendingProps,_=c!==null?c.memoizedProps:null,b=S.children,oe(v,S)?b=null:_!==null&&oe(v,_)&&(h.flags|=32),Mp(c,h),Nt(c,h,b,p),h.child;case 6:return c===null&&uc(h),null;case 13:return Up(c,h,p);case 4:return hc(h,h.stateNode.containerInfo),v=h.pendingProps,c===null?h.child=is(h,null,v,p):Nt(c,h,v,p),h.child;case 11:return v=h.type,S=h.pendingProps,S=h.elementType===v?S:kn(v,S),Cp(c,h,v,S,p);case 7:return Nt(c,h,h.pendingProps,p),h.child;case 8:return Nt(c,h,h.pendingProps.children,p),h.child;case 12:return Nt(c,h,h.pendingProps.children,p),h.child;case 10:e:{if(v=h.type._context,S=h.pendingProps,_=h.memoizedProps,b=S.value,Km(h,v,b),_!==null)if(Gn(_.value,b)){if(_.children===S.children&&!Ht.current){h=vi(c,h,p);break e}}else for(_=h.child,_!==null&&(_.return=h);_!==null;){var F=_.dependencies;if(F!==null){b=_.child;for(var Y=F.firstContext;Y!==null;){if(Y.context===v){if(_.tag===1){Y=mi(-1,p&-p),Y.tag=2;var ee=_.updateQueue;if(ee!==null){ee=ee.shared;var ue=ee.pending;ue===null?Y.next=Y:(Y.next=ue.next,ue.next=Y),ee.pending=Y}}_.lanes|=p,Y=_.alternate,Y!==null&&(Y.lanes|=p),nc(_.return,p,h),F.lanes|=p;break}Y=Y.next}}else if(_.tag===10)b=_.type===h.type?null:_.child;else if(_.tag===18){if(b=_.return,b===null)throw Error(o(341));b.lanes|=p,F=b.alternate,F!==null&&(F.lanes|=p),nc(b,p,h),b=_.sibling}else b=_.child;if(b!==null)b.return=_;else for(b=_;b!==null;){if(b===h){b=null;break}if(_=b.sibling,_!==null){_.return=b.return,b=_;break}b=b.return}_=b}Nt(c,h,S.children,p),h=h.child}return h;case 9:return S=h.type,v=h.pendingProps.children,Jr(h,p),S=pn(S),v=v(S),h.flags|=1,Nt(c,h,v,p),h.child;case 14:return v=h.type,S=kn(v,h.pendingProps),S=kn(v.type,S),bp(c,h,v,S,p);case 15:return kp(c,h,h.type,h.pendingProps,p);case 17:return v=h.type,S=h.pendingProps,S=h.elementType===v?S:kn(v,S),c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2),h.tag=1,Kt(v)?(c=!0,va(h)):c=!1,Jr(h,p),Xm(h,v,S),sc(h,v,S,p),Ac(null,h,v,!0,c,p);case 19:return Hp(c,h,p);case 22:return Op(c,h,p)}throw Error(o(156,h.tag))};function dg(c,h){return qu(c,h)}function QA(c,h,p,v){this.tag=c,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(c,h,p,v){return new QA(c,h,p,v)}function Wc(c){return c=c.prototype,!(!c||!c.isReactComponent)}function ZA(c){if(typeof c=="function")return Wc(c)?1:0;if(c!=null){if(c=c.$$typeof,c===T)return 11;if(c===R)return 14}return 2}function zi(c,h){var p=c.alternate;return p===null?(p=Sn(c.tag,h,c.key,c.mode),p.elementType=c.elementType,p.type=c.type,p.stateNode=c.stateNode,p.alternate=c,c.alternate=p):(p.pendingProps=h,p.type=c.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=c.flags&14680064,p.childLanes=c.childLanes,p.lanes=c.lanes,p.child=c.child,p.memoizedProps=c.memoizedProps,p.memoizedState=c.memoizedState,p.updateQueue=c.updateQueue,h=c.dependencies,p.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},p.sibling=c.sibling,p.index=c.index,p.ref=c.ref,p}function ul(c,h,p,v,S,_){var b=2;if(v=c,typeof c=="function")Wc(c)&&(b=1);else if(typeof c=="string")b=5;else e:switch(c){case f:return xr(p.children,S,_,h);case d:b=8,S|=8;break;case m:return c=Sn(12,p,h,S|2),c.elementType=m,c.lanes=_,c;case E:return c=Sn(13,p,h,S),c.elementType=E,c.lanes=_,c;case x:return c=Sn(19,p,h,S),c.elementType=x,c.lanes=_,c;case P:return cl(p,S,_,h);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case g:b=10;break e;case y:b=9;break e;case T:b=11;break e;case R:b=14;break e;case L:b=16,v=null;break e}throw Error(o(130,c==null?c:typeof c,""))}return h=Sn(b,p,h,S),h.elementType=c,h.type=v,h.lanes=_,h}function xr(c,h,p,v){return c=Sn(7,c,v,h),c.lanes=p,c}function cl(c,h,p,v){return c=Sn(22,c,v,h),c.elementType=P,c.lanes=p,c.stateNode={},c}function jc(c,h,p){return c=Sn(6,c,null,h),c.lanes=p,c}function Yc(c,h,p){return h=Sn(4,c.children!==null?c.children:[],c.key,h),h.lanes=p,h.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},h}function JA(c,h,p,v,S){this.tag=h,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=we,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ju(0),this.expirationTimes=ju(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ju(0),this.identifierPrefix=v,this.onRecoverableError=S,St&&(this.mutableSourceEagerHydrationData=null)}function mg(c,h,p,v,S,_,b,F,Y){return c=new JA(c,h,p,F,Y),h===1?(h=1,_===!0&&(h|=8)):h=0,_=Sn(3,null,null,h),c.current=_,_.stateNode=c,_.memoizedState={element:v,isDehydrated:p,cache:null,transitions:null},ic(_),c}function pg(c){if(!c)return Bi;c=c._reactInternals;e:{if(k(c)!==c||c.tag!==1)throw Error(o(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Kt(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(o(171))}if(c.tag===1){var p=c.type;if(Kt(p))return Um(c,p,h)}return h}function gg(c){var h=c._reactInternals;if(h===void 0)throw typeof c.render=="function"?Error(o(188)):(c=Object.keys(c).join(","),Error(o(268,c)));return c=q(h),c===null?null:c.stateNode}function yg(c,h){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var p=c.retryLane;c.retryLane=p!==0&&p<h?p:h}}function qc(c,h){yg(c,h),(c=c.alternate)&&yg(c,h)}function eL(c){return c=q(c),c===null?null:c.stateNode}function tL(){return null}return t.attemptContinuousHydration=function(c){if(c.tag===13){var h=Bt();En(c,134217728,h),qc(c,134217728)}},t.attemptHydrationAtCurrentPriority=function(c){if(c.tag===13){var h=Bt(),p=Hi(c);En(c,p,h),qc(c,p)}},t.attemptSynchronousHydration=function(c){switch(c.tag){case 3:var h=c.stateNode;if(h.current.memoizedState.isDehydrated){var p=js(h.pendingLanes);p!==0&&(Yu(h,p|1),Wt(h,mt()),(Ae&6)===0&&(us(),Hn()))}break;case 13:var v=Bt();sg(function(){return En(c,1,v)}),qc(c,1)}},t.batchedUpdates=function(c,h){var p=Ae;Ae|=1;try{return c(h)}finally{Ae=p,Ae===0&&(us(),_a&&Hn())}},t.createComponentSelector=function(c){return{$$typeof:qa,value:c}},t.createContainer=function(c,h,p,v,S,_,b){return mg(c,h,!1,null,p,v,S,_,b)},t.createHasPseudoClassSelector=function(c){return{$$typeof:Xa,value:c}},t.createHydrationContainer=function(c,h,p,v,S,_,b,F,Y){return c=mg(p,v,!0,c,S,_,b,F,Y),c.context=pg(null),p=c.current,v=Bt(),S=Hi(p),_=mi(v,S),_.callback=h??null,$i(p,_),c.current.lanes=S,Ys(c,S,v),Wt(c,v),c},t.createPortal=function(c,h,p){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:v==null?null:""+v,children:c,containerInfo:h,implementation:p}},t.createRoleSelector=function(c){return{$$typeof:Qa,value:c}},t.createTestNameSelector=function(c){return{$$typeof:Za,value:c}},t.createTextSelector=function(c){return{$$typeof:Ja,value:c}},t.deferredUpdates=function(c){var h=be,p=nt.transition;try{return nt.transition=null,be=16,c()}finally{be=h,nt.transition=p}},t.discreteUpdates=function(c,h,p,v,S){var _=be,b=nt.transition;try{return nt.transition=null,be=1,c(h,p,v,S)}finally{be=_,nt.transition=b,Ae===0&&us()}},t.findAllNodes=Mc,t.findBoundingRects=function(c,h){if(!xt)throw Error(o(363));h=Mc(c,h),c=[];for(var p=0;p<h.length;p++)c.push(fi(h[p]));for(h=c.length-1;0<h;h--){p=c[h];for(var v=p.x,S=v+p.width,_=p.y,b=_+p.height,F=h-1;0<=F;F--)if(h!==F){var Y=c[F],ee=Y.x,ue=ee+Y.width,Ee=Y.y,pe=Ee+Y.height;if(v>=ee&&_>=Ee&&S<=ue&&b<=pe){c.splice(h,1);break}else if(v!==ee||p.width!==Y.width||pe<_||Ee>b){if(!(_!==Ee||p.height!==Y.height||ue<v||ee>S)){ee>v&&(Y.width+=ee-v,Y.x=v),ue<S&&(Y.width=S-ee),c.splice(h,1);break}}else{Ee>_&&(Y.height+=Ee-_,Y.y=_),pe<b&&(Y.height=b-Ee),c.splice(h,1);break}}}return c},t.findHostInstance=gg,t.findHostInstanceWithNoPortals=function(c){return c=W(c),c=c!==null?te(c):null,c===null?null:c.stateNode},t.findHostInstanceWithWarning=function(c){return gg(c)},t.flushControlled=function(c){var h=Ae;Ae|=1;var p=nt.transition,v=be;try{nt.transition=null,be=1,c()}finally{be=v,nt.transition=p,Ae=h,Ae===0&&(us(),Hn())}},t.flushPassiveEffects=Sr,t.flushSync=sg,t.focusWithin=function(c,h){if(!xt)throw Error(o(363));for(c=bc(c),h=ng(c,h),h=Array.from(h),c=0;c<h.length;){var p=h[c++];if(!$n(p)){if(p.tag===5&&hr(p.stateNode))return!0;for(p=p.child;p!==null;)h.push(p),p=p.sibling}}return!1},t.getCurrentUpdatePriority=function(){return be},t.getFindAllNodesFailureDescription=function(c,h){if(!xt)throw Error(o(363));var p=0,v=[];c=[bc(c),0];for(var S=0;S<c.length;){var _=c[S++],b=c[S++],F=h[b];if((_.tag!==5||!$n(_))&&(kc(_,F)&&(v.push(Oc(F)),b++,b>p&&(p=b)),b<h.length))for(_=_.child;_!==null;)c.push(_,b),_=_.sibling}if(p<h.length){for(c=[];p<h.length;p++)c.push(Oc(h[p]));return`findAllNodes was able to match part of the selector:
  `+(v.join(" > ")+`

No matching component was found for:
  `)+c.join(" > ")}return null},t.getPublicRootInstance=function(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return Z(c.child.stateNode);default:return c.child.stateNode}},t.injectIntoDevTools=function(c){if(c={bundleType:c.bundleType,version:c.version,rendererPackageName:c.rendererPackageName,rendererConfig:c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:eL,findFiberByHostInstance:c.findFiberByHostInstance||tL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")c=!1;else{var h=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(h.isDisabled||!h.supportsFiber)c=!0;else{try{xa=h.inject(c),Vn=h}catch{}c=!!h.checkDCE}}return c},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(c,h,p,v){if(!xt)throw Error(o(363));c=Mc(c,h);var S=ma(c,p,v).disconnect;return{disconnect:function(){S()}}},t.registerMutableSourceForHydration=function(c,h){var p=h._getVersion;p=p(h._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[h,p]:c.mutableSourceEagerHydrationData.push(h,p)},t.runWithPriority=function(c,h){var p=be;try{return be=c,h()}finally{be=p}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(c,h,p,v){var S=h.current,_=Bt(),b=Hi(S);return p=pg(p),h.context===null?h.context=p:h.pendingContext=p,h=mi(_,b),h.payload={element:c},v=v===void 0?null:v,v!==null&&(h.callback=v),$i(S,h),c=En(S,b,_),c!==null&&Ia(c,S,b),b},t}),nh}var Ig;function hL(){return Ig||(Ig=1,Jc.exports=cL()),Jc.exports}var fL=hL();const aN=Gv(fL);var lN=zv();function Pg(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function uN({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=N.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=N.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,u=i?typeof i=="number"?i:i.resize:null,f=N.useRef(!1);N.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[d,m,g]=N.useMemo(()=>{const x=()=>{if(!a.current.element)return;const{left:R,top:L,width:P,height:I,bottom:C,right:D,x:w,y:k}=a.current.element.getBoundingClientRect(),O={left:R,top:L,width:P,height:I,bottom:C,right:D,x:w,y:k};a.current.element instanceof HTMLElement&&n&&(O.height=a.current.element.offsetHeight,O.width=a.current.element.offsetWidth),Object.freeze(O),f.current&&!gL(a.current.lastBounds,O)&&o(a.current.lastBounds=O)};return[x,u?Pg(x,u):x,l?Pg(x,l):x]},[o,n,l,u]);function y(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(x=>x.removeEventListener("scroll",g,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function T(){a.current.element&&(a.current.resizeObserver=new r(g),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(x=>x.addEventListener("scroll",g,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{g()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const E=x=>{!x||x===a.current.element||(y(),a.current.element=x,a.current.scrollContainers=Wv(x),T())};return mL(g,!!e),dL(m),N.useEffect(()=>{y(),T()},[e,g,m]),N.useEffect(()=>y,[]),[E,s,d]}function dL(i){N.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function mL(i,e){N.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function Wv(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,...Wv(i.parentElement)]}const pL=["x","y","top","bottom","left","right","width","height"],gL=(i,e)=>pL.every(t=>i[t]===e[t]);var yL=Object.defineProperty,vL=Object.defineProperties,TL=Object.getOwnPropertyDescriptors,Dg=Object.getOwnPropertySymbols,EL=Object.prototype.hasOwnProperty,SL=Object.prototype.propertyIsEnumerable,wg=(i,e,t)=>e in i?yL(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Cg=(i,e)=>{for(var t in e||(e={}))EL.call(e,t)&&wg(i,t,e[t]);if(Dg)for(var t of Dg(e))SL.call(e,t)&&wg(i,t,e[t]);return i},xL=(i,e)=>vL(i,TL(e)),bg,kg;typeof window<"u"&&((bg=window.document)!=null&&bg.createElement||((kg=window.navigator)==null?void 0:kg.product)==="ReactNative")?N.useLayoutEffect:N.useEffect;function jv(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=i.child;for(;n;){const r=jv(n,e,t);if(r)return r;n=n.sibling}}function Yv(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const Og=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=Og;return}return Og.apply(this,arguments)};const Jf=Yv(N.createContext(null));class _L extends N.Component{render(){return N.createElement(Jf.Provider,{value:this._reactInternals},this.props.children)}}function AL(){const i=N.useContext(Jf);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=N.useId();return N.useMemo(()=>{for(const n of[i,i==null?void 0:i.alternate]){if(!n)continue;const r=jv(n,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[i,e])}function LL(){const i=AL(),[e]=N.useState(()=>new Map);e.clear();let t=i;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==Jf&&!e.has(r)&&e.set(r,N.useContext(Yv(r)))}t=t.return}return e}function cN(){const i=LL();return N.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>N.createElement(e,null,N.createElement(t.Provider,xL(Cg({},n),{value:i.get(t)}))),e=>N.createElement(_L,Cg({},e))),[i])}function Mg(){return Mg=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Mg.apply(null,arguments)}const ae=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},RL=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=IL},IL=Number.MAX_SAFE_INTEGER||9007199254740991;let he=function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i}({}),$=function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i}({}),A=function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i}({});var Re={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ce={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class cs{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class PL{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new cs(e),this.fast_=new cs(t),this.defaultTTFB_=r,this.ttfb_=new cs(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new cs(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new cs(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new cs(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,s=n/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function DL(i,e,t){return(e=CL(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ue(){return Ue=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Ue.apply(null,arguments)}function Fg(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Ne(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fg(Object(t),!0).forEach(function(n){DL(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Fg(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function wL(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function CL(i){var e=wL(i,"string");return typeof e=="symbol"?e:e+""}class Oi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Zi,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const Zi=function(){},bL={trace:Zi,debug:Zi,log:Zi,warn:Zi,info:Zi,error:Zi};function Qh(){return Ue({},bL)}function kL(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Zi}function Ng(i,e,t){return e[i]?e[i].bind(e):kL(i,t)}const Zh=Qh();function OL(i,e,t){const n=Qh();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{n[s]=Ng(s,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.0`)}catch{return Qh()}r.forEach(s=>{Zh[s]=Ng(s,i)})}else Ue(Zh,n);return n}const Pe=Zh;function wi(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ML(i){return typeof self<"u"&&i===self.ManagedMediaSource}function qv(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,s=n.length;return!r||!s||r===s&&!t.some(o=>n.indexOf(o)===-1)}function cn(i,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(i);if(e){const f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}const t=i.length;let n,r,s,o="",a=0;for(;a<t;){if(n=i[a++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:r=i[a++],o+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[a++],s=i[a++],o+=String.fromCharCode((n&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}const Xn={hexDump:function(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}};function FL(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ih={exports:{}},Bg;function NL(){return Bg||(Bg=1,function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,f){if(f=f||{},l=l.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var m=a.parseURL(u);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=a.normalizePath(m.path),a.buildURLFromParts(m)):u;var g=a.parseURL(l);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var y=r.exec(g.path);g.netLoc=y[1],g.path=y[2]}g.netLoc&&!g.path&&(g.path="/");var T={scheme:g.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(T.netLoc=g.netLoc,m.path[0]!=="/"))if(!m.path)T.path=g.path,m.params||(T.params=g.params,m.query||(T.query=g.query));else{var E=g.path,x=E.substring(0,E.lastIndexOf("/")+1)+m.path;T.path=a.normalizePath(x)}return T.path===null&&(T.path=f.alwaysNormalize?a.normalizePath(m.path):m.path),a.buildURLFromParts(T)},parseURL:function(l){var u=n.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=a})()}(ih)),ih.exports}var ed=NL();class xu{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Be={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class td{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,BL(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Be.AUDIO]:null,[Be.VIDEO]:null,[Be.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xu),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ed.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Be.AUDIO]=null,e[Be.VIDEO]=null,e[Be.AUDIOVIDEO]=null}}function At(i){return i.sn!=="initSegment"}class Cl extends td{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(ae(e)&&ae(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ae(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ae(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return At(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class Xv extends td{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Qv(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||Qv(t,e)}}function BL(i,e){const t=Qv(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const Yl=Math.pow(2,32)-1,UL=[].push,Zv={video:1,audio:2,id3:3,text:4};function ht(i){return String.fromCharCode.apply(null,i)}function Jv(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function ge(i,e){const t=eT(i,e);return t<0?4294967296+t:t}function Ug(i,e){let t=ge(i,e);return t*=Math.pow(2,32),t+=ge(i,e+4),t}function eT(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function rh(i,e,t){i[e]=t>>24,i[e+1]=t>>16&255,i[e+2]=t>>8&255,i[e+3]=t&255}function $L(i){const e=i.byteLength;for(let t=0;t<e;){const n=ge(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function ve(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const s=ge(i,r),o=ht(i.subarray(r+4,r+8)),a=s>1?r+s:n;if(o===e[0])if(e.length===1)t.push(i.subarray(r+8,a));else{const l=ve(i.subarray(r+8,a),e.slice(1));l.length&&UL.apply(t,l)}r=a}return t}function VL(i){const e=[],t=i[0];let n=8;const r=ge(i,n);n+=4;let s=0,o=0;t===0?(s=ge(i,n),o=ge(i,n+4),n+=8):(s=Ug(i,n),o=Ug(i,n+8),n+=16),n+=2;let a=i.length+o;const l=Jv(i,n);n+=2;for(let u=0;u<l;u++){let f=n;const d=ge(i,f);f+=4;const m=d&2147483647;if((d&2147483648)>>>31===1)return Pe.warn("SIDX has hierarchical references (not supported)"),null;const y=ge(i,f);f+=4,e.push({referenceSize:m,subsegmentDuration:y,info:{duration:y/r,start:a,end:a+m-1}}),a+=m,f+=4,n=f}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function tT(i){const e=[],t=ve(i,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],o=ve(s,["tkhd"])[0];if(o){let a=o[0];const l=ge(o,a===0?12:20),u=ve(s,["mdia","mdhd"])[0];if(u){a=u[0];const f=ge(u,a===0?12:20),d=ve(s,["mdia","hdlr"])[0];if(d){const m=ht(d.subarray(8,12)),g={soun:Be.AUDIO,vide:Be.VIDEO}[m],y=ve(s,["mdia","minf","stbl","stsd"])[0],T=GL(y);g?(e[l]={timescale:f,type:g,stsd:T},e[g]=Ne({timescale:f,id:l},T)):e[l]={timescale:f,type:m,stsd:T}}}}}return ve(i,["moov","mvex","trex"]).forEach(r=>{const s=ge(r,4),o=e[s];o&&(o.default={duration:ge(r,12),flags:ge(r,20)})}),e}function GL(i){const e=i.subarray(8),t=e.subarray(86),n=ht(e.subarray(4,8));let r=n,s;const o=n==="enca"||n==="encv";if(o){const u=ve(e,[n])[0].subarray(n==="enca"?28:78);ve(u,["sinf"]).forEach(d=>{const m=ve(d,["schm"])[0];if(m){const g=ht(m.subarray(4,8));if(g==="cbcs"||g==="cenc"){const y=ve(d,["frma"])[0];y&&(r=ht(y))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=ve(t,["avcC"])[0];r+="."+fl(l[1])+fl(l[2])+fl(l[3]),s=hl(a==="avc1"?"dva1":"dvav",t);break}case"mp4a":{const l=ve(e,[n])[0],u=ve(l.subarray(28),["esds"])[0];if(u&&u.length>7){let f=4;if(u[f++]!==3)break;f=sh(u,f),f+=2;const d=u[f++];if(d&128&&(f+=2),d&64&&(f+=u[f++]),u[f++]!==4)break;f=sh(u,f);const m=u[f++];if(m===64)r+="."+fl(m);else break;if(f+=12,u[f++]!==5)break;f=sh(u,f);const g=u[f++];let y=(g&248)>>3;y===31&&(y+=1+((g&7)<<3)+((u[f]&224)>>5)),r+="."+y}break}case"hvc1":case"hev1":{const l=ve(t,["hvcC"]);if(l){const u=l[0],f=u[1],d=["","A","B","C"][f>>6],m=f&31,g=ge(u,2),y=(f&32)>>5?"H":"L",T=u[12],E=u.subarray(6,12);r+="."+d+m,r+="."+g.toString(16).toUpperCase(),r+="."+y+T;let x="";for(let R=E.length;R--;){const L=E[R];(L||x)&&(x="."+L.toString(16).toUpperCase()+x)}r+=x}s=hl(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=hl(r,t)||r;break}case"vp09":{const l=ve(t,["vpcC"])[0],u=l[4],f=l[5],d=l[6]>>4&15;r+="."+qn(u)+"."+qn(f)+"."+qn(d);break}case"av01":{const l=ve(t,["av1C"])[0],u=l[1]>>>5,f=l[1]&31,d=l[2]>>>7?"H":"M",m=(l[2]&64)>>6,g=(l[2]&32)>>5,y=u===2&&m?g?12:10:m?10:8,T=(l[2]&16)>>4,E=(l[2]&8)>>3,x=(l[2]&4)>>2,R=l[2]&3;r+="."+u+"."+qn(f)+d+"."+qn(y)+"."+T+"."+E+x+R+"."+qn(1)+"."+qn(1)+"."+qn(1)+"."+0,s=hl("dav1",t);break}}return{codec:r,encrypted:o,supplemental:s}}function hl(i,e){const t=ve(e,["dvvC"]),n=t.length?t[0]:ve(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return i+"."+qn(r)+"."+qn(s)}}function sh(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function fl(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function qn(i){return(i<10?"0":"")+i}function HL(i,e){if(!i||!e)return i;const t=e.keyId;return t&&e.isCommonEncryption&&ve(i,["moov","trak"]).forEach(r=>{const o=ve(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=ve(o,["enca"]);const l=a.length>0;l||(a=ve(o,["encv"])),a.forEach(u=>{const f=l?u.subarray(28):u.subarray(78);ve(f,["sinf"]).forEach(m=>{const g=nT(m);if(g){const y=g.subarray(8,24);y.some(T=>T!==0)||(Pe.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Xn.hexDump(y)} -> ${Xn.hexDump(t)}`),g.set(t,8))}})})}),i}function nT(i){const e=ve(i,["schm"])[0];if(e){const t=ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return ve(i,["schi","tenc"])[0]}return null}function KL(i,e){return ve(e,["moof","traf"]).reduce((t,n)=>{const r=ve(n,["tfdt"])[0],s=r[0],o=ve(n,["tfhd"]).reduce((a,l)=>{const u=ge(l,4),f=i[u];if(f){let d=ge(r,4);if(s===1){if(d===Yl)return Pe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=Yl+1,d+=ge(r,8)}const m=f.timescale||9e4,g=d/m;if(ae(g)&&(a===null||g<a))return g}return a},null);return o!==null&&ae(o)&&(t===null||o<t)?o:t},null)}function zL(i,e){let t=0,n=0,r=0;const s=ve(i,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],l=ve(a,["tfhd"])[0],u=ge(l,4),f=e[u];if(!f)continue;const d=f.default,m=ge(l,0)|(d==null?void 0:d.flags);let g=d==null?void 0:d.duration;m&8&&(m&2?g=ge(l,12):g=ge(l,8));const y=f.timescale||9e4,T=ve(a,["trun"]);for(let E=0;E<T.length;E++){if(t=WL(T[E]),!t&&g){const x=ge(T[E],4);t=g*x}f.type===Be.VIDEO?n+=t/y:f.type===Be.AUDIO&&(r+=t/y)}}if(n===0&&r===0){let o=1/0,a=0,l=0;const u=ve(i,["sidx"]);for(let f=0;f<u.length;f++){const d=VL(u[f]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const m=d.references.reduce((g,y)=>g+y.info.duration||0,0);a=Math.max(a,m+d.earliestPresentationTime/d.timescale),l=a-o}}if(l&&ae(l))return l}return n||r}function WL(i){const e=ge(i,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let n=0;const r=ge(i,4);for(let s=0;s<r;s++){if(e&256){const o=ge(i,t);n+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return n}function jL(i,e,t){ve(e,["moof","traf"]).forEach(n=>{ve(n,["tfhd"]).forEach(r=>{const s=ge(r,4),o=i[s];if(!o)return;const a=o.timescale||9e4;ve(n,["tfdt"]).forEach(l=>{const u=l[0],f=t*a;if(f){let d=ge(l,4);if(u===0)d-=f,d=Math.max(d,0),rh(l,4,d);else{d*=Math.pow(2,32),d+=ge(l,8),d-=f,d=Math.max(d,0);const m=Math.floor(d/(Yl+1)),g=Math.floor(d%(Yl+1));rh(l,4,m),rh(l,8,g)}}})})})}function YL(i){const e={valid:null,remainder:null},t=ve(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function Cn(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function $g(i,e){const t=[],n=e.samples,r=e.timescale,s=e.id;let o=!1;return ve(n,["moof"]).map(l=>{const u=l.byteOffset-8;ve(l,["traf"]).map(d=>{const m=ve(d,["tfdt"]).map(g=>{const y=g[0];let T=ge(g,4);return y===1&&(T*=Math.pow(2,32),T+=ge(g,8)),T/r})[0];return m!==void 0&&(i=m),ve(d,["tfhd"]).map(g=>{const y=ge(g,4),T=ge(g,0)&16777215,E=(T&1)!==0,x=(T&2)!==0,R=(T&8)!==0;let L=0;const P=(T&16)!==0;let I=0;const C=(T&32)!==0;let D=8;y===s&&(E&&(D+=8),x&&(D+=4),R&&(L=ge(g,D),D+=4),P&&(I=ge(g,D),D+=4),C&&(D+=4),e.type==="video"&&(o=_u(e.codec)),ve(d,["trun"]).map(w=>{const k=w[0],O=ge(w,0)&16777215,W=(O&1)!==0;let q=0;const ie=(O&4)!==0,te=(O&256)!==0;let J=0;const Z=(O&512)!==0;let Q=0;const G=(O&1024)!==0,K=(O&2048)!==0;let z=0;const M=ge(w,4);let V=8;W&&(q=ge(w,V),V+=4),ie&&(V+=4);let ne=q+u;for(let re=0;re<M;re++){if(te?(J=ge(w,V),V+=4):J=L,Z?(Q=ge(w,V),V+=4):Q=I,G&&(V+=4),K&&(k===0?z=ge(w,V):z=eT(w,V),V+=4),e.type===Be.VIDEO){let oe=0;for(;oe<Q;){const fe=ge(n,ne);if(ne+=4,qL(o,n[ne])){const Te=n.subarray(ne,ne+fe);nd(Te,o?2:1,i+z/r,t)}ne+=fe,oe+=fe+4}}i+=J/r}}))})})}),t}function _u(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function qL(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function nd(i,e,t,n){const r=iT(i);let s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);const u=r.length-s;let f=s;if(a<u)s+=a;else if(a>u){Pe.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(r[f++]===181){const m=Jv(r,f);if(f+=2,m===49){const g=ge(r,f);if(f+=4,g===1195456820){const y=r[f++];if(y===3){const T=r[f++],E=31&T,x=64&T,R=x?2+E*3:0,L=new Uint8Array(R);if(x){L[0]=T;for(let P=1;P<R;P++)L[P]=r[f++]}n.push({type:y,payloadType:o,pts:t,bytes:L})}}}}}else if(o===5&&a>16){const d=[];for(let y=0;y<16;y++){const T=r[f++].toString(16);d.push(T.length==1?"0"+T:T),(y===3||y===5||y===7||y===9)&&d.push("-")}const m=a-16,g=new Uint8Array(m);for(let y=0;y<m;y++)g[y]=r[f++];n.push({payloadType:o,pts:t,uuid:d.join(""),userData:cn(g),userDataBytes:g})}}}function iT(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,s=new Uint8Array(r);let o=0;for(n=0;n<r;o++,n++)o===t[0]&&(o++,t.shift()),s[n]=i[o];return s}function XL(i){const e=i[0];let t="",n="",r=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;ht(i.subarray(u,u+1))!=="\0";)t+=ht(i.subarray(u,u+1)),u+=1;for(t+=ht(i.subarray(u,u+1)),u+=1;ht(i.subarray(u,u+1))!=="\0";)n+=ht(i.subarray(u,u+1)),u+=1;n+=ht(i.subarray(u,u+1)),u+=1,r=ge(i,12),s=ge(i,16),a=ge(i,20),l=ge(i,24),u=28}else if(e===1){u+=4,r=ge(i,u),u+=4;const d=ge(i,u);u+=4;const m=ge(i,u);for(u+=4,o=2**32*d+m,RL(o)||(o=Number.MAX_SAFE_INTEGER,Pe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=ge(i,u),u+=4,l=ge(i,u),u+=4;ht(i.subarray(u,u+1))!=="\0";)t+=ht(i.subarray(u,u+1)),u+=1;for(t+=ht(i.subarray(u,u+1)),u+=1;ht(i.subarray(u,u+1))!=="\0";)n+=ht(i.subarray(u,u+1)),u+=1;n+=ht(i.subarray(u,u+1)),u+=1}const f=i.subarray(u,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:f}}function QL(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(i,4),r=0,n=8;r<t;r++)s.set(e[r],n),n+=e[r].byteLength;return s}function ZL(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),QL([112,115,115,104],new Uint8Array([n,0,0,0]),i,s,r,o,t||new Uint8Array)}function JL(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const r=new DataView(i,n),s=e1(r);e.push(s),n+=s.size}}return e}function e1(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const s=i.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=i.buffer,a=Xn.hexDump(new Uint8Array(o,t+12,16)),l=i.getUint32(28);let u=null,f=null;if(s===0){if(e-32<l||l<22)return{offset:t,size:e};f=new Uint8Array(o,t+32,l)}else if(s===1){if(!l||n<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(o,t+32+d*16,16))}return{version:s,systemId:a,kids:u,data:f,offset:t,size:e}}const rT=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ps={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function sT(i,e){const t=Ps[e];return!!t&&!!t[i.slice(0,4)]}function Jh(i,e,t=!0){return!i.split(",").some(n=>!oT(n,e,t))}function oT(i,e,t=!0){var n;const r=wi(t);return(n=r==null?void 0:r.isTypeSupported(Uo(i,e)))!=null?n:!1}function Uo(i,e){return`${e}/mp4;codecs=${i}`}function Vg(i){if(i){const e=i.substring(0,4);return Ps.video[e]}return 2}function ql(i){const e=rT();return i.split(",").reduce((t,n)=>{const s=e&&_u(n)?9:Ps.video[n];return s?(s*2+t)/(t?3:2):(Ps.audio[n]+t)/(t?2:1)},0)}const oh={};function t1(i,e=!0){if(oh[i])return oh[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(oT(t[r],"audio",e))return oh[i]=t[r],t[r];if(t[r]==="mp3"&&(n=wi(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const n1=/flac|opus|mp4a\.40\.34/i;function Xl(i,e=!0){return i.replace(n1,t=>t1(t.toLowerCase(),e))}function i1(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)sT(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function bl(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function r1(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");if(n.length>2){let r=n.shift()+".";r+=parseInt(n.shift()).toString(16),r+=("000"+parseInt(n.shift()).toString(16)).slice(-4),e[t]=r}}return e.join(",")}function s1(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function Gg(i){const e=wi(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function aT(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const lT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function uT(i,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:i}}const Hg={};function o1(i,e,t,n,r,s){const o=i.audioCodec?i.audioGroups:null,a=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,u=l?parseInt(l):a?1/0:2;let f=null;if(o!=null&&o.length)try{o.length===1&&o[0]?f=e.groups[o[0]].channels:f=o.reduce((d,m)=>{if(m){const g=e.groups[m];if(!g)throw new Error(`Audio track group ${m} not found`);Object.keys(g.channels).forEach(y=>{d[y]=(d[y]||0)+g.channels[y]})}return d},{2:0})}catch{return!0}return i.videoCodec!==void 0&&(i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!f&&ae(u)&&Object.keys(f).some(d=>parseInt(d)>u)}function cT(i,e,t){const n=i.videoCodec,r=i.audioCodec;if(!n&&!r||!t)return Promise.resolve(lT);const s=[];if(n){const o={width:i.width,height:i.height,bitrate:Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)),framerate:i.frameRate||30},a=i.videoRange;a!=="SDR"&&(o.transferFunction=a.toLowerCase());const l=n.split(","),u=navigator.userAgent;if(l.some(f=>_u(f))&&rT())return Promise.resolve(uT(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${u})`),s));s.push.apply(s,l.map(f=>({type:"media-source",video:Ne(Ne({},o),{},{contentType:Uo(s1(f),"video")})})))}return r&&i.audioGroups&&i.audioGroups.forEach(o=>{var a;o&&((a=e.groups[o])==null||a.tracks.forEach(l=>{if(l.groupId===o){const u=l.channels||"",f=parseFloat(u);ae(f)&&f>2&&s.push.apply(s,r.split(",").map(d=>({type:"media-source",audio:{contentType:Uo(d,"audio"),channels:""+f}})))}}))}),Promise.all(s.map(o=>{const a=a1(o);return Hg[a]||(Hg[a]=t.decodingInfo(o))})).then(o=>({supported:!o.some(a=>!a.supported),configurations:s,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:s,decodingInfoResults:[],error:o}))}function a1(i){const{audio:e,video:t}=i,n=t||e;if(n){const r=aT(n.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${r}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${r}`}return""}const ef=["NONE","TYPE-0","TYPE-1",null];function l1(i){return ef.indexOf(i)>-1}const Ql=["SDR","PQ","HLG"];function u1(i){return!!i&&Ql.indexOf(i)>-1}var Ro={No:"",Yes:"YES",v2:"v2"};function Kg(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?Ro.v2:Ro.Yes:Ro.No}class tf{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ds{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return zg(this._audioGroups,e)}hasSubtitleGroup(e){return zg(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function zg(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function c1(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function h1(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||Ql.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&c1(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const f1=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},je=(i,e)=>JSON.stringify(i,f1(e));function d1(i,e,t,n,r){const s=Object.keys(i),o=n==null?void 0:n.channels,a=n==null?void 0:n.audioCodec,l=r==null?void 0:r.videoCodec,u=o&&parseInt(o)===2;let f=!1,d=!1,m=1/0,g=1/0,y=1/0,T=1/0,E=0,x=[];const{preferHDR:R,allowedVideoRanges:L}=h1(e,r);for(let w=s.length;w--;){const k=i[s[w]];f||(f=k.channels[2]>0),m=Math.min(m,k.minHeight),g=Math.min(g,k.minFramerate),y=Math.min(y,k.minBitrate),L.filter(W=>k.videoRanges[W]>0).length>0&&(d=!0)}m=ae(m)?m:0,g=ae(g)?g:0;const P=Math.max(1080,m),I=Math.max(30,g);y=ae(y)?y:t,t=Math.max(y,t),d||(e=void 0);const C=s.length>1;return{codecSet:s.reduce((w,k)=>{const O=i[k];if(k===w)return w;if(x=d?L.filter(W=>O.videoRanges[W]>0):[],C){if(O.minBitrate>t)return Yn(k,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),w;if(!O.hasDefaultAudio)return Yn(k,"no renditions with default or auto-select sound found"),w;if(a&&k.indexOf(a.substring(0,4))%5!==0)return Yn(k,`audio codec preference "${a}" not found`),w;if(o&&!u){if(!O.channels[o])return Yn(k,`no renditions with ${o} channel sound found (channels options: ${Object.keys(O.channels)})`),w}else if((!a||u)&&f&&O.channels[2]===0)return Yn(k,"no renditions with stereo sound found"),w;if(O.minHeight>P)return Yn(k,`min resolution of ${O.minHeight} > maximum of ${P}`),w;if(O.minFramerate>I)return Yn(k,`min framerate of ${O.minFramerate} > maximum of ${I}`),w;if(!x.some(W=>O.videoRanges[W]>0))return Yn(k,`no variants with VIDEO-RANGE of ${je(x)} found`),w;if(l&&k.indexOf(l.substring(0,4))%5!==0)return Yn(k,`video codec preference "${l}" not found`),w;if(O.maxScore<E)return Yn(k,`max score of ${O.maxScore} < selected max of ${E}`),w}return w&&(ql(k)>=ql(w)||O.fragmentError>i[w].fragmentError)?w:(T=O.minIndex,E=O.maxScore,k)},void 0),videoRanges:x,preferHDR:R,minFramerate:g,minBitrate:y,minIndex:T}}function Yn(i,e){Pe.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function hT(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function m1(i,e,t,n){return i.slice(t,n+1).reduce((r,s,o)=>{if(!s.codecSet)return r;const a=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(f=>{if(!f)return;const d=e.groups[f];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(m=>{l.channels[m]=(l.channels[m]||0)+d.channels[m]}))}),r},{})}function Wg(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}}function ei(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(Mr(i,r,t))return n}return-1}function Mr(i,e,t){const{groupId:n,name:r,lang:s,assocLang:o,default:a}=i,l=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(s===void 0||p1(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||g1(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function p1(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function g1(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function Ir(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function y1(i,e,t,n,r){const s=e[n],a=e.reduce((m,g,y)=>{const T=g.uri;return(m[T]||(m[T]=[])).push(y),m},{})[s.uri];a.length>1&&(n=Math.max.apply(Math,a));const l=s.videoRange,u=s.frameRate,f=s.codecSet.substring(0,4),d=jg(e,n,m=>{if(m.videoRange!==l||m.frameRate!==u||m.codecSet.substring(0,4)!==f)return!1;const g=m.audioGroups,y=t.filter(T=>!g||g.indexOf(T.groupId)!==-1);return ei(i,y,r)>-1});return d>-1?d:jg(e,n,m=>{const g=m.audioGroups,y=t.filter(T=>!g||g.indexOf(T.groupId)!==-1);return ei(i,y,r)>-1})}function jg(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function Zl(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class fT extends Oi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const u=performance.now(),f=s?s.stats:r.stats,d=s?s.duration:r.duration,m=u-f.loading.start,g=o.minAutoLevel,y=r.level,T=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||y<=g){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const E=T>-1&&T!==y,x=!!t||E;if(!x&&(l.paused||!l.playbackRate||!l.readyState))return;const R=o.mainForwardBufferInfo;if(!x&&R===null)return;const L=this.bwEstimator.getEstimateTTFB(),P=Math.abs(l.playbackRate);if(m<=Math.max(L,1e3*(d/(P*2))))return;const I=R?R.len/P:0,C=f.loading.first?f.loading.first-f.loading.start:-1,D=f.loaded&&C>-1,w=this.getBwEstimate(),k=o.levels,O=k[y],W=Math.max(f.loaded,Math.round(d*(r.bitrate||O.averageBitrate)/8));let q=D?m-C:m;q<1&&D&&(q=Math.min(m,f.loaded*8/w));const ie=D?f.loaded*1e3/q:0,te=L/1e3,J=ie?(W-f.loaded)/ie:W*8/w+te;if(J<=I)return;const Z=ie?ie*8:w,Q=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let K=Number.POSITIVE_INFINITY,z;for(z=y-1;z>g;z--){const re=k[z].maxBitrate,oe=!k[z].details||Q;if(K=this.getTimeToLoadFrag(te,Z,d*re,oe),K<Math.min(I,d+te))break}if(K>=J||K>d*10)return;D?this.bwEstimator.sample(m-Math.min(L,C),f.loaded):this.bwEstimator.sampleTTFB(m);const M=k[z].maxBitrate;this.getBwEstimate()*G>M&&this.resetEstimator(M);const V=this.findBestLevel(M,g,z,0,I,1,1);V>-1&&(z=V),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${I.toFixed(3)} s
      Estimated load time for current fragment: ${J.toFixed(3)} s
      Estimated load time for down switch fragment: ${K.toFixed(3)} s
      TTFB estimate: ${C|0} ms
      Current BW estimate: ${ae(w)?w|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${z} @ ${M|0} bps`),o.nextLoadLevel=o.nextAutoLevel=z,this.clearTimer();const ne=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===z&&z>0){const re=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${z>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${re.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,z>g){let oe=this.findBestLevel(this.hls.levels[g].bitrate,g,z,0,re,1,1);oe===-1&&(oe=g),this.hls.nextLoadLevel=this.hls.nextAutoLevel=oe,this.resetEstimator(this.hls.levels[oe].bitrate)}}};E||J>K*2?ne():this.timer=self.setInterval(ne,K*1e3),o.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new PL(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case $.BUFFER_ADD_CODEC_ERROR:case $.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case $.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:s}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const o=performance.now(),a=s?s.stats:n.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,r){const s=e+n/t,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;ae(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===ce.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(A.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ce.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:o}=n,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let f=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const E=this.findBestLevel(l,o,r,u,0,f,d);if(E>=0)return this.rebufferNotice=-1,E}let m=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const E=this.bitrateTestDelay;E&&(m=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=d=1)}const g=this.findBestLevel(l,o,r,u,m,f,d);if(this.rebufferNotice!==g&&(this.rebufferNotice=g,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${g}`)),g>-1)return g;const y=n.levels[o],T=n.loadLevelObj;return T&&(y==null?void 0:y.bitrate)<T.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,o,a){var l;const u=r+s,f=this.lastLoadedFragLevel,d=f===-1?this.hls.firstLevel:f,{fragCurrent:m,partCurrent:g}=this,{levels:y,allAudioTracks:T,loadLevel:E,config:x}=this.hls;if(y.length===1)return 0;const R=y[d],L=!!((l=this.hls.latestLevelDetails)!=null&&l.live),P=E===-1||f===-1;let I,C="SDR",D=(R==null?void 0:R.frameRate)||0;const{audioPreference:w,videoPreference:k}=x,O=this.audioTracksByGroup||(this.audioTracksByGroup=hT(T));let W=-1;if(P){if(this.firstSelection!==-1)return this.firstSelection;const Z=this.codecTiers||(this.codecTiers=m1(y,O,t,n)),Q=d1(Z,C,e,w,k),{codecSet:G,videoRanges:K,minFramerate:z,minBitrate:M,minIndex:V,preferHDR:ne}=Q;W=V,I=G,C=ne?K[K.length-1]:K[0],D=z,e=Math.max(e,M),this.log(`picked start tier ${je(Q)}`)}else I=R==null?void 0:R.codecSet,C=R==null?void 0:R.videoRange;const q=g?g.duration:m?m.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let Z=n;Z>=t;Z--){var J;const Q=y[Z],G=Z>d;if(!Q)continue;if(x.useMediaCapabilities&&!Q.supportedResult&&!Q.supportedPromise){const oe=navigator.mediaCapabilities;typeof(oe==null?void 0:oe.decodingInfo)=="function"&&(o1(Q,O,C,D,e,w)||_u(Q.videoCodec))?(Q.supportedPromise=cT(Q,O,oe),Q.supportedPromise.then(fe=>{if(!this.hls)return;Q.supportedResult=fe;const Te=this.hls.levels,Ie=Te.indexOf(Q);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${Ie} ${je(fe)}`):fe.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ie} ${je(fe)}`),Ie>-1&&Te.length>1&&(this.log(`Removing unsupported level ${Ie}`),this.hls.removeLevel(Ie),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):Q.supportedResult=lT}if((I&&Q.codecSet!==I||C&&Q.videoRange!==C||G&&D>Q.frameRate||!G&&D>0&&D<Q.frameRate||Q.supportedResult&&!((J=Q.supportedResult.decodingInfoResults)!=null&&J[0].smooth))&&(!P||Z!==W)){te.push(Z);continue}const K=Q.details,z=(g?K==null?void 0:K.partTarget:K==null?void 0:K.averagetargetduration)||q;let M;G?M=a*e:M=o*e;const V=q&&r>=q*2&&s===0?Q.averageBitrate:Q.maxBitrate,ne=this.getTimeToLoadFrag(ie,M,V*z,K===void 0);if(M>=V&&(Z===f||Q.loadError===0&&Q.fragmentError===0)&&(ne<=ie||!ae(ne)||L&&!this.bitrateTestDelay||ne<u)){const oe=this.forcedAutoLevel;return Z!==E&&(oe===-1||oe!==E)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${y[te[0]].codecs}" ${y[te[0]].videoRange}; not compatible with "${I}" ${C}`),this.info(`switch candidate:${d}->${Z} adjustedbw(${Math.round(M)})-bitrate=${Math.round(M-V)} ttfb:${ie.toFixed(1)} avgDuration:${z.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${ne.toFixed(1)} firstSelection:${P} codecSet:${Q.codecSet} videoRange:${Q.videoRange} hls.loadLevel:${E}`)),P&&(this.firstSelection=Z),Z}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const id={search:function(i,e){let t=0,n=i.length-1,r=null,s=null;for(;t<=n;){r=(t+n)/2|0,s=i[r];const o=e(s);if(o>0)t=r+1;else if(o<0)n=r-1;else return s}return null}};function v1(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!ae(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;t=t||0;for(let s=0;s<i.length;++s){const o=i[s];if(E1(e,t,o))return o}return null}function Gr(i,e,t=0,n=0,r=.005){let s=null;if(i){s=e[1+i.sn-e[0].sn]||null;const a=i.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&i.level!==s.level&&s.end<=i.end&&(s=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!i||i.level===s.level)&&Yg(t,n,s)===0||T1(s,i,Math.min(r,n))))return s;const o=id.search(e,Yg.bind(null,t,n));return o&&(o!==i||!s)?o:s}function T1(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return i.start<=n}return!1}function Yg(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function E1(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function dT(i,e){return id.search(i,t=>t.cc<e?1:t.cc>e?-1:0)}function S1(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){const n=t.start,r=t.end;let s=i.fragments;if(!t.relurl){const{fragmentHint:o}=i;o&&(s=s.concat(o))}return id.search(s,o=>o.cc<e||o.end<=n?1:o.cc>e||o.start>=r?-1:0)}return null}function Jl(i){switch(i.details){case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_TIMEOUT:case $.LEVEL_LOAD_TIMEOUT:case $.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function qg(i,e){const t=Jl(e);return i.default[`${t?"timeout":"error"}Retry`]}function rd(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function Xg(i){return Ne(Ne({},i),{errorRetry:null,timeoutRetry:null})}function eu(i,e,t,n){if(!i)return!1;const r=n==null?void 0:n.code,s=e<i.maxNumRetry&&(x1(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,s):s}function x1(i){return i===0&&navigator.onLine===!1||!!i&&(i<400||i>499)}var Tt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},In={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class mT extends Oi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ce.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case $.FRAG_LOAD_ERROR:case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_ERROR:case $.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case $.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=$o();return}case $.FRAG_GAP:case $.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Tt.SendAlternateToPenaltyBox;return}case $.LEVEL_EMPTY_ERROR:case $.LEVEL_PARSING_ERROR:{var o,a;const u=t.parent===ce.MAIN?t.level:r.loadLevel;t.details===$.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(a=o.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case $.LEVEL_LOAD_ERROR:case $.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case $.AUDIO_TRACK_LOAD_ERROR:case $.AUDIO_TRACK_LOAD_TIMEOUT:case $.SUBTITLE_LOAD_ERROR:case $.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=r.loadLevelObj;if(u&&(s.type===Re.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===Re.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Tt.SendAlternateToPenaltyBox,t.errorAction.flags=In.MoveAllAlternatesMatchingHost;return}}return;case $.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=r.loadLevelObj,f=u==null?void 0:u.attrs["HDCP-LEVEL"];f?t.errorAction={action:Tt.SendAlternateToPenaltyBox,flags:In.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(t)}return;case $.BUFFER_ADD_CODEC_ERROR:case $.REMUX_ALLOC_ERROR:case $.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:r.loadLevel)}return;case $.INTERNAL_EXCEPTION:case $.BUFFER_APPENDING_ERROR:case $.BUFFER_FULL_ERROR:case $.LEVEL_SWITCH_ERROR:case $.BUFFER_STALLED_ERROR:case $.BUFFER_SEEK_OVER_HOLE:case $.BUFFER_NUDGE_ON_STALL:t.errorAction=$o();return}t.type===he.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=qg(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(eu(r,s,Jl(e),e.response))return{action:Tt.RetryRequest,flags:In.None,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=qg(e.details.startsWith("key")?o:s,e),l=t.levels.reduce((f,d)=>f+d.fragmentError,0);if(r&&(e.details!==$.FRAG_GAP&&r.fragmentError++,eu(a,l,Jl(e),e.response)))return{action:Tt.RetryRequest,flags:In.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,n);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,o;const u=e.details;r.loadError++,u===$.BUFFER_APPEND_ERROR&&r.fragmentError++;let f=-1;const{levels:d,loadLevel:m,minAutoLevel:g,maxAutoLevel:y}=n;n.autoLevelEnabled||(n.loadLevel=-1);const T=(s=e.frag)==null?void 0:s.type,x=(T===ce.AUDIO&&u===$.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===$.BUFFER_ADD_CODEC_ERROR||u===$.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:C})=>r.audioCodec!==C),L=e.sourceBufferName==="video"&&(u===$.BUFFER_ADD_CODEC_ERROR||u===$.BUFFER_APPEND_ERROR)&&d.some(({codecSet:C,audioCodec:D})=>r.codecSet!==C&&r.audioCodec===D),{type:P,groupId:I}=(o=e.context)!=null?o:{};for(let C=d.length;C--;){const D=(C+m)%d.length;if(D!==m&&D>=g&&D<=y&&d[D].loadError===0){var a,l;const w=d[D];if(u===$.FRAG_GAP&&T===ce.MAIN&&e.frag){const k=d[D].details;if(k){const O=Gr(e.frag,k.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(P===Re.AUDIO_TRACK&&w.hasAudioGroup(I)||P===Re.SUBTITLE_TRACK&&w.hasSubtitleGroup(I))continue;if(T===ce.AUDIO&&(a=r.audioGroups)!=null&&a.some(k=>w.hasAudioGroup(k))||T===ce.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(k=>w.hasSubtitleGroup(k))||x&&r.audioCodec===w.audioCodec||!x&&r.audioCodec!==w.audioCodec||L&&r.codecSet===w.codecSet)continue}f=D;break}}if(f>-1&&n.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:Tt.SendAlternateToPenaltyBox,flags:In.None,nextAutoLevel:f}}return{action:Tt.SendAlternateToPenaltyBox,flags:In.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Tt.DoNothing:break;case Tt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==$.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Tt.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r,hdcpLevel:s,nextAutoLevel:o}=n;switch(r){case In.None:this.switchLevel(e,o);break;case In.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=ef[ef.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===$.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=aT(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===n&&this.hls.removeLevel(s)}}}function $o(i){const e={action:Tt.DoNothing,flags:In.None};return i&&(e.resolved=!0),e}var ft={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class _1{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const s=n[r];if(!s)break;const o=s.end;if(s.start<=e&&o!==null&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===t&&(!n||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===n&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(f=>{const d=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=hs(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(a=>{const l=n.elementaryStreams[a];if(!l)return;const u=t[a],f=o||l.partial===!0;s.range[a]=this.getBufferedTimes(n,e.part,f,u)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=n.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),dl(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=n.filter(r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=hs(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let f=0;f<r.length;f++){const d=r.start(f)-this.bufferPadding,m=r.end(f)+this.bufferPadding;if(u>=d&&l<=m){s.time.push({startPTS:Math.max(o,r.start(f)),endPTS:Math.min(a,r.end(f))});break}else if(o<m&&a>d){const g=Math.max(o,r.start(f)),y=Math.min(a,r.end(f));y>g&&(s.partial=!0,s.time.push({startPTS:g,endPTS:y}))}else if(a<=d)break}return s}getPartialFragment(e){let t=null,n,r,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const f=l[u];f&&dl(f)&&(r=f.body.start-a,s=f.body.end+a,e>=r&&e<=s&&(n=Math.min(e-r,s-e),o<=n&&(t=f.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||dl(t))}getState(e){const t=hs(e),n=this.fragments[t];return n?n.buffered?dl(n)?ft.PARTIAL:ft.OK:ft.APPENDING:ft.NOT_LOADED}isTimeBuffered(e,t,n){let r,s;for(let o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,s=n.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=hs(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:o}=t;if(n.sn==="initSegment")return;const a=n.type;if(r){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(r)}this.timeRanges=s;const l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=hs(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==n||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=hs(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=n.filter(s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const n=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;n&&n.forEach(r=>r.clearElementaryStreamInfo())}}function dl(i){var e,t,n;return i.buffered&&(i.body.gap||((e=i.range.video)==null?void 0:e.partial)||((t=i.range.audio)==null?void 0:t.partial)||((n=i.range.audiovideo)==null?void 0:n.partial))}function hs(i){return`${i.type}_${i.level}_${i.sn}`}var sr={cbc:0,ctr:1};class A1{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case sr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case sr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function L1(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class R1{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],o=n[2],a=n[3],l=this.invSubMix,u=l[0],f=l[1],d=l[2],m=l[3],g=new Uint32Array(256);let y=0,T=0,E=0;for(E=0;E<256;E++)E<128?g[E]=E<<1:g[E]=E<<1^283;for(E=0;E<256;E++){let x=T^T<<1^T<<2^T<<3^T<<4;x=x>>>8^x&255^99,e[y]=x,t[x]=y;const R=g[y],L=g[R],P=g[L];let I=g[x]*257^x*16843008;r[y]=I<<24|I>>>8,s[y]=I<<16|I>>>16,o[y]=I<<8|I>>>24,a[y]=I,I=P*16843009^L*65537^R*257^y*16843008,u[x]=I<<24|I>>>8,f[x]=I<<16|I>>>16,d[x]=I<<8|I>>>24,m[x]=I,y?(y=R^g[g[g[P^R]]],T^=g[g[T]]):y=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),d=this.sBox,m=this.rcon,g=this.invSubMix,y=g[0],T=g[1],E=g[2],x=g[3];let R,L;for(a=0;a<o;a++){if(a<s){R=u[a]=t[a];continue}L=R,a%s===0?(L=L<<8|L>>>24,L=d[L>>>24]<<24|d[L>>>16&255]<<16|d[L>>>8&255]<<8|d[L&255],L^=m[a/s|0]<<24):s>6&&a%s===4&&(L=d[L>>>24]<<24|d[L>>>16&255]<<16|d[L>>>8&255]<<8|d[L&255]),u[a]=R=(u[a-s]^L)>>>0}for(l=0;l<o;l++)a=o-l,l&3?L=u[a]:L=u[a-4],l<4||a<=4?f[l]=L:f[l]=y[d[L>>>24]]^T[d[L>>>16&255]]^E[d[L>>>8&255]]^x[d[L&255]],f[l]=f[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],f=a[2],d=a[3],m=this.uint8ArrayToUint32Array_(n);let g=m[0],y=m[1],T=m[2],E=m[3];const x=new Int32Array(e),R=new Int32Array(x.length);let L,P,I,C,D,w,k,O,W,q,ie,te,J,Z;const Q=this.networkToHostOrderSwap;for(;t<x.length;){for(W=Q(x[t]),q=Q(x[t+1]),ie=Q(x[t+2]),te=Q(x[t+3]),D=W^s[0],w=te^s[1],k=ie^s[2],O=q^s[3],J=4,Z=1;Z<r;Z++)L=l[D>>>24]^u[w>>16&255]^f[k>>8&255]^d[O&255]^s[J],P=l[w>>>24]^u[k>>16&255]^f[O>>8&255]^d[D&255]^s[J+1],I=l[k>>>24]^u[O>>16&255]^f[D>>8&255]^d[w&255]^s[J+2],C=l[O>>>24]^u[D>>16&255]^f[w>>8&255]^d[k&255]^s[J+3],D=L,w=P,k=I,O=C,J=J+4;L=o[D>>>24]<<24^o[w>>16&255]<<16^o[k>>8&255]<<8^o[O&255]^s[J],P=o[w>>>24]<<24^o[k>>16&255]<<16^o[O>>8&255]<<8^o[D&255]^s[J+1],I=o[k>>>24]<<24^o[O>>16&255]<<16^o[D>>8&255]<<8^o[w&255]^s[J+2],C=o[O>>>24]<<24^o[D>>16&255]<<16^o[w>>8&255]<<8^o[k&255]^s[J+3],R[t]=Q(L^g),R[t+1]=Q(C^y),R[t+2]=Q(I^T),R[t+3]=Q(P^E),g=W,y=q,T=ie,E=te,t=t+4}return R.buffer}}class I1{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=P1(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function P1(i){switch(i){case sr.cbc:return"AES-CBC";case sr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const D1=16;class sd{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?L1(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==sr.cbc||t.byteLength!==16)return Pe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Cn(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(n=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new R1),u.expandKey(t);const f=o;return this.currentResult=u.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new I1(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new A1(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Pe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%D1;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Pe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Qg=Math.pow(2,17);class w1{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Si({type:he.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){l(Jg(e));return}else e.gap=!1;const u=this.loader=s?new s(r):new o(r),f=Zg(e);e.loader=u;const d=Xg(r.fragLoadPolicy.default),m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Qg};e.stats=u.stats;const g={onSuccess:(y,T,E,x)=>{this.resetLoader(e,u);let R=y.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),a({frag:e,part:null,payload:R,networkDetails:x})},onError:(y,T,E,x)=>{this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ne({url:n,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:x}))},onAbort:(y,T,E)=>{this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,T,E)=>{this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:E,stats:y}))}};t&&(g.onProgress=(y,T,E,x)=>t({frag:e,part:null,payload:E,networkDetails:x})),u.load(f,m,g)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Jg(e,t));return}const u=this.loader=s?new s(r):new o(r),f=Zg(e,t);e.loader=u;const d=Xg(r.fragLoadPolicy.default),m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Qg};t.stats=u.stats,u.load(f,m,{onSuccess:(g,y,T,E)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:g.data,networkDetails:E};n(x),a(x)},onError:(g,y,T,E)=>{this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ne({url:f.url,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:T,stats:E}))},onAbort:(g,y,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:g}))},onTimeout:(g,y,T)=>{this.resetLoader(e,u),l(new Si({type:he.NETWORK_ERROR,details:$.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:T,stats:g}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(n.loaded/s),l),d=(l-u)*Math.round(n.loaded/u);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);const o=n.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Zg(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(ae(r)&&ae(s)){var o;let a=r,l=s;if(i.sn==="initSegment"&&C1((o=i.decryptdata)==null?void 0:o.method)){const u=s-r;u%16&&(l=s+(16-u%16)),r!==0&&(n.resetIV=!0,a=r-16)}n.rangeStart=a,n.rangeEnd=l}return n}function Jg(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:he.MEDIA_ERROR,details:$.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new Si(n)}function C1(i){return i==="AES-128"||i==="AES-256"}class Si extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class pT extends Oi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Au{constructor(e,t,n,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ml(),this.buffering={audio:ml(),video:ml(),audiovideo:ml()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=o}}function ml(){return{start:0,executeStart:0,executeEnd:0,end:0}}const e0={length:0,start:()=>0,end:()=>0};class xe{static isBuffered(e,t){if(e){const n=xe.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=xe.getBuffered(e);return xe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=xe.bufferedRanges(e);if(r.length)return xe.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((f,d)=>f.start-d.start||d.end-f.end);let r=-1,s=[];if(n)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(r=f);const d=s.length;if(d){const m=s[d-1].end;e[f].start-m<n?e[f].end>m&&(s[d-1].end=e[f].end):s.push(e[f])}else s.push(e[f])}else s=e;let o=0,a,l=t,u=t;for(let f=0;f<s.length;f++){const d=s[f].start,m=s[f].end;if(r===-1&&t>=d&&t<=m&&(r=f),t+n>=d&&t<m)l=d,u=m,o=u-t;else if(t+n<d){a=d;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||e0}catch(t){return Pe.log("failed to get media.buffered",t),e0}}}const gT=/\{\$([a-zA-Z0-9-_]+)\}/g;function t0(i){return gT.test(i)}function nf(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(gT,n=>{const r=n.substring(2,n.length-1),s=t==null?void 0:t[r];return s===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):s})}return e}function n0(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function b1(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const k1=/^(\d+)x(\d+)$/,i0=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ze{constructor(e,t){typeof e=="string"&&(e=ze.parseAttrList(e,t)),Ue(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=k1.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={},s='"';for(i0.lastIndex=0;(n=i0.exec(e))!==null;){const o=n[1].trim();let a=n[2];const l=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=nf(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Pe.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}}const O1="com.apple.hls.interstitial";function M1(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function F1(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class od{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:n,t){const s=t.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Pe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ue(new ze({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ae(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Pe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ae(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===O1}get isValid(){return!!this.id&&!this._badValueForSameId&&ae(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const N1=10;class yT{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?ae(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||N1}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function _s(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function ad(i){switch(i){case"AES-128":case"AES-256":return sr.cbc;case"AES-256-CTR":return sr.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function ld(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function rf(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function B1(i){const e=rf(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function U1(i){const e=function(n,r,s){const o=n[r];n[r]=n[s],n[s]=o};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function $1(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const s=r[0]==="base64",o=r[1];s?(n.splice(-1,1),t=ld(o)):t=B1(o)}}return t}const tu=typeof self<"u"?self:void 0;var Me={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ut={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ah(i){switch(i){case Ut.FAIRPLAY:return Me.FAIRPLAY;case Ut.PLAYREADY:return Me.PLAYREADY;case Ut.WIDEVINE:return Me.WIDEVINE;case Ut.CLEARKEY:return Me.CLEARKEY}}var pl={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function lh(i){if(i===pl.WIDEVINE)return Me.WIDEVINE;if(i===pl.PLAYREADY)return Me.PLAYREADY;if(i===pl.CENC||i===pl.CLEARKEY)return Me.CLEARKEY}function uh(i){switch(i){case Me.FAIRPLAY:return Ut.FAIRPLAY;case Me.PLAYREADY:return Ut.PLAYREADY;case Me.WIDEVINE:return Ut.WIDEVINE;case Me.CLEARKEY:return Ut.CLEARKEY}}function gl(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[Me.FAIRPLAY,Me.WIDEVINE,Me.PLAYREADY,Me.CLEARKEY].filter(r=>!!e[r]):[];return!n[Me.WIDEVINE]&&t&&n.push(Me.WIDEVINE),n}const ud=function(i){return tu!=null&&(i=tu.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function V1(i,e,t,n){let r;switch(i){case Me.FAIRPLAY:r=["cenc","sinf"];break;case Me.WIDEVINE:case Me.PLAYREADY:r=["cenc"];break;case Me.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return G1(r,e,t,n)}function G1(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function vT(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=ld(a).subarray(0,16);return U1(l),l}}return null}let yl={};class ws{static clearKeyUriToKeyIdMap(){yl={}}constructor(e,t,n,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!_s(e)}isSupported(){if(this.method){if(_s(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ut.FAIRPLAY:case Ut.WIDEVINE:case Ut.PLAYREADY:case Ut.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(_s(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Pe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=H1(e);return new ws(this.method,this.uri,"identity",this.keyFormatVersions,n)}const t=$1(this.uri);if(t)switch(this.keyFormat){case Ut.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Ut.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ZL(n,null,t),this.keyId=vT(t);break}default:{let n=t.subarray(0,16);if(n.length!==16){const r=new Uint8Array(16);r.set(n,16-n.length),n=r}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=yl[this.uri];if(!n){const r=Object.keys(yl).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,r),yl[this.uri]=n}this.keyId=n}return this}}function H1(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const r0=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,s0=/#EXT-X-MEDIA:(.*)/g,K1=/^#EXT(?:INF|-X-TARGETDURATION):/m,ch=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),z1=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Nn{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return ed.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return K1.test(e)}static parseMasterPlaylist(e,t){const n=t0(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];r0.lastIndex=0;let o;for(;(o=r0.exec(e))!=null;)if(o[1]){var a;const u=new ze(o[1],r),f=nf(r,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Nn.resolve(f,t)},m=u.decimalResolution("RESOLUTION");m&&(d.width=m.width,d.height=m.height),l0(u.CODECS,d);const g=u["SUPPLEMENTAL-CODECS"];g&&(d.supplemental={},l0(g,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||s.push(d),r.levels.push(d)}else if(o[3]){const u=o[3],f=o[4];switch(u){case"SESSION-DATA":{const d=new ze(f,r),m=d["DATA-ID"];m&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[m]=d);break}case"SESSION-KEY":{const d=o0(f,t,r);d.encrypted&&d.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(d)):Pe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const d=new ze(f,r);n0(r,d,t)}break}case"CONTENT-STEERING":{const d=new ze(f,r);r.contentSteering={uri:Nn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=a0(f);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const s={},o=n.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(s0.lastIndex=0;(r=s0.exec(e))!==null;){const u=new ze(r[1],n),f=u.TYPE;if(f){const d=a[f],m=s[f]||[];s[f]=m;const g=u.LANGUAGE,y=u["ASSOC-LANGUAGE"],T=u.CHANNELS,E=u.CHARACTERISTICS,x=u["INSTREAM-ID"],R={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||g||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:g,url:u.URI?Nn.resolve(u.URI,t):""};if(y&&(R.assocLang=y),T&&(R.channels=T),E&&(R.characteristics=E),x&&(R.instreamId=x),d!=null&&d.length){const L=Nn.findGroup(d,R.groupId)||d[0];u0(R,L,"audioCodec"),u0(R,L,"textCodec")}m.push(R)}}return s}static parseLevelPlaylist(e,t,n,r,s,o){var a;const l={url:t},u=new yT(t),f=u.fragments,d=[];let m=null,g=0,y=0,T=0,E=0,x=0,R=null,L=new Cl(r,l),P,I,C,D=-1,w=!1,k=null,O;if(ch.lastIndex=0,u.m3u8=e,u.hasVariableRefs=t0(e),((a=ch.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(P=ch.exec(e))!==null;){w&&(w=!1,L=new Cl(r,l),L.playlistOffset=T,L.start=T,L.sn=g,L.cc=E,x&&(L.bitrate=x),L.level=n,m&&(L.initSegment=m,m.rawProgramDateTime&&(L.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),k&&(L.setByteRange(k),k=null)));const te=P[1];if(te){L.duration=parseFloat(te);const J=(" "+P[2]).slice(1);L.title=J||null,L.tagList.push(J?["INF",te,J]:["INF",te])}else if(P[3]){if(ae(L.duration)){L.playlistOffset=T,L.start=T,C&&h0(L,C,u),L.sn=g,L.level=n,L.cc=E,f.push(L);const J=(" "+P[3]).slice(1);L.relurl=nf(u,J),sf(L,R,d),R=L,T+=L.duration,g++,y=0,w=!0}}else{if(P=P[0].match(z1),!P){Pe.warn("No matches on slow regex match for level playlist!");continue}for(I=1;I<P.length&&P[I]===void 0;I++);const J=(" "+P[I]).slice(1),Z=(" "+P[I+1]).slice(1),Q=P[I+2]?(" "+P[I+2]).slice(1):null;switch(J){case"BYTERANGE":R?L.setByteRange(Z,R):L.setByteRange(Z);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=Z,L.tagList.push(["PROGRAM-DATE-TIME",Z]),D===-1&&(D=f.length);break;case"PLAYLIST-TYPE":u.type&&Ti(u,J,P),u.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Ti(u,J,P):f.length>0&&f0(u,J,P),g=u.startSN=parseInt(Z);break;case"SKIP":{u.skippedSegments&&Ti(u,J,P);const G=new ze(Z,u),K=G.decimalInteger("SKIPPED-SEGMENTS");if(ae(K)){u.skippedSegments+=K;for(let M=K;M--;)f.push(null);g+=K}const z=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");z&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(z.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Ti(u,J,P),u.targetduration=Math.max(parseInt(Z),1);break;case"VERSION":u.version!==null&&Ti(u,J,P),u.version=parseInt(Z);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Ti(u,J,P),u.live=!1;break;case"#":(Z||Q)&&L.tagList.push(Q?[Z,Q]:[Z]);break;case"DISCONTINUITY":E++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([J]);break;case"BITRATE":L.tagList.push([J,Z]),x=parseInt(Z)*1e3,ae(x)?L.bitrate=x:x=0;break;case"DATERANGE":{const G=new ze(Z,u),K=new od(G,u.dateRanges[G.ID],u.dateRangeTagCount);u.dateRangeTagCount++,K.isValid||u.skippedSegments?u.dateRanges[K.id]=K:Pe.warn(`Ignoring invalid DATERANGE tag: "${Z}"`),L.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DEFINE":{{const G=new ze(Z,u);"IMPORT"in G?b1(u,G,o):n0(u,G,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Ti(u,J,P):f.length>0&&f0(u,J,P),u.startCC=E=parseInt(Z);break;case"KEY":{const G=o0(Z,t,u);if(G.isSupported()){if(G.method==="NONE"){C=void 0;break}C||(C={}),C[G.keyFormat]&&(C=Ue({},C)),C[G.keyFormat]=G}else Pe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Z}"`);break}case"START":u.startTimeOffset=a0(Z);break;case"MAP":{const G=new ze(Z,u);if(L.duration){const K=new Cl(r,l);c0(K,G,n,C),m=K,L.initSegment=m,m.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=m.rawProgramDateTime)}else{const K=L.byteRangeEndOffset;if(K){const z=L.byteRangeStartOffset;k=`${K-z}@${z}`}else k=null;c0(L,G,n,C),m=L,w=!0}m.cc=E;break}case"SERVER-CONTROL":{O&&Ti(u,J,P),O=new ze(Z),u.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),u.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Ti(u,J,P);const G=new ze(Z);u.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=u.partList;G||(G=u.partList=[]);const K=y>0?G[G.length-1]:void 0,z=y++,M=new ze(Z,u),V=new Xv(M,L,l,z,K);G.push(V),L.duration+=V.duration;break}case"PRELOAD-HINT":{const G=new ze(Z,u);u.preloadHint=G;break}case"RENDITION-REPORT":{const G=new ze(Z,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(G);break}default:Pe.warn(`line parsed but not handled: ${P}`);break}}}R&&!R.relurl?(f.pop(),T-=R.duration,u.partList&&(u.fragmentHint=R)):u.partList&&(sf(L,R,d),L.cc=E,u.fragmentHint=L,C&&h0(L,C,u)),u.targetduration||(u.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const W=f.length,q=f[0],ie=f[W-1];if(T+=u.skippedSegments*u.targetduration,T>0&&W&&ie){u.averagetargetduration=T/W;const te=ie.sn;u.endSN=te!=="initSegment"?te:0,u.live||(ie.endList=!0),q&&u.startCC===void 0&&(u.startCC=q.cc),D>0&&(j1(f,D),q&&d.unshift(q))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(T+=u.fragmentHint.duration),u.totalduration=T,d.length&&u.dateRangeTagCount&&q&&TT(d,u),u.endCC=E,u}}function TT(i,e){const t=i.length,n=i[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const a=e.dateRanges[s[o]],l=a.startDate.getTime();a.tagAnchor=n.ref;for(let u=t;u--;){const f=W1(e,l,i,u,r);if(f!==-1){a.tagAnchor=e.fragments[f].ref;break}}}}function W1(i,e,t,n,r){const s=t[n];if(s){const a=s.programDateTime;if(e>=a||n===0){var o;const l=(((o=t[n+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){const u=t[n].sn-i.startSN,f=i.fragments;if(f.length>t.length){const m=(t[n+1]||f[f.length-1]).sn-i.startSN;for(let g=m;g>u;g--){const y=f[g].programDateTime;if(e>=y&&e<y+f[g].duration*1e3)return g}}return u}}}return-1}function o0(i,e,t){var n,r;const s=new ze(i,t),o=(n=s.METHOD)!=null?n:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,f=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Pe.error(`Invalid IV: ${s.IV}`);const d=a?Nn.resolve(a,e):"",m=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ws(o,d,f,m,l)}function a0(i){const t=new ze(i).decimalFloatingPoint("TIME-OFFSET");return ae(t)?t:null}function l0(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(s=>sT(s,n));r.length&&(e[`${n}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function u0(i,e,t){const n=e[t];n&&(i[t]=n)}function j1(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function sf(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function c0(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function h0(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function Ti(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function f0(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function hh(i,e){const t=e.startPTS;if(ae(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function ET(i,e,t,n,r,s){n-t<=0&&(Pe.warn("Fragment should have a positive duration",e),n=t+e.duration,s=r+e.duration);let a=t,l=n;const u=e.startPTS,f=e.endPTS;if(ae(u)){const E=Math.abs(u-t);ae(e.deltaPTS)?e.deltaPTS=Math.max(E,e.deltaPTS):e.deltaPTS=E,a=Math.max(t,u),t=Math.min(t,u),r=Math.min(r,e.startDTS),l=Math.min(n,f),n=Math.max(n,f),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=a,e.startDTS=r,e.endPTS=n,e.minEndPTS=l,e.endDTS=s;const m=e.sn;if(!i||m<i.startSN||m>i.endSN)return 0;let g;const y=m-i.startSN,T=i.fragments;for(T[y]=e,g=y;g>0;g--)hh(T[g],T[g-1]);for(g=y;g<T.length-1;g++)hh(T[g],T[g+1]);return i.fragmentHint&&hh(T[T.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,d}function Y1(i,e){if(i===e)return;let t=null;const n=i.fragments;for(let l=n.length-1;l>=0;l--){const u=n[l].initSegment;if(u){t=u;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;Q1(i,e,(l,u,f,d)=>{if(e.skippedSegments&&u.cc!==l.cc){const m=l.cc-u.cc;for(let g=f;g<d.length;g++)d[g].cc+=m}ae(l.startPTS)&&ae(l.endPTS)&&(u.setStart(u.startPTS=l.startPTS),u.startDTS=l.startDTS,u.maxStartPTS=l.maxStartPTS,u.endPTS=l.endPTS,u.endDTS=l.endDTS,u.minEndPTS=l.minEndPTS,u.setDuration(l.endPTS-l.startPTS),u.duration&&(r=u),e.PTSKnown=e.alignedSliding=!0),l.hasStreams&&(u.elementaryStreams=l.elementaryStreams),u.loader=l.loader,l.hasStats&&(u.stats=l.stats),l.initSegment&&(u.initSegment=l.initSegment,t=l.initSegment)});const s=e.fragments,o=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&o.forEach(l=>{var u;l&&(!l.initSegment||l.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(l.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=s.some(l=>!l),e.deltaUpdateFailed){Pe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)s.shift();e.startSN=s[0].sn}else{e.endCC=s[s.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=q1(i.dateRanges,e));const l=i.fragments.filter(u=>u.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let u=1;u<o.length;u++)o[u].programDateTime===null&&sf(o[u],o[u-1],l);TT(l,e)}X1(i.partList,e.partList,(l,u)=>{u.elementaryStreams=l.elementaryStreams,u.stats=l.stats}),r?ET(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):ST(i,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function q1(i,e){const{dateRanges:t,recentlyRemovedDateranges:n}=e,r=Ue({},i);n&&n.forEach(a=>{delete r[a]});const o=Object.keys(r).length;return o&&Object.keys(t).forEach(a=>{const l=r[a],u=new od(t[a].attr,l);u.isValid?(r[a]=u,l||(u.tagOrder+=o)):Pe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${je(t[a].attr)}"`)}),r}function X1(i,e,t){if(i&&e){let n=0;for(let r=0,s=i.length;r<=s;r++){const o=i[r],a=e[r+n];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):n--}}}function Q1(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,s=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,o=e.startSN-i.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let u=r;u<=s;u++){const f=l[o+u];let d=a[u];if(n&&!d&&f&&(d=e.fragments[u]=f),f&&d){if(t(f,d,u,a),f.url&&f.url!==d.url){e.playlistParsingError=d0(`media sequence mismatch ${d.sn}:`,i,e,f,d);return}else if(f.cc!==d.cc){e.playlistParsingError=d0(`discontinuity sequence mismatch (${f.cc}!=${d.cc})`,i,e,f,d);return}}}}function d0(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ST(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,s=n>=0;let o=0;if(s&&n<r.length)o=r[n].start;else if(s&&e.startSN===i.endSN+1)o=i.fragmentEnd;else if(s&&t)o=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=i.fragmentStart;else return;of(e,o)}function of(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function xT(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function Z1(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function m0(i,e,t){return i?_T(i.partList,e,t):null}function _T(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function AT(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Io(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function J1(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function p0(i,e){if(i){const t=i.start+e;i.start=i.startPTS=t,i.endPTS=t+i.duration}}function LT(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)p0(t[n],i);e.fragmentHint&&p0(e.fragmentHint,i),e.alignedSliding=!0}function eR(i,e){i&&(RT(e,i),!e.alignedSliding&&i&&nu(e,i),!e.alignedSliding&&i&&!e.skippedSegments&&ST(i,e,!1))}function RT(i,e){if(!J1(e,i))return;const t=Math.min(e.endCC,i.endCC),n=Io(e.fragments,t),r=Io(i.fragments,t);if(!n||!r)return;Pe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-r.start;LT(s,i)}function nu(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,s;const o=Math.min(e.endCC,i.endCC);e.startCC<o&&i.startCC<o&&(r=Io(n,o),s=Io(t,o)),(!r||!s)&&(r=n[Math.floor(n.length/2)],s=Io(t,r.cc)||t[Math.floor(t.length/2)]);const a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(s.start-r.start);LT(u,i)}const tR={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},X={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Lu extends pT{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=X.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:f}=this,d=l?l.currentTime:0,m=xe.bufferInfo(u||l,d,o.maxBufferHole);if(this.log(`media seeking to ${ae(d)?d.toFixed(3):d}, state: ${f}`),this.state===X.ENDED)this.resetLoadingState();else if(a){const g=o.maxFragLookUpTolerance,y=a.start-g,T=a.start+a.duration+g;if(!m.len||T<m.start||y>m.end){const E=d>T;(d<y||E)&&(E&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const y=Math.max(m.end,d),T=this.shouldLoadParts(this.getLevelDetails(),y);T&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=T)}}!this.hls.hasEnoughToStart&&!m.len&&(this.log(`setting startPosition to ${d} because of seek before start`),this.nextLoadPosition=this.startPosition=d),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new w1(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new sd(e.config)}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===X.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=X.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.nextStart;if(s&&s>r&&s<t.edge||this.media.currentTime<e.start)return!1;const a=t.partList;if(a!=null&&a.length){const u=a[a.length-1];return xe.isBuffered(this.media,u.start+u.duration/2)}const l=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(l)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),n.addEventListener("seeking",this.onMediaSeeking),n.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===X.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=X.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,r).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===X.FRAG_LOADING||!this.fragCurrent&&o===X.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=X.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(A.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===X.STOPPED||this.state===X.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===ft.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===ft.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(A.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:s,payload:o}=n,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&_s(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,ad(a.method)).catch(u=>{throw r.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const f=self.performance.now();return r.trigger(A.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:f}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===X.STOPPED||this.state===X.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==X.STOPPED&&(this.state=X.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?tR.toString(xe.getBuffered(n)):"(detached)"})`),At(e)){var r;if(e.type!==ce.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=X.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=X.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Au(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var s;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=X.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(A.KEY_LOADED,d),this.state===X.KEY_LOADING&&(this.state=X.IDLE),d}),this.hls.trigger(A.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments);const l=this.fragPrevious;if(At(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(n=Math.max(e.start,n||0),this.loadingParts&&At(e)){const d=o.partList;if(d&&r){n>e.end&&o.fragmentHint&&(e=o.fragmentHint);const m=this.getNextPart(d,e,n);if(m>-1){const g=d[m];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${m}/${d.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=X.FRAG_LOADING;let y;return a?y=a.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,g,t,r)).catch(T=>this.handleFragLoadError(T)):y=this.doFragPartsLoad(e,g,t,r).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:g,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(d,n))return Promise.resolve(null)}}if(At(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(n.toFixed(3))}`),ae(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=X.FRAG_LOADING;const u=this.config.progressive;let f;return u&&a?f=a.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,r)).catch(d=>this.handleFragLoadError(d)):f=Promise.all([this.fragmentLoader.load(e,u?r:void 0),a]).then(([d])=>(!u&&d&&r&&r(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,n,r){return new Promise((s,o)=>{var a;const l=[],u=(a=n.details)==null?void 0:a.partList,f=d=>{this.fragmentLoader.loadPart(e,d,r).then(m=>{l[d.index]=m;const g=m.part;this.hls.trigger(A.FRAG_LOADED,m);const y=m0(n.details,e.sn,d.index+1)||_T(u,e.sn,d.index+1);if(y)f(y);else return s({frag:e,part:g,partsLoaded:l})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===$.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==X.PARSING){!this.fragCurrent&&this.state!==X.STOPPED&&this.state!==X.ERROR&&(this.state=X.IDLE);return}const{frag:n,part:r,level:s}=t,o=self.performance.now();n.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var n;const s=e.partList[0],o=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=t[r],l=a.details,u=o>-1?m0(l,s,o):null,f=u?u.fragment:Z1(l,s,n);return f?(n&&n!==f&&(f.stats=n.stats),{frag:f,part:u,level:a}):null}bufferFragmentData(e,t,n,r,s){var o;if(!e||this.state!==X.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(a&&l&&(u=Cn(a,l)),!((o=u)!=null&&o.length))return;const f={type:e.type,frag:t,part:n,chunkMeta:r,parent:t.type,data:u};if(this.hls.trigger(A.BUFFER_APPENDING,f),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!xe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=xe.bufferInfo(t,n,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),n+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!ae(r))return null;const o=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,n,r){const s=xe.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-t,r);return xe.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return s>=r?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=ce.MAIN){var n;const r=(n=this.fragmentTracker)==null?void 0:n.getAppendedFrag(e,t);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,o=n[0].start,a=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(r<d)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t,n);const m=this.hls.startPosition,g=this.hls.liveSyncPosition,y=l?(m!==-1&&m>=o?m:g)||l.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${g} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=o&&(l=n[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let f=this.filterReplacedPrimary(l,t);if(!f&&l){const d=l.sn-t.startSN;f=this.filterReplacedPrimary(n[d+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===ft.OK||n===ft.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(a!==null&&n.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(g0(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(g0(this.hls.config)&&e.type!==ce.SUBTITLE){const n=this.hls.interstitialsManager,r=n==null?void 0:n.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,r>-1&&n<u.start)break;const f=u.loaded;f?r=-1:(s||u.independent||o)&&u.fragment===t&&(r=a),s=f}return r}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=v1(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];n.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=dT(t,n.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:u}=r,f=n.partList,d=!!(this.loadingParts&&f!=null&&f.length&&l);d&&l&&!this.bitrateTest&&f[f.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let m;if(e<t){var g;const T=e<this.lastCurrentTime||e>t-u||(g=this.media)!=null&&g.paused||!this.startFragRequested?0:u;m=Gr(s,o,e,T)}else m=o[o.length-1];if(m){const y=m.sn-n.startSN,T=this.fragmentTracker.getState(m);if((T===ft.OK||T===ft.PARTIAL&&m.gap)&&(s=m),s&&m.sn===s.sn&&(!d||f[0].fragment.sn>m.sn||!n.live&&!d)&&s&&m.level===s.level){const x=o[y+1];m.sn<a&&this.fragmentTracker.getState(x)!==ft.OK?m=x:m=null}}return m}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!t,a=e.alignedSliding&&ae(s);if(o||!a&&!s){eR(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&ae(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&At(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==X.FRAG_LOADING_WAITING_RETRY)&&(this.state=X.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=t.details===$.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const o=t.errorAction,{action:a,flags:l,retryCount:u=0,retryConfig:f}=o||{},d=!!o&&!!f,m=d&&a===Tt.RetryRequest,g=d&&!o.resolved&&l===In.MoveAllAlternatesMatchingHost;if(!m&&g&&At(n)&&!n.endList)this.resetFragmentErrors(e),this.treatAsGap(n),o.resolved=!0;else if((m||g)&&u<f.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const y=rd(f,u);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${u+1}/${f.maxNumRetry} in ${y}ms`),o.resolved=!0,this.retryDate=self.performance.now()+y,this.state=X.FRAG_LOADING_WAITING_RETRY}else if(f&&o)if(this.resetFragmentErrors(e),u<f.maxNumRetry)!s&&a!==Tt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else a===Tt.SendAlternateToPenaltyBox?this.state=X.WAITING_LEVEL:this.state=X.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===X.PARSING||this.state===X.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ce.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==X.STOPPED&&(this.state=X.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=xe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===X.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==X.STOPPED&&(this.state=X.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const f=e.elementaryStreams[u];if(f){const d=f.endPTS-f.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const m=r?0:ET(s,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:s,level:n,drift:m,type:u,frag:e,start:f.startPTS,end:f.endPTS}),!0}return l},!1)){var a;if(n.fragmentError===0&&this.treatAsGap(e,n),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=X.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ce.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function g0(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class IT{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=nR(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function nR(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const s=i[r];t.set(s,n),n+=s.length}return t}var fh={exports:{}},y0;function iR(){return y0||(y0=1,function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function s(l,u,f,d,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var g=new r(f,d||l,m),y=t?t+u:u;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],g]:l._events[y].push(g):(l._events[y]=g,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],f,d;if(this._eventsCount===0)return u;for(d in f=this._events)e.call(f,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},a.prototype.listeners=function(u){var f=t?t+u:u,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var m=0,g=d.length,y=new Array(g);m<g;m++)y[m]=d[m].fn;return y},a.prototype.listenerCount=function(u){var f=t?t+u:u,d=this._events[f];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,f,d,m,g,y){var T=t?t+u:u;if(!this._events[T])return!1;var E=this._events[T],x=arguments.length,R,L;if(E.fn){switch(E.once&&this.removeListener(u,E.fn,void 0,!0),x){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,f),!0;case 3:return E.fn.call(E.context,f,d),!0;case 4:return E.fn.call(E.context,f,d,m),!0;case 5:return E.fn.call(E.context,f,d,m,g),!0;case 6:return E.fn.call(E.context,f,d,m,g,y),!0}for(L=1,R=new Array(x-1);L<x;L++)R[L-1]=arguments[L];E.fn.apply(E.context,R)}else{var P=E.length,I;for(L=0;L<P;L++)switch(E[L].once&&this.removeListener(u,E[L].fn,void 0,!0),x){case 1:E[L].fn.call(E[L].context);break;case 2:E[L].fn.call(E[L].context,f);break;case 3:E[L].fn.call(E[L].context,f,d);break;case 4:E[L].fn.call(E[L].context,f,d,m);break;default:if(!R)for(I=1,R=new Array(x-1);I<x;I++)R[I-1]=arguments[I];E[L].fn.apply(E[L].context,R)}}return!0},a.prototype.on=function(u,f,d){return s(this,u,f,d,!1)},a.prototype.once=function(u,f,d){return s(this,u,f,d,!0)},a.prototype.removeListener=function(u,f,d,m){var g=t?t+u:u;if(!this._events[g])return this;if(!f)return o(this,g),this;var y=this._events[g];if(y.fn)y.fn===f&&(!m||y.once)&&(!d||y.context===d)&&o(this,g);else{for(var T=0,E=[],x=y.length;T<x;T++)(y[T].fn!==f||m&&!y[T].once||d&&y[T].context!==d)&&E.push(y[T]);E.length?this._events[g]=E.length===1?E[0]:E:o(this,g)}return this},a.prototype.removeAllListeners=function(u){var f;return u?(f=t?t+u:u,this._events[f]&&o(this,f)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a}(fh)),fh.exports}var rR=iR(),cd=FL(rR);const Vo="1.6.0",Cs={};function sR(){return typeof __HLS_WORKER_BUNDLE__=="function"}function oR(){const i=Cs[Vo];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Cs[Vo]=r,r}function aR(i){const e=Cs[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Cs[i]=r,r}function lR(i){const e=Cs[i||Vo];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete Cs[i||Vo],r&&self.URL.revokeObjectURL(r),n.terminate()}}function PT(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function hd(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Ru(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Go(i,e){const t=e;let n=0;for(;hd(i,e);){n+=10;const r=Ru(i,e+6);n+=r,PT(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function uR(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){const g=new Error(`invalid ADTS sampling index:${o}`);i.emit(A.ERROR,A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!0,error:g,reason:g.message});return}const a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+a,f=r[o];let d=o;(a===5||a===29)&&(d-=3);const m=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return Pe.log(`manifest codec:${n}, parsed codec:${u}, channels:${l}, rate:${f} (ADTS object type:${a} sampling index:${o})`),{config:m,samplerate:f,channelCount:l,codec:u,parsedCodec:u,manifestCodec:n}}function DT(i,e){return i[e]===255&&(i[e+1]&246)===240}function wT(i,e){return i[e+1]&1?7:9}function fd(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function cR(i,e){return e+5<i.length}function iu(i,e){return e+1<i.length&&DT(i,e)}function hR(i,e){return cR(i,e)&&DT(i,e)&&fd(i,e)<=i.length-e}function fR(i,e){if(iu(i,e)){const t=wT(i,e);if(e+t>=i.length)return!1;const n=fd(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||iu(i,r)}return!1}function CT(i,e,t,n,r){if(!i.samplerate){const s=uR(e,t,n,r);if(!s)return;Ue(i,s)}}function bT(i){return 1024*9e4/i}function dR(i,e){const t=wT(i,e);if(e+t<=i.length){const n=fd(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function kT(i,e,t,n,r){const s=bT(i.samplerate),o=n+r*s,a=dR(e,t);let l;if(a){const{frameLength:d,headerLength:m}=a,g=m+d,y=Math.max(0,t+g-e.length);y?(l=new Uint8Array(g-m),l.set(e.subarray(t+m,e.length),0)):l=e.subarray(t+m,t+g);const T={unit:l,pts:o};return y||i.samples.push(T),{sample:T,length:g,missing:y}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function mR(i,e){return hd(i,e)&&Ru(i,e+6)+10<=i.length-e}function pR(i){if(i.size<2)return;const e=cn(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function gR(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=cn(i.data.subarray(t),!0);t+=n.length+1;const r=cn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=cn(i.data.subarray(1));return{key:i.type,info:"",data:e}}function yR(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=cn(i.data.subarray(t),!0);t+=n.length+1;const r=cn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=cn(i.data);return{key:i.type,info:"",data:e}}function vR(i){return btoa(String.fromCharCode(...i))}function OT(i,e){if(i<0)return-OT(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}function TR(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")}function ER(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function SR(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function dh(i,e=0,t=1/0){return xR(i,e,t,Uint8Array)}function xR(i,e,t,n){const r=_R(i);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const o=AR(i)?i.byteOffset:0,a=(o+i.byteLength)/s,l=(o+e)/s,u=Math.floor(Math.max(0,Math.min(l,a))),f=Math.floor(Math.min(u+Math.max(t,0),a));return new n(r,u,f-u)}function _R(i){return i instanceof ArrayBuffer?i:i.buffer}function AR(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function LR(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=cn(dh(i.data,1,n)),s=i.data[2+n],o=i.data.subarray(3+n).indexOf(0);if(o===-1)return;const a=cn(dh(i.data,3+n,o));let l;return r==="-->"?l=cn(dh(i.data,4+n+o)):l=SR(i.data.subarray(4+n+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function RR(i){return i.type==="PRIV"?pR(i):i.type[0]==="W"?yR(i):i.type==="APIC"?LR(i):gR(i)}function IR(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Ru(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const vl=10,PR=10;function MT(i){let e=0;const t=[];for(;hd(i,e);){const n=Ru(i,e+6);i[e+5]>>6&1&&(e+=vl),e+=vl;const r=e+n;for(;e+PR<r;){const s=IR(i.subarray(e)),o=RR(s);o&&t.push(o),e+=s.size+vl}PT(i,e)&&(e+=vl)}return t}function FT(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function DR(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function dd(i){const e=MT(i);for(let t=0;t<e.length;t++){const n=e[t];if(FT(n))return DR(n)}}let qt=function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i}({});function Zn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class md{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Cn(this.cachedData,e),this.cachedData=null);let n=Go(e,0),r=n?n.length:0,s;const o=this._audioTrack,a=this._id3Track,l=n?dd(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&ae(l))&&(this.basePTS=wR(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:qt.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){const f=this.appendFrame(o,e,r);f?(this.frameIndex++,this.lastPTS=f.sample.pts,r+=f.length,s=r):r=u}else mR(e,r)?(n=Go(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:qt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===u&&s!==u){const f=e.slice(s);this.cachedData?this.cachedData=Cn(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:Zn(),id3Track:a,textTrack:Zn()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Zn(),id3Track:this._id3Track,textTrack:Zn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const wR=(i,e,t)=>{if(ae(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let Tl=null;const CR=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],bR=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],kR=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],OR=[0,1,1,4];function NT(i,e,t,n,r){if(t+24>e.length)return;const s=BT(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=n+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return i.config=[],i.channelCount=s.channelCount,i.samplerate=s.sampleRate,i.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function BT(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,s=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const o=i[e+2]>>1&1,a=i[e+3]>>6,l=t===3?3-n:n===3?3:4,u=CR[l*14+r-1]*1e3,d=bR[(t===3?0:t===2?1:2)*3+s],m=a===3?1:2,g=kR[t][n],y=OR[n],T=g*8*y,E=Math.floor(g*u/d+o)*y;if(Tl===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Tl=L?parseInt(L[1]):0}return!!Tl&&Tl<=87&&n===2&&u>=224e3&&a===0&&(i[e+3]=i[e+3]|128),{sampleRate:d,channelCount:m,frameLength:E,samplesPerFrame:T}}}function pd(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function UT(i,e){return e+1<i.length&&pd(i,e)}function MR(i,e){return pd(i,e)&&4<=i.length-e}function $T(i,e){if(e+1<i.length&&pd(i,e)){const n=BT(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const s=e+r;return s===i.length||UT(i,s)}return!1}class FR extends md{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Go(e,0);let r=(n==null?void 0:n.length)||0;if($T(e,r))return!1;for(let s=e.length;r<s;r++)if(fR(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return hR(e,t)}appendFrame(e,t,n){CT(e,this.observer,t,n,e.manifestCodec);const r=kT(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const VT=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=i[e];const a=Math.min(n,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,n-=a}return t};class NR extends md{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=GT(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Go(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&dd(t)!==void 0&&VT(e,n)<16}}function GT(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+f>e.length)return-1;const d=e[t+6]>>5;let m=0;d===2?m+=2:(d&1&&d!==1&&(m+=2),d&4&&(m+=2));const g=(e[t+6]<<8|e[t+7])>>12-m&1,T=[2,1,2,3,3,4,4,5][d]+g,E=e[t+5]>>3,x=e[t+5]&7,R=new Uint8Array([s<<6|E<<1|x>>2,(x&3)<<6|d<<3|g<<2|l>>4,l<<4&224]),L=1536/a*9e4,P=n+r*L,I=e.subarray(t,t+f);return i.config=R,i.channelCount=T,i.samplerate=a,i.samples.push({unit:I,pts:P}),f}class BR extends md{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Go(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&dd(t)!==void 0&&VT(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if($T(e,n))return Pe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return MR(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return NT(e,t,n,this.basePTS,this.frameIndex)}}const UR=/\/emsg[-/]ID3/i;class $R{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=Zn("video",1),o=this.audioTrack=Zn("audio",1),a=this.txtTrack=Zn("text",1);if(this.id3Track=Zn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=tT(e);if(l.video){const{id:u,timescale:f,codec:d,supplemental:m}=l.video;s.id=u,s.timescale=a.timescale=f,s.codec=d,s.supplemental=m}if(l.audio){const{id:u,timescale:f,codec:d}=l.audio;o.id=u,o.timescale=f,o.codec=d}a.id=Zv.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return $L(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Cn(this.remainderData,e));const a=YL(n);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=n;const o=this.extractID3Track(r,t);return s.samples=$g(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=$g(e,t),{videoTrack:t,audioTrack:Zn(),id3Track:r,textTrack:Zn()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=ve(e.samples,["emsg"]);r&&r.forEach(s=>{const o=XL(s);if(UR.test(o.schemeIdUri)){const a=v0(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;n.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:qt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=v0(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:qt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function v0(i,e){return ae(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class VR{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new sd(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,sr.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const o=iT(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)})}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(n>=s.length);n++){const o=s[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,r,o),!this.decrypter.isSync()))return}}}}class HT{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const s=n[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const o=s,a=[];let l=0,u,f,d,m=-1,g=0;for(s===-1&&(m=0,g=this.getNALuType(t,0),s=0,l=1);l<r;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(f=l-s-1,m>=0){const y={data:t.subarray(m,f),type:g};a.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(o&&l<=4-o&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-o)),f>0&&(y.data=Cn(y.data,t.subarray(0,f)),y.state=0))}l<r?(d=this.getNALuType(t,l),m=l,g=d,s=0):s=-1}else s=0}if(m>=0&&s>=0){const y={data:t.subarray(m,r),type:g,state:s};a.push(y)}if(a.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=Cn(y.data,t))}return e.naluState=s,a}}class Po{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Pe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class T0 extends HT{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(u=>{var f,d;switch(u.type){case 1:{let T=!1;a=!0;const E=u.data;if(l&&E.length>4){const x=this.readSliceType(E);(x===2||x===4||x===7||x===9)&&(T=!0)}if(T){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=T;break}case 5:a=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,nd(u.data,1,n.pts,t.samples);break}case 7:{var g,y;a=!0,l=!0;const T=u.data,E=this.readSPS(T);if(!e.sps||e.width!==E.width||e.height!==E.height||((g=e.pixelRatio)==null?void 0:g[0])!==E.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[T];const x=T.subarray(1,4);let R="avc1.";for(let L=0;L<3;L++){let P=x[L].toString(16);P.length<2&&(P="0"+P),R+=P}e.codec=R}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Po(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=t.readEG(),r=(n+s+256)%256),n=r===0?n:r}readSPS(e){const t=new Po(e);let n=0,r=0,s=0,o=0,a,l,u;const f=t.readUByte.bind(t),d=t.readBits.bind(t),m=t.readUEG.bind(t),g=t.readBoolean.bind(t),y=t.skipBits.bind(t),T=t.skipEG.bind(t),E=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);f();const R=f();if(d(5),y(3),f(),E(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const w=m();if(w===3&&y(1),E(),E(),y(1),g())for(l=w!==3?8:12,u=0;u<l;u++)g()&&(u<6?x(16,t):x(64,t))}E();const L=m();if(L===0)m();else if(L===1)for(y(1),T(),T(),a=m(),u=0;u<a;u++)T();E(),y(1);const P=m(),I=m(),C=d(1);C===0&&y(1),y(1),g()&&(n=m(),r=m(),s=m(),o=m());let D=[1,1];if(g()&&g())switch(f()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((P+1)*16-n*2-r*2),height:(2-C)*(I+1)*16-(C?2:4)*(s+o),pixelRatio:D}}}class E0 extends HT{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(u=>{var f,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,nd(u.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ue(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const g=this.readSPS(u.data);e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.codec=g.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in g.params)e.params[y]=g.params[y]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const g=this.readPPS(u.data);for(const y in g)e.params[y]=g[y]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Po(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new Po(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),f=t.readUByte(),d=t.readUByte(),m=t.readUByte(),g=t.readUByte(),y=t.readUByte(),T=t.readUByte(),E=t.readUByte(),x=t.readUByte(),R=[],L=[];for(let Ce=0;Ce<n;Ce++)R.push(t.readBoolean()),L.push(t.readBoolean());if(n>0)for(let Ce=n;Ce<8;Ce++)t.readBits(2);for(let Ce=0;Ce<n;Ce++)R[Ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[Ce]&&t.readUByte();t.readUEG();const P=t.readUEG();P==3&&t.skipBits(1);const I=t.readUEG(),C=t.readUEG(),D=t.readBoolean();let w=0,k=0,O=0,W=0;D&&(w+=t.readUEG(),k+=t.readUEG(),O+=t.readUEG(),W+=t.readUEG());const q=t.readUEG(),ie=t.readUEG(),te=t.readUEG(),J=t.readBoolean();for(let Ce=J?0:n;Ce<=n;Ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let dt=0;dt<4;dt++)for(let Gt=0;Gt<(dt===3?2:6);Gt++)if(!t.readBoolean())t.readUEG();else{const xt=Math.min(64,1<<4+(dt<<1));dt>1&&t.readEG();for(let Fi=0;Fi<xt;Fi++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let K=0;for(let Ce=0;Ce<G;Ce++){let dt=!1;if(Ce!==0&&(dt=t.readBoolean()),dt){Ce===G&&t.readUEG(),t.readBoolean(),t.readUEG();let Gt=0;for(let hi=0;hi<=K;hi++){const xt=t.readBoolean();let Fi=!1;xt||(Fi=t.readBoolean()),(xt||Fi)&&Gt++}K=Gt}else{const Gt=t.readUEG(),hi=t.readUEG();K=Gt+hi;for(let xt=0;xt<Gt;xt++)t.readUEG(),t.readBoolean();for(let xt=0;xt<hi;xt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ce=t.readUEG();for(let dt=0;dt<Ce;dt++){for(let Gt=0;Gt<te+4;Gt++)t.readBits(1);t.readBits(1)}}let M=0,V=1,ne=1,re=!0,oe=1,fe=0;t.readBoolean(),t.readBoolean();let Te=!1;if(t.readBoolean()){if(t.readBoolean()){const fi=t.readUByte(),fa=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],$n=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];fi>0&&fi<16?(V=fa[fi-1],ne=$n[fi-1]):fi===255&&(V=t.readBits(16),ne=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Te=t.readBoolean(),Te&&(w+=t.readUEG(),k+=t.readUEG(),O+=t.readUEG(),W+=t.readUEG()),t.readBoolean()&&(oe=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const $n=t.readBoolean(),da=t.readBoolean();let hr=!1;($n||da)&&(hr=t.readBoolean(),hr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),hr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let ma=0;ma<=n;ma++){re=t.readBoolean();const $u=re||t.readBoolean();let pa=!1;$u?t.readEG():pa=t.readBoolean();const ga=pa?1:t.readUEG()+1;if($n)for(let fr=0;fr<ga;fr++)t.readUEG(),t.readUEG(),hr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(da)for(let fr=0;fr<ga;fr++)t.readUEG(),t.readUEG(),hr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),M=t.readUEG())}let we=I,ut=C;if(D||Te){let Ce=1,dt=1;P===1?Ce=dt=2:P==2&&(Ce=2),we=I-Ce*k-Ce*w,ut=C-dt*W-dt*O}const tn=r?["A","B","C"][r]:"",qr=a<<24|l<<16|u<<8|f;let St=0;for(let Ce=0;Ce<32;Ce++)St=(St|(qr>>Ce&1)<<31-Ce)>>>0;let Ks=St.toString(16);return o===1&&Ks==="2"&&(Ks="6"),{codecString:`hvc1.${tn}${o}.${Ks}.${s?"H":"L"}${x}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,u,f],general_constraint_indicator_flags:[d,m,g,y,T,E],general_level_idc:x,bit_depth:q+8,bit_depth_luma_minus8:q,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:M,chroma_format_idc:P,frame_rate:{fixed:re,fps:fe/oe}},width:we,height:ut,pixelRatio:[V,ne]}}readPPS(e){const t=new Po(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const yt=188;class Ji{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=Ji.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(yt*5,t-yt)+1,r=0;for(;r<n;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=yt)if(e[l]===71&&(t-l===yt||e[l+yt]===71)){if(a++,o===-1&&(o=l,o!==0&&(n=Math.min(o+yt*99,e.length-yt)+1)),s||(s=af(e,l)===0),s&&a>1&&(o===0&&a>2||l+yt>n))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Zv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ji.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Ji.createTrack("audio",r),this._id3Track=Ji.createTrack("id3"),this._txtTrack=Ji.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let f=o.pid,d=o.pesData,m=a.pid,g=l.pid,y=a.pesData,T=l.pesData,E=null,x=this.pmtParsed,R=this._pmtId,L=e.length;if(this.remainderData&&(e=Cn(this.remainderData,e),L=e.length,this.remainderData=null),L<yt&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const P=Math.max(0,Ji.syncOffset(e));L-=(L-P)%yt,L<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let I=0;for(let D=P;D<L;D+=yt)if(e[D]===71){const w=!!(e[D+1]&64),k=af(e,D),O=(e[D+3]&48)>>4;let W;if(O>1){if(W=D+5+e[D+4],W===D+yt)continue}else W=D+4;switch(k){case f:if(w){if(d&&(s=fs(d,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new T0;break;case"hevc":this.videoParser=new E0;break}this.videoParser!==null&&this.videoParser.parsePES(o,u,s,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(W,D+yt)),d.size+=D+yt-W);break;case m:if(w){if(y&&(s=fs(y,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(W,D+yt)),y.size+=D+yt-W);break;case g:w&&(T&&(s=fs(T,this.logger))&&this.parseID3PES(l,s),T={data:[],size:0}),T&&(T.data.push(e.subarray(W,D+yt)),T.size+=D+yt-W);break;case 0:w&&(W+=e[W]+1),R=this._pmtId=GR(e,W);break;case R:{w&&(W+=e[W]+1);const q=HR(e,W,this.typeSupported,n,this.observer,this.logger);f=q.videoPid,f>0&&(o.pid=f,o.segmentCodec=q.segmentVideoCodec),m=q.audioPid,m>0&&(a.pid=m,a.segmentCodec=q.segmentAudioCodec),g=q.id3Pid,g>0&&(l.pid=g),E!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${D} after unknown PID '${E}'. Backtracking to sync byte @${P} to parse all TS packets.`),E=null,D=P-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=k;break}}else I++;I>0&&lf(this.observer,new Error(`Found ${I} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=y,l.pesData=T;const C={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(C),C}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,o=n.pesData,a=t.pesData,l=r.pesData;let u;if(o&&(u=fs(o,this.logger))){if(this.videoParser===null)switch(n.segmentCodec){case"avc":this.videoParser=new T0;break;case"hevc":this.videoParser=new E0;break}this.videoParser!==null&&(this.videoParser.parsePES(n,s,u,!0),n.pesData=null)}else n.pesData=o;if(a&&(u=fs(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=fs(l,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new VR(this.observer,this.config,t);return this.decrypt(r,s)}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const d=r.missing,m=r.sample.unit.byteLength;if(d===-1)s=Cn(r.sample.unit,s);else{const g=m-d;r.sample.unit.set(s.subarray(0,d),g),e.samples.push(r.sample),n=r.missing}}let o,a;for(o=n,a=s.length;o<a-1&&!iu(s,o);o++);if(o!==n){let d;const m=o<a-1;if(m?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",lf(this.observer,new Error(d),m,this.logger),!m)return}CT(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const d=bT(e.samplerate);l=r.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,f;for(;o<a;)if(f=kT(e,s,o,l,u),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(u++;o<a-1&&!iu(s,o);o++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(UT(n,o)){const l=NT(e,n,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let o=0,a=0,l;for(;a<s&&(l=GT(e,n,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Ue({},t,{type:this._videoTrack?qt.emsg:qt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function af(i,e){return((i[e+1]&31)<<8)+i[e+2]}function GR(i,e){return(i[e+10]&31)<<8|i[e+11]}function HR(i,e,t,n,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(i[e+1]&15)<<8|i[e+2],l=e+3+a-4,u=(i[e+10]&15)<<8|i[e+11];for(e+=12+u;e<l;){const f=af(i,e),d=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){mh("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!n){mh("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!n){mh("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let m=e+5,g=d;for(;g>2;){switch(i[m]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const T=i[m+1]+2;m+=T,g-=T}}break;case 194:case 135:return lf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return o}function lf(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(A.ERROR,A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function mh(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function fs(i,e){let t=0,n,r,s,o,a;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Cn(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const f=n[7];f&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,f&64?(a=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=n[8];let d=s+9;if(i.size<=d)return null;i.size-=d;const m=new Uint8Array(i.size);for(let g=0,y=l.length;g<y;g++){n=l[g];let T=n.byteLength;if(d)if(d>T){d-=T;continue}else n=n.subarray(d),T-=d,d=0;m.set(n,t),t+=T}return r&&(r-=s+3),{data:m,pts:o,dts:a,len:r}}return null}class KR{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Yi=Math.pow(2,32)-1;class U{static init(){U.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in U.types)U.types.hasOwnProperty(e)&&(U.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);U.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);U.STTS=U.STSC=U.STCO=s,U.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),U.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),U.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),U.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);U.FTYP=U.box(U.types.ftyp,o,l,o,a),U.DINF=U.box(U.types.dinf,U.box(U.types.dref,r))}static box(e,...t){let n=8,r=t.length;const s=r;for(;r--;)n+=t[r].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),r=0,n=8;r<s;r++)o.set(t[r],n),n+=t[r].byteLength;return o}static hdlr(e){return U.box(U.types.hdlr,U.HDLR_TYPES[e])}static mdat(e){return U.box(U.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Yi+1)),r=Math.floor(t%(Yi+1));return U.box(U.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return U.box(U.types.mdia,U.mdhd(e.timescale||0,e.duration||0),U.hdlr(e.type),U.minf(e))}static mfhd(e){return U.box(U.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?U.box(U.types.minf,U.box(U.types.smhd,U.SMHD),U.DINF,U.stbl(e)):U.box(U.types.minf,U.box(U.types.vmhd,U.VMHD),U.DINF,U.stbl(e))}static moof(e,t,n){return U.box(U.types.moof,U.mfhd(e),U.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=U.trak(e[t]);return U.box.apply(null,[U.types.moov,U.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(U.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=U.trex(e[t]);return U.box.apply(null,[U.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Yi+1)),r=Math.floor(t%(Yi+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return U.box(U.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return U.box(U.types.sdtp,n)}static stbl(e){return U.box(U.types.stbl,U.stsd(e),U.box(U.types.stts,U.STTS),U.box(U.types.stsc,U.STSC),U.box(U.types.stsz,U.STSZ),U.box(U.types.stco,U.STCO))}static avc1(e){let t=[],n=[],r,s,o;for(r=0;r<e.sps.length;r++)s=e.sps[r],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],o=s.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(s));const a=U.box(U.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,u=e.height,f=e.pixelRatio[0],d=e.pixelRatio[1];return U.box(U.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return U.box(U.types.mp4a,U.audioStsd(e),U.box(U.types.esds,U.esds(e)))}static mp3(e){return U.box(U.types[".mp3"],U.audioStsd(e))}static ac3(e){return U.box(U.types["ac-3"],U.audioStsd(e),U.box(U.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return U.box(U.types.stsd,U.STSD,U.mp4a(e));if(t==="ac3"&&e.config)return U.box(U.types.stsd,U.STSD,U.ac3(e));if(t==="mp3"&&e.codec==="mp3")return U.box(U.types.stsd,U.STSD,U.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return U.box(U.types.stsd,U.STSD,U.avc1(e));if(t==="hevc"&&e.vps)return U.box(U.types.stsd,U.STSD,U.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,o=Math.floor(n/(Yi+1)),a=Math.floor(n%(Yi+1));return U.box(U.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=U.sdtp(e),r=e.id,s=Math.floor(t/(Yi+1)),o=Math.floor(t%(Yi+1));return U.box(U.types.traf,U.box(U.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),U.box(U.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),U.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,U.box(U.types.trak,U.tkhd(e),U.mdia(e))}static trex(e){const t=e.id;return U.box(U.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,o=new Uint8Array(s);let a,l,u,f,d,m;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<r;a++)l=n[a],u=l.duration,f=l.size,d=l.flags,m=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*a);return U.box(U.types.trun,o)}static initSegment(e){U.types||U.init();const t=U.moov(e);return Cn(U.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=s.length;for(let y=0;y<n.length;y+=1){o+=3;for(let T=0;T<n[y].length;T+=1)o+=2+n[y][T].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const l=n.length-1;for(let y=0;y<n.length;y+=1){a.set(new Uint8Array([32+y|(y===l?128:0),0,n[y].length]),o),o+=3;for(let T=0;T<n[y].length;T+=1)a.set(new Uint8Array([n[y][T].length>>8,n[y][T].length&255]),o),o+=2,a.set(n[y][T],o),o+=n[y][T].length}const u=U.box(U.types.hvcC,a),f=e.width,d=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return U.box(U.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}}U.types=void 0;U.HDLR_TYPES=void 0;U.STTS=void 0;U.STSC=void 0;U.STCO=void 0;U.STSZ=void 0;U.VMHD=void 0;U.SMHD=void 0;U.STSD=void 0;U.FTYP=void 0;U.DINF=void 0;const KT=9e4;function gd(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function zR(i,e,t=1,n=!1){return gd(i,e,1/t,n)}function mo(i,e=!1){return gd(i,1e3,1/KT,e)}function WR(i,e=1){return gd(i,KT,1/e)}const jR=10*1e3,YR=1024,qR=1152,XR=1536;let ds=null,ph=null;function S0(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class kl{constructor(e,t,n,r){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.ISGenerated=!1,ds===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ds=o?parseInt(o[1]):0}if(ph===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);ph=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=Pn(a,n),l=a-s),l>0?s:a},n);return t&&this.logger.debug("PTS rollover detected"),r}remux(e,t,n,r,s,o,a,l){let u,f,d,m,g,y,T=s,E=s;const x=e.pid>-1,R=t.pid>-1,L=t.samples.length,P=e.samples.length>0,I=a&&L>0||L>1;if((!x||P)&&(!R||I)||this.ISGenerated||a){if(this.ISGenerated){var D,w,k,O;const te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((D=t.pixelRatio)==null?void 0:D[0])!==((w=te.pixelRatio)==null?void 0:w[0])||((k=t.pixelRatio)==null?void 0:k[1])!==((O=te.pixelRatio)==null?void 0:O[1]))||!te&&I||this.nextAudioPts===null&&P)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,o));const W=this.isVideoContiguous;let q=-1,ie;if(I&&(q=QR(t.samples),!W&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,q>0){this.logger.warn(`[mp4-remuxer]: Dropped ${q} out of ${L} video samples due to a missing keyframe`);const te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(q),t.dropped+=q,E+=(t.samples[0].pts-te)/t.inputTimeScale,ie=E}else q===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${L} video samples`),y=!1);if(this.ISGenerated){if(P&&I){const te=this.getVideoStartPts(t.samples),Z=(Pn(e.samples[0].pts,te)-te)/t.inputTimeScale;T+=Math.max(0,Z),E+=Math.max(0,-Z)}if(P){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),f=this.remuxAudio(e,T,this.isAudioContiguous,o,R||I||l===ce.AUDIO?E:void 0),I){const te=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,E,W,te)}}else I&&(u=this.remuxVideo(t,E,W,0));u&&(u.firstKeyFrame=q,u.independent=q!==-1,u.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(g=zT(n,s,this._initPTS,this._initDTS)),r.samples.length&&(m=WT(r,s,this._initPTS))),{audio:f,video:u,initSegment:d,independent:y,text:m,id3:g}}generateIS(e,t,n,r){const s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let f=!u||r,d="audio/mp4",m,g,y;if(f&&(m=g=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):U.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(y=e.inputTimeScale,!u||y!==u.timescale?m=g=s[0].pts-Math.round(y*n):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:U.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(y=t.inputTimeScale,!u||y!==u.timescale){const T=this.getVideoStartPts(o),E=Math.round(y*n);g=Math.min(g,Pn(o[0].dts,T)-E),m=Math.min(m,T-E)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:m,timescale:y},this._initDTS={baseTime:g,timescale:y}):m=y=void 0,{tracks:l,initPTS:m,timescale:y}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS;let f=this.nextAvcDts,d=8,m=this.videoSampleDuration,g,y,T=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,x=!1;if(!n||f===null){const K=t*s,z=o[0].pts-Pn(o[0].dts,o[0].pts);ds&&f!==null&&Math.abs(K-z-f)<15e3?n=!0:f=K-z}const R=u.baseTime*s/u.timescale;for(let K=0;K<l;K++){const z=o[K];z.pts=Pn(z.pts-R,f),z.dts=Pn(z.dts-R,f),z.dts<o[K>0?K-1:K].dts&&(x=!0)}x&&o.sort(function(K,z){const M=K.dts-z.dts,V=K.pts-z.pts;return M||V}),g=o[0].dts,y=o[o.length-1].dts;const L=y-g,P=L?Math.round(L/(l-1)):m||e.inputTimeScale/30;if(n){const K=g-f,z=K>P,M=K<-1;if((z||M)&&(z?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${mo(K,!0)} ms (${K}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${mo(-K,!0)} ms (${K}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!M||f>=o[0].pts||ds)){g=f;const V=o[0].pts-K;if(z)o[0].dts=g,o[0].pts=V;else{let ne=!0;for(let re=0;re<o.length&&!(o[re].dts>V&&ne);re++){const oe=o[re].pts;if(o[re].dts-=K,o[re].pts-=K,re<o.length-1){const fe=o[re+1].pts,Te=o[re].pts,Ie=fe<=Te,we=fe<=oe;ne=Ie==we}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${mo(V,!0)}/${mo(g,!0)}, delta: ${mo(K,!0)} ms`)}}g=Math.max(0,g);let I=0,C=0,D=g;for(let K=0;K<l;K++){const z=o[K],M=z.units,V=M.length;let ne=0;for(let re=0;re<V;re++)ne+=M[re].data.length;C+=ne,I+=V,z.length=ne,z.dts<D?(z.dts=D,D+=P/4|0||1):D=z.dts,T=Math.min(z.pts,T),E=Math.max(z.pts,E)}y=o[l-1].dts;const w=C+4*I+8;let k;try{k=new Uint8Array(w)}catch(K){this.observer.emit(A.ERROR,A.ERROR,{type:he.MUX_ERROR,details:$.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:w,reason:`fail allocating video mdat ${w}`});return}const O=new DataView(k.buffer);O.setUint32(0,w),k.set(U.types.mdat,4);let W=!1,q=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let K=0;K<l;K++){const z=o[K],M=z.units;let V=0;for(let oe=0,fe=M.length;oe<fe;oe++){const Te=M[oe],Ie=Te.data,we=Te.data.byteLength;O.setUint32(d,we),d+=4,k.set(Ie,d),d+=we,V+=4+we}let ne;if(K<l-1)m=o[K+1].dts-z.dts,ne=o[K+1].pts-z.pts;else{const oe=this.config,fe=K>0?z.dts-o[K-1].dts:P;if(ne=K>0?z.pts-o[K-1].pts:P,oe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Te=Math.floor(oe.maxBufferHole*s),Ie=(r?T+r*s:this.nextAudioPts)-z.pts;Ie>Te?(m=Ie-fe,m<0?m=fe:W=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Ie/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=fe}else m=fe}const re=Math.round(z.pts-z.dts);q=Math.min(q,m),te=Math.max(te,m),ie=Math.min(ie,ne),J=Math.max(J,ne),a.push(S0(z.key,m,V,re))}if(a.length){if(ds){if(ds<70){const K=a[0].flags;K.dependsOn=2,K.isNonSync=0}}else if(ph&&J-ie<te-q&&P/te<.025&&a[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let K=g;for(let z=0,M=a.length;z<M;z++){const V=K+a[z].duration,ne=K+a[z].cts;if(z<M-1){const re=V+a[z+1].cts;a[z].duration=re-ne}else a[z].duration=z?a[z-1].duration:P;a[z].cts=0,K=V}}}m=W||!m?P:m,this.nextAvcDts=f=y+m,this.videoSampleDuration=m,this.isVideoContiguous=!0;const G={data1:U.moof(e.sequenceNumber++,g,Ue(e,{samples:a})),data2:k,startPTS:T/s,endPTS:(E+m)/s,startDTS:g/s,endDTS:f/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,G}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return qR;case"ac3":return XR;default:return YR}}remuxAudio(e,t,n,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),f=u*l,d=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],y=s!==void 0;let T=e.samples,E=m?0:8,x=this.nextAudioPts||-1;const R=t*o,L=d.baseTime*o/d.timescale;if(this.isAudioContiguous=n=n||T.length&&x>0&&(r&&Math.abs(R-x)<9e3||Math.abs(Pn(T[0].pts-L,R)-x)<20*f),T.forEach(function(Z){Z.pts=Pn(Z.pts-L,R)}),!n||x<0){if(T=T.filter(Z=>Z.pts>=0),!T.length)return;s===0?x=0:r&&!y?x=Math.max(0,R):x=T[0].pts}if(e.segmentCodec==="aac"){const Z=this.config.maxAudioFramesDrift;for(let Q=0,G=x;Q<T.length;Q++){const K=T[Q],z=K.pts,M=z-G,V=Math.abs(1e3*M/o);if(M<=-Z*f&&y)Q===0&&(this.logger.warn(`Audio frame @ ${(z/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*M/o)} ms.`),this.nextAudioPts=x=G=z);else if(M>=Z*f&&V<jR&&y){let ne=Math.round(M/f);G=z-ne*f,G<0&&(ne--,G+=f),Q===0&&(this.nextAudioPts=x=G),this.logger.warn(`[mp4-remuxer]: Injecting ${ne} audio frame @ ${(G/o).toFixed(3)}s due to ${Math.round(1e3*M/o)} ms gap.`);for(let re=0;re<ne;re++){const oe=Math.max(G,0);let fe=KR.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);fe||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),fe=K.unit.subarray()),T.splice(Q,0,{unit:fe,pts:oe}),G+=f,Q++}}K.pts=G,G+=f}}let P=null,I=null,C,D=0,w=T.length;for(;w--;)D+=T[w].unit.byteLength;for(let Z=0,Q=T.length;Z<Q;Z++){const G=T[Z],K=G.unit;let z=G.pts;if(I!==null){const V=g[Z-1];V.duration=Math.round((z-I)/l)}else if(n&&e.segmentCodec==="aac"&&(z=x),P=z,D>0){D+=E;try{C=new Uint8Array(D)}catch(V){this.observer.emit(A.ERROR,A.ERROR,{type:he.MUX_ERROR,details:$.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:D,reason:`fail allocating audio mdat ${D}`});return}m||(new DataView(C.buffer).setUint32(0,D),C.set(U.types.mdat,4))}else return;C.set(K,E);const M=K.byteLength;E+=M,g.push(S0(!0,u,M,0)),I=z}const k=g.length;if(!k)return;const O=g[g.length-1];this.nextAudioPts=x=I+l*O.duration;const W=m?new Uint8Array(0):U.moof(e.sequenceNumber++,P/l,Ue({},e,{samples:g}));e.samples=[];const q=P/o,ie=x/o,J={data1:W,data2:C,startPTS:q,endPTS:ie,startDTS:q,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.isAudioContiguous=!0,J}}function Pn(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function QR(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function zT(i,e,t,n){const r=i.samples.length;if(!r)return;const s=i.inputTimeScale;for(let a=0;a<r;a++){const l=i.samples[a];l.pts=Pn(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Pn(l.dts-n.baseTime*s/n.timescale,e*s)/s}const o=i.samples;return i.samples=[],{samples:o}}function WT(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let o=0;o<n;o++){const a=i.samples[o];a.pts=Pn(a.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((o,a)=>o.pts-a.pts);const s=i.samples;return i.samples=[],{samples:s}}class ZR{constructor(e,t,n,r){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=r}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(HL(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=tT(e);r.audio&&(t=x0(r.audio,Be.AUDIO)),r.video&&(n=x0(r.video,Be.VIDEO));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+n,supplemental:r.video.supplemental,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:n,supplemental:r.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,n,r,s,o){var a,l;let{initPTS:u,lastEndTime:f}=this;const d={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};ae(f)||(f=this.lastEndTime=s||0);const m=t.samples;if(!(m!=null&&m.length))return d;const g={initPTS:void 0,timescale:1};let y=this.initData;if((a=y)!=null&&a.length||(this.generateInitSegment(m),y=this.initData),!((l=y)!=null&&l.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);const T=zL(m,y),E=KL(y,m),x=E===null?s:E;(o||!u)&&(JR(u,x,s,T)||g.timescale!==u.timescale)&&(g.initPTS=x-s,u&&u.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${u.baseTime/u.timescale} to ${g.initPTS}`),this.initPTS=u={baseTime:g.initPTS,timescale:1});const R=e?x-u.baseTime/u.timescale:f,L=R+T;jL(y,m,u.baseTime/u.timescale),T>0?this.lastEndTime=L:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const P=!!y.audio,I=!!y.video;let C="";P&&(C+="audio"),I&&(C+="video");const D={data1:m,startPTS:R,startDTS:R,endPTS:L,endDTS:L,type:C,hasAudio:P,hasVideo:I,nb:1,dropped:0};return d.audio=D.type==="audio"?D:void 0,d.video=D.type!=="audio"?D:void 0,d.initSegment=g,d.id3=zT(n,s,u,u),r.samples.length&&(d.text=WT(r,s,u)),d}}function JR(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),s=e-i.baseTime/i.timescale;return Math.abs(s-t)>r}function x0(i,e){const t=i==null?void 0:i.codec;return t&&t.length>4?t:e===Be.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?Xl(t,!1):(Pe.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(Pe.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let xi;try{xi=self.performance.now.bind(self.performance)}catch{xi=Date.now}const Ol=[{demux:$R,remux:ZR},{demux:Ji,remux:kl},{demux:FR,remux:kl},{demux:BR,remux:kl}];Ol.splice(2,0,{demux:NR,remux:kl});class _0{constructor(e,t,n,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=xi();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:u,discontinuity:f,trackSwitch:d,accurateTimeOffset:m,timeOffset:g,initSegmentChange:y}=r||a,{audioCodec:T,videoCodec:E,defaultInitPts:x,duration:R,initSegmentData:L}=l,P=eI(o,t);if(P&&_s(P.method)){const w=this.getDecrypter(),k=ad(P.method);if(w.isSync()){let O=w.softwareDecrypt(o,P.key.buffer,P.iv.buffer,k);if(n.part>-1){const q=w.flush();O=q&&q.buffer}if(!O)return s.executeEnd=xi(),gh(n);o=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=w.webCryptoDecrypt(o,P.key.buffer,P.iv.buffer,k).then(O=>{const W=this.push(O,null,n);return this.decryptionPromise=null,W}),this.decryptionPromise}const I=this.needsProbing(f,d);if(I){const w=this.configureTransmuxer(o);if(w)return this.logger.warn(`[transmuxer] ${w.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message}),s.executeEnd=xi(),gh(n)}(f||d||y||I)&&this.resetInitSegment(L,T,E,R,t),(f||y||I)&&this.resetInitialTimestamp(x),u||this.resetContiguity();const C=this.transmux(o,P,g,m,n);this.asyncResult=Ho(C);const D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,s.executeEnd=xi(),C}flush(e){const t=e.transmuxing;t.executeStart=xi();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(n){const d=n.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=xi();const d=[gh(e)];return this.asyncResult?Promise.resolve(d):d}const f=l.flush(a);return Ho(f)?(this.asyncResult=!0,f.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===ce.MAIN?"level":"track"} ${n.level}`);const f=this.remuxer.remux(r,s,o,a,u,l,!0,this.id);e.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=xi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,r,s):o=this.transmuxUnencrypted(e,n,r,s),o}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let d=0,m=Ol.length;d<m;d++){var o;if((o=Ol[d].demux)!=null&&o.probe(e,this.logger)){s=Ol[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=s.remux,f=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(n,t,r,this.logger)),(!a||!(a instanceof f))&&(this.demuxer=new f(n,t,r,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new sd(this.config)),e}}function eI(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const gh=i=>({remuxResult:{},chunkMeta:i});function Ho(i){return"then"in i&&i.then instanceof Function}class tI{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class nI{constructor(e,t,n,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}let A0=0;class jT{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=A0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,f=this.hls;if(!(!f||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const m=(d=this.workerContext)==null?void 0:d.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{f.logger[u.data.logType]&&f.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,f.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===A.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new cd,this.observer.on(A.FRAG_DECRYPTED,o),this.observer.on(A.ERROR,o);const a=Gg(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||sR()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=aR(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=oR());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:je(s)})}catch(f){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new _0(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new _0(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=A0++;const t=this.hls.config,n=Gg(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:je(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),lR(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,o,a,l,u,f){var d,m;u.transmuxing.start=self.performance.now();const{instanceNo:g,transmuxer:y}=this,T=o?o.start:s.start,E=s.decryptdata,x=this.frag,R=!(x&&s.cc===x.cc),L=!(x&&u.level===x.level),P=x?u.sn-x.sn:-1,I=this.part?u.part-this.part.index:-1,C=P===0&&u.id>1&&u.id===(x==null?void 0:x.stats.chunkCount),D=!L&&(P===1||P===0&&(I===1||C&&I<=0)),w=self.performance.now();(L||P||s.stats.parsing.start===0)&&(s.stats.parsing.start=w),o&&(I||!D)&&(o.stats.parsing.start=w);const k=!(x&&((d=s.initSegment)==null?void 0:d.url)===((m=x.initSegment)==null?void 0:m.url)),O=new nI(R,D,l,L,T,k);if(!D||R||k){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ce.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${R}
        trackSwitch: ${L}
        contiguous: ${D}
        accurateTimeOffset: ${l}
        timeOffset: ${T}
        initSegmentChange: ${k}`);const W=new tI(n,r,t,a,f);this.configureTransmuxer(W)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:g,cmd:"demux",data:e,decryptdata:E,chunkMeta:u,state:O},e instanceof ArrayBuffer?[e]:[]);else if(y){const W=y.push(e,E,u,O);Ho(W)?W.then(q=>{this.handleTransmuxComplete(q)}).catch(q=>{this.transmuxerError(q,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(W)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);Ho(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const L0=100;class YT extends Lu{constructor(e,t,n){super(e,t,n,"audio-stream-controller",ce.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s}){if(n===ce.MAIN){const o=t.cc,a=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${r}/${s}`),this.mainAnchor=t,this.state===X.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==o)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&a&&a.cc!==o?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,a.abortRequests(),this.resetLoadingState()):this.state===X.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),n=e.cc;return S1(t,n,e)||t&&dT(t.fragments,n)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=X.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(L0),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=X.IDLE):this.state=X.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case X.IDLE:this.doTickIdle();break;case X.WAITING_TRACK:{const{levels:t,trackId:n}=this,r=t==null?void 0:t[n],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=X.WAITING_INIT_PTS}break}case X.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((r==null?void 0:r[s])||null),this.state=X.IDLE}break}case X.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:n,part:r,cache:s,complete:o}=t,a=this.mainAnchor;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.state=X.FRAG_LOADING;const l=s.flush().buffer,u={frag:n,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),o&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${n.cc}) cancelled because video is at cc ${a.cc}`),this.nextLoadPosition=this.findSyncFrag(a).start,this.clearWaitingFragment())}else this.state=X.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==X.STOPPED&&(this.state=X.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[s]))return;const a=n[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=X.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Be.AUDIO,ce.AUDIO));const f=this.getFwdBufferInfo(u,ce.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,l)){t.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=X.ENDED;return}const d=f.len,m=t.maxBufferLength,g=l.fragments,y=g[0].start,T=this.getLoadPosition(),E=this.flushing?T:f.end;if(this.switchingTrack&&r){const L=T;l.PTSKnown&&L<y&&(f.end>y||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=y+.05)}if(d>=m&&!this.switchingTrack&&E<g[g.length-1].start)return;let x=this.getNextFragment(E,l);if(x&&this.isLoopLoading(x,E)&&(x=this.getNextFragmentLoopLoading(x,l,f,ce.MAIN,m)),!x){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&At(x)&&!x.endList&&(!l.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===ft.OK&&(this.mainFragLoading=R=null),R&&At(R))){if(x.start>R.end){const P=this.fragmentTracker.getFragAtPos(E,ce.MAIN);P&&P.end>R.end&&(R=P,this.mainFragLoading={frag:P,targetBufferTime:null})}if(x.start>R.end)return}this.loadFragment(x,a,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ds(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==X.STOPPED&&(this.setInterval(L0),this.state=X.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==X.STOPPED&&(this.state=X.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const f=r[o];let d=0;if(s.live||(n=f.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(f.details){var m;d=this.alignPlaylists(s,f.details,(m=this.levelLastLoaded)==null?void 0:m.details)}s.alignedSliding||(RT(s,u),s.alignedSliding||nu(s,u),d=s.fragmentStart)}f.details=s,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===X.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=X.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const f=u.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new jT(this.hls,ce.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const g=this.initPTS[n.cc],y=(t=n.initSegment)==null?void 0:t.data;if(g!==void 0){const E=r?r.index:-1,x=E!==-1,R=new Au(n.level,n.sn,n.stats.chunkCount,s.byteLength,E,x);m.push(s,y,d,"",n,r,f.totalduration,!1,R,g)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${f.startSN} ,${f.endSN}],track ${a}`);const{cache:T}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new IT,complete:!1};T.push(new Uint8Array(s)),this.state!==X.STOPPED&&(this.state=X.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ce.MAIN&&At(t.frag)&&(this.mainFragLoading=t,this.state===X.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==ce.AUDIO){!this.audioOnly&&n.type===ce.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(At(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,Ne({},s)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=X.ERROR;return}switch(t.details){case $.FRAG_GAP:case $.FRAG_PARSING_ERROR:case $.FRAG_DECRYPT_ERROR:case $.FRAG_LOAD_ERROR:case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_ERROR:case $.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ce.AUDIO,t);break;case $.AUDIO_TRACK_LOAD_ERROR:case $.AUDIO_TRACK_LOAD_TIMEOUT:case $.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===X.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Re.AUDIO_TRACK&&(this.state=X.IDLE);break;case $.BUFFER_ADD_CODEC_ERROR:case $.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case $.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case $.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Be.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Be.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===X.ENDED&&(this.state=X.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,ce.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:f}=a,{details:d}=f,{audio:m,text:g,id3:y,initSegment:T}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=X.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const E=l.initSegment||l;this._bufferInitSegment(f,T.tracks,E,o),r.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:n,tracks:T.tracks})}if(m){const{startPTS:E,endPTS:x,startDTS:R,endDTS:L}=m;u&&(u.elementaryStreams[Be.AUDIO]={startPTS:E,endPTS:x,startDTS:R,endDTS:L}),l.setElementaryStreamInfo(Be.AUDIO,E,x,R,L),this.bufferFragmentData(m,l,u,o)}if(y!=null&&(t=y.samples)!=null&&t.length){const E=Ue({id:n,frag:l,details:d},y);r.trigger(A.FRAG_PARSING_METADATA,E)}if(g){const E=Ue({id:n,frag:l,details:d},g);r.trigger(A.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,n,r){if(this.state!==X.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=ce.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(A.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(A.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===ft.NOT_LOADED||r===ft.PARTIAL){var s;if(!At(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=X.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&nu(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Mr({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,Ir)||(Zl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,Ne({},e))}}class Iu extends Oi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=r[s],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&f>t.partTarget&&(l+=1)}const u=n&&Kg(n);return new tf(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const f=Math.max(l||0,0);r.appliedTimelineOffset=f,r.fragments.forEach(d=>{d.start=d.playlistOffset+f})}if(r.live||n!=null&&n.live){const f="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){Y1(n,r);const R=r.playlistParsingError;if(R){this.warn(R);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var u;const{networkDetails:P}=t;L.trigger(A.ERROR,{type:he.NETWORK_ERROR,details:$.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:R,reason:R.message,level:t.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:P,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,m=d?d.end-d.len:0,g=(r.edge-m)*1e3,y=xT(r,g);if(r.requestScheduled+y<o?r.requestScheduled=o:r.requestScheduled+=y,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let T,E,x;if(r.canBlockReload&&r.endSN&&r.advanced){const R=this.hls.config.lowLatencyMode,L=r.lastPartSn,P=r.endSN,I=r.lastPartIndex,C=I!==-1,D=L===P;C?D?(E=P+1,x=R?0:I):(E=L,x=R?I+1:r.maxPartIndex):E=P+1;const w=r.age,k=w+r.ageHeader;let O=Math.min(k-r.partTarget,r.targetduration*1.5);if(O>0){if(k>r.targetduration*3)this.log(`Playlist last advanced ${w.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,x=void 0;else if(n!=null&&n.tuneInGoal&&k-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${r.age}`),O=0;else{const W=Math.floor(O/r.targetduration);if(E+=W,x!==void 0){const q=Math.round(O%r.targetduration/r.partTarget);x+=q}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${w.toFixed(2)}s goal: ${O} skip sn ${W} to part ${x}`)}r.tuneInGoal=O}if(T=this.getDeliveryDirectives(r,t.deliveryDirectives,E,x),R||!D){r.requestScheduled=o,this.loadingPlaylist(f,T);return}}else(r.canBlockReload||r.canSkipUntil)&&(T=this.getDeliveryDirectives(r,t.deliveryDirectives,E,x));T&&E!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(y-a*2,y/2)),this.scheduleLoading(f,T,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let s=Kg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=Ro.No),new tf(n,r,s)}checkRetry(e){const t=e.details,n=Jl(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Tt.RetryRequest||!r.resolved&&s===Tt.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=rd(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function qT(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Ko(i[t].attrs,e[t].attrs))return!1;return!0}function Ko(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function uf(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class XT extends Iu{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(m=>!n||n.indexOf(m.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(m=>m.default)&&(this.selectDefaultTrack=!1),a.forEach((m,g)=>{m.id=g});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const m=ei(l,a,Ir);if(m>-1)s=a[m];else{const g=ei(l,this.tracks);s=this.tracks[g]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const f={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,f);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const m=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(m.message),this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Re.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Mr(e,r,Ir))return r;const s=ei(e,this.tracksInGroup,Ir);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=y1(e,t.levels,n,o,Ir);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=ei(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,Ne({},r)),s))return;const o=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Mr(e,r,Ir)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const f=t[u];if(Mr({name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},f,Ir))return u}for(let u=0;u<t.length;u++){const f=t[u];if(Ko(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const f=t[u];if(Ko(e.attrs,f.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Zl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class iI{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var n;if(r.onError(s),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n==null?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const R0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,QT="HlsJsTrackRemovedError";class rI extends Error{constructor(e){super(e),this.name=QT}}class ZT extends Oi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:s}=this;n&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=ML(wi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this),e.off(A.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Ue(n,r.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(n[o]=Ue({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media,r=wi(this.appendSource);if(this.transferData=this.overrides=void 0,n&&r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=n.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&o instanceof l,I0(n),sI(n,a),n.load()}catch{n.src=a}else n.src=a}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${je(n,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${je(r,(l,u)=>l==="initSegment"?void 0:u)}}`),!qv(r,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,f=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(f-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${f} currentTime: ${l}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,s.forEach(l=>{const u=l,f=r[u];if(f){const d=f.buffer;if(d){const m=this.fragmentTracker,g=f.id;if(m.hasFragments(g)||m.hasParts(g)){const E=xe.getBuffered(d);m.detectEvictedFragments(u,E,g,null,!0)}const y=yh(u),T=[u,d];this.sourceBuffers[y]=T,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,f)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),s.removeSourceBuffer(l[u]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&I0(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[yh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new iI(this.tracks)}onBufferCodecs(e,t){const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),o=!s&&this.sourceBufferCount&&this.media&&r.some(a=>!n[a]);if(s||o){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(a=>{var l,u,f;const d=t[a],{id:m,codec:g,levelCodec:y,container:T,metadata:E,supplemental:x}=d;let R=n[a];const L=(l=this.transferData)==null||(u=l.tracks)==null?void 0:u[a],P=L!=null&&L.buffer?L:R,I=(P==null?void 0:P.pendingCodec)||(P==null?void 0:P.codec),C=P==null?void 0:P.levelCodec;R||(R=n[a]={buffer:void 0,listeners:[],codec:g,supplemental:x,container:T,levelCodec:y,metadata:E,id:m});const D=bl(I,C),w=D==null?void 0:D.replace(R0,"$1");let k=bl(g,y);const O=(f=k)==null?void 0:f.replace(R0,"$1");k&&D&&w!==O&&(a.slice(0,5)==="audio"&&(k=Xl(k,this.appendSource)),this.log(`switching codec ${I} to ${k}`),k!==(R.pendingCodec||R.codec)&&(R.pendingCodec=k),R.container=T,this.appendChangeType(a,T,k))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,s={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,ce.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&xe.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,ce.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:u}=t,f=u.buffering[s],d=a.sn,m=self.performance.now();f.start=m;const g=a.stats.buffering,y=l?l.stats.buffering:null;g.start===0&&(g.start=m),y&&y.start===0&&(y.start=m);const T=n.audio;let E=!1;s==="audio"&&(T==null?void 0:T.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const x=this.tracks.video,R=x==null?void 0:x.buffer;if(R&&d!=="initSegment"){const I=l||a,C=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend){const w=I.start+I.duration*.05,k=R.buffered,O=this.currentOp("video");!k.length&&!O?this.blockAudio(I):!O&&!xe.isBuffered(R,w)&&this.lastVideoAppendEnd<w&&this.blockAudio(I)}else if(s==="video"){const D=I.end;if(C){const w=C.frag.start;(D>w||D<this.lastVideoAppendEnd||xe.isBuffered(R,w))&&this.unblockAudio()}this.lastVideoAppendEnd=D}}const L=(l||a).start,P={label:`append-${s}`,execute:()=>{if(f.executeStart=self.performance.now(),E){const I=this.tracks[s];if(I){const C=I.buffer;if(C){const D=L-C.timestampOffset;Math.abs(D)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${L} (delta: ${D}) sn: ${d})`),C.timestampOffset=L)}}}this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const I=self.performance.now();f.executeEnd=f.end=I,g.first===0&&(g.first=I),y&&y.first===0&&(y.first=I);const C={};this.sourceBuffers.forEach(([D,w])=>{D&&(C[D]=xe.getBuffered(w))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:C})},onError:I=>{var C;const D={type:he.MEDIA_ERROR,parent:a.type,details:$.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:u,error:I,err:I,fatal:!1};if(I.code===DOMException.QUOTA_EXCEEDED_ERR)D.details=$.BUFFER_FULL_ERROR;else if(I.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!((C=this.media)!=null&&C.error))D.errorAction=$o(!0);else if(I.name===QT)this.sourceBufferCount===0?D.errorAction=$o(!0):++this.appendErrors[s];else{const w=++this.appendErrors[s];this.warn(`Failed ${w}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer`),w>=this.hls.config.appendErrorMaxRetry&&(D.fatal=!0)}this.hls.trigger(A.ERROR,D)}};this.append(P,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],o=r?r.elementaryStreams:n.elementaryStreams;o[Be.AUDIOVIDEO]?s.push("audiovideo"):(o[Be.AUDIO]&&s.push("audio"),o[Be.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();n.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const u=r?r.stats:n.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:n,part:r,stats:u,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,s)}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,n;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((n=this.tracks[e])==null?void 0:n.ending))})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})&&(r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===$.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;ae(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ae(a)&&a>=0){const l=Math.max(a,o),u=Math.floor(s/o)*o-l;this.flushBackBuffer(s,o,u)}if(ae(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const l=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),u=Math.max(l,o),f=Math.floor(s/o)*o+u;this.flushFrontBuffer(s,o,f)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=xe.getBuffered(s);if(a.length>0&&n>a.start(0)){var o;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=xe.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(n>l||e>=l&&e<=u)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&n.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),f=Math.max(u,r);return{duration:1/0,start:u,end:f}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return ae(s)?{duration:s}:null;const o=this.media.duration,a=ae(n.duration)?n.duration:0;return r>a&&r>o||!ae(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(ae(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${je(n)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${je(a)}`);try{const f=n.addSourceBuffer(u),d=yh(o),m=[o,f];t[d]=m,a.buffer=f}catch(f){var r;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&Jh(n,"video")&&(r=i1(r,n));const s=bl(r,e.levelCodec);return s?t.slice(0,5)==="audio"?Xl(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=ae(r.duration)?r.duration:1/0,u=ae(s.duration)?s.duration:1/0,f=Math.max(0,t),d=Math.min(n,l,u);d>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${d}] from the ${e} SourceBuffer`),a.remove(f,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n==null?void 0:n.buffer;if(!r)throw new rI(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){this.isUpdating()||this.isQueued()?this.blockBuffers(e):e()}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:n}=this,r=t.map(o=>this.appendBlocker(o));t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(t))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const o=n.bind(this,e);r.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function I0(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function sI(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function yh(i){return i==="audio"?1:0}class Pu{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ae(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,Pu.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,n);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}}const oI={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Yt=oI,aI={HLS:"h"},lI=aI,uI="CMCD-Object",cI="CMCD-Request",hI="CMCD-Session",fI="CMCD-Status",Eo={OBJECT:uI,REQUEST:cI,SESSION:hI,STATUS:fI},dI={[Eo.OBJECT]:["br","d","ot","tb"],[Eo.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Eo.SESSION]:["cid","pr","sf","sid","st","v"],[Eo.STATUS]:["bs","rtp"]};class bs{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof bs?n:new bs(n))),this.value=e,this.params=t}}const mI="Dict";function pI(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function gI(i,e,t,n){return new Error(`failed to ${i} "${pI(e)}" as ${t}`,{cause:n})}function ai(i,e,t){return gI("serialize",i,e,t)}class JT{constructor(e){this.description=e}}const P0="Bare Item",yI="Boolean";function vI(i){if(typeof i!="boolean")throw ai(i,yI);return i?"?1":"?0"}const TI="Byte Sequence";function EI(i){if(ArrayBuffer.isView(i)===!1)throw ai(i,TI);return`:${vR(i)}:`}const SI="Integer";function xI(i){return i<-999999999999999||999999999999999<i}function eE(i){if(xI(i))throw ai(i,SI);return i.toString()}function _I(i){return`@${eE(i.getTime()/1e3)}`}const AI="Decimal";function LI(i){const e=OT(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ai(i,AI);const t=e.toString();return t.includes(".")?t:`${t}.0`}const RI="String",II=/[\x00-\x1f\x7f]+/;function PI(i){if(II.test(i))throw ai(i,RI);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function DI(i){return i.description||i.toString().slice(7,-1)}const wI="Token";function D0(i){const e=DI(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ai(e,wI);return e}function cf(i){switch(typeof i){case"number":if(!ae(i))throw ai(i,P0);return Number.isInteger(i)?eE(i):LI(i);case"string":return PI(i);case"symbol":return D0(i);case"boolean":return vI(i);case"object":if(i instanceof Date)return _I(i);if(i instanceof Uint8Array)return EI(i);if(i instanceof JT)return D0(i);default:throw ai(i,P0)}}const CI="Key";function hf(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw ai(i,CI);return i}function yd(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${hf(e)}`:`;${hf(e)}=${cf(t)}`).join("")}function tE(i){return i instanceof bs?`${cf(i.value)}${yd(i.params)}`:cf(i)}function bI(i){return`(${i.value.map(tE).join(" ")})${yd(i.params)}`}function kI(i,e={whitespace:!0}){if(typeof i!="object")throw ai(i,mI);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof bs||(s=new bs(s));let o=hf(r);return s.value===!0?o+=yd(s.params):(o+="=",Array.isArray(s.value)?o+=bI(s):o+=tE(s)),o}).join(`,${n}`)}function OI(i,e){return kI(i,e)}function MI(i){return i==="ot"||i==="sf"||i==="st"}function FI(i){return typeof i=="number"?ae(i):i!=null&&i!==""&&i!==!1}const Ml=i=>Math.round(i),NI=(i,e)=>(e!=null&&e.baseUrl&&(i=TR(i,e.baseUrl)),encodeURIComponent(i)),El=i=>Ml(i/100)*100,BI={br:Ml,d:Ml,bl:El,dl:El,mtp:El,nor:NI,rtp:El,tb:Ml};function UI(i,e){const t={};if(i==null||typeof i!="object")return t;const n=Object.keys(i).sort(),r=Ue({},BI,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return n.forEach(o=>{if(s!=null&&s(o))return;let a=i[o];const l=r[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||FI(a)&&(MI(o)&&typeof a=="string"&&(a=new JT(a)),t[o]=a))}),t}function nE(i,e={}){return i?OI(UI(i,e),Ue({whitespace:!1},e)):""}function $I(i,e={}){const t={};if(!i)return t;const n=Object.entries(i),r=Object.entries(dI).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=n.reduce((o,a)=>{var l,u;const[f,d]=a,m=((l=r.find(g=>g[1].includes(f)))===null||l===void 0?void 0:l[0])||Eo.REQUEST;return(u=o[m])!==null&&u!==void 0||(o[m]={}),o[m][f]=d,o},{});return Object.entries(s).reduce((o,[a,l])=>(o[a]=nE(l,e),o),t)}function VI(i,e,t){return Ue(i,$I(e,t))}const GI="CMCD";function HI(i,e={}){if(!i)return"";const t=nE(i,e);return`${GI}=${encodeURIComponent(t)}`}const w0=/CMCD=[^&#]+/;function KI(i,e,t){const n=HI(e,t);if(!n)return i;if(w0.test(i))return i.replace(w0,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class iE{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Yt.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(o||s).duration*1e3,ot:l};(l===Yt.VIDEO||l===Yt.AUDIO||l==Yt.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const f=o?this.getNextPart(o):this.getNextFrag(s);f!=null&&f.url&&f.url!==s.url&&(u.nor=f.url),this.apply(r,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:lI.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ue(t,this.createData());const n=t.ot===Yt.INIT||t.ot===Yt.VIDEO||t.ot===Yt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),VI(e.headers,t,s)):e.url=KI(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t,n;const{index:r,fragment:s}=e,o=(t=this.hls.levels[s.level])==null||(n=t.details)==null?void 0:n.partList;if(o){const{sn:a}=s;for(let l=o.length-1;l>=0;l--){const u=o[l];if(u.index===r&&u.fragment.sn===a)return o[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Yt.TIMED_TEXT;if(e.sn==="initSegment")return Yt.INIT;if(t==="audio")return Yt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===Yt.AUDIO)n=r.audioTracks;else{const s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;n=r.levels.slice(0,o)}for(const s of n)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:xe.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const zI=3e5;class rE extends Oi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Tt.SendAlternateToPenaltyBox&&n.flags===In.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&r?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==o),n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${je(s)} penalized: ${je(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(s=>{r-n[s]>zI&&delete n[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in n)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,AT(t),this.hls.trigger(A.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===Re.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===Re.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(f=>f.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(f=>{const d=new ze(f.attrs);d["PATHWAY-ID"]=o;const m=d.AUDIO&&`${d.AUDIO}_clone_${o}`,g=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;m&&(n[d.AUDIO]=m,d.AUDIO=m),g&&(r[d.SUBTITLES]=g,d.SUBTITLES=g);const y=sE(f.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),T=new Ds({attrs:d,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:y,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let E=1;E<f.audioGroups.length;E++)T.addGroupId("audio",`${f.audioGroups[E]}_clone_${o}`);if(f.subtitleGroups)for(let E=1;E<f.subtitleGroups.length;E++)T.addGroupId("text",`${f.subtitleGroups[E]}_clone_${o}`);return T});t.push(...u),C0(this.audioTracks,n,l,o),C0(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+f)}const s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(f,d,m,g)=>{this.log(`Loaded steering manifest: "${r}"`);const y=f.data;if((y==null?void 0:y.VERSION)!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":x}=y;if(T)try{this.uri=new self.URL(T,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||m.url),E&&this.clonePathways(E);const R={steeringManifest:y,url:r.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,R),x&&this.updatePathwayPriority(x)},onError:(f,d,m,g)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${d.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let y=this.timeToLoad*1e3;if(f.code===429){const T=this.loader;if(typeof(T==null?void 0:T.getResponseHeader)=="function"){const E=T.getResponseHeader("Retry-After");E&&(y=parseFloat(E)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,y)},onTimeout:(f,d,m)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function C0(i,e,t,n){i&&Object.keys(e).forEach(r=>{const s=i.filter(o=>o.groupId===r).map(o=>{const a=Ue({},o);return a.details=void 0,a.attrs=new ze(a.attrs),a.url=a.attrs.URI=sE(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=n,a});i.push(...s)})}function sE(i,e,t,n){const{HOST:r,PARAMS:s,[t]:o}=n;let a;e&&(a=o==null?void 0:o[e],a&&(i=a));const l=new self.URL(i);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}class Fr extends Oi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Fr.CDMCleanupPromise?[Fr.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:n,initData:r}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=gl(this.config));const a=o.map(uh).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=ah(o);let l,u;if(n==="sinf"){if(a!==Me.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}const y=ht(new Uint8Array(r));try{const T=ld(JSON.parse(y).sinf),E=nT(T);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(E.subarray(8,24)),u=Me.FAIRPLAY}catch(T){this.warn(`${s} Failed to parse sinf: ${T}`);return}}else{if(a!==Me.WIDEVINE&&a!==Me.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}const y=JL(r),T=y.filter(x=>!!x.systemId&&lh(x.systemId)===a);T.length>1&&this.warn(`${s} Using first of ${T.length} pssh found for selected key-system ${a}`);const E=T[0];if(!E){y.length===0||y.some(x=>!x.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${y.map(x=>lh(x.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=lh(E.systemId),E.version===0&&E.data)if(u===Me.WIDEVINE){const x=E.data.length-22;l=new Uint8Array(E.data.subarray(x,x+16))}else u===Me.PLAYREADY&&(l=vT(E.data))}if(!u||!l)return;const f=Xn.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:m}=this;let g=d[f];for(let y=0;y<m.length;y++){const T=m[y],E=T.decryptdata;if(!E.keyId)continue;const x=Xn.hexDump(E.keyId);if(f===x||E.uri.replace(/-/g,"").indexOf(f)!==-1){if(g=d[x],E.pssh)break;delete d[x],E.pssh=new Uint8Array(r),E.keyId=l,g=d[f]=g.then(()=>this.generateRequestWithPreferredKeySession(T,n,r,"encrypted-event-key-match")),g.catch(R=>this.handleError(R));break}}if(!g){if(u!==a){this.log(`Ignoring "${t.type}" event with ${u} init data for selected key-system ${a}`);return}g=d[f]=this.getKeySystemSelectionPromise([u]).then(({keySystem:y,mediaKeys:T})=>{var E;this.throwIfDestroyed();const x=new ws("ISO-23001-7",f,(E=uh(y))!=null?E:"");return x.pssh=new Uint8Array(r),x.keyId=l,this.attemptSetMediaKeys(y,T).then(()=>{this.throwIfDestroyed();const R=this.createMediaKeySessionContext({decryptdata:x,keySystem:y,mediaKeys:T});return this.generateRequestWithPreferredKeySession(R,n,r,"encrypted-event-no-match")})}),g.catch(y=>this.handleError(y))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===Me.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,a,l)=>!!o&&l.indexOf(o)===a,r=t.map(o=>o.audioCodec).filter(n),s=t.map(o=>o.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const f=u.shift();this.getMediaKeysPromise(f,r,s).then(d=>o({keySystem:f,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof _n?a(d):a(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return ud===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){const r=V1(e,t,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let o=s==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${je(r)}`),o=this.requestMediaKeySystemAccess(e,r);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),u.then(d=>d?this.setMediaKeysServerCertificate(f,e,d):f))),a.mediaKeys.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),a.mediaKeys})}return o.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Xn.hexDump(e.keyId||[])}`);const r=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Xn.hexDump(e.keyId)}updateKeySession(e,t){var n;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Xn.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const r=gl(this.config),s=e.map(ah).filter(o=>!!o&&r.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:o})=>{const a=uh(o);a?t(a):n(new Error(`Unable to find format for key-system "${o}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),r=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(a,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[n]=s.then(a=>{const l="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(a,l,u,"playlist-key")})).catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof _n?this.hls.trigger(A.ERROR,e.data):this.hls.trigger(A.ERROR,{type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=ah(e.keyFormat),s=r?[r]:gl(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=gl(this.config)),e.length===0)throw new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${je({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var s,o;const a=(s=this.config.drmSystems)==null||(o=s[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const y=a.call(this.hls,t,n,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,n=y.initData?y.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(y){var l;if(this.warn(y.message),(l=this.hls)!=null&&l.config.debug)throw y}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${u} (init data type: ${t} length: ${n?n.byteLength:null})`);const f=new cd,d=e._onmessage=y=>{const T=e.mediaKeysSession;if(!T){f.emit("error",new Error("invalid state"));return}const{messageType:E,message:x}=y;this.log(`"${E}" message event for session "${T.sessionId}" message size: ${x.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,x).catch(R=>{f.eventNames().length?f.emit("error",R):this.handleError(R)}):E==="license-release"?e.keySystem===Me.FAIRPLAY&&(this.updateKeySession(e,rf("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${E}"`)},m=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){f.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const E=e.keyStatus;f.emit("keyStatus",E),E==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",m);const g=new Promise((y,T)=>{f.on("error",T),f.on("keyStatus",E=>{E.startsWith("usable")?y():E==="output-restricted"?T(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):E==="internal-error"?T(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${E}"`)):E==="expired"?T(new Error("key expired while generating request")):this.warn(`unhandled key status change "${E}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var y;this.log(`Request generated for key-session "${(y=e.mediaKeysSession)==null?void 0:y.sessionId}" keyId: ${u}`)}).catch(y=>{throw new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_NO_SESSION,error:y,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>g).catch(y=>{throw f.removeAllListeners(),this.removeSession(e),y}).then(()=>(f.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Xn.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Xn.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(m,g,y,T)=>{o(m.data)},onError:(m,g,y,T)=>{a(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:Ne({url:l.url,data:void 0},m)},`"${e}" certificate request failed (${s}). Status: ${m.code} (${m.text})`))},onTimeout:(m,g,y)=>{a(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(m,g,y)=>{a(new Error("aborted"))}};r.load(l,f,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),r(e)}).catch(o=>{s(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let f;for(let d=0,m=s.length;d<m;d++){var o,a;f=s[d];const g=(o=f.querySelector("name"))==null?void 0:o.textContent,y=(a=f.querySelector("value"))==null?void 0:a.textContent;g&&y&&e.setRequestHeader(g,y)}}const l=r.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return rf(atob(u))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(f){this.error(f)}r(l)}else{const l=n.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)s(new _n({type:he.KEY_SYSTEM_ERROR,details:$.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const f=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==Me.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.removeEventListener("encrypted",this.onMediaEncrypted),n.removeEventListener("waitingforkey",this.onWaitingForKey),n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const n=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ws.clearKeyUriToKeyIdMap();const r=n.length;Fr.CDMCleanupPromise=Promise.all(n.map(s=>this.removeSession(s)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(s=>{var o;this.log(`Could not clear media keys: ${s}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),n.length=0)}).catch(s=>{var o;this.log(`Could not close sessions and clear media keys: ${s}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch(s=>{var o;this.log(`Could not remove session: ${s}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${s}`)})}).then(()=>t.close()).catch(s=>{var o;this.log(`Could not close session: ${s}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${s}`)})})}}}Fr.CDMCleanupPromise=void 0;class _n extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class oE{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(A.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let f=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=f)&&(f=f-1,u.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aE(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function lE(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Pe.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Pe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function ps(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function ff(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const s=jI(i.cues,e,t);for(let o=0;o<s.length;o++)(!n||n(s[o]))&&i.removeCue(s[o])}r==="disabled"&&(i.mode=r)}function WI(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,s;for(;n<=r;)if(s=Math.floor((r+n)/2),e<i[s].startTime)r=s-1;else if(e>i[s].startTime&&n<t)n=s+1;else return s;return i[n].startTime-e<e-i[r].startTime?n:r}function jI(i,e,t){const n=[],r=WI(i,e);if(r>-1)for(let s=r,o=i.length;s<o;s++){const a=i[s];if(a.startTime>=e&&a.endTime<=t)n.push(a);else if(a.startTime>t)return n}return n}function Fl(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class uE extends Iu{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Fl(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Fl(n.textTracks).forEach(o=>{ps(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,d)=>{f.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const f=ei(a,o);if(f>-1)s=o[f];else{const d=ei(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(n&&!s.default||!n&&!e)&&(!e||Mr(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(Ko(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Ko(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(uf(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Re.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Mr(e,n))return n;const r=ei(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(n)return null;{const s=ei(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Fl(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(s=>uf(n,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ae(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:f}=r;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:f});const d=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(d)}}function Do(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const As=.025;let ru=function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i}({});function YI(i,e,t){return`${i.identifier}-${t+1}-${Do(e)}`}class qI{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return vh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=vh(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ae(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return vh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<As))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ru.Range:ru.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return XI(this)}}function vh(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<As)?e.start:e.start+e.duration}function cE(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function XI(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function df(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class QI{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const u=this.interstitial.playoutLimit,f=this.currentTime;this.startOffset+f>=u&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;let o=r.uri;try{o=cE(o,s.sessionId).href}catch{}s.loadSource(o);const a=()=>{this.hasDetails=!0};s.once(A.LEVEL_LOADED,a),s.once(A.AUDIO_TRACK_LOADED,a),s.once(A.SUBTITLE_TRACK_LOADED,a),s.on(A.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&u.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const n=this.timelineOffset,r=xe.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=xe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,n){this.hls.on(e,t)}once(e,t,n){this.hls.once(e,t)}off(e,t,n){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${df(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const b0=.033;class ZI extends Oi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=r[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const s=n[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const o=n[s];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&t<a+(o.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const n=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(n){const r=n.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,o=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),l=s?s.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,f)=>{const d=u.cue.pre,m=u.cue.post,g=f.cue.pre,y=f.cue.post;if(d&&!g)return-1;if(g&&!d||m&&!y)return 1;if(y&&!m)return-1;if(!d&&!g&&!m&&!y){const T=u.startTime,E=f.startTime;if(T!==E)return T-E}return u.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,s=this.parseSchedule(n,e);(t.length||(r==null?void 0:r.length)!==s.length||s.some((a,l)=>Math.abs(a.playout.start-r[l].playout.start)>.005||Math.abs(a.playout.end-r[l].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new qI(l,t),this.eventMap[a]=u,n===!1&&(u.appendInPlace=n)),r.push(u)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((f,d)=>{const m=f.cue.pre,g=f.cue.post,y=e[d-1]||null,T=f.appendInPlace,E=g?s:f.startOffset,x=f.duration,R=f.timelineOccupancy===ru.Range?x:0,L=f.resumptionOffset,P=(y==null?void 0:y.startTime)===E,I=E+f.cumulativeDuration;let C=T?I+x:E+L;if(m||!g&&E<=0){const w=u;u+=R,f.timelineStart=I;const k=o;o+=x,n.push({event:f,start:I,end:C,playout:{start:k,end:o},integrated:{start:w,end:u}})}else if(E<=s){if(!P){const O=E-l;if(O>b0){const W=l,q=u;u+=O;const ie=o;o+=O;const te={previousEvent:e[d-1]||null,nextEvent:f,start:W,end:W+O,playout:{start:ie,end:o},integrated:{start:q,end:u}};n.push(te)}else O>0&&y&&(y.cumulativeDuration+=O,n[n.length-1].end=E)}g&&(C=I),f.timelineStart=I;const w=u;u+=R;const k=o;o+=x,n.push({event:f,start:I,end:C,playout:{start:k,end:o},integrated:{start:w,end:u}})}else return;const D=f.resumeTime;g||D>s?l=s:l=D}),l<s){var a;const f=l,d=u,m=s-l;u+=m;const g=o;o+=m,n.push({previousEvent:((a=n[n.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:f+m,playout:{start:g,end:o},integrated:{start:d,end:u}})}this.setDurations(s,o,u)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,f=a.cue.post,d=u?0:f?r:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=s:(s=0,o=d),!f&&a.snapOptions.in&&(a.resumeAnchor=Gr(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<b0&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const g=ae(a.resumeOffset)?a.resumeOffset:a.duration;s+=g})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>As?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):t?!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${l}`),!1;const u=Gr(null,a.fragments,n);if(!u)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(u.start-n)<As+f||Math.abs(u.end-n)<As+f?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${n} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;e.assetList.forEach((o,a)=>{const l=t+n;o.startOffset=n,o.timelineStart=l,r||(r=o.duration===null),s||(s=!!o.error);const u=o.error?0:o.duration||0;n+=u}),r&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function qi(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class JI{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=cE(n,this.hls.sessionId,e.baseUrl)}catch(m){const g=this.assignAssetListError(e,$.ASSET_LIST_LOAD_ERROR,m,n);this.hls.trigger(A.ERROR,g);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},u=s.interstitialAssetListLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(m,g,y,T)=>{const E=m.data,x=E==null?void 0:E.ASSETS;if(!Array.isArray(x)){const R=this.assignAssetListError(e,$.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,g,T);this.hls.trigger(A.ERROR,R);return}e.assetListResponse=E,this.hls.trigger(A.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:T})},onError:(m,g,y,T)=>{const E=this.assignAssetListError(e,$.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${g.url})`),g.url,T,y);this.hls.trigger(A.ERROR,E)},onTimeout:(m,g,y)=>{const T=this.assignAssetListError(e,$.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${g.url})`),g.url,m,y);this.hls.trigger(A.ERROR,T)}};return a.load(l,f,d),this.hls.trigger(A.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,r,s,o){return e.error=n,{type:he.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:o,stats:s}}}function Ri(i,e,t){ti(i,e,t),i.addEventListener(e,t)}function ti(i,e,t){i.removeEventListener(e,t)}function k0(i){i==null||i.play().catch(()=>{})}class eP extends Oi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(),this.checkBuffer(),o&&n<a.start||n>=a.end){var l;const m=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o){const g=this.findItemIndex(a);if(m>g){const y=this.schedule.findJumpRestrictedIndex(g+1,m);if(y>g){this.setSchedulePosition(y);return}}}this.setSchedulePosition(m);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const m=a.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,m))}return}const f=u.timelineStart,d=u.duration||0;(o&&n<f||n>=f+d)&&this.setScheduleToAssetAtTime(n,u)},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,r)=>{const s=this.schedule,o=this.playingItem,a=s.events||[],l=s.items||[],u=s.durations,f=n.map(g=>g.identifier),d=!!(a.length||f.length);if(d&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(g=>qi(g))}`),f.length&&this.log(`Removed events ${f}`),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const y=g.assetItem.timelineStart,T=g.timelineOffset-y;if(T)try{g.timelineOffset=y}catch(E){Math.abs(T)>As&&this.warn(`${E} ("${g.assetId}" ${g.timelineOffset}->${y})`)}}}),o){const g=this.updateItem(o,this.timelinePos);this.itemsMatch(o,g)&&(this.playingItem=g,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m){const g=this.updateItem(m,this.bufferedPos);this.itemsMatch(m,g)?this.bufferingItem=g:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))}if(n.forEach(g=>{g.assetList.forEach(y=>{this.clearAssetPlayer(y.identifier,null)})}),d||r){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new JI(e),this.schedule=new ZI(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(A.MEDIA_ENDED,this.onMediaEnded,this),e.on(A.ERROR,this.onError,this),e.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(A.MEDIA_ENDED,this.onMediaEnded,this),e.off(A.ERROR,this.onError,this),e.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ti(e,"play",this.onPlay),ti(e,"pause",this.onPause),ti(e,"seeking",this.onSeeking),ti(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Ri(n,"seeking",this.onSeeking),Ri(n,"timeupdate",this.onTimeupdate),Ri(n,"play",this.onPlay),Ri(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=d=>d&&e.getAssetPlayer(d.identifier),r=(d,m,g,y,T)=>{if(d){let E=d[m].start;const x=d.event;if(x){if(m==="playout"||x.timelineOccupancy!==ru.Point){const R=n(g);(R==null?void 0:R.interstitial)===x&&(E+=R.assetItem.startOffset+R[T])}}else{const R=y==="bufferedPos"?o():e[y];E+=R-d.start}return E}return 0},s=(d,m)=>{if(d!==0&&m!=="primary"&&e.schedule.length){var g;const y=e.schedule.findItemIndexAtTime(d),T=(g=e.schedule.items)==null?void 0:g[y];if(T){const E=T[m].start-T.start;return d+E}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var m;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:e.schedule.durations[d]},l=(d,m)=>{var g,y;const T=e.effectivePlayingItem;if(T!=null&&(g=T.event)!=null&&g.restrictions.skip)return;e.log(`seek to ${d} "${m}"`);const E=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(d,m),R=(y=e.schedule.items)==null?void 0:y[x],L=e.getBufferingPlayer(),P=L==null?void 0:L.interstitial,I=P==null?void 0:P.appendInPlace,C=E&&e.itemsMatch(E,R);if(E&&(I||C)){const w=n(e.playingAsset),k=(w==null?void 0:w.media)||e.primaryMedia;if(k){const O=m==="primary"?k.currentTime:r(E,m,e.playingAsset,"timelinePos","currentTime"),W=d-O,q=(I?O:k.currentTime)+W;if(q>=0&&(!w||I||q<=w.duration)){k.currentTime=q;return}}}if(R){let w=d;if(m!=="primary"){const O=R[m].start,W=d-O;w=R.start+W}const k=!e.isInterstitial(R);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(k||R.event.appendInPlace)){const O=e.media||(I?L==null?void 0:L.media:null);O&&(O.currentTime=w)}else if(E){const O=e.findItemIndex(E);if(x>O){const q=e.schedule.findJumpRestrictedIndex(O+1,x);if(q>O){e.setSchedulePosition(q);return}}let W=0;if(k)e.timelinePos=w,e.checkBuffer();else{var D;const q=R==null||(D=R.event)==null?void 0:D.assetList;if(q){const ie=d-(R[m]||R).start;for(let te=q.length;te--;){const J=q[te];if(J.duration&&ie>=J.startOffset&&ie<J.startOffset+J.duration){W=te;break}}}}e.setSchedulePosition(x,W)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const m=t();return e.isInterstitial(m)?m:null},f={get currentTime(){const d=u(),m=e.effectivePlayingItem;return m&&m===d?r(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(d){const m=u(),g=e.effectivePlayingItem;g&&g===m&&l(d+g.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const m=(d=u())==null?void 0:d.event.assetList;return m?m.map(g=>e.getAssetPlayer(g.identifier)):[]},get playingIndex(){var d;const m=(d=u())==null?void 0:d.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};this.manager={get events(){var d,m;return((d=e.schedule)==null||(m=d.events)==null?void 0:m.slice(0))||[]},get schedule(){var d,m;return((d=e.schedule)==null||(m=d.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return u()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,m=d==null?void 0:d.event;if(m&&!m.restrictions.skip){const g=e.findItemIndex(d);if(m.appendInPlace){const y=d.playout.start+d.event.duration;l(y+.001,"playout")}else e.advanceAfterAssetEnded(m,g,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,n;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const o=(n=s)==null?void 0:n.currentTime;if(!(o===void 0||!ae(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${je(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(n=this.detachedData)==null?void 0:n.mediaSource;let f;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),f="Primary";else if(u){const g=this.getBufferingPlayer();g?(s=g.transferMedia(),f=`${g}`):f="detached MediaSource"}else f="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${je(s)}`);else if(!this.detachedData||o.media===t){const g=this.playerQueue;g.length>1&&g.forEach(y=>{if(a&&y.interstitial.appendInPlace!==l){const T=y.interstitial;this.clearInterstitial(y.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",m=d&&s?s:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${f}`),m===s){const g=a&&e.assetId===this.schedule.assetIdAtEnd;m.overrides={duration:this.schedule.duration,endOfStream:!a||g,cueRemoval:!a}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,n){const r=n+1;if(!e.isAssetPastPlayoutLimit(r)&&!e.assetList[r].error)this.setSchedulePosition(t,r);else{const s=this.schedule.items;if(s){const o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const n=this.schedule,r=t.parentIdentifier,s=n.getEvent(r);if(s){const o=n.findEventIndex(r),a=n.findAssetIndex(s,e);this.setSchedulePosition(o,a)}}setSchedulePosition(e,t){const n=this.schedule.items;if(!n||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?n[e]:null,s=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(s)){var a;const u=s.event,f=this.playingAsset,d=f==null?void 0:f.identifier,m=d?this.getAssetPlayer(d):null;if(m&&d&&(!this.eventItemsMatch(s,r)||t!==void 0&&d!==((a=u.assetList)==null?void 0:a[t].identifier))){var l;const g=u.findAssetIndex(f);this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${u.assetList.length} ${df(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:g,event:u,schedule:n.slice(0),scheduleIndex:e,player:m}),this.retreiveMediaSource(d,r),m.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(s,r)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${qi(s)}`),u.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:u,schedule:n.slice(0),scheduleIndex:e}),u.cue.once)){this.updateSchedule();const g=this.schedule.items;if(r&&g){const y=this.schedule.findItemIndex(r);this.advanceSchedule(y,g,t,s,o)}return}}this.advanceSchedule(e,n,t,s,o)}advanceSchedule(e,t,n,r,s){const o=e>=0?t[e]:null,a=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(u=>{const f=u.interstitial,d=this.schedule.findEventIndex(f.identifier);(d<e||d>e+1)&&this.clearInterstitial(f,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;n===void 0&&(n=this.schedule.findAssetIndex(u,this.timelinePos));const f=this.waitingItem;this.assetsBuffered(o,a)||this.setBufferingItem(o);let d=this.preloadAssets(u,n);if(this.eventItemsMatch(o,f||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${qi(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!a){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const m=u.assetList[n];if(!m){const g=t[e+1],y=this.media;g&&y&&!this.isInterstitial(g)&&y.currentTime<g.start&&(y.currentTime=this.timelinePos=g.start),this.advanceAfterAssetEnded(u,e,n||0);return}if(d||(d=this.getAssetPlayer(m.identifier)),d===null||d.destroyed){const g=u.assetList.length;this.warn(`asset ${n+1}/${g} player destroyed ${u}`),d=this.createAssetPlayer(u,m,n)}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(d,n,t,e,a),this.shouldPlay&&k0(d.media)}else o!==null?(this.resumePrimary(o,e,r),this.shouldPlay&&k0(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${qi(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const s=this.schedule.items;s&&(this.log(`resumed ${qi(e)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:xe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const n=this.hls.levels[t.level],r=Ne(Ne({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ne(Ne({},this.altSelection),{},{audio:n});return}const s=Ne(Ne({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ne(Ne({},this.altSelection),{},{subtitles:n});return}const s=Ne(Ne({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=Wg(t);this.playerQueue.forEach(r=>r.hls.setAudioOption(t)||r.hls.setAudioOption(n))}onSubtitleTrackSwitch(e,t){const n=Wg(t);this.playerQueue.forEach(r=>r.hls.setSubtitleOption(t)||t.id!==-1&&r.hls.setSubtitleOption(n))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var n;const o=this.schedule.findEventIndex(s.identifier),a=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){const n=this.schedule.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const n=xe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,t,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u,f;const d=this.findItemIndex(s),m=Math.min(d+1,t.length-1),g=t[m];if((l===-1&&s&&e>=s.end||(u=g.event)!=null&&u.appendInPlace&&e+.01>=g.start)&&(l=m),m-a>1&&(s==null||(f=s.event)==null?void 0:f.appendInPlace)===!1)return;if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(g);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&g.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else n&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:r,events:s}=n;if(!r||!s)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const l=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${qi(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),o?e.event.assetList.forEach(u=>{const f=this.getAssetPlayer(u.identifier);f&&f.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering()))}this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(r||!s){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const a=n.assetList[t],l=this.primaryMedia;a&&l&&this.bufferAssetPlayer(o,l)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var a;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(a=m.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const m=f-l;m>0&&(u=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${u?` live-start: ${f} start-offset: ${u}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!o&&r){for(let l=t;l<r;l++){const u=e.assetList[l],f=this.getAssetPlayerQueueIndex(u.identifier);(f===-1||this.playerQueue[f].destroyed)&&!u.error&&this.createAssetPlayer(e,u,l)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,s,o){const a={parentIdentifier:e.identifier,identifier:YI(e,o,t),duration:s,startOffset:n,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){this.log(`create HLSAssetPlayer for ${df(t)}`);const r=this.hls,s=r.userConfig;let o=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=Ue({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const P=t.duration;P&&L<P&&(f=L)}}const d=t.identifier,m=Ne(Ne({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const g=m.cmcd;g!=null&&g.sessionId&&g.contentId&&(m.cmcd=Ue({},g,{contentId:Do(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const y=new QI(this.HlsPlayerClass,m,e,t);this.playerQueue.push(y),e.assetList[n]=t;const T=L=>{if(L.live){const C=new Error(`Interstitials MUST be VOD assets ${e}`),D={fatal:!0,type:he.OTHER_ERROR,details:$.INTERSTITIAL_ASSET_ITEM_ERROR,error:C};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),n,C.message);return}const P=L.edge-L.fragmentStart,I=t.duration;(I===null||P>I)&&(this.log(`Interstitial asset "${d}" duration change ${I} > ${P}`),t.duration=P,this.updateSchedule())};y.on(A.LEVEL_UPDATED,(L,{details:P})=>T(P)),y.on(A.LEVEL_PTS_UPDATED,(L,{details:P})=>T(P));const E=(L,P)=>{const I=this.getAssetPlayer(d);if(I&&P.tracks){I.off(A.BUFFER_CODECS,E),I.tracks=P.tracks;const C=this.primaryMedia;this.bufferingAsset===I.assetItem&&C&&!I.media&&this.bufferAssetPlayer(I,C)}};y.on(A.BUFFER_CODECS,E);const x=()=>{var L;const P=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${P}`),!P)return;const I=this.schedule.findEventIndex(e.identifier),C=e.findAssetIndex(t),D=C+1,w=(L=this.schedule.items)==null?void 0:L[I];if(this.isInterstitial(w))if(C!==-1&&!e.isAssetPastPlayoutLimit(D)&&!e.assetList[D].error)this.bufferedToItem(w,D);else{var k;const O=(k=this.schedule.items)==null?void 0:k[I+1];O&&this.bufferedToItem(O)}};y.on(A.BUFFERED_TO_END,x);const R=L=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const I=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,I,L)};return y.once(A.MEDIA_ENDED,R(n)),y.once(A.PLAYOUT_LIMIT_REACHED,R(1/0)),y.on(A.ERROR,(L,P)=>{const I=this.getAssetPlayer(d);if(P.details===$.BUFFER_STALLED_ERROR){if(I!=null&&I.media){const C=I.currentTime,D=I.duration-C;C&&e.appendInPlace&&D/I.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${I.media.currentTime}`),x()):(this.warn(`Stalled at ${C} of ${C+D} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${P.error} ${e}`)}),y.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const P=new Error(`Asset player destroyed unexpectedly ${d}`),I={fatal:!0,type:he.OTHER_ERROR,details:$.INTERSTITIAL_ASSET_ITEM_ERROR,error:P};this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),n,P.message)}),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:y}),y}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&qi(t)}`);const r=this.playerQueue[n];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!f||f.identifier!==l)&&(f&&(this.clearAssetPlayer(f.identifier,n[r]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${e}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;const{interstitial:s,assetItem:o,assetId:a}=e,l=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[l];if(!u)return;this.setBufferingItem(u),this.bufferingAsset=o;const f=this.getBufferingPlayer();if(f===e)return;const d=s.appendInPlace;if(d&&(f==null?void 0:f.interstitial.appendInPlace)===!1)return;const m=(f==null?void 0:f.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks)return;if(m&&!qv(m,e.tracks)){const g=new Error(`Asset "${a}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),y={fatal:!0,type:he.OTHER_ERROR,details:$.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},T=s.findAssetIndex(o);this.handleAssetItemError(y,s,l,T,g.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,n,r,s){if(e.details===$.BUFFER_STALLED_ERROR)return;const o=t.assetList[r]||null;let a=null;if(o){const d=this.getAssetPlayerQueueIndex(o.identifier);a=this.playerQueue[d]||null}const l=this.schedule.items,u=Ue({},e,{fatal:!1,errorAction:$o(!0),asset:o,assetListIndex:r,event:t,schedule:l,scheduleIndex:n,player:a});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const f=new Error(s);o&&(this.playingAsset!==o&&this.clearAssetPlayer(o.identifier,null),o.error=f),t.assetList.some(d=>!d.error)?t.appendInPlace&&(t.error=f):t.error=f,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(this.updateSchedule(),n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${n?qi(n):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const s=this.updateItem(n,r);if(this.itemsMatch(n,s))this.clearInterstitial(e,null);else{const o=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(o)}}else this.checkStart()}onAssetListLoaded(e,t){var n;const r=t.event,s=r.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const a=r.timelineStart,l=r.duration;let u=0;o.forEach((y,T)=>{const E=parseFloat(y.DURATION);this.createAsset(r,T,u,a+u,E,y.URI),u+=E}),r.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${r}`);const f=this.waitingItem,d=(f==null?void 0:f.event.identifier)===s;this.updateSchedule();const m=(n=this.bufferingItem)==null?void 0:n.event;if(d){var g;const y=this.schedule.findEventIndex(s),T=(g=this.schedule.items)==null?void 0:g[y];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(y)}else if((m==null?void 0:m.identifier)===s&&m.appendInPlace){const y=r.assetList[0],T=this.getAssetPlayer(y.identifier),E=this.primaryMedia;y&&T&&E&&this.bufferAssetPlayer(T,E)}}onError(e,t){switch(t.details){case $.ASSET_LIST_PARSING_ERROR:case $.ASSET_LIST_LOAD_ERROR:case $.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&this.primaryFallback(n);break}case $.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const O0=500;class hE extends Lu{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",ce.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=X.IDLE,this.setInterval(O0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(At(n)&&(this.fragPrevious=n),this.state=X.IDLE,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=n.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}const l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(n,s,ce.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===ce.SUBTITLE&&(t.details===$.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==X.STOPPED&&(this.state=X.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&qT(this.levels,t)){this.levels=t.map(n=>new Ds(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new Ds(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ce.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==X.STOPPED&&this.setInterval(O0)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(n=l.details)!=null&&n.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const m=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(nu(o,d),u=o.fragmentStart):m&&(u=m.start,of(o,u));else{var f;u=this.alignPlaylists(o,l.details,(f=this.levelLastLoaded)==null?void 0:f.details),u===0&&m&&(u=m.start,of(o,u))}}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===X.IDLE&&(Gr(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&_s(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,ad(r.method)).catch(a=>{throw s.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(A.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=X.IDLE})}}doTick(){if(!this.media){this.state=X.IDLE;return}if(this.state===X.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),o=xe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,u=n.details,f=this.hls.maxBufferLength+u.levelTargetDuration;if(l>f)return;const d=u.fragments,m=d.length,g=u.edge;let y=null;const T=this.fragPrevious;if(a<g){const R=r.maxFragLookUpTolerance,L=a>g-R?0:R;y=Gr(T,d,Math.max(d[0].start,a),L),!y&&T&&T.start<d[0].start&&(y=d[0])}else y=d[m-1];if(y=this.filterReplacedPrimary(y,n.details),!y)return;const E=y.sn-u.startSN,x=d[E-1];if(x&&x.cc===y.cc&&this.fragmentTracker.getState(x)===ft.NOT_LOADED&&(y=x),this.fragmentTracker.getState(y)===ft.NOT_LOADED){const R=this.mapToInitFragWhenRequired(y);R&&this.loadFragment(R,n,a)}}}loadFragment(e,t,n){At(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new tP(this.tracksBuffered[this.currentTrackId]||[])}}class tP{constructor(e){this.buffered=void 0;const t=(n,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const nP={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},fE=i=>String.fromCharCode(nP[i]||i),Mn=15,Ei=100,iP={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rP={17:2,18:4,21:6,22:8,23:10,19:13,20:15},sP={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},oP={25:2,26:4,29:6,30:8,31:10,27:13,28:15},aP=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class lP{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Pe.log(`${this.time} [${e}] ${n}`)}}}const _r=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class dE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class uP{constructor(){this.uchar=" ",this.penState=new dE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class cP{constructor(e){this.chars=[],this.pos=0,this.currPenState=new dE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ei;t++)this.chars.push(new uP);this.logger=e}equals(e){for(let t=0;t<Ei;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ei;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ei;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ei&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ei)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=fE(e);if(this.pos>=Ei){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ei;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Ei;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Th{constructor(e){this.rows=[],this.currRow=Mn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Mn;t++)this.rows.push(new cP(e));this.logger=e}reset(){for(let e=0;e<Mn;e++)this.rows[e].clear();this.currRow=Mn-1}equals(e){let t=!0;for(let n=0;n<Mn;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Mn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Mn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+je(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Mn;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+je(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<Mn;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class M0{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Th(n),this.nonDisplayedMemory=new Th(n),this.lastOutputScreen=new Th(n),this.currRollUpRow=this.displayedMemory.rows[Mn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Mn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+je(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class F0{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=fP(),this.logger=void 0;const r=this.logger=new lP;this.channels=[null,new M0(e,t,r),new M0(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,s=t[n+1]&127;let o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+_r([t[n],t[n+1]])+"] -> ("+_r([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(hP(r,s,l)){Sl(null,null,l),this.logger.log(3,()=>"Repeated command ("+_r([r,s])+") is dropped");continue}Sl(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else Sl(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+_r([r,s])+" orig: "+_r([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+_r([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?iP[e]:sP[e]:n=o===1?rP[e]:oP[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+fE(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+_r(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=aP[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Sl(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Sl(i,e,t){t.a=i,t.b=e}function hP(i,e,t){return t.a===i&&t.b===e}function fP(){return{a:null,b:null}}var vd=function(){if(tu!=null&&tu.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function n(a){return t(i,a)}function r(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){const f=arguments[u];for(const d in f)a[d]=f[d]}return a}function o(a,l,u){const f=this,d={enumerable:!0};f.hasBeenReset=!1;let m="",g=!1,y=a,T=l,E=u,x=null,R="",L=!0,P="auto",I="start",C=50,D="middle",w=50,k="middle";Object.defineProperty(f,"id",s({},d,{get:function(){return m},set:function(O){m=""+O}})),Object.defineProperty(f,"pauseOnExit",s({},d,{get:function(){return g},set:function(O){g=!!O}})),Object.defineProperty(f,"startTime",s({},d,{get:function(){return y},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");y=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",s({},d,{get:function(){return T},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");T=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",s({},d,{get:function(){return E},set:function(O){E=""+O,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",s({},d,{get:function(){return x},set:function(O){x=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",s({},d,{get:function(){return R},set:function(O){const W=n(O);if(W===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=W,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",s({},d,{get:function(){return L},set:function(O){L=!!O,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",s({},d,{get:function(){return P},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");P=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",s({},d,{get:function(){return I},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");I=W,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",s({},d,{get:function(){return C},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");C=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",s({},d,{get:function(){return D},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");D=W,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",s({},d,{get:function(){return w},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");w=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",s({},d,{get:function(){return k},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");k=W,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class dP{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function mE(i){function e(n,r,s,o){return(n|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class mP{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function pE(i,e,t,n){const r=n?i.split(n):[i];for(const s in r){if(typeof r[s]!="string")continue;const o=r[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const mf=new vd(0,0,""),xl=mf.align==="middle"?"middle":"center";function pP(i,e,t){const n=i;function r(){const a=mE(i);if(a===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const u=new mP;pE(a,function(m,g){let y;switch(m){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===g){u.set(m,t[T].region);break}break;case"vertical":u.alt(m,g,["rl","lr"]);break;case"line":y=g.split(","),u.integer(m,y[0]),u.percent(m,y[0])&&u.set("snapToLines",!1),u.alt(m,y[0],["auto"]),y.length===2&&u.alt("lineAlign",y[1],["start",xl,"end"]);break;case"position":y=g.split(","),u.percent(m,y[0]),y.length===2&&u.alt("positionAlign",y[1],["start",xl,"end","line-left","line-right","auto"]);break;case"size":u.percent(m,g);break;case"align":u.alt(m,g,["start",xl,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let f=u.get("line","auto");f==="auto"&&mf.line===-1&&(f=-1),l.line=f,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",xl);let d=u.get("position","auto");d==="auto"&&mf.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){i=i.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),o(),e.endTime=r(),o(),s(i,e)}function gE(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class gP{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new dP,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,o=0;for(s=gE(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){pE(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=n(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new vd(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{pP(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const yP=/\r\n|\n\r|\n|\r/g,Eh=function(e,t,n=0){return e.slice(n,n+t.length)===t},vP=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ae(t)||!ae(n)||!ae(r)||!ae(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=60*60*1e3*s,t};function Td(i,e,t){return Do(i.toString())+Do(e.toString())+Do(t)}const TP=function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n};function EP(i,e,t,n,r,s,o){const a=new gP,l=cn(new Uint8Array(i)).trim().replace(yP,`
`).split(`
`),u=[],f=e?WR(e.baseTime,e.timescale):0;let d="00:00.000",m=0,g=0,y,T=!0;a.oncue=function(E){const x=t[n];let R=t.ccOffset;const L=(m-f)/9e4;if(x!=null&&x.new&&(g!==void 0?R=t.ccOffset=x.start:TP(t,n,L)),L){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}R=L-t.presentationOffset}const P=E.endTime-E.startTime,I=Pn((E.startTime+R-g)*9e4,r*9e4)/9e4;E.startTime=Math.max(I,0),E.endTime=Math.max(I+P,0);const C=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(C)),E.id||(E.id=Td(E.startTime,E.endTime,C)),E.endTime>0&&u.push(E)},a.onparsingerror=function(E){y=E},a.onflush=function(){if(y){o(y);return}s(u)},l.forEach(E=>{if(T)if(Eh(E,"X-TIMESTAMP-MAP=")){T=!1,E.slice(16).split(",").forEach(x=>{Eh(x,"LOCAL:")?d=x.slice(6):Eh(x,"MPEGTS:")&&(m=parseInt(x.slice(7)))});try{g=vP(d)/1e3}catch(x){y=x}return}else E===""&&(T=!1);a.parse(E+`
`)}),a.flush()}const Sh="stpp.ttml.im1t",yE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,vE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,SP={left:"start",center:"center",right:"end",start:"start",end:"end"};function N0(i,e,t,n){const r=ve(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(a=>cn(a)),o=zR(e.baseTime,1,e.timescale);try{s.forEach(a=>t(xP(a,o)))}catch(a){n(a)}}function xP(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,m)=>(d[m]=r.getAttribute(`ttp:${m}`)||s[m],d),{}),a=r.getAttribute("xml:space")!=="preserve",l=B0(xh(r,"styling","style")),u=B0(xh(r,"layout","region")),f=xh(r,"body","[begin]");return[].map.call(f,d=>{const m=TE(d,a);if(!m||!d.hasAttribute("begin"))return null;const g=Ah(d.getAttribute("begin"),o),y=Ah(d.getAttribute("dur"),o);let T=Ah(d.getAttribute("end"),o);if(g===null)throw U0(d);if(T===null){if(y===null)throw U0(d);T=g+y}const E=new vd(g-e,T-e,m);E.id=Td(E.startTime,E.endTime,E.text);const x=u[d.getAttribute("region")],R=l[d.getAttribute("style")],L=_P(x,R,l),{textAlign:P}=L;if(P){const I=SP[P];I&&(E.lineAlign=I),E.align=P}return Ue(E,L),E}).filter(d=>d!==null)}function xh(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function B0(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function TE(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var s;return n.nodeName==="br"&&r?t+`
`:(s=n.childNodes)!=null&&s.length?TE(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function _P(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{const u=_h(e,n,l)||_h(i,n,l)||_h(r,n,l);return u&&(a[l]=u),a},{})}function _h(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function U0(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Ah(i,e){if(!i)return null;let t=mE(i);return t===null&&(yE.test(i)?t=AP(i,e):vE.test(i)&&(t=LP(i,e))),t}function AP(i,e){const t=yE.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function LP(i,e){const t=vE.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class _l{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class EE{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=V0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new _l(this,"textTrack1"),t=new _l(this,"textTrack2"),n=new _l(this,"textTrack3"),r=new _l(this,"textTrack4");this.cea608Parser1=new F0(1,e,t),this.cea608Parser2=new F0(3,n,r)}addCues(e,t,n,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],u=RP(l[0],l[1],t,n);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),o=!0,u/(n-t)>.5))return}if(o||s.push([t,n]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,n,r)}else{const a=this.Cues.newCue(null,t,n,r);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s}){const{unparsedVttFrags:o}=this;n===ce.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(A.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if($0(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)n[e]=a,ps(n[e]),aE(n[e],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{ps(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=V0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)ps(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(s=>s.textCodec===Sh);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(qT(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,a=o?Fl(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let f;if(a){let d=null;for(let m=0;m<a.length;m++)if(a[m]&&$0(a[m],l)){d=a[m],a[m]=null;break}d&&(f=d)}if(f)ps(f);else{const d=SE(l);f=this.createTextTrack(d,l.name,l.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ce.MAIN){var n,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,f=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;s&&o&&(u!==a+1||u===a&&f!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===ce.SUBTITLE)if(r.byteLength){const s=n.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===Sh?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;N0(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[n.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=n.initSegment)!=null&&t.data?Cn(n.initSegment.data,new Uint8Array(r)).buffer:r;EP(u,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,f=>{this._appendCues(f,n.level),l.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},f=>{const d=f.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(n,r),l.logger.log(`Failed to parse VTT cue: ${f}`),!(d&&a>n.cc)&&l.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:f})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||N0(t,this.initPTS[e.cc],()=>{n.textCodec=Sh,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>lE(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===ce.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===ce.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<r.length;s++){const o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>ff(a[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>ff(a[l],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let s=0;s<n;s++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(a),t[f].push(l))}}return t}}function SE(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function $0(i,e){return!!i&&i.kind===SE(e)&&uf(e,i)}function RP(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function V0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const IP=/\s/,xE={newCue(i,e,t,n){const r=[];let s,o,a,l,u;const f=self.VTTCue||self.TextTrackCue;for(let m=0;m<n.rows.length;m++)if(s=n.rows[m],a=!0,l=0,u="",!s.isEmpty()){var d;for(let T=0;T<s.chars.length;T++)IP.test(s.chars[T].uchar)&&a?l++:(u+=s.chars[T].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const g=gE(u.trim()),y=Td(e,t,g);i!=null&&(d=i.cues)!=null&&d.getCueById(y)||(o=new f(e,t,g),o.id=y,o.line=m+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return i&&r.length&&(r.sort((m,g)=>m.line==="auto"||g.line==="auto"?0:m.line>8&&g.line>8?g.line-m.line:m.line-g.line),r.forEach(m=>lE(i,m))),r}};function _E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const PP=/(\d+)-(\d+)\/(\d+)/;class pf{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||bP,this.controller=new self.AbortController,this.stats=new xu}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=DP(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&ae(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Ho(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var m;this.response=this.loader=d;const g=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(g-r.loading.start)),!d.ok){const{status:T,statusText:E}=d;throw new kP(E||"fetch, bad network response",T,d)}r.loading.first=g,r.total=CP(d.headers)||r.total;const y=(m=this.callbacks)==null?void 0:m.onProgress;return y&&ae(t.highWaterMark)?this.loadProgressively(d,r,e,t.highWaterMark,y):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var m,g;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const T=d[a];T&&(r.loaded=r.total=T);const E={url:y.url,data:d,code:y.status},x=(m=this.callbacks)==null?void 0:m.onProgress;x&&!ae(t.highWaterMark)&&x(r,e,d,y),(g=this.callbacks)==null||g.onSuccess(E,r,e,y)}).catch(d=>{var m;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const g=d&&d.code||0,y=d?d.message:null;(m=this.callbacks)==null||m.onError({code:g,text:y},e,d?d.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,s){const o=new IT,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=u.value,d=f.length;return t.loaded+=d,d<r||o.dataLength?(o.push(f),o.dataLength>=r&&s(t,n,o.flush().buffer,e)):s(t,n,f.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function DP(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ue({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function wP(i){const e=PP.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function CP(i){const e=i.get("Content-Range");if(e){const n=wP(e);if(ae(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function bP(i,e){return new self.Request(i.url,e)}class kP extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const OP=/^age:\s*[\d.]+\s*$/im;class Ed{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xu,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:n.status,text:o.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&ae(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,f=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const y=f??t.response;if(y!=null){var o,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=t.responseType==="arraybuffer"?y.byteLength:y.length;n.loaded=n.total=T,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const E=(o=this.callbacks)==null?void 0:o.onProgress;E&&E(n,e,y,t);const x={url:t.responseURL,data:y,code:u};(a=this.callbacks)==null||a.onSuccess(x,n,e,t);return}}const d=s.loadPolicy.errorRetry,m=n.retry,g={url:e.url,data:void 0,code:u};if(eu(d,m,!1,g))this.retry(d);else{var l;Pe.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(eu(e,t,!0))this.retry(e);else{var n;Pe.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=rd(e,n.retry),n.retry++,Pe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&OP.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const MP={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},FP=Ne(Ne({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ed,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:fT,bufferController:ZT,capLevelController:Pu,errorController:mT,fpsController:oE,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ud,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:MP},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},NP()),{},{subtitleStreamController:hE,subtitleTrackController:uE,timelineController:EE,audioStreamController:YT,audioTrackController:XT,emeController:Fr,cmcdController:iE,contentSteeringController:rE,interstitialsController:eP});function NP(){return{cueHandler:xE,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function BP(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=gf(i),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];s.forEach(f=>{const d=`${o}Loading${f}`,m=e[d];if(m!==void 0&&l){u.push(d);const g=n[a].default;switch(e[a]={default:g},f){case"TimeOut":g.maxLoadTimeMs=m,g.maxTimeToFirstByteMs=m;break;case"MaxRetry":g.errorRetry.maxNumRetry=m,g.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":g.errorRetry.retryDelayMs=m,g.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":g.errorRetry.maxRetryDelayMs=m,g.timeoutRetry.maxRetryDelayMs=m;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${je(e[a])}`)}),Ne(Ne({},n),e)}function gf(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(gf):Object.keys(i).reduce((e,t)=>(e[t]=gf(i[t]),e),{}):i}function UP(i,e){const t=i.loader;t!==pf&&t!==Ed?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):_E()&&(i.loader=pf,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Nl=2,$P=.1,VP=.05,GP=100;class HP extends pT{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(GP),this.mediaSource=t.mediaSource;const n=this.media=t.media;Ri(n,"playing",this.onMediaPlaying),Ri(n,"waiting",this.onMediaWaiting),Ri(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(ti(n,"playing",this.onMediaPlaying),ti(n,"waiting",this.onMediaWaiting),ti(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const{media:o,stalled:a}=this;if(!o)return;const{seeking:l}=o,u=this.seeking&&!l,f=!this.seeking&&l,d=o.paused&&!l||o.ended||o.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(f||u){u&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!xe.getBuffered(o).length){this.nudgeRetry=0;return}const m=xe.bufferInfo(o,e,0),g=m.nextStart||0,y=this.fragmentTracker;if(l&&y&&this.hls){const C=G0(this.hls.inFlightFragments,e),D=m.len>Nl,w=!g||C||g-e>Nl&&!y.getPartialFragment(e);if(D||w)return;this.moved=!1}const T=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(m.len>0)&&!g)return;const D=Math.max(g,m.start||0)-e,k=!!(T!=null&&T.live)?T.targetduration*2:Nl,O=y.getPartialFragment(e);if(D>0&&(D<=k||O)){o.paused||this._trySkipBufferHole(O);return}}const E=s.detectStallWithCurrentTimeMs,x=self.performance.now(),R=this.waiting;if(a===null){R>0&&x-R<E?this.stalled=R:this.stalled=x;return}const L=x-a;if(!l&&(L>=E||R)&&this.hls){var P;if(((P=this.mediaSource)==null?void 0:P.readyState)==="ended"&&!(T!=null&&T.live)&&Math.abs(e-((T==null?void 0:T.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const I=xe.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(I,L)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const s=xe.bufferedInfo(xe.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const o=xe.timeRangesToArray(r),a=xe.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=xe.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,f=o[a+1].start;if((l===-1||l>a)&&f-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${f} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;const m=this.fragmentTracker.getPartialFragment(e)||void 0,g=xe.bufferInfo(this.media,e,0);this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:m,buffer:g.len,bufferInfo:g})}}}}}_tryFixBufferStall(e,t){var n,r;const{fragmentTracker:s,media:o}=this,a=(n=this.hls)==null?void 0:n.config;if(!o||!s||!a)return;const l=o.currentTime,u=(r=this.hls)==null?void 0:r.latestLevelDetails,f=s.getPartialFragment(l);if((f||u!=null&&u.live&&l<u.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const d=e.buffered;(d&&d.length>1&&e.len>a.maxBufferHole||e.nextStart&&e.nextStart-l<a.maxBufferHole)&&(t>a.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&s!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${je(e)})`);this.warn(o.message),t.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!n||!s)return 0;const o=r.currentTime,a=xe.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const f=a.len<=s.maxBufferHole,d=a.len>0&&a.len<1&&r.readyState<3,m=l-o;if(m>0&&(f||d)){if(m>s.maxBufferHole){let y=!1;if(o===0){const T=n.getAppendedFrag(0,ce.MAIN);T&&l<T.end&&(y=!0)}if(!y){const T=e||n.getAppendedFrag(o,ce.MAIN);if(T){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||G0(this.hls.inFlightFragments,l))return 0;let x=!1,R=T.end;for(;R<l;){const L=n.getPartialFragment(R);if(L)R+=L.duration;else{x=!0;break}}if(x)return 0}}}const g=Math.max(l+VP,o+$P);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${g}`),this.moved=!0,r.currentTime=g,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${g}`);this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e||void 0,buffer:a.len,bufferInfo:a})}return g}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const o=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),n.currentTime=a,t.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function G0(i,e){const t=H0(i.main);if(t&&t.start<=e)return t;const n=H0(i.audio);return n&&n.start<=e?n:null}function H0(i){if(!i)return null;switch(i.state){case X.IDLE:case X.STOPPED:case X.ENDED:case X.ERROR:return null}return i.frag}const KP=.25;function yf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function K0(i,e,t,n,r){let s=new i(e,t,"");try{s.value=n,r&&(s.type=r)}catch{s=new i(e,t,je(r?Ne({type:r},n):n))}return s}const Al=(()=>{const i=yf();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function zP(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class WP{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&ps(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return aE(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:r}}}=this;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=yf();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===qt.emsg&&!n||!r)continue;const u=MT(s[a].data);if(u){const f=s[a].pts;let d=f+s[a].duration;d>Al&&(d=Al),d-f<=0&&(d=f+KP);for(let g=0;g<u.length;g++){const y=u[g];if(!FT(y)){this.updateId3CueEnds(f,l);const T=K0(o,f,d,y,l);T&&this.id3Track.addCue(T)}}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===t&&o.startTime<e&&o.endTime===Al&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;r==="audio"?u=f=>f.type===qt.audioId3&&l:r==="video"?u=f=>f.type===qt.emsg&&a:u=f=>f.type===qt.audioId3&&l||f.type===qt.emsg&&a,ff(s,t,n,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:n}=this,{dateRanges:r}=e,s=Object.keys(r);let o=this.dateRangeCuesAppended;if(n&&t){var a;if((a=n.cues)!=null&&a.length){const f=Object.keys(o).filter(d=>!s.includes(d));for(let d=f.length;d--;){const m=f[d],g=o[m].cues;delete o[m],Object.keys(g).forEach(y=>{try{const T=g[y];T.removeEventListener("enter",this.onEventCueEnter),n.removeCue(T)}catch{}})}}else o=this.dateRangeCuesAppended={}}const l=e.fragments[e.fragments.length-1];if(s.length===0||!ae(l==null?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=yf();for(let f=0;f<s.length;f++){const d=s[f],m=r[d],g=m.startTime,y=o[d],T=(y==null?void 0:y.cues)||{};let E=(y==null?void 0:y.durationKnown)||!1,x=Al;const{duration:R,endDate:L}=m;if(L&&R!==null)x=g+R,E=!0;else if(m.endOnNext&&!E){const I=s.reduce((C,D)=>{if(D!==m.id){const w=r[D];if(w.class===m.class&&w.startDate>m.startDate&&(!C||m.startDate<C.startDate))return w}return C},null);I&&(x=I.startTime,E=!0)}const P=Object.keys(m.attr);for(let I=0;I<P.length;I++){const C=P[I];if(!M1(C))continue;const D=T[C];if(D)E&&!y.durationKnown?D.endTime=x:Math.abs(D.startTime-g)>.01&&(D.startTime=g,D.endTime=x);else if(u){let w=m.attr[C];F1(C)&&(w=zP(w));const O=K0(u,g,x,{key:C,data:w},qt.dateRange);O&&(O.id=d,this.id3Track.addCue(O),T[C]=O,this.hls.config.interstitialsController&&(C==="X-ASSET-LIST"||C==="X-ASSET-URL")&&O.addEventListener("enter",this.onEventCueEnter))}}o[d]={cues:T,dateRange:m,durationKnown:E}}}}class jP{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!n.live)return;const a=this.targetLatency;if(a===null)return;const l=r-a,u=Math.min(this.maxLatency,a+n.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,g=Math.min(d,Math.max(1,m));this.changeMediaPlaybackRate(t,g)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*r);const f=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,s=e-t-this.edgeStalled,o=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===$.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class YP extends Iu{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(f=>{var d;const m=f.attrs;let{audioCodec:g,videoCodec:y}=f;g&&(f.audioCodec=g=Xl(g,n)||void 0),((d=y)==null?void 0:d.indexOf("avc1"))===0&&(y=f.videoCodec=r1(y));const{width:T,height:E,unknownCodecs:x}=f;let R=x?x.length:0;if(x)for(let W=R;W--;){const q=x[W];this.isAudioSupported(q)?(f.audioCodec=g=g?`${g},${q}`:q,R--,Ps.audio[g.substring(0,4)]=2):this.isVideoSupported(q)&&(f.videoCodec=y=y?`${y},${q}`:q,R--,Ps.video[y.substring(0,4)]=2)}if(a||(a=!!(T&&E)),l||(l=!!y),u||(u=!!g),R||g&&!this.isAudioSupported(g)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:L,"FRAME-RATE":P,"HDCP-LEVEL":I,"PATHWAY-ID":C,RESOLUTION:D,"VIDEO-RANGE":w}=m,O=`${`${C||"."}-`}${f.bitrate}-${D}-${P}-${L}-${w}-${I}`;if(s[O])if(s[O].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const W=o[O]+=1;f.attrs["PATHWAY-ID"]=new Array(W+1).join(".");const q=this.createLevel(f);s[O]=q,r.push(q)}else s[O].addGroupId("audio",m.AUDIO),s[O].addGroupId("text",m.SUBTITLES);else{const W=this.createLevel(f);s[O]=W,o[O]=1,r.push(W)}}),this.filterAndSortMediaOptions(r,t,a,l,u)}createLevel(e){const t=new Ds(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=uT(r,[])}return t}isAudioSupported(e){return Jh(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Jh(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){let o=[],a=[],l=e;if((n||r)&&s&&(l=l.filter(({videoCodec:y,videoRange:T,width:E,height:x})=>(!!y||!!(E&&x))&&u1(T))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",T=y;t.levels.length&&(T=`one or more CODECS in variant not supported: ${je(t.levels.map(x=>x.attrs.CODECS).filter((x,R,L)=>L.indexOf(x)===R))}`,this.warn(T),y+=` (${T})`);const E=new Error(y);this.hls.trigger(A.ERROR,{type:he.MEDIA_ERROR,details:$.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:T})}});return}t.audioTracks&&(o=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),z0(o)),t.subtitles&&(a=t.subtitles,z0(a));const u=l.slice(0);l.sort((y,T)=>{if(y.attrs["HDCP-LEVEL"]!==T.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(T.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&y.height!==T.height)return y.height-T.height;if(y.frameRate!==T.frameRate)return y.frameRate-T.frameRate;if(y.videoRange!==T.videoRange)return Ql.indexOf(y.videoRange)-Ql.indexOf(T.videoRange);if(y.videoCodec!==T.videoCodec){const E=Vg(y.videoCodec),x=Vg(T.videoCodec);if(E!==x)return x-E}if(y.uri===T.uri&&y.codecSet!==T.codecSet){const E=ql(y.codecSet),x=ql(T.codecSet);if(E!==x)return x-E}return y.averageBitrate!==T.averageBitrate?y.averageBitrate-T.averageBitrate:0});let f=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let y=0;y<u.length;y++)if(u[y].pathwayId===l[0].pathwayId){f=u[y];break}}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===f){var d;this._firstLevel=y;const T=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${T}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const x=Math.min(T,this.hls.config.abrEwmaDefaultEstimateMax);x>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=x)}break}const m=s&&!r,g={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:!m&&o.some(y=>!!y.url)};this.hls.trigger(A.MANIFEST_PARSED,g)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:f,reason:f.message}),d)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${n}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const f=this.switchParams(o.uri,r==null?void 0:r.details,u);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Re.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ce.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(A.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));AT(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(A.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function z0(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function AE(){return self.SourceBuffer||self.WebKitSourceBuffer}function Sd(){if(!wi())return!1;const e=AE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function LE(){if(!Sd())return!1;const i=wi();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Uo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Uo(e,"audio"))))}function qP(){var i;const e=AE();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const XP=100;class QP extends Lu{constructor(e,t,n){super(e,t,n,"stream-controller",ce.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!ae(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(r,s,ce.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(XP),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=X.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=X.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case X.WAITING_LEVEL:{const{levels:t,level:n}=this,r=t==null?void 0:t[n],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=X.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=X.IDLE;break}break}case X.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:r,level:s}=this,o=r==null?void 0:r[s];this.resetStartWhenNotLoaded(o||null),this.state=X.IDLE}}break}this.state===X.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const o=n[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(A.BUFFER_EOS,T),this.state=X.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=o.details;if(!u||this.state===X.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=X.WAITING_LEVEL,this.startFragRequested=!1;return}const f=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(f>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:a.end;let g=this.getNextFragment(m,u);if(this.couldBacktrack&&!this.fragPrevious&&g&&At(g)&&this.fragmentTracker.getState(g)!==ft.OK){var y;const E=((y=this.backtrackFragment)!=null?y:g).sn-u.startSN,x=u.fragments[E-1];x&&g.cc===x.cc&&(g=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,m)){if(!g.gap){const E=this.audioOnly&&!this.altAudio?Be.AUDIO:Be.VIDEO,x=(E===Be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,E,ce.MAIN)}g=this.getNextFragmentLoopLoading(g,u,a,ce.MAIN,d)}g&&(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,o,m))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===ft.NOT_LOADED||r===ft.PARTIAL?At(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ce.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,f=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case X.KEY_LOADING:case X.FRAG_LOADING:case X.FRAG_LOADING_WAITING_RETRY:case X.PARSING:case X.PARSED:this.state=X.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Ri(n,"playing",this.onMediaPlaying),Ri(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(ti(n,"playing",this.onMediaPlaying),ti(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;t.levels.forEach(s=>{const o=s.audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&r&&!qP(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==X.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=X.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=t.levelInfo,f=this.fragCurrent;f&&(this.state===X.FRAG_LOADING||this.state===X.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let d=0;if(a.live||(n=u.details)!=null&&n.live){var m;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,u.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(u.details=a,this.levelLastLoaded=u,s||this.setStartPosition(a,d),this.hls.trigger(A.LEVEL_UPDATED,{details:a,level:o}),this.state===X.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=X.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&n.duration>r&&(s<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&n.readyState<4||s<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),n.currentTime=r))}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const a=o[n.level];if(!a){this.warn(`Level ${n.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=a.videoCodec,f=l.PTSKnown||!l.live,d=(t=n.initSegment)==null?void 0:t.data,m=this._getAudioCodec(a),g=this.transmuxer=this.transmuxer||new jT(this.hls,ce.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=r?r.index:-1,T=y!==-1,E=new Au(n.level,n.sn,n.stats.chunkCount,s.byteLength,y,T),x=this.initPTS[n.cc];g.push(s,d,m,u,n,r,l.totalduration,f,E,x)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio===2;if(Zl(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),n.once(A.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(A.AUDIO_TRACK_SWITCHED,t)}),n.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(A.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Zl(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,o=!1;for(const a in n){const l=n[a];if(l.id==="main"){if(s=a,r=l,a==="video"){const u=n[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===ce.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===X.PARSED&&(this.state=X.IDLE);return}const a=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),At(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const o=this.media;o&&(!this._hasEnoughToStart&&xe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=X.ERROR;return}switch(t.details){case $.FRAG_GAP:case $.FRAG_PARSING_ERROR:case $.FRAG_DECRYPT_ERROR:case $.FRAG_LOAD_ERROR:case $.FRAG_LOAD_TIMEOUT:case $.KEY_LOAD_ERROR:case $.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ce.MAIN,t);break;case $.LEVEL_LOAD_ERROR:case $.LEVEL_LOAD_TIMEOUT:case $.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===X.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Re.LEVEL&&(this.state=X.IDLE);break;case $.BUFFER_ADD_CODEC_ERROR:case $.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case $.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case $.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=X.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Be.AUDIO||!this.altAudio){const n=(t===Be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,ce.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),o=xe.getBuffered(e),a=o.length?o.start(0):0,l=a-n,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=X.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(A.FRAG_LOADED,n),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:f}=a,{video:d,text:m,id3:g,initSegment:y}=s,{details:T}=f,E=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=X.PARSING,y){if(y!=null&&y.tracks){const L=l.initSegment||l;this._bufferInitSegment(f,y.tracks,L,o),r.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:n,tracks:y.tracks})}const x=y.initPTS,R=y.timescale;ae(x)&&(this.initPTS[l.cc]={baseTime:x,timescale:R},r.trigger(A.INIT_PTS_FOUND,{frag:l,id:n,initPTS:x,timescale:R}))}if(d&&T){const x=T.fragments[l.sn-1-T.startSN],R=l.sn===T.startSN,L=!x||l.cc>x.cc;if(s.independent!==!1){const{startPTS:P,endPTS:I,startDTS:C,endDTS:D}=d;if(u)u.elementaryStreams[d.type]={startPTS:P,endPTS:I,startDTS:C,endDTS:D};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!L&&(this.couldBacktrack=!0),d.dropped&&d.independent){const w=this.getMainFwdBufferInfo(),k=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,O=d.firstKeyFramePTS?d.firstKeyFramePTS:P;if(!R&&k<O-this.config.maxBufferHole&&!L){this.backtrack(l);return}else L&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,I,l.start,D,!0)}else R&&P-(T.appliedTimelineOffset||0)>Nl&&(l.gap=!0);l.setElementaryStreamInfo(d.type,P,I,C,D),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,o,R||L)}else if(R||L)l.gap=!0;else{this.backtrack(l);return}}if(E){const{startPTS:x,endPTS:R,startDTS:L,endDTS:P}=E;u&&(u.elementaryStreams[Be.AUDIO]={startPTS:x,endPTS:R,startDTS:L,endDTS:P}),l.setElementaryStreamInfo(Be.AUDIO,x,R,L,P),this.bufferFragmentData(E,l,u,o)}if(T&&g!=null&&(t=g.samples)!=null&&t.length){const x={id:n,frag:l,details:T,samples:g.samples};r.trigger(A.FRAG_PARSING_METADATA,x)}if(T&&m){const x={id:n,frag:l,details:T,samples:m.samples};r.trigger(A.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,t,n,r){if(this.state!==X.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let u=bl(s.codec,e.audioCodec);u==="mp4a"&&(u="mp4a.40.5");const f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=s.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),e.audioCodec&&e.audioCodec!==u&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${u}"`),s.levelCodec=u,s.id=ce.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ce.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(A.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:u,data:d,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ce.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=X.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(xe.isBuffered(e,n)?t=this.getAppendedFrag(n):xe.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ae(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ae(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?Gr(null,n.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const o=s+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class ZP{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=$.KEY_LOAD_ERROR,n,r,s){return new Si({type:he.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:r}=e;for(let s=0;s<t.length;s++){const o=t[s];if(r<=o.cc&&(n==="initSegment"||o.sn==="initSegment"||n<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,$.KEY_LOAD_ERROR,u))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,$.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((n=a)!=null&&n.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((r=a)!=null&&r.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(u=>(s.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,$.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(n);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,n))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,s=new r(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(m,g,y,T)=>{const{frag:E,keyInfo:x,url:R}=y;if(!E.decryptdata||x!==this.keyUriToKeyInfo[R])return a(this.createKeyLoadError(E,$.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));x.decryptdata.key=E.decryptdata.key=new Uint8Array(m.data),E.keyLoader=null,x.loader=null,o({frag:E,keyInfo:x})},onError:(m,g,y,T)=>{this.resetLoader(g),a(this.createKeyLoadError(t,$.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),y,Ne({url:l.url,data:void 0},m)))},onTimeout:(m,g,y)=>{this.resetLoader(g),a(this.createKeyLoadError(t,$.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(m,g,y)=>{this.resetLoader(g),a(this.createKeyLoadError(t,$.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};s.load(l,f,d)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}function W0(i){const{type:e}=i;switch(e){case Re.AUDIO_TRACK:return ce.AUDIO;case Re.SUBTITLE_TRACK:return ce.SUBTITLE;default:return ce.MAIN}}function Lh(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class JP{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=n||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Re.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:Re.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Re.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Re.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[Re.LEVEL];if(n){const r=n.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(n.abort(),delete this.loaders[Re.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const u=this.hls.logger,f=r.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===Re.MANIFEST?s=n.manifestLoadPolicy.default:s=Ue({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),ae((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Re.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Re.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Re.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const f=u.partTarget,d=u.targetduration;if(f&&d){const m=Math.max(f*3,d*.8)*1e3;s=Ue({},s,{maxTimeToFirstByteMs:Math.min(m,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,f,d,m)=>{const g=this.getInternalLoader(d);this.resetInternalLoader(d.type);const y=u.data;if(y.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),m||null,f);return}f.parsing.start=performance.now(),Nn.isMediaPlaylist(y)||d.type!==Re.MANIFEST?this.handleTrackOrLevelPlaylist(u,f,d,m||null,g):this.handleMasterPlaylist(u,f,d,m)},onError:(u,f,d,m)=>{this.handleNetworkError(f,d,!1,u,m)},onTimeout:(u,f,d)=>{this.handleNetworkError(f,d,!0,void 0,u)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,o=e.data,a=Lh(e,n),l=Nn.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,n,l.playlistParsingError,r,t);return}const{contentSteering:u,levels:f,sessionData:d,sessionKeys:m,startTimeOffset:g,variableList:y}=l;this.variableList=y;const{AUDIO:T=[],SUBTITLES:E,"CLOSED-CAPTIONS":x}=Nn.parseMasterPlaylistMedia(o,a,l);T.length&&!T.some(L=>!L.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ze({}),bitrate:0,url:""})),s.trigger(A.MANIFEST_LOADED,{levels:f,audioTracks:T,subtitles:E,captions:x,contentSteering:u,url:a,stats:t,networkDetails:r,sessionData:d,sessionKeys:m,startTimeOffset:g,variableList:y})}handleTrackOrLevelPlaylist(e,t,n,r,s){const o=this.hls,{id:a,level:l,type:u}=n,f=Lh(e,n),d=ae(l)?l:ae(a)?a:0,m=W0(n),g=Nn.parseLevelPlaylist(e.data,f,d,m,0,this.variableList);if(u===Re.MANIFEST){const y={attrs:new ze({}),bitrate:0,details:g,name:"",url:f};g.requestScheduled=t.loading.start+xT(g,0),o.trigger(A.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:f,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=g,this.handlePlaylistLoaded(g,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(A.ERROR,{type:he.NETWORK_ERROR,details:$.MANIFEST_PARSING_ERROR,fatal:t.type===Re.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,n=!1,r,s){let o=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Re.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Re.AUDIO_TRACK||e.type===Re.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=$.UNKNOWN,u=!1;const f=this.getInternalLoader(e);switch(e.type){case Re.MANIFEST:l=n?$.MANIFEST_LOAD_TIMEOUT:$.MANIFEST_LOAD_ERROR,u=!0;break;case Re.LEVEL:l=n?$.LEVEL_LOAD_TIMEOUT:$.LEVEL_LOAD_ERROR,u=!1;break;case Re.AUDIO_TRACK:l=n?$.AUDIO_TRACK_LOAD_TIMEOUT:$.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Re.SUBTITLE_TRACK:l=n?$.SUBTITLE_TRACK_LOAD_TIMEOUT:$.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(e.type);const d={type:he.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:f,context:e,error:a,networkDetails:t,stats:s};if(r){const m=(t==null?void 0:t.url)||e.url;d.response=Ne({url:m,data:void 0},r)}this.hls.trigger(A.ERROR,d)}handlePlaylistLoaded(e,t,n,r,s,o){const a=this.hls,{type:l,level:u,id:f,groupId:d,deliveryDirectives:m}=r,g=Lh(t,r),y=W0(r),T=typeof r.level=="number"&&y===ce.MAIN?u:void 0;if(!e.fragments.length){const x=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(A.ERROR,{type:he.NETWORK_ERROR,details:$.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:x,reason:x.message,response:t,context:r,level:T,parent:y,networkDetails:s,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(E),!a.config.ignorePlaylistParsingErrors){a.trigger(A.ERROR,{type:he.NETWORK_ERROR,details:$.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:r,level:T,parent:y,networkDetails:s,stats:n});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Re.MANIFEST:case Re.LEVEL:a.trigger(A.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||a.levels[0],level:T||0,id:f||0,stats:n,networkDetails:s,deliveryDirectives:m,withoutMultiVariant:l===Re.MANIFEST});break;case Re.AUDIO_TRACK:a.trigger(A.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:f||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:m});break;case Re.SUBTITLE_TRACK:a.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:f||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:m});break}}}class Li{static get version(){return Vo}static isMSESupported(){return Sd()}static isSupported(){return LE()}static getMediaSource(){return wi()}static get Events(){return A}static get MetadataSchema(){return qt}static get ErrorTypes(){return he}static get ErrorDetails(){return $}static get DefaultConfig(){return Li.defaultConfig?Li.defaultConfig:FP}static set DefaultConfig(e){Li.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new cd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=OL(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=BP(Li.DefaultConfig,e,t);this.userConfig=e,n.progressive&&UP(n,t);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=n,u=new a(this),f=this.abrController=new r(this),d=new _1(this),m=n.interstitialsController,g=m?this.interstitialsController=new m(this,Li):null,y=this.bufferController=new s(this,d),T=this.capLevelController=new o(this),E=new l(this),x=new JP(this),R=n.contentSteeringController,L=R?new R(this):null,P=this.levelController=new YP(this,L),I=new WP(this),C=new ZP(this.config),D=this.streamController=new QP(this,d,C),w=this.gapController=new HP(this,d);T.setStreamController(D),E.setStreamController(D);const k=[x,P,D];g&&k.splice(1,0,g),L&&k.splice(1,0,L),this.networkControllers=k;const O=[f,y,w,T,E,I,d];this.audioTrackController=this.createController(n.audioTrackController,k);const W=n.audioStreamController;W&&k.push(this.audioStreamController=new W(this,d,C)),this.subtitleTrackController=this.createController(n.subtitleTrackController,k);const q=n.subtitleStreamController;q&&k.push(this.subtititleStreamController=new q(this,d,C)),this.createController(n.timelineController,O),C.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(jP,O),this.coreComponents=O,k.push(u);const ie=u.onErrorOut;typeof ie=="function"&&this.on(A.ERROR,ie,u),this.on(A.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===A.ERROR;this.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(A.ERROR,{type:he.OTHER_ERROR,details:$.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(A.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=ed.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ce.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ce.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ce.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=ER()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){l1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let s=r;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=hT(t);return cT(e,n,navigator.mediaCapabilities)}}Li.defaultConfig=void 0;const dN=Object.freeze(Object.defineProperty({__proto__:null,AbrController:fT,AttrList:ze,AudioStreamController:YT,AudioTrackController:XT,BasePlaylistController:Iu,BaseSegment:td,BaseStreamController:Lu,BufferController:ZT,CMCDController:iE,CapLevelController:Pu,ChunkMetadata:Au,ContentSteeringController:rE,Cues:xE,DateRange:od,EMEController:Fr,ErrorActionFlags:In,ErrorController:mT,ErrorDetails:$,ErrorTypes:he,Events:A,FPSController:oE,FetchLoader:pf,Fragment:Cl,Hls:Li,HlsSkip:Ro,HlsUrlParameters:tf,KeySystemFormats:Ut,KeySystems:Me,Level:Ds,LevelDetails:yT,LevelKey:ws,LoadStats:xu,M3U8Parser:Nn,MetadataSchema:qt,NetworkErrorAction:Tt,Part:Xv,PlaylistLevelType:ce,SubtitleStreamController:hE,SubtitleTrackController:uE,TimelineController:EE,XhrLoader:Ed,default:Li,fetchSupported:_E,getMediaSource:wi,isMSESupported:Sd,isSupported:LE,requestMediaKeySystemAccess:ud},Symbol.toStringTag,{value:"Module"}));var po={},j0;function eD(){if(j0)return po;j0=1,Object.defineProperty(po,"__esModule",{value:!0}),po.parse=o,po.serialize=u;const i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,r=Object.prototype.toString,s=(()=>{const m=function(){};return m.prototype=Object.create(null),m})();function o(m,g){const y=new s,T=m.length;if(T<2)return y;const E=(g==null?void 0:g.decode)||f;let x=0;do{const R=m.indexOf("=",x);if(R===-1)break;const L=m.indexOf(";",x),P=L===-1?T:L;if(R>P){x=m.lastIndexOf(";",R-1)+1;continue}const I=a(m,x,R),C=l(m,R,I),D=m.slice(I,C);if(y[D]===void 0){let w=a(m,R+1,P),k=l(m,P,w);const O=E(m.slice(w,k));y[D]=O}x=P+1}while(x<T);return y}function a(m,g,y){do{const T=m.charCodeAt(g);if(T!==32&&T!==9)return g}while(++g<y);return y}function l(m,g,y){for(;g>y;){const T=m.charCodeAt(--g);if(T!==32&&T!==9)return g+1}return y}function u(m,g,y){const T=(y==null?void 0:y.encode)||encodeURIComponent;if(!i.test(m))throw new TypeError(`argument name is invalid: ${m}`);const E=T(g);if(!e.test(E))throw new TypeError(`argument val is invalid: ${g}`);let x=m+"="+E;if(!y)return x;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);x+="; Max-Age="+y.maxAge}if(y.domain){if(!t.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);x+="; Domain="+y.domain}if(y.path){if(!n.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);x+="; Path="+y.path}if(y.expires){if(!d(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);x+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(x+="; HttpOnly"),y.secure&&(x+="; Secure"),y.partitioned&&(x+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":x+="; Priority=Low";break;case"medium":x+="; Priority=Medium";break;case"high":x+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":x+="; SameSite=Strict";break;case"lax":x+="; SameSite=Lax";break;case"none":x+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return x}function f(m){if(m.indexOf("%")===-1)return m;try{return decodeURIComponent(m)}catch{return m}}function d(m){return r.call(m)==="[object Date]"}return po}eD();var Y0="popstate";function tD(i={}){function e(r,s){let{pathname:o="/",search:a="",hash:l=""}=zr(r.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),vf("",{pathname:o,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){let o=r.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=r.location.href,u=l.indexOf("#");a=u===-1?l:l.slice(0,u)}return a+"#"+(typeof s=="string"?s:zo(s))}function n(r,s){Bn(r.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(s)})`)}return iD(e,t,n,i)}function Ze(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Bn(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function nD(){return Math.random().toString(36).substring(2,10)}function q0(i,e){return{usr:i.state,key:i.key,idx:e}}function vf(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?zr(e):e,state:t,key:e&&e.key||n||nD()}}function zo({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function zr(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function iD(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,o=r.history,a="POP",l=null,u=f();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function f(){return(o.state||{idx:null}).idx}function d(){a="POP";let E=f(),x=E==null?null:E-u;u=E,l&&l({action:a,location:T.location,delta:x})}function m(E,x){a="PUSH";let R=vf(T.location,E,x);t&&t(R,E),u=f()+1;let L=q0(R,u),P=T.createHref(R);try{o.pushState(L,"",P)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;r.location.assign(P)}s&&l&&l({action:a,location:T.location,delta:1})}function g(E,x){a="REPLACE";let R=vf(T.location,E,x);t&&t(R,E),u=f();let L=q0(R,u),P=T.createHref(R);o.replaceState(L,"",P),s&&l&&l({action:a,location:T.location,delta:0})}function y(E){return rD(E)}let T={get action(){return a},get location(){return i(r,o)},listen(E){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(Y0,d),l=E,()=>{r.removeEventListener(Y0,d),l=null}},createHref(E){return e(r,E)},createURL:y,encodeLocation(E){let x=y(E);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:m,replace:g,go(E){return o.go(E)}};return T}function rD(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ze(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:zo(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function RE(i,e,t="/"){return sD(i,e,t,!1)}function sD(i,e,t,n){let r=typeof e=="string"?zr(e):e,s=Ci(r.pathname||"/",t);if(s==null)return null;let o=IE(i);oD(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=yD(s);a=pD(o[l],u,n)}return a}function IE(i,e=[],t=[],n=""){let r=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Ze(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let u=Ii([n,l.relativePath]),f=t.concat(l);s.children&&s.children.length>0&&(Ze(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),IE(s.children,e,f,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:dD(u,s.index),routesMeta:f})};return i.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let l of PE(s.path))r(s,o,l)}),e}function PE(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let o=PE(n.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>i.startsWith("/")&&l===""?"/":l)}function oD(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:mD(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var aD=/^:[\w-]+$/,lD=3,uD=2,cD=1,hD=10,fD=-2,X0=i=>i==="*";function dD(i,e){let t=i.split("/"),n=t.length;return t.some(X0)&&(n+=fD),e&&(n+=uD),t.filter(r=>!X0(r)).reduce((r,s)=>r+(aD.test(s)?lD:s===""?cD:hD),n)}function mD(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function pD(i,e,t=!1){let{routesMeta:n}=i,r={},s="/",o=[];for(let a=0;a<n.length;++a){let l=n[a],u=a===n.length-1,f=s==="/"?e:e.slice(s.length)||"/",d=su({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},f),m=l.route;if(!d&&u&&t&&!n[n.length-1].route.index&&(d=su({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},f)),!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:Ii([s,d.pathname]),pathnameBase:SD(Ii([s,d.pathnameBase])),route:m}),d.pathnameBase!=="/"&&(s=Ii([s,d.pathnameBase]))}return o}function su(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=gD(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:n.reduce((u,{paramName:f,isOptional:d},m)=>{if(f==="*"){let y=a[m]||"";o=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[m];return d&&!g?u[f]=void 0:u[f]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:i}}function gD(i,e=!1,t=!0){Bn(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function yD(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Bn(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Ci(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}function vD(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?zr(i):i;return{pathname:t?t.startsWith("/")?t:TD(t,e):e,search:xD(n),hash:_D(r)}}function TD(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Rh(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ED(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function DE(i){let e=ED(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function wE(i,e,t,n=!1){let r;typeof i=="string"?r=zr(i):(r={...i},Ze(!r.pathname||!r.pathname.includes("?"),Rh("?","pathname","search",r)),Ze(!r.pathname||!r.pathname.includes("#"),Rh("#","pathname","hash",r)),Ze(!r.search||!r.search.includes("#"),Rh("#","search","hash",r)));let s=i===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!n&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),d-=1;r.pathname=m.join("/")}a=d>=0?e[d]:"/"}let l=vD(r,a),u=o&&o!=="/"&&o.endsWith("/"),f=(s||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||f)&&(l.pathname+="/"),l}var Ii=i=>i.join("/").replace(/\/\/+/g,"/"),SD=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),xD=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,_D=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function AD(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var CE=["POST","PUT","PATCH","DELETE"];new Set(CE);var LD=["GET",...CE];new Set(LD);var Vs=N.createContext(null);Vs.displayName="DataRouter";var Du=N.createContext(null);Du.displayName="DataRouterState";var bE=N.createContext({isTransitioning:!1});bE.displayName="ViewTransition";var RD=N.createContext(new Map);RD.displayName="Fetchers";var ID=N.createContext(null);ID.displayName="Await";var ci=N.createContext(null);ci.displayName="Navigation";var ia=N.createContext(null);ia.displayName="Location";var Mi=N.createContext({outlet:null,matches:[],isDataRoute:!1});Mi.displayName="Route";var xd=N.createContext(null);xd.displayName="RouteError";function PD(i,{relative:e}={}){Ze(ra(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=N.useContext(ci),{hash:r,pathname:s,search:o}=sa(i,{relative:e}),a=s;return t!=="/"&&(a=s==="/"?t:Ii([t,s])),n.createHref({pathname:a,search:o,hash:r})}function ra(){return N.useContext(ia)!=null}function Wr(){return Ze(ra(),"useLocation() may be used only in the context of a <Router> component."),N.useContext(ia).location}var kE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function OE(i){N.useContext(ci).static||N.useLayoutEffect(i)}function DD(){let{isDataRoute:i}=N.useContext(Mi);return i?GD():wD()}function wD(){Ze(ra(),"useNavigate() may be used only in the context of a <Router> component.");let i=N.useContext(Vs),{basename:e,navigator:t}=N.useContext(ci),{matches:n}=N.useContext(Mi),{pathname:r}=Wr(),s=JSON.stringify(DE(n)),o=N.useRef(!1);return OE(()=>{o.current=!0}),N.useCallback((l,u={})=>{if(Bn(o.current,kE),!o.current)return;if(typeof l=="number"){t.go(l);return}let f=wE(l,JSON.parse(s),r,u.relative==="path");i==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Ii([e,f.pathname])),(u.replace?t.replace:t.push)(f,u.state,u)},[e,t,s,r,i])}N.createContext(null);function sa(i,{relative:e}={}){let{matches:t}=N.useContext(Mi),{pathname:n}=Wr(),r=JSON.stringify(DE(t));return N.useMemo(()=>wE(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function CD(i,e){return ME(i,e)}function ME(i,e,t,n){var R;Ze(ra(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r,static:s}=N.useContext(ci),{matches:o}=N.useContext(Mi),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",f=a?a.pathnameBase:"/",d=a&&a.route;{let L=d&&d.path||"";FE(u,!d||L.endsWith("*")||L.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${L}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${L}"> to <Route path="${L==="/"?"*":`${L}/*`}">.`)}let m=Wr(),g;if(e){let L=typeof e=="string"?zr(e):e;Ze(f==="/"||((R=L.pathname)==null?void 0:R.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${L.pathname}" was given in the \`location\` prop.`),g=L}else g=m;let y=g.pathname||"/",T=y;if(f!=="/"){let L=f.replace(/^\//,"").split("/");T="/"+y.replace(/^\//,"").split("/").slice(L.length).join("/")}let E=!s&&t&&t.matches&&t.matches.length>0?t.matches:RE(i,{pathname:T});Bn(d||E!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),Bn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=FD(E&&E.map(L=>Object.assign({},L,{params:Object.assign({},l,L.params),pathname:Ii([f,r.encodeLocation?r.encodeLocation(L.pathname).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?f:Ii([f,r.encodeLocation?r.encodeLocation(L.pathnameBase).pathname:L.pathnameBase])})),o,t,n);return e&&x?N.createElement(ia.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},x):x}function bD(){let i=VD(),e=AD(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",i),o=N.createElement(N.Fragment,null,N.createElement("p",null,"💿 Hey developer 👋"),N.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",N.createElement("code",{style:s},"ErrorBoundary")," or"," ",N.createElement("code",{style:s},"errorElement")," prop on your route.")),N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:r},t):null,o)}var kD=N.createElement(bD,null),OD=class extends N.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){console.error("React Router caught the following error during render",i,e)}render(){return this.state.error!==void 0?N.createElement(Mi.Provider,{value:this.props.routeContext},N.createElement(xd.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function MD({routeContext:i,match:e,children:t}){let n=N.useContext(Vs);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),N.createElement(Mi.Provider,{value:i},t)}function FD(i,e=[],t=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,s=t==null?void 0:t.errors;if(s!=null){let l=r.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);Ze(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<r.length;l++){let u=r[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:f,errors:d}=t,m=u.route.loader&&!f.hasOwnProperty(u.route.id)&&(!d||d[u.route.id]===void 0);if(u.route.lazy||m){o=!0,a>=0?r=r.slice(0,a+1):r=[r[0]];break}}}return r.reduceRight((l,u,f)=>{let d,m=!1,g=null,y=null;t&&(d=s&&u.route.id?s[u.route.id]:void 0,g=u.route.errorElement||kD,o&&(a<0&&f===0?(FE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,y=null):a===f&&(m=!0,y=u.route.hydrateFallbackElement||null)));let T=e.concat(r.slice(0,f+1)),E=()=>{let x;return d?x=g:m?x=y:u.route.Component?x=N.createElement(u.route.Component,null):u.route.element?x=u.route.element:x=l,N.createElement(MD,{match:u,routeContext:{outlet:l,matches:T,isDataRoute:t!=null},children:x})};return t&&(u.route.ErrorBoundary||u.route.errorElement||f===0)?N.createElement(OD,{location:t.location,revalidation:t.revalidation,component:g,error:d,children:E(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):E()},null)}function _d(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ND(i){let e=N.useContext(Vs);return Ze(e,_d(i)),e}function BD(i){let e=N.useContext(Du);return Ze(e,_d(i)),e}function UD(i){let e=N.useContext(Mi);return Ze(e,_d(i)),e}function Ad(i){let e=UD(i),t=e.matches[e.matches.length-1];return Ze(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function $D(){return Ad("useRouteId")}function VD(){var n;let i=N.useContext(xd),e=BD("useRouteError"),t=Ad("useRouteError");return i!==void 0?i:(n=e.errors)==null?void 0:n[t]}function GD(){let{router:i}=ND("useNavigate"),e=Ad("useNavigate"),t=N.useRef(!1);return OE(()=>{t.current=!0}),N.useCallback(async(r,s={})=>{Bn(t.current,kE),t.current&&(typeof r=="number"?i.navigate(r):await i.navigate(r,{fromRouteId:e,...s}))},[i,e])}var Q0={};function FE(i,e,t){!e&&!Q0[i]&&(Q0[i]=!0,Bn(!1,t))}N.memo(HD);function HD({routes:i,future:e,state:t}){return ME(i,void 0,t,e)}function KD(i){Ze(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function zD({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:s=!1}){Ze(!ra(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=i.replace(/^\/*/,"/"),a=N.useMemo(()=>({basename:o,navigator:r,static:s,future:{}}),[o,r,s]);typeof t=="string"&&(t=zr(t));let{pathname:l="/",search:u="",hash:f="",state:d=null,key:m="default"}=t,g=N.useMemo(()=>{let y=Ci(l,o);return y==null?null:{location:{pathname:y,search:u,hash:f,state:d,key:m},navigationType:n}},[o,l,u,f,d,m,n]);return Bn(g!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${f}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:N.createElement(ci.Provider,{value:a},N.createElement(ia.Provider,{children:e,value:g}))}function mN({children:i,location:e}){return CD(Tf(i),e)}function Tf(i,e=[]){let t=[];return N.Children.forEach(i,(n,r)=>{if(!N.isValidElement(n))return;let s=[...e,r];if(n.type===N.Fragment){t.push.apply(t,Tf(n.props.children,s));return}Ze(n.type===KD,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ze(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Tf(n.props.children,s)),t.push(o)}),t}var Bl="get",Ul="application/x-www-form-urlencoded";function wu(i){return i!=null&&typeof i.tagName=="string"}function WD(i){return wu(i)&&i.tagName.toLowerCase()==="button"}function jD(i){return wu(i)&&i.tagName.toLowerCase()==="form"}function YD(i){return wu(i)&&i.tagName.toLowerCase()==="input"}function qD(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function XD(i,e){return i.button===0&&(!e||e==="_self")&&!qD(i)}var Ll=null;function QD(){if(Ll===null)try{new FormData(document.createElement("form"),0),Ll=!1}catch{Ll=!0}return Ll}var ZD=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ih(i){return i!=null&&!ZD.has(i)?(Bn(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ul}"`),null):i}function JD(i,e){let t,n,r,s,o;if(jD(i)){let a=i.getAttribute("action");n=a?Ci(a,e):null,t=i.getAttribute("method")||Bl,r=Ih(i.getAttribute("enctype"))||Ul,s=new FormData(i)}else if(WD(i)||YD(i)&&(i.type==="submit"||i.type==="image")){let a=i.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=i.getAttribute("formaction")||a.getAttribute("action");if(n=l?Ci(l,e):null,t=i.getAttribute("formmethod")||a.getAttribute("method")||Bl,r=Ih(i.getAttribute("formenctype"))||Ih(a.getAttribute("enctype"))||Ul,s=new FormData(a,i),!QD()){let{name:u,type:f,value:d}=i;if(f==="image"){let m=u?`${u}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else u&&s.append(u,d)}}else{if(wu(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Bl,n=null,r=Ul,o=i}return s&&r==="text/plain"&&(o=s,s=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:s,body:o}}function Ld(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}async function ew(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tw(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function nw(i,e,t){let n=await Promise.all(i.map(async r=>{let s=e.routes[r.route.id];if(s){let o=await ew(s,t);return o.links?o.links():[]}return[]}));return ow(n.flat(1).filter(tw).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Z0(i,e,t,n,r,s){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,a=(l,u)=>{var f;return t[u].pathname!==l.pathname||((f=t[u].route.path)==null?void 0:f.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):s==="data"?e.filter((l,u)=>{var d;let f=n.routes[l.route.id];if(!f||!f.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let m=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(i,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function iw(i,e,{includeHydrateFallback:t}={}){return rw(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function rw(i){return[...new Set(i)]}function sw(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function ow(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let s=JSON.stringify(sw(r));return t.has(s)||(t.add(s),n.push({key:s,link:r})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var aw=new Set([100,101,204,205]);function lw(i,e){let t=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t.pathname==="/"?t.pathname="_root.data":e&&Ci(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function NE(){let i=N.useContext(Vs);return Ld(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function uw(){let i=N.useContext(Du);return Ld(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Rd=N.createContext(void 0);Rd.displayName="FrameworkContext";function BE(){let i=N.useContext(Rd);return Ld(i,"You must render this element inside a <HydratedRouter> element"),i}function cw(i,e){let t=N.useContext(Rd),[n,r]=N.useState(!1),[s,o]=N.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:f,onTouchStart:d}=e,m=N.useRef(null);N.useEffect(()=>{if(i==="render"&&o(!0),i==="viewport"){let T=x=>{x.forEach(R=>{o(R.isIntersecting)})},E=new IntersectionObserver(T,{threshold:.5});return m.current&&E.observe(m.current),()=>{E.disconnect()}}},[i]),N.useEffect(()=>{if(n){let T=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(T)}}},[n]);let g=()=>{r(!0)},y=()=>{r(!1),o(!1)};return t?i!=="intent"?[s,m,{}]:[s,m,{onFocus:go(a,g),onBlur:go(l,y),onMouseEnter:go(u,g),onMouseLeave:go(f,y),onTouchStart:go(d,g)}]:[!1,m,{}]}function go(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function hw({page:i,...e}){let{router:t}=NE(),n=N.useMemo(()=>RE(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?N.createElement(dw,{page:i,matches:n,...e}):null}function fw(i){let{manifest:e,routeModules:t}=BE(),[n,r]=N.useState([]);return N.useEffect(()=>{let s=!1;return nw(i,e,t).then(o=>{s||r(o)}),()=>{s=!0}},[i,e,t]),n}function dw({page:i,matches:e,...t}){let n=Wr(),{manifest:r,routeModules:s}=BE(),{basename:o}=NE(),{loaderData:a,matches:l}=uw(),u=N.useMemo(()=>Z0(i,e,l,r,n,"data"),[i,e,l,r,n]),f=N.useMemo(()=>Z0(i,e,l,r,n,"assets"),[i,e,l,r,n]),d=N.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let y=new Set,T=!1;if(e.forEach(x=>{var L;let R=r.routes[x.route.id];!R||!R.hasLoader||(!u.some(P=>P.route.id===x.route.id)&&x.route.id in a&&((L=s[x.route.id])!=null&&L.shouldRevalidate)||R.hasClientLoader?T=!0:y.add(x.route.id))}),y.size===0)return[];let E=lw(i,o);return T&&y.size>0&&E.searchParams.set("_routes",e.filter(x=>y.has(x.route.id)).map(x=>x.route.id).join(",")),[E.pathname+E.search]},[o,a,n,r,u,e,i,s]),m=N.useMemo(()=>iw(f,r),[f,r]),g=fw(f);return N.createElement(N.Fragment,null,d.map(y=>N.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),m.map(y=>N.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),g.map(({key:y,link:T})=>N.createElement("link",{key:y,...T})))}function mw(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var UE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{UE&&(window.__reactRouterVersion="7.6.0")}catch{}function pN({basename:i,children:e,window:t}){let n=N.useRef();n.current==null&&(n.current=tD({window:t,v5Compat:!0}));let r=n.current,[s,o]=N.useState({action:r.action,location:r.location}),a=N.useCallback(l=>{N.startTransition(()=>o(l))},[o]);return N.useLayoutEffect(()=>r.listen(a),[r,a]),N.createElement(zD,{basename:i,children:e,location:s.location,navigationType:s.action,navigator:r})}var $E=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,VE=N.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:o,state:a,target:l,to:u,preventScrollReset:f,viewTransition:d,...m},g){let{basename:y}=N.useContext(ci),T=typeof u=="string"&&$E.test(u),E,x=!1;if(typeof u=="string"&&T&&(E=u,UE))try{let k=new URL(window.location.href),O=u.startsWith("//")?new URL(k.protocol+u):new URL(u),W=Ci(O.pathname,y);O.origin===k.origin&&W!=null?u=W+O.search+O.hash:x=!0}catch{Bn(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let R=PD(u,{relative:r}),[L,P,I]=cw(n,m),C=vw(u,{replace:o,state:a,target:l,preventScrollReset:f,relative:r,viewTransition:d});function D(k){e&&e(k),k.defaultPrevented||C(k)}let w=N.createElement("a",{...m,...I,href:E||R,onClick:x||s?e:D,ref:mw(g,P),target:l,"data-discover":!T&&t==="render"?"true":void 0});return L&&!T?N.createElement(N.Fragment,null,w,N.createElement(hw,{page:R})):w});VE.displayName="Link";var pw=N.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:o,viewTransition:a,children:l,...u},f){let d=sa(o,{relative:u.relative}),m=Wr(),g=N.useContext(Du),{navigator:y,basename:T}=N.useContext(ci),E=g!=null&&_w(d)&&a===!0,x=y.encodeLocation?y.encodeLocation(d).pathname:d.pathname,R=m.pathname,L=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(R=R.toLowerCase(),L=L?L.toLowerCase():null,x=x.toLowerCase()),L&&T&&(L=Ci(L,T)||L);const P=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let I=R===x||!r&&R.startsWith(x)&&R.charAt(P)==="/",C=L!=null&&(L===x||!r&&L.startsWith(x)&&L.charAt(x.length)==="/"),D={isActive:I,isPending:C,isTransitioning:E},w=I?e:void 0,k;typeof n=="function"?k=n(D):k=[n,I?"active":null,C?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let O=typeof s=="function"?s(D):s;return N.createElement(VE,{...u,"aria-current":w,className:k,ref:f,style:O,to:o,viewTransition:a},typeof l=="function"?l(D):l)});pw.displayName="NavLink";var gw=N.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:s,method:o=Bl,action:a,onSubmit:l,relative:u,preventScrollReset:f,viewTransition:d,...m},g)=>{let y=Sw(),T=xw(a,{relative:u}),E=o.toLowerCase()==="get"?"get":"post",x=typeof a=="string"&&$E.test(a),R=L=>{if(l&&l(L),L.defaultPrevented)return;L.preventDefault();let P=L.nativeEvent.submitter,I=(P==null?void 0:P.getAttribute("formmethod"))||o;y(P||L.currentTarget,{fetcherKey:e,method:I,navigate:t,replace:r,state:s,relative:u,preventScrollReset:f,viewTransition:d})};return N.createElement("form",{ref:g,method:E,action:T,onSubmit:n?l:R,...m,"data-discover":!x&&i==="render"?"true":void 0})});gw.displayName="Form";function yw(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GE(i){let e=N.useContext(Vs);return Ze(e,yw(i)),e}function vw(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:s,viewTransition:o}={}){let a=DD(),l=Wr(),u=sa(i,{relative:s});return N.useCallback(f=>{if(XD(f,e)){f.preventDefault();let d=t!==void 0?t:zo(l)===zo(u);a(i,{replace:d,state:n,preventScrollReset:r,relative:s,viewTransition:o})}},[l,a,u,t,n,e,i,r,s,o])}var Tw=0,Ew=()=>`__${String(++Tw)}__`;function Sw(){let{router:i}=GE("useSubmit"),{basename:e}=N.useContext(ci),t=$D();return N.useCallback(async(n,r={})=>{let{action:s,method:o,encType:a,formData:l,body:u}=JD(n,e);if(r.navigate===!1){let f=r.fetcherKey||Ew();await i.fetch(f,t,r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,flushSync:r.flushSync})}else await i.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[i,e,t])}function xw(i,{relative:e}={}){let{basename:t}=N.useContext(ci),n=N.useContext(Mi);Ze(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...sa(i||".",{relative:e})},o=Wr();if(i==null){s.search=o.search;let a=new URLSearchParams(s.search),l=a.getAll("index");if(l.some(f=>f==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let f=a.toString();s.search=f?`?${f}`:""}}return(!i||i===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Ii([t,s.pathname])),zo(s)}function _w(i,e={}){let t=N.useContext(bE);Ze(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=GE("useViewTransitionState"),r=sa(i,{relative:e.relative});if(!t.isTransitioning)return!1;let s=Ci(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=Ci(t.nextLocation.pathname,n)||t.nextLocation.pathname;return su(r.pathname,o)!=null||su(r.pathname,s)!=null}[...aw];function _i(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function HE(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var hn={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ks={duration:.5,overwrite:!1,delay:0},Id,Rt,We,ri=1e8,Ot=1/ri,Ef=Math.PI*2,Aw=Ef/4,Lw=0,KE=Math.sqrt,Rw=Math.cos,Iw=Math.sin,Et=function(e){return typeof e=="string"},tt=function(e){return typeof e=="function"},bi=function(e){return typeof e=="number"},Pd=function(e){return typeof e>"u"},li=function(e){return typeof e=="object"},Xt=function(e){return e!==!1},Dd=function(){return typeof window<"u"},Rl=function(e){return tt(e)||Et(e)},zE=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ft=Array.isArray,Sf=/(?:-?\.?\d|\.)+/gi,WE=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,gs=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Ph=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,jE=/[+-]=-?[.\d]+/,YE=/[^,'"\[\]\s]+/gi,Pw=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,qe,Qn,xf,wd,fn={},ou={},qE,XE=function(e){return(ou=Os(e,fn))&&en},Cd=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Wo=function(e,t){return!t&&console.warn(e)},QE=function(e,t){return e&&(fn[e]=t)&&ou&&(ou[e]=t)||fn},jo=function(){return 0},Dw={suppressEvents:!0,isStart:!0,kill:!1},$l={suppressEvents:!0,kill:!1},ww={suppressEvents:!0},bd={},ir=[],_f={},ZE,an={},Dh={},J0=30,Vl=[],kd="",Od=function(e){var t=e[0],n,r;if(li(t)||tt(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(r=Vl.length;r--&&!Vl[r].targetTest(t););n=Vl[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new xS(e[r],n)))||e.splice(r,1);return e},Nr=function(e){return e._gsap||Od(Dn(e))[0]._gsap},JE=function(e,t,n){return(n=e[t])&&tt(n)?e[t]():Pd(n)&&e.getAttribute&&e.getAttribute(t)||n},Qt=function(e,t){return(e=e.split(",")).forEach(t)||e},rt=function(e){return Math.round(e*1e5)/1e5||0},lt=function(e){return Math.round(e*1e7)/1e7||0},Ls=function(e,t){var n=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+r:n==="-"?e-r:n==="*"?e*r:e/r},Cw=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},au=function(){var e=ir.length,t=ir.slice(0),n,r;for(_f={},ir.length=0,n=0;n<e;n++)r=t[n],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},Md=function(e){return!!(e._initted||e._startAt||e.add)},eS=function(e,t,n,r){ir.length&&!Rt&&au(),e.render(t,n,!!(Rt&&t<0&&Md(e))),ir.length&&!Rt&&au()},tS=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(YE).length<2?t:Et(e)?e.trim():e},nS=function(e){return e},dn=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},bw=function(e){return function(t,n){for(var r in n)r in t||r==="duration"&&e||r==="ease"||(t[r]=n[r])}},Os=function(e,t){for(var n in t)e[n]=t[n];return e},ey=function i(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=li(t[n])?i(e[n]||(e[n]={}),t[n]):t[n]);return e},lu=function(e,t){var n={},r;for(r in e)r in t||(n[r]=e[r]);return n},wo=function(e){var t=e.parent||qe,n=e.keyframes?bw(Ft(e.keyframes)):dn;if(Xt(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},kw=function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0},iS=function(e,t,n,r,s){var o=e[r],a;if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},Cu=function(e,t,n,r){n===void 0&&(n="_first"),r===void 0&&(r="_last");var s=t._prev,o=t._next;s?s._next=o:e[n]===t&&(e[n]=o),o?o._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},or=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Br=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Ow=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Af=function(e,t,n,r){return e._startAt&&(Rt?e._startAt.revert($l):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},Mw=function i(e){return!e||e._ts&&i(e.parent)},ty=function(e){return e._repeat?Ms(e._tTime,e=e.duration()+e._rDelay)*e:0},Ms=function(e,t){var n=Math.floor(e=lt(e/t));return e&&n===e?n-1:n},uu=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},bu=function(e){return e._end=lt(e._start+(e._tDur/Math.abs(e._ts||e._rts||Ot)||0))},ku=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=lt(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),bu(e),n._dirty||Br(n,e)),e},rS=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=uu(e.rawTime(),t),(!t._dur||oa(0,t.totalDuration(),n)-t._tTime>Ot)&&t.render(n,!0)),Br(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},Jn=function(e,t,n,r){return t.parent&&or(t),t._start=lt((bi(n)?n:n||e!==qe?Ln(e,n,t):e._time)+t._delay),t._end=lt(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),iS(e,t,"_first","_last",e._sort?"_start":0),Lf(t)||(e._recent=t),r||rS(e,t),e._ts<0&&ku(e,e._tTime),e},sS=function(e,t){return(fn.ScrollTrigger||Cd("scrollTrigger",t))&&fn.ScrollTrigger.create(t,e)},oS=function(e,t,n,r,s){if(Nd(e,t,s),!e._initted)return 1;if(!n&&e._pt&&!Rt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&ZE!==ln.frame)return ir.push(e),e._lazy=[s,r],1},Fw=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},Lf=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Nw=function(e,t,n,r){var s=e.ratio,o=t<0||!t&&(!e._start&&Fw(e)&&!(!e._initted&&Lf(e))||(e._ts<0||e._dp._ts<0)&&!Lf(e))?0:1,a=e._rDelay,l=0,u,f,d;if(a&&e._repeat&&(l=oa(0,e._tDur,t),f=Ms(l,a),e._yoyo&&f&1&&(o=1-o),f!==Ms(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||Rt||r||e._zTime===Ot||!t&&e._zTime){if(!e._initted&&oS(e,t,r,n,l))return;for(d=e._zTime,e._zTime=t||(n?Ot:0),n||(n=t&&!d),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,u=e._pt;u;)u.r(o,u.d),u=u._next;t<0&&Af(e,t,n,!0),e._onUpdate&&!n&&un(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&un(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&or(e,1),!n&&!Rt&&(un(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Bw=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},Fs=function(e,t,n,r){var s=e._repeat,o=lt(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:lt(o*(s+1)+e._rDelay*s):o,a>0&&!r&&ku(e,e._tTime=e._tDur*a),e.parent&&bu(e),n||Br(e.parent,e),e},ny=function(e){return e instanceof $t?Br(e):Fs(e,e._dur)},Uw={_start:0,endTime:jo,totalDuration:jo},Ln=function i(e,t,n){var r=e.labels,s=e._recent||Uw,o=e.duration()>=ri?s.endTime(!1):e._dur,a,l,u;return Et(t)&&(isNaN(t)||t in r)?(l=t.charAt(0),u=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(u?(a<0?s:n).totalDuration()/100:1)):a<0?(t in r||(r[t]=o),r[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),u&&n&&(l=l/100*(Ft(n)?n[0]:n).totalDuration()),a>1?i(e,t.substr(0,a-1),n)+l:o+l)):t==null?o:+t},Co=function(e,t,n){var r=bi(t[1]),s=(r?2:1)+(e<2?0:1),o=t[s],a,l;if(r&&(o.duration=t[1]),o.parent=n,e){for(a=o,l=n;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=Xt(l.vars.inherit)&&l.parent;o.immediateRender=Xt(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new at(t[0],o,t[s+1])},ur=function(e,t){return e||e===0?t(e):t},oa=function(e,t,n){return n<e?e:n>t?t:n},kt=function(e,t){return!Et(e)||!(t=Pw.exec(e))?"":t[1]},$w=function(e,t,n){return ur(n,function(r){return oa(e,t,r)})},Rf=[].slice,aS=function(e,t){return e&&li(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&li(e[0]))&&!e.nodeType&&e!==Qn},Vw=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(r){var s;return Et(r)&&!t||aS(r,1)?(s=n).push.apply(s,Dn(r)):n.push(r)})||n},Dn=function(e,t,n){return We&&!t&&We.selector?We.selector(e):Et(e)&&!n&&(xf||!Ns())?Rf.call((t||wd).querySelectorAll(e),0):Ft(e)?Vw(e,n):aS(e)?Rf.call(e,0):e?[e]:[]},If=function(e){return e=Dn(e)[0]||Wo("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Dn(t,n.querySelectorAll?n:n===e?Wo("Invalid scope")||wd.createElement("div"):e)}},lS=function(e){return e.sort(function(){return .5-Math.random()})},uS=function(e){if(tt(e))return e;var t=li(e)?e:{each:e},n=Ur(t.ease),r=t.from||0,s=parseFloat(t.base)||0,o={},a=r>0&&r<1,l=isNaN(r)||a,u=t.axis,f=r,d=r;return Et(r)?f=d={center:.5,edges:.5,end:1}[r]||0:!a&&l&&(f=r[0],d=r[1]),function(m,g,y){var T=(y||t).length,E=o[T],x,R,L,P,I,C,D,w,k;if(!E){if(k=t.grid==="auto"?0:(t.grid||[1,ri])[1],!k){for(D=-1e8;D<(D=y[k++].getBoundingClientRect().left)&&k<T;);k<T&&k--}for(E=o[T]=[],x=l?Math.min(k,T)*f-.5:r%k,R=k===ri?0:l?T*d/k-.5:r/k|0,D=0,w=ri,C=0;C<T;C++)L=C%k-x,P=R-(C/k|0),E[C]=I=u?Math.abs(u==="y"?P:L):KE(L*L+P*P),I>D&&(D=I),I<w&&(w=I);r==="random"&&lS(E),E.max=D-w,E.min=w,E.v=T=(parseFloat(t.amount)||parseFloat(t.each)*(k>T?T-1:u?u==="y"?T/k:k:Math.max(k,T/k))||0)*(r==="edges"?-1:1),E.b=T<0?s-T:s,E.u=kt(t.amount||t.each)||0,n=n&&T<0?TS(n):n}return T=(E[m]-E.min)/E.max||0,lt(E.b+(n?n(T):T)*E.v)+E.u}},Pf=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=lt(Math.round(parseFloat(n)/e)*e*t);return(r-r%1)/t+(bi(n)?0:kt(n))}},cS=function(e,t){var n=Ft(e),r,s;return!n&&li(e)&&(r=n=e.radius||ri,e.values?(e=Dn(e.values),(s=!bi(e[0]))&&(r*=r)):e=Pf(e.increment)),ur(t,n?tt(e)?function(o){return s=e(o),Math.abs(s-o)<=r?s:o}:function(o){for(var a=parseFloat(s?o.x:o),l=parseFloat(s?o.y:0),u=ri,f=0,d=e.length,m,g;d--;)s?(m=e[d].x-a,g=e[d].y-l,m=m*m+g*g):m=Math.abs(e[d]-a),m<u&&(u=m,f=d);return f=!r||u<=r?e[f]:o,s||f===o||bi(o)?f:f+kt(o)}:Pf(e))},hS=function(e,t,n,r){return ur(Ft(e)?!t:n===!0?!!(n=0):!r,function(){return Ft(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*r)/r})},Gw=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){return t.reduce(function(s,o){return o(s)},r)}},Hw=function(e,t){return function(n){return e(parseFloat(n))+(t||kt(n))}},Kw=function(e,t,n){return dS(e,t,0,1,n)},fS=function(e,t,n){return ur(n,function(r){return e[~~t(r)]})},zw=function i(e,t,n){var r=t-e;return Ft(e)?fS(e,i(0,e.length),t):ur(n,function(s){return(r+(s-e)%r)%r+e})},Ww=function i(e,t,n){var r=t-e,s=r*2;return Ft(e)?fS(e,i(0,e.length-1),t):ur(n,function(o){return o=(s+(o-e)%s)%s||0,e+(o>r?s-o:o)})},Yo=function(e){for(var t=0,n="",r,s,o,a;~(r=e.indexOf("random(",t));)o=e.indexOf(")",r),a=e.charAt(r+7)==="[",s=e.substr(r+7,o-r-7).match(a?YE:Sf),n+=e.substr(t,r-t)+hS(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return n+e.substr(t,e.length-t)},dS=function(e,t,n,r,s){var o=t-e,a=r-n;return ur(s,function(l){return n+((l-e)/o*a||0)})},jw=function i(e,t,n,r){var s=isNaN(e+t)?0:function(g){return(1-g)*e+g*t};if(!s){var o=Et(e),a={},l,u,f,d,m;if(n===!0&&(r=1)&&(n=null),o)e={p:e},t={p:t};else if(Ft(e)&&!Ft(t)){for(f=[],d=e.length,m=d-2,u=1;u<d;u++)f.push(i(e[u-1],e[u]));d--,s=function(y){y*=d;var T=Math.min(m,~~y);return f[T](y-T)},n=t}else r||(e=Os(Ft(e)?[]:{},e));if(!f){for(l in t)Fd.call(a,e,l,"get",t[l]);s=function(y){return $d(y,a)||(o?e.p:e)}}}return ur(n,s)},iy=function(e,t,n){var r=e.labels,s=ri,o,a,l;for(o in r)a=r[o]-t,a<0==!!n&&a&&s>(a=Math.abs(a))&&(l=o,s=a);return l},un=function(e,t,n){var r=e.vars,s=r[t],o=We,a=e._ctx,l,u,f;if(s)return l=r[t+"Params"],u=r.callbackScope||e,n&&ir.length&&au(),a&&(We=a),f=l?s.apply(u,l):s.call(u),We=o,f},So=function(e){return or(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Rt),e.progress()<1&&un(e,"onInterrupt"),e},ys,mS=[],pS=function(e){if(e)if(e=!e.name&&e.default||e,Dd()||e.headless){var t=e.name,n=tt(e),r=t&&!n&&e.init?function(){this._props=[]}:e,s={init:jo,render:$d,add:Fd,kill:uC,modifier:lC,rawVars:0},o={targetTest:0,get:0,getSetter:Ud,aliases:{},register:0};if(Ns(),e!==r){if(an[t])return;dn(r,dn(lu(e,s),o)),Os(r.prototype,Os(s,lu(e,o))),an[r.prop=t]=r,e.targetTest&&(Vl.push(r),bd[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}QE(t,r),e.register&&e.register(en,r,Zt)}else mS.push(e)},Ve=255,xo={aqua:[0,Ve,Ve],lime:[0,Ve,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ve],navy:[0,0,128],white:[Ve,Ve,Ve],olive:[128,128,0],yellow:[Ve,Ve,0],orange:[Ve,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ve,0,0],pink:[Ve,192,203],cyan:[0,Ve,Ve],transparent:[Ve,Ve,Ve,0]},wh=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Ve+.5|0},gS=function(e,t,n){var r=e?bi(e)?[e>>16,e>>8&Ve,e&Ve]:0:xo.black,s,o,a,l,u,f,d,m,g,y;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),xo[e])r=xo[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Ve,r&Ve,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Ve,e&Ve]}else if(e.substr(0,3)==="hsl"){if(r=y=e.match(Sf),!t)l=+r[0]%360/360,u=+r[1]/100,f=+r[2]/100,o=f<=.5?f*(u+1):f+u-f*u,s=f*2-o,r.length>3&&(r[3]*=1),r[0]=wh(l+1/3,s,o),r[1]=wh(l,s,o),r[2]=wh(l-1/3,s,o);else if(~e.indexOf("="))return r=e.match(WE),n&&r.length<4&&(r[3]=1),r}else r=e.match(Sf)||xo.transparent;r=r.map(Number)}return t&&!y&&(s=r[0]/Ve,o=r[1]/Ve,a=r[2]/Ve,d=Math.max(s,o,a),m=Math.min(s,o,a),f=(d+m)/2,d===m?l=u=0:(g=d-m,u=f>.5?g/(2-d-m):g/(d+m),l=d===s?(o-a)/g+(o<a?6:0):d===o?(a-s)/g+2:(s-o)/g+4,l*=60),r[0]=~~(l+.5),r[1]=~~(u*100+.5),r[2]=~~(f*100+.5)),n&&r.length<4&&(r[3]=1),r},yS=function(e){var t=[],n=[],r=-1;return e.split(rr).forEach(function(s){var o=s.match(gs)||[];t.push.apply(t,o),n.push(r+=o.length+1)}),t.c=n,t},ry=function(e,t,n){var r="",s=(e+r).match(rr),o=t?"hsla(":"rgba(",a=0,l,u,f,d;if(!s)return e;if(s=s.map(function(m){return(m=gS(m,t,1))&&o+(t?m[0]+","+m[1]+"%,"+m[2]+"%,"+m[3]:m.join(","))+")"}),n&&(f=yS(e),l=n.c,l.join(r)!==f.c.join(r)))for(u=e.replace(rr,"1").split(gs),d=u.length-1;a<d;a++)r+=u[a]+(~l.indexOf(a)?s.shift()||o+"0,0,0,0)":(f.length?f:s.length?s:n).shift());if(!u)for(u=e.split(rr),d=u.length-1;a<d;a++)r+=u[a]+s[a];return r+u[d]},rr=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in xo)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),Yw=/hsl[a]?\(/,vS=function(e){var t=e.join(" "),n;if(rr.lastIndex=0,rr.test(t))return n=Yw.test(t),e[1]=ry(e[1],n),e[0]=ry(e[0],n,yS(e[1])),!0},qo,ln=function(){var i=Date.now,e=500,t=33,n=i(),r=n,s=1e3/240,o=s,a=[],l,u,f,d,m,g,y=function T(E){var x=i()-r,R=E===!0,L,P,I,C;if((x>e||x<0)&&(n+=x-t),r+=x,I=r-n,L=I-o,(L>0||R)&&(C=++d.frame,m=I-d.time*1e3,d.time=I=I/1e3,o+=L+(L>=s?4:s-L),P=1),R||(l=u(T)),P)for(g=0;g<a.length;g++)a[g](I,m,C,E)};return d={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(E){return m/(1e3/(E||60))},wake:function(){qE&&(!xf&&Dd()&&(Qn=xf=window,wd=Qn.document||{},fn.gsap=en,(Qn.gsapVersions||(Qn.gsapVersions=[])).push(en.version),XE(ou||Qn.GreenSockGlobals||!Qn.gsap&&Qn||{}),mS.forEach(pS)),f=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&d.sleep(),u=f||function(E){return setTimeout(E,o-d.time*1e3+1|0)},qo=1,y(2))},sleep:function(){(f?cancelAnimationFrame:clearTimeout)(l),qo=0,u=jo},lagSmoothing:function(E,x){e=E||1/0,t=Math.min(x||33,e)},fps:function(E){s=1e3/(E||240),o=d.time*1e3+s},add:function(E,x,R){var L=x?function(P,I,C,D){E(P,I,C,D),d.remove(L)}:E;return d.remove(E),a[R?"unshift":"push"](L),Ns(),L},remove:function(E,x){~(x=a.indexOf(E))&&a.splice(x,1)&&g>=x&&g--},_listeners:a},d}(),Ns=function(){return!qo&&ln.wake()},De={},qw=/^[\d.\-M][\d.\-,\s]/,Xw=/["']/g,Qw=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),r=n[0],s=1,o=n.length,a,l,u;s<o;s++)l=n[s],a=s!==o-1?l.lastIndexOf(","):l.length,u=l.substr(0,a),t[r]=isNaN(u)?u.replace(Xw,"").trim():+u,r=l.substr(a+1).trim();return t},Zw=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<n?e.indexOf(")",n+1):n)},Jw=function(e){var t=(e+"").split("("),n=De[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[Qw(t[1])]:Zw(e).split(",").map(tS)):De._CE&&qw.test(e)?De._CE("",e):n},TS=function(e){return function(t){return 1-e(1-t)}},ES=function i(e,t){for(var n=e._first,r;n;)n instanceof $t?i(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?i(n.timeline,t):(r=n._ease,n._ease=n._yEase,n._yEase=r,n._yoyo=t)),n=n._next},Ur=function(e,t){return e&&(tt(e)?e:De[e]||Jw(e))||t},jr=function(e,t,n,r){n===void 0&&(n=function(l){return 1-t(1-l)}),r===void 0&&(r=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var s={easeIn:t,easeOut:n,easeInOut:r},o;return Qt(e,function(a){De[a]=fn[a]=s,De[o=a.toLowerCase()]=n;for(var l in s)De[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=De[a+"."+l]=s[l]}),s},SS=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Ch=function i(e,t,n){var r=t>=1?t:1,s=(n||(e?.3:.45))/(t<1?t:1),o=s/Ef*(Math.asin(1/r)||0),a=function(f){return f===1?1:r*Math.pow(2,-10*f)*Iw((f-o)*s)+1},l=e==="out"?a:e==="in"?function(u){return 1-a(1-u)}:SS(a);return s=Ef/s,l.config=function(u,f){return i(e,u,f)},l},bh=function i(e,t){t===void 0&&(t=1.70158);var n=function(o){return o?--o*o*((t+1)*o+t)+1:0},r=e==="out"?n:e==="in"?function(s){return 1-n(1-s)}:SS(n);return r.config=function(s){return i(e,s)},r};Qt("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;jr(i+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});De.Linear.easeNone=De.none=De.Linear.easeIn;jr("Elastic",Ch("in"),Ch("out"),Ch());(function(i,e){var t=1/e,n=2*t,r=2.5*t,s=function(a){return a<t?i*a*a:a<n?i*Math.pow(a-1.5/e,2)+.75:a<r?i*(a-=2.25/e)*a+.9375:i*Math.pow(a-2.625/e,2)+.984375};jr("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);jr("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});jr("Circ",function(i){return-(KE(1-i*i)-1)});jr("Sine",function(i){return i===1?1:-Rw(i*Aw)+1});jr("Back",bh("in"),bh("out"),bh());De.SteppedEase=De.steps=fn.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,r=e+(t?0:1),s=t?1:0,o=1-Ot;return function(a){return((r*oa(0,o,a)|0)+s)*n}}};ks.ease=De["quad.out"];Qt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return kd+=i+","+i+"Params,"});var xS=function(e,t){this.id=Lw++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:JE,this.set=t?t.getSetter:Ud},Xo=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Fs(this,+t.duration,1,1),this.data=t.data,We&&(this._ctx=We,We.data.push(this)),qo||ln.wake()}var e=i.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,Fs(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,r){if(Ns(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(ku(this,n),!s._dp||s.parent||rS(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Jn(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Ot||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),eS(this,n,r)),this},e.time=function(n,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+ty(this))%(this._dur+this._rDelay)||(n?this._dur:0),r):this._time},e.totalProgress=function(n,r){return arguments.length?this.totalTime(this.totalDuration()*n,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+ty(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,r):this._repeat?Ms(this._tTime,s)+1:1},e.timeScale=function(n,r){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?uu(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-1e-8?0:this._rts,this.totalTime(oa(-Math.abs(this._delay),this.totalDuration(),s),r!==!1),bu(this),Ow(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ns(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Ot&&(this._tTime-=Ot)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&Jn(r,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(Xt(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var r=this.parent||this._dp;return r?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?uu(r.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=ww);var r=Rt;return Rt=n,Md(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),Rt=r,this},e.globalTime=function(n){for(var r=this,s=arguments.length?n:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,ny(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var r=this._time;return this._rDelay=n,ny(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,r){return this.totalTime(Ln(this,n),Xt(r))},e.restart=function(n,r){return this.play().totalTime(n?-this._delay:0,Xt(r)),this._dur||(this._zTime=-1e-8),this},e.play=function(n,r){return n!=null&&this.seek(n,r),this.reversed(!1).paused(!1)},e.reverse=function(n,r){return n!=null&&this.seek(n||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(n,r){return n!=null&&this.seek(n,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var n=this.parent||this._dp,r=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=r&&s<this.endTime(!0)-Ot)},e.eventCallback=function(n,r,s){var o=this.vars;return arguments.length>1?(r?(o[n]=r,s&&(o[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=r)):delete o[n],this):o[n]},e.then=function(n){var r=this;return new Promise(function(s){var o=tt(n)?n:nS,a=function(){var u=r.then;r.then=null,tt(o)&&(o=o(r))&&(o.then||o===r)&&(r.then=u),s(o),r.then=u};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?a():r._prom=a})},e.kill=function(){So(this)},i}();dn(Xo.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var $t=function(i){HE(e,i);function e(n,r){var s;return n===void 0&&(n={}),s=i.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=Xt(n.sortChildren),qe&&Jn(n.parent||qe,_i(s),r),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&sS(_i(s),n.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,o){return Co(0,arguments,this),this},t.from=function(r,s,o){return Co(1,arguments,this),this},t.fromTo=function(r,s,o,a){return Co(2,arguments,this),this},t.set=function(r,s,o){return s.duration=0,s.parent=this,wo(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new at(r,s,Ln(this,o),1),this},t.call=function(r,s,o){return Jn(this,at.delayedCall(0,r,s),o)},t.staggerTo=function(r,s,o,a,l,u,f){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=u,o.onCompleteParams=f,o.parent=this,new at(r,o,Ln(this,l)),this},t.staggerFrom=function(r,s,o,a,l,u,f){return o.runBackwards=1,wo(o).immediateRender=Xt(o.immediateRender),this.staggerTo(r,s,o,a,l,u,f)},t.staggerFromTo=function(r,s,o,a,l,u,f,d){return a.startAt=o,wo(a).immediateRender=Xt(a.immediateRender),this.staggerTo(r,s,a,l,u,f,d)},t.render=function(r,s,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,u=this._dur,f=r<=0?0:lt(r),d=this._zTime<0!=r<0&&(this._initted||!u),m,g,y,T,E,x,R,L,P,I,C,D;if(this!==qe&&f>l&&r>=0&&(f=l),f!==this._tTime||o||d){if(a!==this._time&&u&&(f+=this._time-a,r+=this._time-a),m=f,P=this._start,L=this._ts,x=!L,d&&(u||(a=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(C=this._yoyo,E=u+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(E*100+r,s,o);if(m=lt(f%E),f===l?(T=this._repeat,m=u):(I=lt(f/E),T=~~I,T&&T===I&&(m=u,T--),m>u&&(m=u)),I=Ms(this._tTime,E),!a&&this._tTime&&I!==T&&this._tTime-I*E-this._dur<=0&&(I=T),C&&T&1&&(m=u-m,D=1),T!==I&&!this._lock){var w=C&&I&1,k=w===(C&&T&1);if(T<I&&(w=!w),a=w?0:f%u?u:f,this._lock=1,this.render(a||(D?0:lt(T*E)),s,!u)._lock=0,this._tTime=f,!s&&this.parent&&un(this,"onRepeat"),this.vars.repeatRefresh&&!D&&(this.invalidate()._lock=1),a&&a!==this._time||x!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(u=this._dur,l=this._tDur,k&&(this._lock=2,a=w?u:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!D&&this.invalidate()),this._lock=0,!this._ts&&!x)return this;ES(this,D)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(R=Bw(this,lt(a),lt(m)),R&&(f-=m-(m=R._start))),this._tTime=f,this._time=m,this._act=!L,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,a=0),!a&&f&&!s&&!I&&(un(this,"onStart"),this._tTime!==f))return this;if(m>=a&&r>=0)for(g=this._first;g;){if(y=g._next,(g._act||m>=g._start)&&g._ts&&R!==g){if(g.parent!==this)return this.render(r,s,o);if(g.render(g._ts>0?(m-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(m-g._start)*g._ts,s,o),m!==this._time||!this._ts&&!x){R=0,y&&(f+=this._zTime=-1e-8);break}}g=y}else{g=this._last;for(var O=r<0?r:m;g;){if(y=g._prev,(g._act||O<=g._end)&&g._ts&&R!==g){if(g.parent!==this)return this.render(r,s,o);if(g.render(g._ts>0?(O-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(O-g._start)*g._ts,s,o||Rt&&Md(g)),m!==this._time||!this._ts&&!x){R=0,y&&(f+=this._zTime=O?-1e-8:Ot);break}}g=y}}if(R&&!s&&(this.pause(),R.render(m>=a?0:-1e-8)._zTime=m>=a?1:-1,this._ts))return this._start=P,bu(this),this.render(r,s,o);this._onUpdate&&!s&&un(this,"onUpdate",!0),(f===l&&this._tTime>=this.totalDuration()||!f&&a)&&(P===this._start||Math.abs(L)!==Math.abs(this._ts))&&(this._lock||((r||!u)&&(f===l&&this._ts>0||!f&&this._ts<0)&&or(this,1),!s&&!(r<0&&!a)&&(f||a||!l)&&(un(this,f===l&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(f<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var o=this;if(bi(s)||(s=Ln(this,s,r)),!(r instanceof Xo)){if(Ft(r))return r.forEach(function(a){return o.add(a,s)}),this;if(Et(r))return this.addLabel(r,s);if(tt(r))r=at.delayedCall(0,r);else return this}return this!==r?Jn(this,r,s):this},t.getChildren=function(r,s,o,a){r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-1e8);for(var l=[],u=this._first;u;)u._start>=a&&(u instanceof at?s&&l.push(u):(o&&l.push(u),r&&l.push.apply(l,u.getChildren(!0,s,o)))),u=u._next;return l},t.getById=function(r){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===r)return s[o]},t.remove=function(r){return Et(r)?this.removeLabel(r):tt(r)?this.killTweensOf(r):(r.parent===this&&Cu(this,r),r===this._recent&&(this._recent=this._last),Br(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=lt(ln.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),i.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=Ln(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,o){var a=at.delayedCall(0,s||jo,o);return a.data="isPause",this._hasPause=1,Jn(this,a,Ln(this,r))},t.removePause=function(r){var s=this._first;for(r=Ln(this,r);s;)s._start===r&&s.data==="isPause"&&or(s),s=s._next},t.killTweensOf=function(r,s,o){for(var a=this.getTweensOf(r,o),l=a.length;l--;)er!==a[l]&&a[l].kill(r,s);return this},t.getTweensOf=function(r,s){for(var o=[],a=Dn(r),l=this._first,u=bi(s),f;l;)l instanceof at?Cw(l._targets,a)&&(u?(!er||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&o.push(l):(f=l.getTweensOf(a,s)).length&&o.push.apply(o,f),l=l._next;return o},t.tweenTo=function(r,s){s=s||{};var o=this,a=Ln(o,r),l=s,u=l.startAt,f=l.onStart,d=l.onStartParams,m=l.immediateRender,g,y=at.to(o,dn({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale())||Ot,onStart:function(){if(o.pause(),!g){var E=s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale());y._dur!==E&&Fs(y,E,0,1).render(y._time,!0,!0),g=1}f&&f.apply(y,d||[])}},s));return m?y.render(0):y},t.tweenFromTo=function(r,s,o){return this.tweenTo(s,dn({startAt:{time:Ln(this,r)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),iy(this,Ln(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),iy(this,Ln(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Ot)},t.shiftChildren=function(r,s,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,u;a;)a._start>=o&&(a._start+=r,a._end+=r),a=a._next;if(s)for(u in l)l[u]>=o&&(l[u]+=r);return Br(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return i.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Br(this)},t.totalDuration=function(r){var s=0,o=this,a=o._last,l=ri,u,f,d;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-r:r));if(o._dirty){for(d=o.parent;a;)u=a._prev,a._dirty&&a.totalDuration(),f=a._start,f>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,Jn(o,a,f-a._delay,1)._lock=0):l=f,f<0&&a._ts&&(s-=f,(!d&&!o._dp||d&&d.smoothChildTiming)&&(o._start+=f/o._ts,o._time-=f,o._tTime-=f),o.shiftChildren(-f,!1,-1/0),l=0),a._end>s&&a._ts&&(s=a._end),a=u;Fs(o,o===qe&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(r){if(qe._ts&&(eS(qe,uu(r,qe)),ZE=ln.frame),ln.frame>=J0){J0+=hn.autoSleep||120;var s=qe._first;if((!s||!s._ts)&&hn.autoSleep&&ln._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||ln.sleep()}}},e}(Xo);dn($t.prototype,{_lock:0,_hasPause:0,_forcing:0});var eC=function(e,t,n,r,s,o,a){var l=new Zt(this._pt,e,t,0,1,PS,null,s),u=0,f=0,d,m,g,y,T,E,x,R;for(l.b=n,l.e=r,n+="",r+="",(x=~r.indexOf("random("))&&(r=Yo(r)),o&&(R=[n,r],o(R,e,t),n=R[0],r=R[1]),m=n.match(Ph)||[];d=Ph.exec(r);)y=d[0],T=r.substring(u,d.index),g?g=(g+1)%5:T.substr(-5)==="rgba("&&(g=1),y!==m[f++]&&(E=parseFloat(m[f-1])||0,l._pt={_next:l._pt,p:T||f===1?T:",",s:E,c:y.charAt(1)==="="?Ls(E,y)-E:parseFloat(y)-E,m:g&&g<4?Math.round:0},u=Ph.lastIndex);return l.c=u<r.length?r.substring(u,r.length):"",l.fp=a,(jE.test(r)||x)&&(l.e=0),this._pt=l,l},Fd=function(e,t,n,r,s,o,a,l,u,f){tt(r)&&(r=r(s||0,e,o));var d=e[t],m=n!=="get"?n:tt(d)?u?e[t.indexOf("set")||!tt(e["get"+t.substr(3)])?t:"get"+t.substr(3)](u):e[t]():d,g=tt(d)?u?sC:RS:Bd,y;if(Et(r)&&(~r.indexOf("random(")&&(r=Yo(r)),r.charAt(1)==="="&&(y=Ls(m,r)+(kt(m)||0),(y||y===0)&&(r=y))),!f||m!==r||Df)return!isNaN(m*r)&&r!==""?(y=new Zt(this._pt,e,t,+m||0,r-(m||0),typeof d=="boolean"?aC:IS,0,g),u&&(y.fp=u),a&&y.modifier(a,this,e),this._pt=y):(!d&&!(t in e)&&Cd(t,r),eC.call(this,e,t,m,r,g,l||hn.stringFilter,u))},tC=function(e,t,n,r,s){if(tt(e)&&(e=bo(e,s,t,n,r)),!li(e)||e.style&&e.nodeType||Ft(e)||zE(e))return Et(e)?bo(e,s,t,n,r):e;var o={},a;for(a in e)o[a]=bo(e[a],s,t,n,r);return o},_S=function(e,t,n,r,s,o){var a,l,u,f;if(an[e]&&(a=new an[e]).init(s,a.rawVars?t[e]:tC(t[e],r,s,o,n),n,r,o)!==!1&&(n._pt=l=new Zt(n._pt,s,e,0,1,a.render,a,0,a.priority),n!==ys))for(u=n._ptLookup[n._targets.indexOf(s)],f=a._props.length;f--;)u[a._props[f]]=l;return a},er,Df,Nd=function i(e,t,n){var r=e.vars,s=r.ease,o=r.startAt,a=r.immediateRender,l=r.lazy,u=r.onUpdate,f=r.runBackwards,d=r.yoyoEase,m=r.keyframes,g=r.autoRevert,y=e._dur,T=e._startAt,E=e._targets,x=e.parent,R=x&&x.data==="nested"?x.vars.targets:E,L=e._overwrite==="auto"&&!Id,P=e.timeline,I,C,D,w,k,O,W,q,ie,te,J,Z,Q;if(P&&(!m||!s)&&(s="none"),e._ease=Ur(s,ks.ease),e._yEase=d?TS(Ur(d===!0?s:d,ks.ease)):0,d&&e._yoyo&&!e._repeat&&(d=e._yEase,e._yEase=e._ease,e._ease=d),e._from=!P&&!!r.runBackwards,!P||m&&!r.stagger){if(q=E[0]?Nr(E[0]).harness:0,Z=q&&r[q.prop],I=lu(r,bd),T&&(T._zTime<0&&T.progress(1),t<0&&f&&a&&!g?T.render(-1,!0):T.revert(f&&y?$l:Dw),T._lazy=0),o){if(or(e._startAt=at.set(E,dn({data:"isStart",overwrite:!1,parent:x,immediateRender:!0,lazy:!T&&Xt(l),startAt:null,delay:0,onUpdate:u&&function(){return un(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Rt||!a&&!g)&&e._startAt.revert($l),a&&y&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(f&&y&&!T){if(t&&(a=!1),D=dn({overwrite:!1,data:"isFromStart",lazy:a&&!T&&Xt(l),immediateRender:a,stagger:0,parent:x},I),Z&&(D[q.prop]=Z),or(e._startAt=at.set(E,D)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Rt?e._startAt.revert($l):e._startAt.render(-1,!0)),e._zTime=t,!a)i(e._startAt,Ot,Ot);else if(!t)return}for(e._pt=e._ptCache=0,l=y&&Xt(l)||l&&!y,C=0;C<E.length;C++){if(k=E[C],W=k._gsap||Od(E)[C]._gsap,e._ptLookup[C]=te={},_f[W.id]&&ir.length&&au(),J=R===E?C:R.indexOf(k),q&&(ie=new q).init(k,Z||I,e,J,R)!==!1&&(e._pt=w=new Zt(e._pt,k,ie.name,0,1,ie.render,ie,0,ie.priority),ie._props.forEach(function(G){te[G]=w}),ie.priority&&(O=1)),!q||Z)for(D in I)an[D]&&(ie=_S(D,I,e,J,k,R))?ie.priority&&(O=1):te[D]=w=Fd.call(e,k,D,"get",I[D],J,R,0,r.stringFilter);e._op&&e._op[C]&&e.kill(k,e._op[C]),L&&e._pt&&(er=e,qe.killTweensOf(k,te,e.globalTime(t)),Q=!e.parent,er=0),e._pt&&l&&(_f[W.id]=1)}O&&DS(e),e._onInit&&e._onInit(e)}e._onUpdate=u,e._initted=(!e._op||e._pt)&&!Q,m&&t<=0&&P.render(ri,!0,!0)},nC=function(e,t,n,r,s,o,a,l){var u=(e._pt&&e._ptCache||(e._ptCache={}))[t],f,d,m,g;if(!u)for(u=e._ptCache[t]=[],m=e._ptLookup,g=e._targets.length;g--;){if(f=m[g][t],f&&f.d&&f.d._pt)for(f=f.d._pt;f&&f.p!==t&&f.fp!==t;)f=f._next;if(!f)return Df=1,e.vars[t]="+=0",Nd(e,a),Df=0,l?Wo(t+" not eligible for reset"):1;u.push(f)}for(g=u.length;g--;)d=u[g],f=d._pt||d,f.s=(r||r===0)&&!s?r:f.s+(r||0)+o*f.c,f.c=n-f.s,d.e&&(d.e=rt(n)+kt(d.e)),d.b&&(d.b=f.s+kt(d.b))},iC=function(e,t){var n=e[0]?Nr(e[0]).harness:0,r=n&&n.aliases,s,o,a,l;if(!r)return t;s=Os({},t);for(o in r)if(o in s)for(l=r[o].split(","),a=l.length;a--;)s[l[a]]=s[o];return s},rC=function(e,t,n,r){var s=t.ease||r||"power1.inOut",o,a;if(Ft(t))a=n[e]||(n[e]=[]),t.forEach(function(l,u){return a.push({t:u/(t.length-1)*100,v:l,e:s})});else for(o in t)a=n[o]||(n[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:s})},bo=function(e,t,n,r,s){return tt(e)?e.call(t,n,r,s):Et(e)&&~e.indexOf("random(")?Yo(e):e},AS=kd+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",LS={};Qt(AS+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return LS[i]=1});var at=function(i){HE(e,i);function e(n,r,s,o){var a;typeof r=="number"&&(s.duration=r,r=s,s=null),a=i.call(this,o?r:wo(r))||this;var l=a.vars,u=l.duration,f=l.delay,d=l.immediateRender,m=l.stagger,g=l.overwrite,y=l.keyframes,T=l.defaults,E=l.scrollTrigger,x=l.yoyoEase,R=r.parent||qe,L=(Ft(n)||zE(n)?bi(n[0]):"length"in r)?[n]:Dn(n),P,I,C,D,w,k,O,W;if(a._targets=L.length?Od(L):Wo("GSAP target "+n+" not found. https://gsap.com",!hn.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=g,y||m||Rl(u)||Rl(f)){if(r=a.vars,P=a.timeline=new $t({data:"nested",defaults:T||{},targets:R&&R.data==="nested"?R.vars.targets:L}),P.kill(),P.parent=P._dp=_i(a),P._start=0,m||Rl(u)||Rl(f)){if(D=L.length,O=m&&uS(m),li(m))for(w in m)~AS.indexOf(w)&&(W||(W={}),W[w]=m[w]);for(I=0;I<D;I++)C=lu(r,LS),C.stagger=0,x&&(C.yoyoEase=x),W&&Os(C,W),k=L[I],C.duration=+bo(u,_i(a),I,k,L),C.delay=(+bo(f,_i(a),I,k,L)||0)-a._delay,!m&&D===1&&C.delay&&(a._delay=f=C.delay,a._start+=f,C.delay=0),P.to(k,C,O?O(I,k,L):0),P._ease=De.none;P.duration()?u=f=0:a.timeline=0}else if(y){wo(dn(P.vars.defaults,{ease:"none"})),P._ease=Ur(y.ease||r.ease||"none");var q=0,ie,te,J;if(Ft(y))y.forEach(function(Z){return P.to(L,Z,">")}),P.duration();else{C={};for(w in y)w==="ease"||w==="easeEach"||rC(w,y[w],C,y.easeEach);for(w in C)for(ie=C[w].sort(function(Z,Q){return Z.t-Q.t}),q=0,I=0;I<ie.length;I++)te=ie[I],J={ease:te.e,duration:(te.t-(I?ie[I-1].t:0))/100*u},J[w]=te.v,P.to(L,J,q),q+=J.duration;P.duration()<u&&P.to({},{duration:u-P.duration()})}}u||a.duration(u=P.duration())}else a.timeline=0;return g===!0&&!Id&&(er=_i(a),qe.killTweensOf(L),er=0),Jn(R,_i(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),(d||!u&&!y&&a._start===lt(R._time)&&Xt(d)&&Mw(_i(a))&&R.data!=="nested")&&(a._tTime=-1e-8,a.render(Math.max(0,-f)||0)),E&&sS(_i(a),E),a}var t=e.prototype;return t.render=function(r,s,o){var a=this._time,l=this._tDur,u=this._dur,f=r<0,d=r>l-Ot&&!f?l:r<Ot?0:r,m,g,y,T,E,x,R,L,P;if(!u)Nw(this,r,s,o);else if(d!==this._tTime||!r||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f||this._lazy){if(m=d,L=this.timeline,this._repeat){if(T=u+this._rDelay,this._repeat<-1&&f)return this.totalTime(T*100+r,s,o);if(m=lt(d%T),d===l?(y=this._repeat,m=u):(E=lt(d/T),y=~~E,y&&y===E?(m=u,y--):m>u&&(m=u)),x=this._yoyo&&y&1,x&&(P=this._yEase,m=u-m),E=Ms(this._tTime,T),m===a&&!o&&this._initted&&y===E)return this._tTime=d,this;y!==E&&(L&&this._yEase&&ES(L,x),this.vars.repeatRefresh&&!x&&!this._lock&&m!==T&&this._initted&&(this._lock=o=1,this.render(lt(T*y),!0).invalidate()._lock=0))}if(!this._initted){if(oS(this,f?r:m,o,s,d))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&y!==E))return this;if(u!==this._dur)return this.render(r,s,o)}if(this._tTime=d,this._time=m,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=R=(P||this._ease)(m/u),this._from&&(this.ratio=R=1-R),!a&&d&&!s&&!E&&(un(this,"onStart"),this._tTime!==d))return this;for(g=this._pt;g;)g.r(R,g.d),g=g._next;L&&L.render(r<0?r:L._dur*L._ease(m/this._dur),s,o)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(f&&Af(this,r,s,o),un(this,"onUpdate")),this._repeat&&y!==E&&this.vars.onRepeat&&!s&&this.parent&&un(this,"onRepeat"),(d===this._tDur||!d)&&this._tTime===d&&(f&&!this._onUpdate&&Af(this,r,!0,!0),(r||!u)&&(d===this._tDur&&this._ts>0||!d&&this._ts<0)&&or(this,1),!s&&!(f&&!a)&&(d||a||x)&&(un(this,d===l?"onComplete":"onReverseComplete",!0),this._prom&&!(d<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),i.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,o,a,l){qo||ln.wake(),this._ts||this.play();var u=Math.min(this._dur,(this._dp._time-this._start)*this._ts),f;return this._initted||Nd(this,u),f=this._ease(u/this._dur),nC(this,r,s,o,a,f,u,l)?this.resetTo(r,s,o,a,1):(ku(this,0),this.parent||iS(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?So(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Rt),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,er&&er.vars.overwrite!==!0)._first||So(this),this.parent&&o!==this.timeline.totalDuration()&&Fs(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=r?Dn(r):a,u=this._ptLookup,f=this._pt,d,m,g,y,T,E,x;if((!s||s==="all")&&kw(a,l))return s==="all"&&(this._pt=0),So(this);for(d=this._op=this._op||[],s!=="all"&&(Et(s)&&(T={},Qt(s,function(R){return T[R]=1}),s=T),s=iC(a,s)),x=a.length;x--;)if(~l.indexOf(a[x])){m=u[x],s==="all"?(d[x]=s,y=m,g={}):(g=d[x]=d[x]||{},y=s);for(T in y)E=m&&m[T],E&&((!("kill"in E.d)||E.d.kill(T)===!0)&&Cu(this,E,"_pt"),delete m[T]),g!=="all"&&(g[T]=1)}return this._initted&&!this._pt&&f&&So(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return Co(1,arguments)},e.delayedCall=function(r,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(r,s,o){return Co(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,o){return qe.killTweensOf(r,s,o)},e}(Xo);dn(at.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Qt("staggerTo,staggerFrom,staggerFromTo",function(i){at[i]=function(){var e=new $t,t=Rf.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var Bd=function(e,t,n){return e[t]=n},RS=function(e,t,n){return e[t](n)},sC=function(e,t,n,r){return e[t](r.fp,n)},oC=function(e,t,n){return e.setAttribute(t,n)},Ud=function(e,t){return tt(e[t])?RS:Pd(e[t])&&e.setAttribute?oC:Bd},IS=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},aC=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},PS=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},$d=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},lC=function(e,t,n,r){for(var s=this._pt,o;s;)o=s._next,s.p===r&&s.modifier(e,t,n),s=o},uC=function(e){for(var t=this._pt,n,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?Cu(this,t,"_pt"):t.dep||(n=1),t=r;return!n},cC=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},DS=function(e){for(var t=e._pt,n,r,s,o;t;){for(n=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:o)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:o=t,t=n}e._pt=s},Zt=function(){function i(t,n,r,s,o,a,l,u,f){this.t=n,this.s=s,this.c=o,this.p=r,this.r=a||IS,this.d=l||this,this.set=u||Bd,this.pr=f||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(n,r,s){this.mSet=this.mSet||this.set,this.set=cC,this.m=n,this.mt=s,this.tween=r},i}();Qt(kd+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return bd[i]=1});fn.TweenMax=fn.TweenLite=at;fn.TimelineLite=fn.TimelineMax=$t;qe=new $t({sortChildren:!1,defaults:ks,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});hn.stringFilter=vS;var $r=[],Gl={},hC=[],sy=0,fC=0,kh=function(e){return(Gl[e]||hC).map(function(t){return t()})},wf=function(){var e=Date.now(),t=[];e-sy>2&&(kh("matchMediaInit"),$r.forEach(function(n){var r=n.queries,s=n.conditions,o,a,l,u;for(a in r)o=Qn.matchMedia(r[a]).matches,o&&(l=1),o!==s[a]&&(s[a]=o,u=1);u&&(n.revert(),l&&t.push(n))}),kh("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(r){return n.add(null,r)})}),sy=e,kh("matchMedia"))},wS=function(){function i(t,n){this.selector=n&&If(n),this.data=[],this._r=[],this.isReverted=!1,this.id=fC++,t&&this.add(t)}var e=i.prototype;return e.add=function(n,r,s){tt(n)&&(s=r,r=n,n=tt);var o=this,a=function(){var u=We,f=o.selector,d;return u&&u!==o&&u.data.push(o),s&&(o.selector=If(s)),We=o,d=r.apply(o,arguments),tt(d)&&o._r.push(d),We=u,o.selector=f,o.isReverted=!1,d};return o.last=a,n===tt?a(o,function(l){return o.add(null,l)}):n?o[n]=a:a},e.ignore=function(n){var r=We;We=null,n(this),We=r},e.getTweens=function(){var n=[];return this.data.forEach(function(r){return r instanceof i?n.push.apply(n,r.getTweens()):r instanceof at&&!(r.parent&&r.parent.data==="nested")&&n.push(r)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,r){var s=this;if(n?function(){for(var a=s.getTweens(),l=s.data.length,u;l--;)u=s.data[l],u.data==="isFlip"&&(u.revert(),u.getChildren(!0,!0,!1).forEach(function(f){return a.splice(a.indexOf(f),1)}));for(a.map(function(f){return{g:f._dur||f._delay||f._sat&&!f._sat.vars.immediateRender?f.globalTime(0):-1/0,t:f}}).sort(function(f,d){return d.g-f.g||-1/0}).forEach(function(f){return f.t.revert(n)}),l=s.data.length;l--;)u=s.data[l],u instanceof $t?u.data!=="nested"&&(u.scrollTrigger&&u.scrollTrigger.revert(),u.kill()):!(u instanceof at)&&u.revert&&u.revert(n);s._r.forEach(function(f){return f(n,s)}),s.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),r)for(var o=$r.length;o--;)$r[o].id===this.id&&$r.splice(o,1)},e.revert=function(n){this.kill(n||{})},i}(),dC=function(){function i(t){this.contexts=[],this.scope=t,We&&We.data.push(this)}var e=i.prototype;return e.add=function(n,r,s){li(n)||(n={matches:n});var o=new wS(0,s||this.scope),a=o.conditions={},l,u,f;We&&!o.selector&&(o.selector=We.selector),this.contexts.push(o),r=o.add("onMatch",r),o.queries=n;for(u in n)u==="all"?f=1:(l=Qn.matchMedia(n[u]),l&&($r.indexOf(o)<0&&$r.push(o),(a[u]=l.matches)&&(f=1),l.addListener?l.addListener(wf):l.addEventListener("change",wf)));return f&&r(o,function(d){return o.add(null,d)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(r){return r.kill(n,!0)})},i}(),cu={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(r){return pS(r)})},timeline:function(e){return new $t(e)},getTweensOf:function(e,t){return qe.getTweensOf(e,t)},getProperty:function(e,t,n,r){Et(e)&&(e=Dn(e)[0]);var s=Nr(e||{}).get,o=n?nS:tS;return n==="native"&&(n=""),e&&(t?o((an[t]&&an[t].get||s)(e,t,n,r)):function(a,l,u){return o((an[a]&&an[a].get||s)(e,a,l,u))})},quickSetter:function(e,t,n){if(e=Dn(e),e.length>1){var r=e.map(function(f){return en.quickSetter(f,t,n)}),s=r.length;return function(f){for(var d=s;d--;)r[d](f)}}e=e[0]||{};var o=an[t],a=Nr(e),l=a.harness&&(a.harness.aliases||{})[t]||t,u=o?function(f){var d=new o;ys._pt=0,d.init(e,n?f+n:f,ys,0,[e]),d.render(1,d),ys._pt&&$d(1,ys)}:a.set(e,l);return o?u:function(f){return u(e,l,n?f+n:f,a,1)}},quickTo:function(e,t,n){var r,s=en.to(e,dn((r={},r[t]="+=0.1",r.paused=!0,r.stagger=0,r),n||{})),o=function(l,u,f){return s.resetTo(t,l,u,f)};return o.tween=s,o},isTweening:function(e){return qe.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ur(e.ease,ks.ease)),ey(ks,e||{})},config:function(e){return ey(hn,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,s=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach(function(a){return a&&!an[a]&&!fn[a]&&Wo(t+" effect requires "+a+" plugin.")}),Dh[t]=function(a,l,u){return n(Dn(a),dn(l||{},s),u)},o&&($t.prototype[t]=function(a,l,u){return this.add(Dh[t](a,li(l)?l:(u=l)&&{},this),u)})},registerEase:function(e,t){De[e]=Ur(t)},parseEase:function(e,t){return arguments.length?Ur(e,t):De},getById:function(e){return qe.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new $t(e),r,s;for(n.smoothChildTiming=Xt(e.smoothChildTiming),qe.remove(n),n._dp=0,n._time=n._tTime=qe._time,r=qe._first;r;)s=r._next,(t||!(!r._dur&&r instanceof at&&r.vars.onComplete===r._targets[0]))&&Jn(n,r,r._start-r._delay),r=s;return Jn(qe,n,0),n},context:function(e,t){return e?new wS(e,t):We},matchMedia:function(e){return new dC(e)},matchMediaRefresh:function(){return $r.forEach(function(e){var t=e.conditions,n,r;for(r in t)t[r]&&(t[r]=!1,n=1);n&&e.revert()})||wf()},addEventListener:function(e,t){var n=Gl[e]||(Gl[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Gl[e],r=n&&n.indexOf(t);r>=0&&n.splice(r,1)},utils:{wrap:zw,wrapYoyo:Ww,distribute:uS,random:hS,snap:cS,normalize:Kw,getUnit:kt,clamp:$w,splitColor:gS,toArray:Dn,selector:If,mapRange:dS,pipe:Gw,unitize:Hw,interpolate:jw,shuffle:lS},install:XE,effects:Dh,ticker:ln,updateRoot:$t.updateRoot,plugins:an,globalTimeline:qe,core:{PropTween:Zt,globals:QE,Tween:at,Timeline:$t,Animation:Xo,getCache:Nr,_removeLinkedListItem:Cu,reverting:function(){return Rt},context:function(e){return e&&We&&(We.data.push(e),e._ctx=We),We},suppressOverwrites:function(e){return Id=e}}};Qt("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return cu[i]=at[i]});ln.add($t.updateRoot);ys=cu.to({},{duration:0});var mC=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},pC=function(e,t){var n=e._targets,r,s,o;for(r in t)for(s=n.length;s--;)o=e._ptLookup[s][r],o&&(o=o.d)&&(o._pt&&(o=mC(o,r)),o&&o.modifier&&o.modifier(t[r],e,n[s],r))},Oh=function(e,t){return{name:e,headless:1,rawVars:1,init:function(r,s,o){o._onInit=function(a){var l,u;if(Et(s)&&(l={},Qt(s,function(f){return l[f]=1}),s=l),t){l={};for(u in s)l[u]=t(s[u]);s=l}pC(a,s)}}}},en=cu.registerPlugin({name:"attr",init:function(e,t,n,r,s){var o,a,l;this.tween=n;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],r,s,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var n=t._pt;n;)Rt?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},Oh("roundProps",Pf),Oh("modifiers"),Oh("snap",cS))||cu;at.version=$t.version=en.version="3.13.0";qE=1;Dd()&&Ns();De.Power0;De.Power1;De.Power2;De.Power3;De.Power4;De.Linear;De.Quad;De.Cubic;De.Quart;De.Quint;De.Strong;De.Elastic;De.Back;De.SteppedEase;De.Bounce;De.Sine;De.Expo;De.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var oy,tr,Rs,Vd,br,ay,Gd,gC=function(){return typeof window<"u"},ki={},Pr=180/Math.PI,Is=Math.PI/180,ms=Math.atan2,ly=1e8,Hd=/([A-Z])/g,yC=/(left|right|width|margin|padding|x)/i,vC=/[\s,\(]\S/,ni={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Cf=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},TC=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},EC=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},SC=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},CS=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},bS=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},xC=function(e,t,n){return e.style[t]=n},_C=function(e,t,n){return e.style.setProperty(t,n)},AC=function(e,t,n){return e._gsap[t]=n},LC=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},RC=function(e,t,n,r,s){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(s,o)},IC=function(e,t,n,r,s){var o=e._gsap;o[t]=n,o.renderTransform(s,o)},Xe="transform",Jt=Xe+"Origin",PC=function i(e,t){var n=this,r=this.target,s=r.style,o=r._gsap;if(e in ki&&s){if(this.tfm=this.tfm||{},e!=="transform")e=ni[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return n.tfm[a]=Ai(r,a)}):this.tfm[e]=o.x?o[e]:Ai(r,e),e===Jt&&(this.tfm.zOrigin=o.zOrigin);else return ni.transform.split(",").forEach(function(a){return i.call(n,a,t)});if(this.props.indexOf(Xe)>=0)return;o.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(Jt,t,"")),e=Xe}(s||t)&&this.props.push(e,t,s[e])},kS=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},DC=function(){var e=this.props,t=this.target,n=t.style,r=t._gsap,s,o;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?n[e[s]]=e[s+2]:n.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(Hd,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)r[o]=this.tfm[o];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=Gd(),(!s||!s.isStart)&&!n[Xe]&&(kS(n),r.zOrigin&&n[Jt]&&(n[Jt]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},OS=function(e,t){var n={target:e,props:[],revert:DC,save:PC};return e._gsap||en.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(r){return n.save(r)}),n},MS,bf=function(e,t){var n=tr.createElementNS?tr.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):tr.createElement(e);return n&&n.style?n:tr.createElement(e)},wn=function i(e,t,n){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(Hd,"-$1").toLowerCase())||r.getPropertyValue(t)||!n&&i(e,Bs(t)||t,1)||""},uy="O,Moz,ms,Ms,Webkit".split(","),Bs=function(e,t,n){var r=t||br,s=r.style,o=5;if(e in s&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(uy[o]+e in s););return o<0?null:(o===3?"ms":o>=0?uy[o]:"")+e},kf=function(){gC()&&window.document&&(oy=window,tr=oy.document,Rs=tr.documentElement,br=bf("div")||{style:{}},bf("div"),Xe=Bs(Xe),Jt=Xe+"Origin",br.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",MS=!!Bs("perspective"),Gd=en.core.reverting,Vd=1)},cy=function(e){var t=e.ownerSVGElement,n=bf("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=e.cloneNode(!0),s;r.style.display="block",n.appendChild(r),Rs.appendChild(n);try{s=r.getBBox()}catch{}return n.removeChild(r),Rs.removeChild(n),s},hy=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},FS=function(e){var t,n;try{t=e.getBBox()}catch{t=cy(e),n=1}return t&&(t.width||t.height)||n||(t=cy(e)),t&&!t.width&&!t.x&&!t.y?{x:+hy(e,["x","cx","x1"])||0,y:+hy(e,["y","cy","y1"])||0,width:0,height:0}:t},NS=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&FS(e))},Hr=function(e,t){if(t){var n=e.style,r;t in ki&&t!==Jt&&(t=Xe),n.removeProperty?(r=t.substr(0,2),(r==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(r==="--"?t:t.replace(Hd,"-$1").toLowerCase())):n.removeAttribute(t)}},nr=function(e,t,n,r,s,o){var a=new Zt(e._pt,t,n,0,1,o?bS:CS);return e._pt=a,a.b=r,a.e=s,e._props.push(n),a},fy={deg:1,rad:1,turn:1},wC={grid:1,flex:1},ar=function i(e,t,n,r){var s=parseFloat(n)||0,o=(n+"").trim().substr((s+"").length)||"px",a=br.style,l=yC.test(t),u=e.tagName.toLowerCase()==="svg",f=(u?"client":"offset")+(l?"Width":"Height"),d=100,m=r==="px",g=r==="%",y,T,E,x;if(r===o||!s||fy[r]||fy[o])return s;if(o!=="px"&&!m&&(s=i(e,t,n,"px")),x=e.getCTM&&NS(e),(g||o==="%")&&(ki[t]||~t.indexOf("adius")))return y=x?e.getBBox()[l?"width":"height"]:e[f],rt(g?s/y*d:s/100*y);if(a[l?"width":"height"]=d+(m?o:r),T=r!=="rem"&&~t.indexOf("adius")||r==="em"&&e.appendChild&&!u?e:e.parentNode,x&&(T=(e.ownerSVGElement||{}).parentNode),(!T||T===tr||!T.appendChild)&&(T=tr.body),E=T._gsap,E&&g&&E.width&&l&&E.time===ln.time&&!E.uncache)return rt(s/E.width*d);if(g&&(t==="height"||t==="width")){var R=e.style[t];e.style[t]=d+r,y=e[f],R?e.style[t]=R:Hr(e,t)}else(g||o==="%")&&!wC[wn(T,"display")]&&(a.position=wn(e,"position")),T===e&&(a.position="static"),T.appendChild(br),y=br[f],T.removeChild(br),a.position="absolute";return l&&g&&(E=Nr(T),E.time=ln.time,E.width=T[f]),rt(m?y*s/d:y&&s?d/y*s:0)},Ai=function(e,t,n,r){var s;return Vd||kf(),t in ni&&t!=="transform"&&(t=ni[t],~t.indexOf(",")&&(t=t.split(",")[0])),ki[t]&&t!=="transform"?(s=Zo(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:fu(wn(e,Jt))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=hu[t]&&hu[t](e,t,n)||wn(e,t)||JE(e,t)||(t==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?ar(e,t,s,n)+n:s},CC=function(e,t,n,r){if(!n||n==="none"){var s=Bs(t,e,1),o=s&&wn(e,s,1);o&&o!==n?(t=s,n=o):t==="borderColor"&&(n=wn(e,"borderTopColor"))}var a=new Zt(this._pt,e.style,t,0,1,PS),l=0,u=0,f,d,m,g,y,T,E,x,R,L,P,I;if(a.b=n,a.e=r,n+="",r+="",r.substring(0,6)==="var(--"&&(r=wn(e,r.substring(4,r.indexOf(")")))),r==="auto"&&(T=e.style[t],e.style[t]=r,r=wn(e,t)||r,T?e.style[t]=T:Hr(e,t)),f=[n,r],vS(f),n=f[0],r=f[1],m=n.match(gs)||[],I=r.match(gs)||[],I.length){for(;d=gs.exec(r);)E=d[0],R=r.substring(l,d.index),y?y=(y+1)%5:(R.substr(-5)==="rgba("||R.substr(-5)==="hsla(")&&(y=1),E!==(T=m[u++]||"")&&(g=parseFloat(T)||0,P=T.substr((g+"").length),E.charAt(1)==="="&&(E=Ls(g,E)+P),x=parseFloat(E),L=E.substr((x+"").length),l=gs.lastIndex-L.length,L||(L=L||hn.units[t]||P,l===r.length&&(r+=L,a.e+=L)),P!==L&&(g=ar(e,t,T,L)||0),a._pt={_next:a._pt,p:R||u===1?R:",",s:g,c:x-g,m:y&&y<4||t==="zIndex"?Math.round:0});a.c=l<r.length?r.substring(l,r.length):""}else a.r=t==="display"&&r==="none"?bS:CS;return jE.test(r)&&(a.e=0),this._pt=a,a},dy={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},bC=function(e){var t=e.split(" "),n=t[0],r=t[1]||"50%";return(n==="top"||n==="bottom"||r==="left"||r==="right")&&(e=n,n=r,r=e),t[0]=dy[n]||n,t[1]=dy[r]||r,t.join(" ")},kC=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,r=n.style,s=t.u,o=n._gsap,a,l,u;if(s==="all"||s===!0)r.cssText="",l=1;else for(s=s.split(","),u=s.length;--u>-1;)a=s[u],ki[a]&&(l=1,a=a==="transformOrigin"?Jt:Xe),Hr(n,a);l&&(Hr(n,Xe),o&&(o.svg&&n.removeAttribute("transform"),r.scale=r.rotate=r.translate="none",Zo(n,1),o.uncache=1,kS(r)))}},hu={clearProps:function(e,t,n,r,s){if(s.data!=="isFromStart"){var o=e._pt=new Zt(e._pt,t,n,0,0,kC);return o.u=r,o.pr=-10,o.tween=s,e._props.push(n),1}}},Qo=[1,0,0,1,0,0],BS={},US=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},my=function(e){var t=wn(e,Xe);return US(t)?Qo:t.substr(7).match(WE).map(rt)},Kd=function(e,t){var n=e._gsap||Nr(e),r=e.style,s=my(e),o,a,l,u;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?Qo:s):(s===Qo&&!e.offsetParent&&e!==Rs&&!n.svg&&(l=r.display,r.display="block",o=e.parentNode,(!o||!e.offsetParent&&!e.getBoundingClientRect().width)&&(u=1,a=e.nextElementSibling,Rs.appendChild(e)),s=my(e),l?r.display=l:Hr(e,"display"),u&&(a?o.insertBefore(e,a):o?o.appendChild(e):Rs.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Of=function(e,t,n,r,s,o){var a=e._gsap,l=s||Kd(e,!0),u=a.xOrigin||0,f=a.yOrigin||0,d=a.xOffset||0,m=a.yOffset||0,g=l[0],y=l[1],T=l[2],E=l[3],x=l[4],R=l[5],L=t.split(" "),P=parseFloat(L[0])||0,I=parseFloat(L[1])||0,C,D,w,k;n?l!==Qo&&(D=g*E-y*T)&&(w=P*(E/D)+I*(-T/D)+(T*R-E*x)/D,k=P*(-y/D)+I*(g/D)-(g*R-y*x)/D,P=w,I=k):(C=FS(e),P=C.x+(~L[0].indexOf("%")?P/100*C.width:P),I=C.y+(~(L[1]||L[0]).indexOf("%")?I/100*C.height:I)),r||r!==!1&&a.smooth?(x=P-u,R=I-f,a.xOffset=d+(x*g+R*T)-x,a.yOffset=m+(x*y+R*E)-R):a.xOffset=a.yOffset=0,a.xOrigin=P,a.yOrigin=I,a.smooth=!!r,a.origin=t,a.originIsAbsolute=!!n,e.style[Jt]="0px 0px",o&&(nr(o,a,"xOrigin",u,P),nr(o,a,"yOrigin",f,I),nr(o,a,"xOffset",d,a.xOffset),nr(o,a,"yOffset",m,a.yOffset)),e.setAttribute("data-svg-origin",P+" "+I)},Zo=function(e,t){var n=e._gsap||new xS(e);if("x"in n&&!t&&!n.uncache)return n;var r=e.style,s=n.scaleX<0,o="px",a="deg",l=getComputedStyle(e),u=wn(e,Jt)||"0",f,d,m,g,y,T,E,x,R,L,P,I,C,D,w,k,O,W,q,ie,te,J,Z,Q,G,K,z,M,V,ne,re,oe;return f=d=m=T=E=x=R=L=P=0,g=y=1,n.svg=!!(e.getCTM&&NS(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(r[Xe]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Xe]!=="none"?l[Xe]:"")),r.scale=r.rotate=r.translate="none"),D=Kd(e,n.svg),n.svg&&(n.uncache?(G=e.getBBox(),u=n.xOrigin-G.x+"px "+(n.yOrigin-G.y)+"px",Q=""):Q=!t&&e.getAttribute("data-svg-origin"),Of(e,Q||u,!!Q||n.originIsAbsolute,n.smooth!==!1,D)),I=n.xOrigin||0,C=n.yOrigin||0,D!==Qo&&(W=D[0],q=D[1],ie=D[2],te=D[3],f=J=D[4],d=Z=D[5],D.length===6?(g=Math.sqrt(W*W+q*q),y=Math.sqrt(te*te+ie*ie),T=W||q?ms(q,W)*Pr:0,R=ie||te?ms(ie,te)*Pr+T:0,R&&(y*=Math.abs(Math.cos(R*Is))),n.svg&&(f-=I-(I*W+C*ie),d-=C-(I*q+C*te))):(oe=D[6],ne=D[7],z=D[8],M=D[9],V=D[10],re=D[11],f=D[12],d=D[13],m=D[14],w=ms(oe,V),E=w*Pr,w&&(k=Math.cos(-w),O=Math.sin(-w),Q=J*k+z*O,G=Z*k+M*O,K=oe*k+V*O,z=J*-O+z*k,M=Z*-O+M*k,V=oe*-O+V*k,re=ne*-O+re*k,J=Q,Z=G,oe=K),w=ms(-ie,V),x=w*Pr,w&&(k=Math.cos(-w),O=Math.sin(-w),Q=W*k-z*O,G=q*k-M*O,K=ie*k-V*O,re=te*O+re*k,W=Q,q=G,ie=K),w=ms(q,W),T=w*Pr,w&&(k=Math.cos(w),O=Math.sin(w),Q=W*k+q*O,G=J*k+Z*O,q=q*k-W*O,Z=Z*k-J*O,W=Q,J=G),E&&Math.abs(E)+Math.abs(T)>359.9&&(E=T=0,x=180-x),g=rt(Math.sqrt(W*W+q*q+ie*ie)),y=rt(Math.sqrt(Z*Z+oe*oe)),w=ms(J,Z),R=Math.abs(w)>2e-4?w*Pr:0,P=re?1/(re<0?-re:re):0),n.svg&&(Q=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!US(wn(e,Xe)),Q&&e.setAttribute("transform",Q))),Math.abs(R)>90&&Math.abs(R)<270&&(s?(g*=-1,R+=T<=0?180:-180,T+=T<=0?180:-180):(y*=-1,R+=R<=0?180:-180)),t=t||n.uncache,n.x=f-((n.xPercent=f&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-f)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+o,n.y=d-((n.yPercent=d&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-d)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+o,n.z=m+o,n.scaleX=rt(g),n.scaleY=rt(y),n.rotation=rt(T)+a,n.rotationX=rt(E)+a,n.rotationY=rt(x)+a,n.skewX=R+a,n.skewY=L+a,n.transformPerspective=P+o,(n.zOrigin=parseFloat(u.split(" ")[2])||!t&&n.zOrigin||0)&&(r[Jt]=fu(u)),n.xOffset=n.yOffset=0,n.force3D=hn.force3D,n.renderTransform=n.svg?MC:MS?$S:OC,n.uncache=0,n},fu=function(e){return(e=e.split(" "))[0]+" "+e[1]},Mh=function(e,t,n){var r=kt(t);return rt(parseFloat(t)+parseFloat(ar(e,"x",n+"px",r)))+r},OC=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,$S(e,t)},Ar="0deg",yo="0px",Lr=") ",$S=function(e,t){var n=t||this,r=n.xPercent,s=n.yPercent,o=n.x,a=n.y,l=n.z,u=n.rotation,f=n.rotationY,d=n.rotationX,m=n.skewX,g=n.skewY,y=n.scaleX,T=n.scaleY,E=n.transformPerspective,x=n.force3D,R=n.target,L=n.zOrigin,P="",I=x==="auto"&&e&&e!==1||x===!0;if(L&&(d!==Ar||f!==Ar)){var C=parseFloat(f)*Is,D=Math.sin(C),w=Math.cos(C),k;C=parseFloat(d)*Is,k=Math.cos(C),o=Mh(R,o,D*k*-L),a=Mh(R,a,-Math.sin(C)*-L),l=Mh(R,l,w*k*-L+L)}E!==yo&&(P+="perspective("+E+Lr),(r||s)&&(P+="translate("+r+"%, "+s+"%) "),(I||o!==yo||a!==yo||l!==yo)&&(P+=l!==yo||I?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+Lr),u!==Ar&&(P+="rotate("+u+Lr),f!==Ar&&(P+="rotateY("+f+Lr),d!==Ar&&(P+="rotateX("+d+Lr),(m!==Ar||g!==Ar)&&(P+="skew("+m+", "+g+Lr),(y!==1||T!==1)&&(P+="scale("+y+", "+T+Lr),R.style[Xe]=P||"translate(0, 0)"},MC=function(e,t){var n=t||this,r=n.xPercent,s=n.yPercent,o=n.x,a=n.y,l=n.rotation,u=n.skewX,f=n.skewY,d=n.scaleX,m=n.scaleY,g=n.target,y=n.xOrigin,T=n.yOrigin,E=n.xOffset,x=n.yOffset,R=n.forceCSS,L=parseFloat(o),P=parseFloat(a),I,C,D,w,k;l=parseFloat(l),u=parseFloat(u),f=parseFloat(f),f&&(f=parseFloat(f),u+=f,l+=f),l||u?(l*=Is,u*=Is,I=Math.cos(l)*d,C=Math.sin(l)*d,D=Math.sin(l-u)*-m,w=Math.cos(l-u)*m,u&&(f*=Is,k=Math.tan(u-f),k=Math.sqrt(1+k*k),D*=k,w*=k,f&&(k=Math.tan(f),k=Math.sqrt(1+k*k),I*=k,C*=k)),I=rt(I),C=rt(C),D=rt(D),w=rt(w)):(I=d,w=m,C=D=0),(L&&!~(o+"").indexOf("px")||P&&!~(a+"").indexOf("px"))&&(L=ar(g,"x",o,"px"),P=ar(g,"y",a,"px")),(y||T||E||x)&&(L=rt(L+y-(y*I+T*D)+E),P=rt(P+T-(y*C+T*w)+x)),(r||s)&&(k=g.getBBox(),L=rt(L+r/100*k.width),P=rt(P+s/100*k.height)),k="matrix("+I+","+C+","+D+","+w+","+L+","+P+")",g.setAttribute("transform",k),R&&(g.style[Xe]=k)},FC=function(e,t,n,r,s){var o=360,a=Et(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?Pr:1),u=l-r,f=r+u+"deg",d,m;return a&&(d=s.split("_")[1],d==="short"&&(u%=o,u!==u%(o/2)&&(u+=u<0?o:-360)),d==="cw"&&u<0?u=(u+o*ly)%o-~~(u/o)*o:d==="ccw"&&u>0&&(u=(u-o*ly)%o-~~(u/o)*o)),e._pt=m=new Zt(e._pt,t,n,r,u,TC),m.e=f,m.u="deg",e._props.push(n),m},py=function(e,t){for(var n in t)e[n]=t[n];return e},NC=function(e,t,n){var r=py({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=n.style,a,l,u,f,d,m,g,y;r.svg?(u=n.getAttribute("transform"),n.setAttribute("transform",""),o[Xe]=t,a=Zo(n,1),Hr(n,Xe),n.setAttribute("transform",u)):(u=getComputedStyle(n)[Xe],o[Xe]=t,a=Zo(n,1),o[Xe]=u);for(l in ki)u=r[l],f=a[l],u!==f&&s.indexOf(l)<0&&(g=kt(u),y=kt(f),d=g!==y?ar(n,l,u,y):parseFloat(u),m=parseFloat(f),e._pt=new Zt(e._pt,a,l,d,m-d,Cf),e._pt.u=y||0,e._props.push(l));py(a,r)};Qt("padding,margin,Width,Radius",function(i,e){var t="Top",n="Right",r="Bottom",s="Left",o=(e<3?[t,n,r,s]:[t+s,t+n,r+n,r+s]).map(function(a){return e<2?i+a:"border"+a+i});hu[e>1?"border"+i:i]=function(a,l,u,f,d){var m,g;if(arguments.length<4)return m=o.map(function(y){return Ai(a,y,u)}),g=m.join(" "),g.split(m[0]).length===5?m[0]:g;m=(f+"").split(" "),g={},o.forEach(function(y,T){return g[y]=m[T]=m[T]||m[(T-1)/2|0]}),a.init(l,g,d)}});var VS={name:"css",register:kf,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,s){var o=this._props,a=e.style,l=n.vars.startAt,u,f,d,m,g,y,T,E,x,R,L,P,I,C,D,w;Vd||kf(),this.styles=this.styles||OS(e),w=this.styles.props,this.tween=n;for(T in t)if(T!=="autoRound"&&(f=t[T],!(an[T]&&_S(T,t,n,r,e,s)))){if(g=typeof f,y=hu[T],g==="function"&&(f=f.call(n,r,e,s),g=typeof f),g==="string"&&~f.indexOf("random(")&&(f=Yo(f)),y)y(this,e,T,f,n)&&(D=1);else if(T.substr(0,2)==="--")u=(getComputedStyle(e).getPropertyValue(T)+"").trim(),f+="",rr.lastIndex=0,rr.test(u)||(E=kt(u),x=kt(f)),x?E!==x&&(u=ar(e,T,u,x)+x):E&&(f+=E),this.add(a,"setProperty",u,f,r,s,0,0,T),o.push(T),w.push(T,0,a[T]);else if(g!=="undefined"){if(l&&T in l?(u=typeof l[T]=="function"?l[T].call(n,r,e,s):l[T],Et(u)&&~u.indexOf("random(")&&(u=Yo(u)),kt(u+"")||u==="auto"||(u+=hn.units[T]||kt(Ai(e,T))||""),(u+"").charAt(1)==="="&&(u=Ai(e,T))):u=Ai(e,T),m=parseFloat(u),R=g==="string"&&f.charAt(1)==="="&&f.substr(0,2),R&&(f=f.substr(2)),d=parseFloat(f),T in ni&&(T==="autoAlpha"&&(m===1&&Ai(e,"visibility")==="hidden"&&d&&(m=0),w.push("visibility",0,a.visibility),nr(this,a,"visibility",m?"inherit":"hidden",d?"inherit":"hidden",!d)),T!=="scale"&&T!=="transform"&&(T=ni[T],~T.indexOf(",")&&(T=T.split(",")[0]))),L=T in ki,L){if(this.styles.save(T),g==="string"&&f.substring(0,6)==="var(--"&&(f=wn(e,f.substring(4,f.indexOf(")"))),d=parseFloat(f)),P||(I=e._gsap,I.renderTransform&&!t.parseTransform||Zo(e,t.parseTransform),C=t.smoothOrigin!==!1&&I.smooth,P=this._pt=new Zt(this._pt,a,Xe,0,1,I.renderTransform,I,0,-1),P.dep=1),T==="scale")this._pt=new Zt(this._pt,I,"scaleY",I.scaleY,(R?Ls(I.scaleY,R+d):d)-I.scaleY||0,Cf),this._pt.u=0,o.push("scaleY",T),T+="X";else if(T==="transformOrigin"){w.push(Jt,0,a[Jt]),f=bC(f),I.svg?Of(e,f,0,C,0,this):(x=parseFloat(f.split(" ")[2])||0,x!==I.zOrigin&&nr(this,I,"zOrigin",I.zOrigin,x),nr(this,a,T,fu(u),fu(f)));continue}else if(T==="svgOrigin"){Of(e,f,1,C,0,this);continue}else if(T in BS){FC(this,I,T,m,R?Ls(m,R+f):f);continue}else if(T==="smoothOrigin"){nr(this,I,"smooth",I.smooth,f);continue}else if(T==="force3D"){I[T]=f;continue}else if(T==="transform"){NC(this,f,e);continue}}else T in a||(T=Bs(T)||T);if(L||(d||d===0)&&(m||m===0)&&!vC.test(f)&&T in a)E=(u+"").substr((m+"").length),d||(d=0),x=kt(f)||(T in hn.units?hn.units[T]:E),E!==x&&(m=ar(e,T,u,x)),this._pt=new Zt(this._pt,L?I:a,T,m,(R?Ls(m,R+d):d)-m,!L&&(x==="px"||T==="zIndex")&&t.autoRound!==!1?SC:Cf),this._pt.u=x||0,E!==x&&x!=="%"&&(this._pt.b=u,this._pt.r=EC);else if(T in a)CC.call(this,e,T,u,R?R+f:f);else if(T in e)this.add(e,T,u||e[T],R?R+f:f,r,s);else if(T!=="parseTransform"){Cd(T,f);continue}L||(T in a?w.push(T,0,a[T]):typeof e[T]=="function"?w.push(T,2,e[T]()):w.push(T,1,u||e[T])),o.push(T)}}D&&DS(this)},render:function(e,t){if(t.tween._time||!Gd())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Ai,aliases:ni,getSetter:function(e,t,n){var r=ni[t];return r&&r.indexOf(",")<0&&(t=r),t in ki&&t!==Jt&&(e._gsap.x||Ai(e,"x"))?n&&ay===n?t==="scale"?LC:AC:(ay=n||{})&&(t==="scale"?RC:IC):e.style&&!Pd(e.style[t])?xC:~t.indexOf("-")?_C:Ud(e,t)},core:{_removeProperty:Hr,_getMatrix:Kd}};en.utils.checkPrefix=Bs;en.core.getStyleSaver=OS;(function(i,e,t,n){var r=Qt(i+","+e+","+t,function(s){ki[s]=1});Qt(e,function(s){hn.units[s]="deg",BS[s]=1}),ni[r[13]]=i+","+e,Qt(n,function(s){var o=s.split(":");ni[o[1]]=r[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Qt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){hn.units[i]="px"});en.registerPlugin(VS);var GS=en.registerPlugin(VS)||en;GS.core.Tween;/*!
 * @gsap/react 2.1.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let gy=typeof document<"u"?N.useLayoutEffect:N.useEffect,yy=i=>i&&!Array.isArray(i)&&typeof i=="object",Il=[],BC={},HS=GS;const KS=(i,e=Il)=>{let t=BC;yy(i)?(t=i,i=null,e="dependencies"in t?t.dependencies:Il):yy(e)&&(t=e,e="dependencies"in t?t.dependencies:Il),i&&typeof i!="function"&&console.warn("First parameter must be a function or config object");const{scope:n,revertOnUpdate:r}=t,s=N.useRef(!1),o=N.useRef(HS.context(()=>{},n)),a=N.useRef(u=>o.current.add(null,u)),l=e&&e.length&&!r;return l&&gy(()=>(s.current=!0,()=>o.current.revert()),Il),gy(()=>{if(i&&o.current.add(i,n),!l||!s.current)return()=>o.current.revert()},e),{context:o.current,contextSafe:a.current}};KS.register=i=>{HS=i};KS.headless=!0;const zS=N.createContext({});function Ou(i){const e=N.useRef(null);return e.current===null&&(e.current=i()),e.current}const zd=N.createContext(null),Wd=N.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function UC(i=!0){const e=N.useContext(zd);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,s=N.useId();N.useEffect(()=>{i&&r(s)},[i]);const o=N.useCallback(()=>i&&n&&n(s),[s,n,i]);return!t&&n?[!1,o]:[!0]}const jd=typeof window<"u",Yd=jd?N.useLayoutEffect:N.useEffect,Vt=i=>i;let $C=Vt,WS=Vt;function qd(i){let e;return()=>(e===void 0&&(e=i()),e)}const Kr=(i,e,t)=>{const n=e-i;return n===0?1:(t-i)/n},Pi=i=>i*1e3,Di=i=>i/1e3,VC={useManualTiming:!1};function GC(i){let e=new Set,t=new Set,n=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(u){s.has(u)&&(l.schedule(u),i()),u(o)}const l={schedule:(u,f=!1,d=!1)=>{const g=d&&n?e:t;return f&&s.add(u),g.has(u)||g.add(u),u},cancel:u=>{t.delete(u),s.delete(u)},process:u=>{if(o=u,n){r=!0;return}n=!0,[e,t]=[t,e],e.forEach(a),e.clear(),n=!1,r&&(r=!1,l.process(u))}};return l}const Pl=["read","resolveKeyframes","update","preRender","render","postRender"],HC=40;function jS(i,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,o=Pl.reduce((x,R)=>(x[R]=GC(s),x),{}),{read:a,resolveKeyframes:l,update:u,preRender:f,render:d,postRender:m}=o,g=()=>{const x=performance.now();t=!1,r.delta=n?1e3/60:Math.max(Math.min(x-r.timestamp,HC),1),r.timestamp=x,r.isProcessing=!0,a.process(r),l.process(r),u.process(r),f.process(r),d.process(r),m.process(r),r.isProcessing=!1,t&&e&&(n=!1,i(g))},y=()=>{t=!0,n=!0,r.isProcessing||i(g)};return{schedule:Pl.reduce((x,R)=>{const L=o[R];return x[R]=(P,I=!1,C=!1)=>(t||y(),L.schedule(P,I,C)),x},{}),cancel:x=>{for(let R=0;R<Pl.length;R++)o[Pl[R]].cancel(x)},state:r,steps:o}}const{schedule:Fe,cancel:Un,state:vt,steps:Fh}=jS(typeof requestAnimationFrame<"u"?requestAnimationFrame:Vt,!0),YS=N.createContext({strict:!1}),vy={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Us={};for(const i in vy)Us[i]={isEnabled:e=>vy[i].some(t=>!!e[t])};function KC(i){for(const e in i)Us[e]={...Us[e],...i[e]}}const zC=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function du(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||zC.has(i)}let qS=i=>!du(i);function WC(i){i&&(qS=e=>e.startsWith("on")?!du(e):i(e))}try{WC(require("@emotion/is-prop-valid").default)}catch{}function jC(i,e,t){const n={};for(const r in i)r==="values"&&typeof i.values=="object"||(qS(r)||t===!0&&du(r)||!e&&!du(r)||i.draggable&&r.startsWith("onDrag"))&&(n[r]=i[r]);return n}function YC(i){if(typeof Proxy>"u")return i;const e=new Map,t=(...n)=>i(...n);return new Proxy(t,{get:(n,r)=>r==="create"?i:(e.has(r)||e.set(r,i(r)),e.get(r))})}const Mu=N.createContext({});function Jo(i){return typeof i=="string"||Array.isArray(i)}function Fu(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}const Xd=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Qd=["initial",...Xd];function Nu(i){return Fu(i.animate)||Qd.some(e=>Jo(i[e]))}function XS(i){return!!(Nu(i)||i.variants)}function qC(i,e){if(Nu(i)){const{initial:t,animate:n}=i;return{initial:t===!1||Jo(t)?t:void 0,animate:Jo(n)?n:void 0}}return i.inherit!==!1?e:{}}function XC(i){const{initial:e,animate:t}=qC(i,N.useContext(Mu));return N.useMemo(()=>({initial:e,animate:t}),[Ty(e),Ty(t)])}function Ty(i){return Array.isArray(i)?i.join(" "):i}const QC=Symbol.for("motionComponentSymbol");function vs(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function ZC(i,e,t){return N.useCallback(n=>{n&&i.onMount&&i.onMount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):vs(t)&&(t.current=n))},[e])}const Zd=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),JC="framerAppearId",QS="data-"+Zd(JC),{schedule:Jd}=jS(queueMicrotask,!1),ZS=N.createContext({});function eb(i,e,t,n,r){var s,o;const{visualElement:a}=N.useContext(Mu),l=N.useContext(YS),u=N.useContext(zd),f=N.useContext(Wd).reducedMotion,d=N.useRef(null);n=n||l.renderer,!d.current&&n&&(d.current=n(i,{visualState:e,parent:a,props:t,presenceContext:u,blockInitialAnimation:u?u.initial===!1:!1,reducedMotionConfig:f}));const m=d.current,g=N.useContext(ZS);m&&!m.projection&&r&&(m.type==="html"||m.type==="svg")&&tb(d.current,t,r,g);const y=N.useRef(!1);N.useInsertionEffect(()=>{m&&y.current&&m.update(t,u)});const T=t[QS],E=N.useRef(!!T&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,T))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,T)));return Yd(()=>{m&&(y.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Jd.render(m.render),E.current&&m.animationState&&m.animationState.animateChanges())}),N.useEffect(()=>{m&&(!E.current&&m.animationState&&m.animationState.animateChanges(),E.current&&(queueMicrotask(()=>{var x;(x=window.MotionHandoffMarkAsComplete)===null||x===void 0||x.call(window,T)}),E.current=!1))}),m}function tb(i,e,t,n){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:u}=e;i.projection=new t(i.latestValues,e["data-framer-portal-id"]?void 0:JS(i.parent)),i.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!o||a&&vs(a),visualElement:i,animationType:typeof s=="string"?s:"both",initialPromotionConfig:n,layoutScroll:l,layoutRoot:u})}function JS(i){if(i)return i.options.allowProjection!==!1?i.projection:JS(i.parent)}function nb({preloadedFeatures:i,createVisualElement:e,useRender:t,useVisualState:n,Component:r}){var s,o;i&&KC(i);function a(u,f){let d;const m={...N.useContext(Wd),...u,layoutId:ib(u)},{isStatic:g}=m,y=XC(u),T=n(u,g);if(!g&&jd){rb();const E=sb(m);d=E.MeasureLayout,y.visualElement=eb(r,T,m,e,E.ProjectionNode)}return Xh.jsxs(Mu.Provider,{value:y,children:[d&&y.visualElement?Xh.jsx(d,{visualElement:y.visualElement,...m}):null,t(r,u,ZC(T,y.visualElement,f),T,g,y.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(s=r.displayName)!==null&&s!==void 0?s:r.name)!==null&&o!==void 0?o:""})`}`;const l=N.forwardRef(a);return l[QC]=r,l}function ib({layoutId:i}){const e=N.useContext(zS).id;return e&&i!==void 0?e+"-"+i:i}function rb(i,e){N.useContext(YS).strict}function sb(i){const{drag:e,layout:t}=Us;if(!e&&!t)return{};const n={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(i)||t!=null&&t.isEnabled(i)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}const ob=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function em(i){return typeof i!="string"||i.includes("-")?!1:!!(ob.indexOf(i)>-1||/[A-Z]/u.test(i))}function Ey(i){const e=[{},{}];return i==null||i.values.forEach((t,n)=>{e[0][n]=t.get(),e[1][n]=t.getVelocity()}),e}function tm(i,e,t,n){if(typeof e=="function"){const[r,s]=Ey(n);e=e(t!==void 0?t:i.custom,r,s)}if(typeof e=="string"&&(e=i.variants&&i.variants[e]),typeof e=="function"){const[r,s]=Ey(n);e=e(t!==void 0?t:i.custom,r,s)}return e}const Mf=i=>Array.isArray(i),ab=i=>!!(i&&typeof i=="object"&&i.mix&&i.toValue),lb=i=>Mf(i)?i[i.length-1]||0:i,Mt=i=>!!(i&&i.getVelocity);function Hl(i){const e=Mt(i)?i.get():i;return ab(e)?e.toValue():e}function ub({scrapeMotionValuesFromProps:i,createRenderState:e,onUpdate:t},n,r,s){const o={latestValues:cb(n,r,s,i),renderState:e()};return t&&(o.onMount=a=>t({props:n,current:a,...o}),o.onUpdate=a=>t(a)),o}const ex=i=>(e,t)=>{const n=N.useContext(Mu),r=N.useContext(zd),s=()=>ub(i,e,n,r);return t?s():Ou(s)};function cb(i,e,t,n){const r={},s=n(i,{});for(const m in s)r[m]=Hl(s[m]);let{initial:o,animate:a}=i;const l=Nu(i),u=XS(i);e&&u&&!l&&i.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let f=t?t.initial===!1:!1;f=f||o===!1;const d=f?a:o;if(d&&typeof d!="boolean"&&!Fu(d)){const m=Array.isArray(d)?d:[d];for(let g=0;g<m.length;g++){const y=tm(i,m[g]);if(y){const{transitionEnd:T,transition:E,...x}=y;for(const R in x){let L=x[R];if(Array.isArray(L)){const P=f?L.length-1:0;L=L[P]}L!==null&&(r[R]=L)}for(const R in T)r[R]=T[R]}}}return r}const Gs=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Yr=new Set(Gs),tx=i=>e=>typeof e=="string"&&e.startsWith(i),nx=tx("--"),hb=tx("var(--"),nm=i=>hb(i)?fb.test(i.split("/*")[0].trim()):!1,fb=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ix=(i,e)=>e&&typeof i=="number"?e.transform(i):i,ui=(i,e,t)=>t>e?e:t<i?i:t,Hs={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},ea={...Hs,transform:i=>ui(0,1,i)},Dl={...Hs,default:1},aa=i=>({test:e=>typeof e=="string"&&e.endsWith(i)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${i}`}),Xi=aa("deg"),si=aa("%"),ye=aa("px"),db=aa("vh"),mb=aa("vw"),Sy={...si,parse:i=>si.parse(i)/100,transform:i=>si.transform(i*100)},pb={borderWidth:ye,borderTopWidth:ye,borderRightWidth:ye,borderBottomWidth:ye,borderLeftWidth:ye,borderRadius:ye,radius:ye,borderTopLeftRadius:ye,borderTopRightRadius:ye,borderBottomRightRadius:ye,borderBottomLeftRadius:ye,width:ye,maxWidth:ye,height:ye,maxHeight:ye,top:ye,right:ye,bottom:ye,left:ye,padding:ye,paddingTop:ye,paddingRight:ye,paddingBottom:ye,paddingLeft:ye,margin:ye,marginTop:ye,marginRight:ye,marginBottom:ye,marginLeft:ye,backgroundPositionX:ye,backgroundPositionY:ye},gb={rotate:Xi,rotateX:Xi,rotateY:Xi,rotateZ:Xi,scale:Dl,scaleX:Dl,scaleY:Dl,scaleZ:Dl,skew:Xi,skewX:Xi,skewY:Xi,distance:ye,translateX:ye,translateY:ye,translateZ:ye,x:ye,y:ye,z:ye,perspective:ye,transformPerspective:ye,opacity:ea,originX:Sy,originY:Sy,originZ:ye},xy={...Hs,transform:Math.round},im={...pb,...gb,zIndex:xy,size:ye,fillOpacity:ea,strokeOpacity:ea,numOctaves:xy},yb={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},vb=Gs.length;function Tb(i,e,t){let n="",r=!0;for(let s=0;s<vb;s++){const o=Gs[s],a=i[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const u=ix(a,im[o]);if(!l){r=!1;const f=yb[o]||o;n+=`${f}(${u}) `}t&&(e[o]=u)}}return n=n.trim(),t?n=t(e,r?"":n):r&&(n="none"),n}function rm(i,e,t){const{style:n,vars:r,transformOrigin:s}=i;let o=!1,a=!1;for(const l in e){const u=e[l];if(Yr.has(l)){o=!0;continue}else if(nx(l)){r[l]=u;continue}else{const f=ix(u,im[l]);l.startsWith("origin")?(a=!0,s[l]=f):n[l]=f}}if(e.transform||(o||t?n.transform=Tb(e,i.transform,t):n.transform&&(n.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:f=0}=s;n.transformOrigin=`${l} ${u} ${f}`}}const Eb={offset:"stroke-dashoffset",array:"stroke-dasharray"},Sb={offset:"strokeDashoffset",array:"strokeDasharray"};function xb(i,e,t=1,n=0,r=!0){i.pathLength=1;const s=r?Eb:Sb;i[s.offset]=ye.transform(-n);const o=ye.transform(e),a=ye.transform(t);i[s.array]=`${o} ${a}`}function _y(i,e,t){return typeof i=="string"?i:ye.transform(e+t*i)}function _b(i,e,t){const n=_y(e,i.x,i.width),r=_y(t,i.y,i.height);return`${n} ${r}`}function sm(i,{attrX:e,attrY:t,attrScale:n,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...u},f,d){if(rm(i,u,d),f){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:m,style:g,dimensions:y}=i;m.transform&&(y&&(g.transform=m.transform),delete m.transform),y&&(r!==void 0||s!==void 0||g.transform)&&(g.transformOrigin=_b(y,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(m.x=e),t!==void 0&&(m.y=t),n!==void 0&&(m.scale=n),o!==void 0&&xb(m,o,a,l,!1)}const om=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),rx=()=>({...om(),attrs:{}}),am=i=>typeof i=="string"&&i.toLowerCase()==="svg";function sx(i,{style:e,vars:t},n,r){Object.assign(i.style,e,r&&r.getProjectionStyles(n));for(const s in t)i.style.setProperty(s,t[s])}const ox=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ax(i,e,t,n){sx(i,e,void 0,n);for(const r in e.attrs)i.setAttribute(ox.has(r)?r:Zd(r),e.attrs[r])}const mu={};function Ab(i){Object.assign(mu,i)}function lx(i,{layout:e,layoutId:t}){return Yr.has(i)||i.startsWith("origin")||(e||t!==void 0)&&(!!mu[i]||i==="opacity")}function lm(i,e,t){var n;const{style:r}=i,s={};for(const o in r)(Mt(r[o])||e.style&&Mt(e.style[o])||lx(o,i)||((n=t==null?void 0:t.getValue(o))===null||n===void 0?void 0:n.liveStyle)!==void 0)&&(s[o]=r[o]);return s}function ux(i,e,t){const n=lm(i,e,t);for(const r in i)if(Mt(i[r])||Mt(e[r])){const s=Gs.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[s]=i[r]}return n}function Lb(i,e){try{e.dimensions=typeof i.getBBox=="function"?i.getBBox():i.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Ay=["x","y","width","height","cx","cy","r"],Rb={useVisualState:ex({scrapeMotionValuesFromProps:ux,createRenderState:rx,onUpdate:({props:i,prevProps:e,current:t,renderState:n,latestValues:r})=>{if(!t)return;let s=!!i.drag;if(!s){for(const a in r)if(Yr.has(a)){s=!0;break}}if(!s)return;let o=!e;if(e)for(let a=0;a<Ay.length;a++){const l=Ay[a];i[l]!==e[l]&&(o=!0)}o&&Fe.read(()=>{Lb(t,n),Fe.render(()=>{sm(n,r,am(t.tagName),i.transformTemplate),ax(t,n)})})}})},Ib={useVisualState:ex({scrapeMotionValuesFromProps:lm,createRenderState:om})};function cx(i,e,t){for(const n in e)!Mt(e[n])&&!lx(n,t)&&(i[n]=e[n])}function Pb({transformTemplate:i},e){return N.useMemo(()=>{const t=om();return rm(t,e,i),Object.assign({},t.vars,t.style)},[e])}function Db(i,e){const t=i.style||{},n={};return cx(n,t,i),Object.assign(n,Pb(i,e)),n}function wb(i,e){const t={},n=Db(i,e);return i.drag&&i.dragListener!==!1&&(t.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(t.tabIndex=0),t.style=n,t}function Cb(i,e,t,n){const r=N.useMemo(()=>{const s=rx();return sm(s,e,am(n),i.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(i.style){const s={};cx(s,i.style,i),r.style={...s,...r.style}}return r}function bb(i=!1){return(t,n,r,{latestValues:s},o)=>{const l=(em(t)?Cb:wb)(n,s,o,t),u=jC(n,typeof t=="string",i),f=t!==N.Fragment?{...u,...l,ref:r}:{},{children:d}=n,m=N.useMemo(()=>Mt(d)?d.get():d,[d]);return N.createElement(t,{...f,children:m})}}function kb(i,e){return function(n,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...em(n)?Rb:Ib,preloadedFeatures:i,useRender:bb(r),createVisualElement:e,Component:n};return nb(o)}}function hx(i,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==i.length)return!1;for(let n=0;n<t;n++)if(e[n]!==i[n])return!1;return!0}function Bu(i,e,t){const n=i.getProps();return tm(n,e,t!==void 0?t:n.custom,i)}const fx=qd(()=>window.ScrollTimeline!==void 0);class Ob{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let n=0;n<this.animations.length;n++)this.animations[n][e]=t}attachTimeline(e,t){const n=this.animations.map(r=>{if(fx()&&r.attachTimeline)return r.attachTimeline(e);if(typeof t=="function")return t(r)});return()=>{n.forEach((r,s)=>{r&&r(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Mb extends Ob{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function um(i,e){return i?i[e]||i.default||i:void 0}const Ff=2e4;function dx(i){let e=0;const t=50;let n=i.next(e);for(;!n.done&&e<Ff;)e+=t,n=i.next(e);return e>=Ff?1/0:e}function cm(i){return typeof i=="function"}function Ly(i,e){i.timeline=e,i.onfinish=null}const hm=i=>Array.isArray(i)&&typeof i[0]=="number",Fb={linearEasing:void 0};function Nb(i,e){const t=qd(i);return()=>{var n;return(n=Fb[e])!==null&&n!==void 0?n:t()}}const pu=Nb(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),mx=(i,e,t=10)=>{let n="";const r=Math.max(Math.round(e/t),2);for(let s=0;s<r;s++)n+=i(Kr(0,r-1,s))+", ";return`linear(${n.substring(0,n.length-2)})`};function px(i){return!!(typeof i=="function"&&pu()||!i||typeof i=="string"&&(i in Nf||pu())||hm(i)||Array.isArray(i)&&i.every(px))}const _o=([i,e,t,n])=>`cubic-bezier(${i}, ${e}, ${t}, ${n})`,Nf={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_o([0,.65,.55,1]),circOut:_o([.55,0,1,.45]),backIn:_o([.31,.01,.66,-.59]),backOut:_o([.33,1.53,.69,.99])};function gx(i,e){if(i)return typeof i=="function"&&pu()?mx(i,e):hm(i)?_o(i):Array.isArray(i)?i.map(t=>gx(t,e)||Nf.easeOut):Nf[i]}const Fn={x:!1,y:!1};function yx(){return Fn.x||Fn.y}function vx(i,e,t){var n;if(i instanceof Element)return[i];if(typeof i=="string"){let r=document;const s=(n=void 0)!==null&&n!==void 0?n:r.querySelectorAll(i);return s?Array.from(s):[]}return Array.from(i)}function Tx(i,e){const t=vx(i),n=new AbortController,r={passive:!0,...e,signal:n.signal};return[t,r,()=>n.abort()]}function Ry(i){return e=>{e.pointerType==="touch"||yx()||i(e)}}function Bb(i,e,t={}){const[n,r,s]=Tx(i,t),o=Ry(a=>{const{target:l}=a,u=e(a);if(typeof u!="function"||!l)return;const f=Ry(d=>{u(d),l.removeEventListener("pointerleave",f)});l.addEventListener("pointerleave",f,r)});return n.forEach(a=>{a.addEventListener("pointerenter",o,r)}),s}const Ex=(i,e)=>e?i===e?!0:Ex(i,e.parentElement):!1,fm=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,Ub=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function $b(i){return Ub.has(i.tagName)||i.tabIndex!==-1}const Ao=new WeakSet;function Iy(i){return e=>{e.key==="Enter"&&i(e)}}function Nh(i,e){i.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Vb=(i,e)=>{const t=i.currentTarget;if(!t)return;const n=Iy(()=>{if(Ao.has(t))return;Nh(t,"down");const r=Iy(()=>{Nh(t,"up")}),s=()=>Nh(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",n,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",n),e)};function Py(i){return fm(i)&&!yx()}function Gb(i,e,t={}){const[n,r,s]=Tx(i,t),o=a=>{const l=a.currentTarget;if(!Py(a)||Ao.has(l))return;Ao.add(l);const u=e(a),f=(g,y)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",m),!(!Py(g)||!Ao.has(l))&&(Ao.delete(l),typeof u=="function"&&u(g,{success:y}))},d=g=>{f(g,t.useGlobalTarget||Ex(l,g.target))},m=g=>{f(g,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",m,r)};return n.forEach(a=>{!$b(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",u=>Vb(u,r),r)}),s}function Hb(i){return i==="x"||i==="y"?Fn[i]?null:(Fn[i]=!0,()=>{Fn[i]=!1}):Fn.x||Fn.y?null:(Fn.x=Fn.y=!0,()=>{Fn.x=Fn.y=!1})}const Sx=new Set(["width","height","top","left","right","bottom",...Gs]);let Kl;function Kb(){Kl=void 0}const oi={now:()=>(Kl===void 0&&oi.set(vt.isProcessing||VC.useManualTiming?vt.timestamp:performance.now()),Kl),set:i=>{Kl=i,queueMicrotask(Kb)}};function dm(i,e){i.indexOf(e)===-1&&i.push(e)}function mm(i,e){const t=i.indexOf(e);t>-1&&i.splice(t,1)}class pm{constructor(){this.subscriptions=[]}add(e){return dm(this.subscriptions,e),()=>mm(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function gm(i,e){return e?i*(1e3/e):0}const Dy=30,zb=i=>!isNaN(parseFloat(i)),ko={current:void 0};class Wb{constructor(e,t={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(n,r=!0)=>{const s=oi.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=oi.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=zb(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new pm);const n=this.events[e].add(t);return e==="change"?()=>{n(),Fe.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return ko.current&&ko.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=oi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Dy)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,Dy);return gm(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ii(i,e){return new Wb(i,e)}function jb(i,e,t){i.hasValue(e)?i.getValue(e).set(t):i.addValue(e,ii(t))}function Yb(i,e){const t=Bu(i,e);let{transitionEnd:n={},transition:r={},...s}=t||{};s={...s,...n};for(const o in s){const a=lb(s[o]);jb(i,o,a)}}function qb(i){return!!(Mt(i)&&i.add)}function Bf(i,e){const t=i.getValue("willChange");if(qb(t))return t.add(e)}function xx(i){return i.props[QS]}const _x=(i,e,t)=>(((1-3*t+3*e)*i+(3*t-6*e))*i+3*e)*i,Xb=1e-7,Qb=12;function Zb(i,e,t,n,r){let s,o,a=0;do o=e+(t-e)/2,s=_x(o,n,r)-i,s>0?t=o:e=o;while(Math.abs(s)>Xb&&++a<Qb);return o}function la(i,e,t,n){if(i===e&&t===n)return Vt;const r=s=>Zb(s,0,1,i,t);return s=>s===0||s===1?s:_x(r(s),e,n)}const Ax=i=>e=>e<=.5?i(2*e)/2:(2-i(2*(1-e)))/2,Lx=i=>e=>1-i(1-e),Rx=la(.33,1.53,.69,.99),ym=Lx(Rx),Ix=Ax(ym),Px=i=>(i*=2)<1?.5*ym(i):.5*(2-Math.pow(2,-10*(i-1))),vm=i=>1-Math.sin(Math.acos(i)),Dx=Lx(vm),wx=Ax(vm),Cx=i=>/^0[^.\s]+$/u.test(i);function Jb(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||Cx(i):!0}const Oo=i=>Math.round(i*1e5)/1e5,Tm=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ek(i){return i==null}const tk=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Em=(i,e)=>t=>!!(typeof t=="string"&&tk.test(t)&&t.startsWith(i)||e&&!ek(t)&&Object.prototype.hasOwnProperty.call(t,e)),bx=(i,e,t)=>n=>{if(typeof n!="string")return n;const[r,s,o,a]=n.match(Tm);return{[i]:parseFloat(r),[e]:parseFloat(s),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},nk=i=>ui(0,255,i),Bh={...Hs,transform:i=>Math.round(nk(i))},kr={test:Em("rgb","red"),parse:bx("red","green","blue"),transform:({red:i,green:e,blue:t,alpha:n=1})=>"rgba("+Bh.transform(i)+", "+Bh.transform(e)+", "+Bh.transform(t)+", "+Oo(ea.transform(n))+")"};function ik(i){let e="",t="",n="",r="";return i.length>5?(e=i.substring(1,3),t=i.substring(3,5),n=i.substring(5,7),r=i.substring(7,9)):(e=i.substring(1,2),t=i.substring(2,3),n=i.substring(3,4),r=i.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const Uf={test:Em("#"),parse:ik,transform:kr.transform},Ts={test:Em("hsl","hue"),parse:bx("hue","saturation","lightness"),transform:({hue:i,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(i)+", "+si.transform(Oo(e))+", "+si.transform(Oo(t))+", "+Oo(ea.transform(n))+")"},bt={test:i=>kr.test(i)||Uf.test(i)||Ts.test(i),parse:i=>kr.test(i)?kr.parse(i):Ts.test(i)?Ts.parse(i):Uf.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?kr.transform(i):Ts.transform(i)},rk=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function sk(i){var e,t;return isNaN(i)&&typeof i=="string"&&(((e=i.match(Tm))===null||e===void 0?void 0:e.length)||0)+(((t=i.match(rk))===null||t===void 0?void 0:t.length)||0)>0}const kx="number",Ox="color",ok="var",ak="var(",wy="${}",lk=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ta(i){const e=i.toString(),t=[],n={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(lk,l=>(bt.test(l)?(n.color.push(s),r.push(Ox),t.push(bt.parse(l))):l.startsWith(ak)?(n.var.push(s),r.push(ok),t.push(l)):(n.number.push(s),r.push(kx),t.push(parseFloat(l))),++s,wy)).split(wy);return{values:t,split:a,indexes:n,types:r}}function Mx(i){return ta(i).values}function Fx(i){const{split:e,types:t}=ta(i),n=e.length;return r=>{let s="";for(let o=0;o<n;o++)if(s+=e[o],r[o]!==void 0){const a=t[o];a===kx?s+=Oo(r[o]):a===Ox?s+=bt.transform(r[o]):s+=r[o]}return s}}const uk=i=>typeof i=="number"?0:i;function ck(i){const e=Mx(i);return Fx(i)(e.map(uk))}const lr={test:sk,parse:Mx,createTransformer:Fx,getAnimatableNone:ck},hk=new Set(["brightness","contrast","saturate","opacity"]);function fk(i){const[e,t]=i.slice(0,-1).split("(");if(e==="drop-shadow")return i;const[n]=t.match(Tm)||[];if(!n)return i;const r=t.replace(n,"");let s=hk.has(e)?1:0;return n!==t&&(s*=100),e+"("+s+r+")"}const dk=/\b([a-z-]*)\(.*?\)/gu,$f={...lr,getAnimatableNone:i=>{const e=i.match(dk);return e?e.map(fk).join(" "):i}},mk={...im,color:bt,backgroundColor:bt,outlineColor:bt,fill:bt,stroke:bt,borderColor:bt,borderTopColor:bt,borderRightColor:bt,borderBottomColor:bt,borderLeftColor:bt,filter:$f,WebkitFilter:$f},Sm=i=>mk[i];function Nx(i,e){let t=Sm(i);return t!==$f&&(t=lr),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const pk=new Set(["auto","none","0"]);function gk(i,e,t){let n=0,r;for(;n<i.length&&!r;){const s=i[n];typeof s=="string"&&!pk.has(s)&&ta(s).values.length&&(r=i[n]),n++}if(r&&t)for(const s of e)i[s]=Nx(t,r)}const Cy=i=>i===Hs||i===ye,by=(i,e)=>parseFloat(i.split(", ")[e]),ky=(i,e)=>(t,{transform:n})=>{if(n==="none"||!n)return 0;const r=n.match(/^matrix3d\((.+)\)$/u);if(r)return by(r[1],e);{const s=n.match(/^matrix\((.+)\)$/u);return s?by(s[1],i):0}},yk=new Set(["x","y","z"]),vk=Gs.filter(i=>!yk.has(i));function Tk(i){const e=[];return vk.forEach(t=>{const n=i.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e}const $s={width:({x:i},{paddingLeft:e="0",paddingRight:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),height:({y:i},{paddingTop:e="0",paddingBottom:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),top:(i,{top:e})=>parseFloat(e),left:(i,{left:e})=>parseFloat(e),bottom:({y:i},{top:e})=>parseFloat(e)+(i.max-i.min),right:({x:i},{left:e})=>parseFloat(e)+(i.max-i.min),x:ky(4,13),y:ky(5,14)};$s.translateX=$s.x;$s.translateY=$s.y;const Vr=new Set;let Vf=!1,Gf=!1;function Bx(){if(Gf){const i=Array.from(Vr).filter(n=>n.needsMeasurement),e=new Set(i.map(n=>n.element)),t=new Map;e.forEach(n=>{const r=Tk(n);r.length&&(t.set(n,r),n.render())}),i.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const r=t.get(n);r&&r.forEach(([s,o])=>{var a;(a=n.getValue(s))===null||a===void 0||a.set(o)})}),i.forEach(n=>n.measureEndState()),i.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Gf=!1,Vf=!1,Vr.forEach(i=>i.complete()),Vr.clear()}function Ux(){Vr.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(Gf=!0)})}function Ek(){Ux(),Bx()}class xm{constructor(e,t,n,r,s,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=s,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Vr.add(this),Vf||(Vf=!0,Fe.read(Ux),Fe.resolveKeyframes(Bx))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(n&&t){const l=n.readValue(t,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Vr.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Vr.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const $x=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i),Sk=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function xk(i){const e=Sk.exec(i);if(!e)return[,];const[,t,n,r]=e;return[`--${t??n}`,r]}function Vx(i,e,t=1){const[n,r]=xk(i);if(!n)return;const s=window.getComputedStyle(e).getPropertyValue(n);if(s){const o=s.trim();return $x(o)?parseFloat(o):o}return nm(r)?Vx(r,e,t+1):r}const Gx=i=>e=>e.test(i),_k={test:i=>i==="auto",parse:i=>i},Hx=[Hs,ye,si,Xi,mb,db,_k],Oy=i=>Hx.find(Gx(i));class Kx extends xm{constructor(e,t,n,r,s){super(e,t,n,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),nm(u))){const f=Vx(u,t.current);f!==void 0&&(e[l]=f),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!Sx.has(n)||e.length!==2)return;const[r,s]=e,o=Oy(r),a=Oy(s);if(o!==a)if(Cy(o)&&Cy(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)Jb(e[r])&&n.push(r);n.length&&gk(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=$s[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(n,r).jump(r,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const s=t.getValue(n);s&&s.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=$s[n](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,u])=>{t.getValue(l).set(u)}),this.resolveNoneKeyframes()}}const My=(i,e)=>e==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(lr.test(i)||i==="0")&&!i.startsWith("url("));function Ak(i){const e=i[0];if(i.length===1)return!0;for(let t=0;t<i.length;t++)if(i[t]!==e)return!0}function Lk(i,e,t,n){const r=i[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=i[i.length-1],o=My(r,e),a=My(s,e);return!o||!a?!1:Ak(i)||(t==="spring"||cm(t))&&n}const Rk=i=>i!==null;function Uu(i,{repeat:e,repeatType:t="loop"},n){const r=i.filter(Rk),s=e&&t!=="loop"&&e%2===1?0:r.length-1;return!s||n===void 0?r[s]:n}const Ik=40;class zx{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=oi.now(),this.options={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:s,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Ik?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Ek(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=oi.now(),this.hasAttemptedResolve=!0;const{name:n,type:r,velocity:s,delay:o,onComplete:a,onUpdate:l,isGenerator:u}=this.options;if(!u&&!Lk(e,n,r,s))if(o)this.options.duration=0;else{l&&l(Uu(e,this.options,t)),a&&a(),this.resolveFinishedPromise();return}const f=this.initPlayback(e,t);f!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...f},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Qe=(i,e,t)=>i+(e-i)*t;function Uh(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function Pk({hue:i,saturation:e,lightness:t,alpha:n}){i/=360,e/=100,t/=100;let r=0,s=0,o=0;if(!e)r=s=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;r=Uh(l,a,i+1/3),s=Uh(l,a,i),o=Uh(l,a,i-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:n}}function gu(i,e){return t=>t>0?e:i}const $h=(i,e,t)=>{const n=i*i,r=t*(e*e-n)+n;return r<0?0:Math.sqrt(r)},Dk=[Uf,kr,Ts],wk=i=>Dk.find(e=>e.test(i));function Fy(i){const e=wk(i);if(!e)return!1;let t=e.parse(i);return e===Ts&&(t=Pk(t)),t}const Ny=(i,e)=>{const t=Fy(i),n=Fy(e);if(!t||!n)return gu(i,e);const r={...t};return s=>(r.red=$h(t.red,n.red,s),r.green=$h(t.green,n.green,s),r.blue=$h(t.blue,n.blue,s),r.alpha=Qe(t.alpha,n.alpha,s),kr.transform(r))},Ck=(i,e)=>t=>e(i(t)),ua=(...i)=>i.reduce(Ck),Hf=new Set(["none","hidden"]);function bk(i,e){return Hf.has(i)?t=>t<=0?i:e:t=>t>=1?e:i}function kk(i,e){return t=>Qe(i,e,t)}function _m(i){return typeof i=="number"?kk:typeof i=="string"?nm(i)?gu:bt.test(i)?Ny:Fk:Array.isArray(i)?Wx:typeof i=="object"?bt.test(i)?Ny:Ok:gu}function Wx(i,e){const t=[...i],n=t.length,r=i.map((s,o)=>_m(s)(s,e[o]));return s=>{for(let o=0;o<n;o++)t[o]=r[o](s);return t}}function Ok(i,e){const t={...i,...e},n={};for(const r in t)i[r]!==void 0&&e[r]!==void 0&&(n[r]=_m(i[r])(i[r],e[r]));return r=>{for(const s in n)t[s]=n[s](r);return t}}function Mk(i,e){var t;const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const o=e.types[s],a=i.indexes[o][r[o]],l=(t=i.values[a])!==null&&t!==void 0?t:0;n[s]=l,r[o]++}return n}const Fk=(i,e)=>{const t=lr.createTransformer(e),n=ta(i),r=ta(e);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?Hf.has(i)&&!r.values.length||Hf.has(e)&&!n.values.length?bk(i,e):ua(Wx(Mk(n,r),r.values),t):gu(i,e)};function jx(i,e,t){return typeof i=="number"&&typeof e=="number"&&typeof t=="number"?Qe(i,e,t):_m(i)(i,e)}const Nk=5;function Yx(i,e,t){const n=Math.max(e-Nk,0);return gm(t-i(n),e-n)}const et={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},By=.001;function Bk({duration:i=et.duration,bounce:e=et.bounce,velocity:t=et.velocity,mass:n=et.mass}){let r,s,o=1-e;o=ui(et.minDamping,et.maxDamping,o),i=ui(et.minDuration,et.maxDuration,Di(i)),o<1?(r=u=>{const f=u*o,d=f*i,m=f-t,g=Kf(u,o),y=Math.exp(-d);return By-m/g*y},s=u=>{const d=u*o*i,m=d*t+t,g=Math.pow(o,2)*Math.pow(u,2)*i,y=Math.exp(-d),T=Kf(Math.pow(u,2),o);return(-r(u)+By>0?-1:1)*((m-g)*y)/T}):(r=u=>{const f=Math.exp(-u*i),d=(u-t)*i+1;return-.001+f*d},s=u=>{const f=Math.exp(-u*i),d=(t-u)*(i*i);return f*d});const a=5/i,l=$k(r,s,a);if(i=Pi(i),isNaN(l))return{stiffness:et.stiffness,damping:et.damping,duration:i};{const u=Math.pow(l,2)*n;return{stiffness:u,damping:o*2*Math.sqrt(n*u),duration:i}}}const Uk=12;function $k(i,e,t){let n=t;for(let r=1;r<Uk;r++)n=n-i(n)/e(n);return n}function Kf(i,e){return i*Math.sqrt(1-e*e)}const Vk=["duration","bounce"],Gk=["stiffness","damping","mass"];function Uy(i,e){return e.some(t=>i[t]!==void 0)}function Hk(i){let e={velocity:et.velocity,stiffness:et.stiffness,damping:et.damping,mass:et.mass,isResolvedFromDuration:!1,...i};if(!Uy(i,Gk)&&Uy(i,Vk))if(i.visualDuration){const t=i.visualDuration,n=2*Math.PI/(t*1.2),r=n*n,s=2*ui(.05,1,1-(i.bounce||0))*Math.sqrt(r);e={...e,mass:et.mass,stiffness:r,damping:s}}else{const t=Bk(i);e={...e,...t,mass:et.mass},e.isResolvedFromDuration=!0}return e}function qx(i=et.visualDuration,e=et.bounce){const t=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:e}:i;let{restSpeed:n,restDelta:r}=t;const s=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:s},{stiffness:l,damping:u,mass:f,duration:d,velocity:m,isResolvedFromDuration:g}=Hk({...t,velocity:-Di(t.velocity||0)}),y=m||0,T=u/(2*Math.sqrt(l*f)),E=o-s,x=Di(Math.sqrt(l/f)),R=Math.abs(E)<5;n||(n=R?et.restSpeed.granular:et.restSpeed.default),r||(r=R?et.restDelta.granular:et.restDelta.default);let L;if(T<1){const I=Kf(x,T);L=C=>{const D=Math.exp(-T*x*C);return o-D*((y+T*x*E)/I*Math.sin(I*C)+E*Math.cos(I*C))}}else if(T===1)L=I=>o-Math.exp(-x*I)*(E+(y+x*E)*I);else{const I=x*Math.sqrt(T*T-1);L=C=>{const D=Math.exp(-T*x*C),w=Math.min(I*C,300);return o-D*((y+T*x*E)*Math.sinh(w)+I*E*Math.cosh(w))/I}}const P={calculatedDuration:g&&d||null,next:I=>{const C=L(I);if(g)a.done=I>=d;else{let D=0;T<1&&(D=I===0?Pi(y):Yx(L,I,C));const w=Math.abs(D)<=n,k=Math.abs(o-C)<=r;a.done=w&&k}return a.value=a.done?o:C,a},toString:()=>{const I=Math.min(dx(P),Ff),C=mx(D=>P.next(I*D).value,I,30);return I+"ms "+C}};return P}function $y({keyframes:i,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:u=.5,restSpeed:f}){const d=i[0],m={done:!1,value:d},g=w=>a!==void 0&&w<a||l!==void 0&&w>l,y=w=>a===void 0?l:l===void 0||Math.abs(a-w)<Math.abs(l-w)?a:l;let T=t*e;const E=d+T,x=o===void 0?E:o(E);x!==E&&(T=x-d);const R=w=>-T*Math.exp(-w/n),L=w=>x+R(w),P=w=>{const k=R(w),O=L(w);m.done=Math.abs(k)<=u,m.value=m.done?x:O};let I,C;const D=w=>{g(m.value)&&(I=w,C=qx({keyframes:[m.value,y(m.value)],velocity:Yx(L,w,m.value),damping:r,stiffness:s,restDelta:u,restSpeed:f}))};return D(0),{calculatedDuration:null,next:w=>{let k=!1;return!C&&I===void 0&&(k=!0,P(w),D(w)),I!==void 0&&w>=I?C.next(w-I):(!k&&P(w),m)}}}const Kk=la(.42,0,1,1),zk=la(0,0,.58,1),Xx=la(.42,0,.58,1),Wk=i=>Array.isArray(i)&&typeof i[0]!="number",jk={linear:Vt,easeIn:Kk,easeInOut:Xx,easeOut:zk,circIn:vm,circInOut:wx,circOut:Dx,backIn:ym,backInOut:Ix,backOut:Rx,anticipate:Px},Vy=i=>{if(hm(i)){WS(i.length===4);const[e,t,n,r]=i;return la(e,t,n,r)}else if(typeof i=="string")return jk[i];return i};function Yk(i,e,t){const n=[],r=t||jx,s=i.length-1;for(let o=0;o<s;o++){let a=r(i[o],i[o+1]);if(e){const l=Array.isArray(e)?e[o]||Vt:e;a=ua(l,a)}n.push(a)}return n}function Am(i,e,{clamp:t=!0,ease:n,mixer:r}={}){const s=i.length;if(WS(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=i[0]===i[1];i[0]>i[s-1]&&(i=[...i].reverse(),e=[...e].reverse());const a=Yk(e,n,r),l=a.length,u=f=>{if(o&&f<i[0])return e[0];let d=0;if(l>1)for(;d<i.length-2&&!(f<i[d+1]);d++);const m=Kr(i[d],i[d+1],f);return a[d](m)};return t?f=>u(ui(i[0],i[s-1],f)):u}function qk(i,e){const t=i[i.length-1];for(let n=1;n<=e;n++){const r=Kr(0,e,n);i.push(Qe(t,1,r))}}function Qx(i){const e=[0];return qk(e,i.length-1),e}function Xk(i,e){return i.map(t=>t*e)}function Qk(i,e){return i.map(()=>e||Xx).splice(0,i.length-1)}function yu({duration:i=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=Wk(n)?n.map(Vy):Vy(n),s={done:!1,value:e[0]},o=Xk(t&&t.length===e.length?t:Qx(e),i),a=Am(o,e,{ease:Array.isArray(r)?r:Qk(e,r)});return{calculatedDuration:i,next:l=>(s.value=a(l),s.done=l>=i,s)}}const Zk=i=>{const e=({timestamp:t})=>i(t);return{start:()=>Fe.update(e,!0),stop:()=>Un(e),now:()=>vt.isProcessing?vt.timestamp:oi.now()}},Jk={decay:$y,inertia:$y,tween:yu,keyframes:yu,spring:qx},eO=i=>i/100;class Lm extends zx{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:t,motionValue:n,element:r,keyframes:s}=this.options,o=(r==null?void 0:r.KeyframeResolver)||xm,a=(l,u)=>this.onKeyframesResolved(l,u);this.resolver=new o(s,a,t,n,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:n=0,repeatDelay:r=0,repeatType:s,velocity:o=0}=this.options,a=cm(t)?t:Jk[t]||yu;let l,u;a!==yu&&typeof e[0]!="number"&&(l=ua(eO,jx(e[0],e[1])),e=[0,100]);const f=a({...this.options,keyframes:e});s==="mirror"&&(u=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),f.calculatedDuration===null&&(f.calculatedDuration=dx(f));const{calculatedDuration:d}=f,m=d+r,g=m*(n+1)-r;return{generator:f,mirroredGenerator:u,mapPercentToKeyframes:l,calculatedDuration:d,resolvedDuration:m,totalDuration:g}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,t=!1){const{resolved:n}=this;if(!n){const{keyframes:w}=this.options;return{done:!0,value:w[w.length-1]}}const{finalKeyframe:r,generator:s,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:u,totalDuration:f,resolvedDuration:d}=n;if(this.startTime===null)return s.next(0);const{delay:m,repeat:g,repeatType:y,repeatDelay:T,onUpdate:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-f/this.speed,this.startTime)),t?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const x=this.currentTime-m*(this.speed>=0?1:-1),R=this.speed>=0?x<0:x>f;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=f);let L=this.currentTime,P=s;if(g){const w=Math.min(this.currentTime,f)/d;let k=Math.floor(w),O=w%1;!O&&w>=1&&(O=1),O===1&&k--,k=Math.min(k,g+1),!!(k%2)&&(y==="reverse"?(O=1-O,T&&(O-=T/d)):y==="mirror"&&(P=o)),L=ui(0,1,O)*d}const I=R?{done:!1,value:l[0]}:P.next(L);a&&(I.value=a(I.value));let{done:C}=I;!R&&u!==null&&(C=this.speed>=0?this.currentTime>=f:this.currentTime<=0);const D=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&C);return D&&r!==void 0&&(I.value=Uu(l,this.options,r)),E&&E(I.value),D&&this.finish(),I}get duration(){const{resolved:e}=this;return e?Di(e.calculatedDuration):0}get time(){return Di(this.currentTime)}set time(e){e=Pi(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Di(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=Zk,onPlay:t,startTime:n}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),t&&t();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=n??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const tO=new Set(["opacity","clipPath","filter","transform"]);function nO(i,e,t,{delay:n=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeInOut",times:l}={}){const u={[e]:t};l&&(u.offset=l);const f=gx(a,r);return Array.isArray(f)&&(u.easing=f),i.animate(u,{delay:n,duration:r,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}const iO=qd(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),vu=10,rO=2e4;function sO(i){return cm(i.type)||i.type==="spring"||!px(i.ease)}function oO(i,e){const t=new Lm({...e,keyframes:i,repeat:0,delay:0,isGenerator:!0});let n={done:!1,value:i[0]};const r=[];let s=0;for(;!n.done&&s<rO;)n=t.sample(s),r.push(n.value),s+=vu;return{times:void 0,keyframes:r,duration:s-vu,ease:"linear"}}const Zx={anticipate:Px,backInOut:Ix,circInOut:wx};function aO(i){return i in Zx}class Gy extends zx{constructor(e){super(e);const{name:t,motionValue:n,element:r,keyframes:s}=this.options;this.resolver=new Kx(s,(o,a)=>this.onKeyframesResolved(o,a),t,n,r),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:n=300,times:r,ease:s,type:o,motionValue:a,name:l,startTime:u}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof s=="string"&&pu()&&aO(s)&&(s=Zx[s]),sO(this.options)){const{onComplete:d,onUpdate:m,motionValue:g,element:y,...T}=this.options,E=oO(e,T);e=E.keyframes,e.length===1&&(e[1]=e[0]),n=E.duration,r=E.times,s=E.ease,o="keyframes"}const f=nO(a.owner.current,l,e,{...this.options,duration:n,times:r,ease:s});return f.startTime=u??this.calcStartTime(),this.pendingTimeline?(Ly(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:d}=this.options;a.set(Uu(e,this.options,t)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:n,times:r,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Di(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Di(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.currentTime=Pi(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:t}=this;if(!t)return Vt;const{animation:n}=t;Ly(n,e)}return Vt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.playState==="finished"&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:n,duration:r,type:s,ease:o,times:a}=e;if(t.playState==="idle"||t.playState==="finished")return;if(this.time){const{motionValue:u,onUpdate:f,onComplete:d,element:m,...g}=this.options,y=new Lm({...g,keyframes:n,duration:r,type:s,ease:o,times:a,isGenerator:!0}),T=Pi(this.time);u.setWithVelocity(y.sample(T-vu).value,y.sample(T).value,vu)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:n,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=t.owner.getProps();return iO()&&n&&tO.has(n)&&!l&&!u&&!r&&s!=="mirror"&&o!==0&&a!=="inertia"}}const lO={type:"spring",stiffness:500,damping:25,restSpeed:10},uO=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),cO={type:"keyframes",duration:.8},hO={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},fO=(i,{keyframes:e})=>e.length>2?cO:Yr.has(i)?i.startsWith("scale")?uO(e[1]):lO:hO;function dO({when:i,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:u,...f}){return!!Object.keys(f).length}const Rm=(i,e,t,n={},r,s)=>o=>{const a=um(n,i)||{},l=a.delay||n.delay||0;let{elapsed:u=0}=n;u=u-Pi(l);let f={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:m=>{e.set(m),a.onUpdate&&a.onUpdate(m)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:i,motionValue:e,element:s?void 0:r};dO(a)||(f={...f,...fO(i,f)}),f.duration&&(f.duration=Pi(f.duration)),f.repeatDelay&&(f.repeatDelay=Pi(f.repeatDelay)),f.from!==void 0&&(f.keyframes[0]=f.from);let d=!1;if((f.type===!1||f.duration===0&&!f.repeatDelay)&&(f.duration=0,f.delay===0&&(d=!0)),d&&!s&&e.get()!==void 0){const m=Uu(f.keyframes,a);if(m!==void 0)return Fe.update(()=>{f.onUpdate(m),f.onComplete()}),new Mb([])}return!s&&Gy.supports(f)?new Gy(f):new Lm(f)};function mO({protectedKeys:i,needsAnimating:e},t){const n=i.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function Jx(i,e,{delay:t=0,transitionOverride:n,type:r}={}){var s;let{transition:o=i.getDefaultTransition(),transitionEnd:a,...l}=e;n&&(o=n);const u=[],f=r&&i.animationState&&i.animationState.getState()[r];for(const d in l){const m=i.getValue(d,(s=i.latestValues[d])!==null&&s!==void 0?s:null),g=l[d];if(g===void 0||f&&mO(f,d))continue;const y={delay:t,...um(o||{},d)};let T=!1;if(window.MotionHandoffAnimation){const x=xx(i);if(x){const R=window.MotionHandoffAnimation(x,d,Fe);R!==null&&(y.startTime=R,T=!0)}}Bf(i,d),m.start(Rm(d,m,g,i.shouldReduceMotion&&Sx.has(d)?{type:!1}:y,i,T));const E=m.animation;E&&u.push(E)}return a&&Promise.all(u).then(()=>{Fe.update(()=>{a&&Yb(i,a)})}),u}function zf(i,e,t={}){var n;const r=Bu(i,e,t.type==="exit"?(n=i.presenceContext)===null||n===void 0?void 0:n.custom:void 0);let{transition:s=i.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(s=t.transitionOverride);const o=r?()=>Promise.all(Jx(i,r,t)):()=>Promise.resolve(),a=i.variantChildren&&i.variantChildren.size?(u=0)=>{const{delayChildren:f=0,staggerChildren:d,staggerDirection:m}=s;return pO(i,e,f+u,d,m,t)}:()=>Promise.resolve(),{when:l}=s;if(l){const[u,f]=l==="beforeChildren"?[o,a]:[a,o];return u().then(()=>f())}else return Promise.all([o(),a(t.delay)])}function pO(i,e,t=0,n=0,r=1,s){const o=[],a=(i.variantChildren.size-1)*n,l=r===1?(u=0)=>u*n:(u=0)=>a-u*n;return Array.from(i.variantChildren).sort(gO).forEach((u,f)=>{u.notify("AnimationStart",e),o.push(zf(u,e,{...s,delay:t+l(f)}).then(()=>u.notify("AnimationComplete",e)))}),Promise.all(o)}function gO(i,e){return i.sortNodePosition(e)}function yO(i,e,t={}){i.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(s=>zf(i,s,t));n=Promise.all(r)}else if(typeof e=="string")n=zf(i,e,t);else{const r=typeof e=="function"?Bu(i,e,t.custom):e;n=Promise.all(Jx(i,r,t))}return n.then(()=>{i.notify("AnimationComplete",e)})}const vO=Qd.length;function e_(i){if(!i)return;if(!i.isControllingVariants){const t=i.parent?e_(i.parent)||{}:{};return i.props.initial!==void 0&&(t.initial=i.props.initial),t}const e={};for(let t=0;t<vO;t++){const n=Qd[t],r=i.props[n];(Jo(r)||r===!1)&&(e[n]=r)}return e}const TO=[...Xd].reverse(),EO=Xd.length;function SO(i){return e=>Promise.all(e.map(({animation:t,options:n})=>yO(i,t,n)))}function xO(i){let e=SO(i),t=Hy(),n=!0;const r=l=>(u,f)=>{var d;const m=Bu(i,f,l==="exit"?(d=i.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(m){const{transition:g,transitionEnd:y,...T}=m;u={...u,...T,...y}}return u};function s(l){e=l(i)}function o(l){const{props:u}=i,f=e_(i.parent)||{},d=[],m=new Set;let g={},y=1/0;for(let E=0;E<EO;E++){const x=TO[E],R=t[x],L=u[x]!==void 0?u[x]:f[x],P=Jo(L),I=x===l?R.isActive:null;I===!1&&(y=E);let C=L===f[x]&&L!==u[x]&&P;if(C&&n&&i.manuallyAnimateOnMount&&(C=!1),R.protectedKeys={...g},!R.isActive&&I===null||!L&&!R.prevProp||Fu(L)||typeof L=="boolean")continue;const D=_O(R.prevProp,L);let w=D||x===l&&R.isActive&&!C&&P||E>y&&P,k=!1;const O=Array.isArray(L)?L:[L];let W=O.reduce(r(x),{});I===!1&&(W={});const{prevResolvedValues:q={}}=R,ie={...q,...W},te=Q=>{w=!0,m.has(Q)&&(k=!0,m.delete(Q)),R.needsAnimating[Q]=!0;const G=i.getValue(Q);G&&(G.liveStyle=!1)};for(const Q in ie){const G=W[Q],K=q[Q];if(g.hasOwnProperty(Q))continue;let z=!1;Mf(G)&&Mf(K)?z=!hx(G,K):z=G!==K,z?G!=null?te(Q):m.add(Q):G!==void 0&&m.has(Q)?te(Q):R.protectedKeys[Q]=!0}R.prevProp=L,R.prevResolvedValues=W,R.isActive&&(g={...g,...W}),n&&i.blockInitialAnimation&&(w=!1),w&&(!(C&&D)||k)&&d.push(...O.map(Q=>({animation:Q,options:{type:x}})))}if(m.size){const E={};m.forEach(x=>{const R=i.getBaseTarget(x),L=i.getValue(x);L&&(L.liveStyle=!0),E[x]=R??null}),d.push({animation:E})}let T=!!d.length;return n&&(u.initial===!1||u.initial===u.animate)&&!i.manuallyAnimateOnMount&&(T=!1),n=!1,T?e(d):Promise.resolve()}function a(l,u){var f;if(t[l].isActive===u)return Promise.resolve();(f=i.variantChildren)===null||f===void 0||f.forEach(m=>{var g;return(g=m.animationState)===null||g===void 0?void 0:g.setActive(l,u)}),t[l].isActive=u;const d=o(l);for(const m in t)t[m].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>t,reset:()=>{t=Hy(),n=!0}}}function _O(i,e){return typeof e=="string"?e!==i:Array.isArray(e)?!hx(e,i):!1}function Rr(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Hy(){return{animate:Rr(!0),whileInView:Rr(),whileHover:Rr(),whileTap:Rr(),whileDrag:Rr(),whileFocus:Rr(),exit:Rr()}}class cr{constructor(e){this.isMounted=!1,this.node=e}update(){}}class AO extends cr{constructor(e){super(e),e.animationState||(e.animationState=xO(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Fu(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let LO=0;class RO extends cr{constructor(){super(...arguments),this.id=LO++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const IO={animation:{Feature:AO},exit:{Feature:RO}};function na(i,e,t,n={passive:!0}){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t)}function ca(i){return{point:{x:i.pageX,y:i.pageY}}}const PO=i=>e=>fm(e)&&i(e,ca(e));function Mo(i,e,t,n){return na(i,e,PO(t),n)}const Ky=(i,e)=>Math.abs(i-e);function DO(i,e){const t=Ky(i.x,e.x),n=Ky(i.y,e.y);return Math.sqrt(t**2+n**2)}class t_{constructor(e,t,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Gh(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,g=DO(d.offset,{x:0,y:0})>=3;if(!m&&!g)return;const{point:y}=d,{timestamp:T}=vt;this.history.push({...y,timestamp:T});const{onStart:E,onMove:x}=this.handlers;m||(E&&E(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),x&&x(this.lastMoveEvent,d)},this.handlePointerMove=(d,m)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=Vh(m,this.transformPagePoint),Fe.update(this.updatePoint,!0)},this.handlePointerUp=(d,m)=>{this.end();const{onEnd:g,onSessionEnd:y,resumeAnimation:T}=this.handlers;if(this.dragSnapToOrigin&&T&&T(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const E=Gh(d.type==="pointercancel"?this.lastMoveEventInfo:Vh(m,this.transformPagePoint),this.history);this.startEvent&&g&&g(d,E),y&&y(d,E)},!fm(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const o=ca(e),a=Vh(o,this.transformPagePoint),{point:l}=a,{timestamp:u}=vt;this.history=[{...l,timestamp:u}];const{onSessionStart:f}=t;f&&f(e,Gh(a,this.history)),this.removeListeners=ua(Mo(this.contextWindow,"pointermove",this.handlePointerMove),Mo(this.contextWindow,"pointerup",this.handlePointerUp),Mo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Un(this.updatePoint)}}function Vh(i,e){return e?{point:e(i.point)}:i}function zy(i,e){return{x:i.x-e.x,y:i.y-e.y}}function Gh({point:i},e){return{point:i,delta:zy(i,n_(e)),offset:zy(i,wO(e)),velocity:CO(e,.1)}}function wO(i){return i[0]}function n_(i){return i[i.length-1]}function CO(i,e){if(i.length<2)return{x:0,y:0};let t=i.length-1,n=null;const r=n_(i);for(;t>=0&&(n=i[t],!(r.timestamp-n.timestamp>Pi(e)));)t--;if(!n)return{x:0,y:0};const s=Di(r.timestamp-n.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-n.x)/s,y:(r.y-n.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const i_=1e-4,bO=1-i_,kO=1+i_,r_=.01,OO=0-r_,MO=0+r_;function mn(i){return i.max-i.min}function FO(i,e,t){return Math.abs(i-e)<=t}function Wy(i,e,t,n=.5){i.origin=n,i.originPoint=Qe(e.min,e.max,i.origin),i.scale=mn(t)/mn(e),i.translate=Qe(t.min,t.max,i.origin)-i.originPoint,(i.scale>=bO&&i.scale<=kO||isNaN(i.scale))&&(i.scale=1),(i.translate>=OO&&i.translate<=MO||isNaN(i.translate))&&(i.translate=0)}function Fo(i,e,t,n){Wy(i.x,e.x,t.x,n?n.originX:void 0),Wy(i.y,e.y,t.y,n?n.originY:void 0)}function jy(i,e,t){i.min=t.min+e.min,i.max=i.min+mn(e)}function NO(i,e,t){jy(i.x,e.x,t.x),jy(i.y,e.y,t.y)}function Yy(i,e,t){i.min=e.min-t.min,i.max=i.min+mn(e)}function No(i,e,t){Yy(i.x,e.x,t.x),Yy(i.y,e.y,t.y)}function BO(i,{min:e,max:t},n){return e!==void 0&&i<e?i=n?Qe(e,i,n.min):Math.max(i,e):t!==void 0&&i>t&&(i=n?Qe(t,i,n.max):Math.min(i,t)),i}function qy(i,e,t){return{min:e!==void 0?i.min+e:void 0,max:t!==void 0?i.max+t-(i.max-i.min):void 0}}function UO(i,{top:e,left:t,bottom:n,right:r}){return{x:qy(i.x,t,r),y:qy(i.y,e,n)}}function Xy(i,e){let t=e.min-i.min,n=e.max-i.max;return e.max-e.min<i.max-i.min&&([t,n]=[n,t]),{min:t,max:n}}function $O(i,e){return{x:Xy(i.x,e.x),y:Xy(i.y,e.y)}}function VO(i,e){let t=.5;const n=mn(i),r=mn(e);return r>n?t=Kr(e.min,e.max-n,i.min):n>r&&(t=Kr(i.min,i.max-r,e.min)),ui(0,1,t)}function GO(i,e){const t={};return e.min!==void 0&&(t.min=e.min-i.min),e.max!==void 0&&(t.max=e.max-i.min),t}const Wf=.35;function HO(i=Wf){return i===!1?i=0:i===!0&&(i=Wf),{x:Qy(i,"left","right"),y:Qy(i,"top","bottom")}}function Qy(i,e,t){return{min:Zy(i,e),max:Zy(i,t)}}function Zy(i,e){return typeof i=="number"?i:i[e]||0}const Jy=()=>({translate:0,scale:1,origin:0,originPoint:0}),Es=()=>({x:Jy(),y:Jy()}),ev=()=>({min:0,max:0}),it=()=>({x:ev(),y:ev()});function Rn(i){return[i("x"),i("y")]}function s_({top:i,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:i,max:n}}}function KO({x:i,y:e}){return{top:e.min,right:i.max,bottom:e.max,left:i.min}}function zO(i,e){if(!e)return i;const t=e({x:i.left,y:i.top}),n=e({x:i.right,y:i.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function Hh(i){return i===void 0||i===1}function jf({scale:i,scaleX:e,scaleY:t}){return!Hh(i)||!Hh(e)||!Hh(t)}function Dr(i){return jf(i)||o_(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function o_(i){return tv(i.x)||tv(i.y)}function tv(i){return i&&i!=="0%"}function Tu(i,e,t){const n=i-t,r=e*n;return t+r}function nv(i,e,t,n,r){return r!==void 0&&(i=Tu(i,r,n)),Tu(i,t,n)+e}function Yf(i,e=0,t=1,n,r){i.min=nv(i.min,e,t,n,r),i.max=nv(i.max,e,t,n,r)}function a_(i,{x:e,y:t}){Yf(i.x,e.translate,e.scale,e.originPoint),Yf(i.y,t.translate,t.scale,t.originPoint)}const iv=.999999999999,rv=1.0000000000001;function WO(i,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=t[a],o=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&xs(i,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,a_(i,o)),n&&Dr(s.latestValues)&&xs(i,s.latestValues))}e.x<rv&&e.x>iv&&(e.x=1),e.y<rv&&e.y>iv&&(e.y=1)}function Ss(i,e){i.min=i.min+e,i.max=i.max+e}function sv(i,e,t,n,r=.5){const s=Qe(i.min,i.max,r);Yf(i,e,t,s,n)}function xs(i,e){sv(i.x,e.x,e.scaleX,e.scale,e.originX),sv(i.y,e.y,e.scaleY,e.scale,e.originY)}function l_(i,e){return s_(zO(i.getBoundingClientRect(),e))}function jO(i,e,t){const n=l_(i,t),{scroll:r}=e;return r&&(Ss(n.x,r.offset.x),Ss(n.y,r.offset.y)),n}const u_=({current:i})=>i?i.ownerDocument.defaultView:null,YO=new WeakMap;class qO{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=it(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const r=f=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ca(f).point)},s=(f,d)=>{const{drag:m,dragPropagation:g,onDragStart:y}=this.getProps();if(m&&!g&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Hb(m),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Rn(E=>{let x=this.getAxisMotionValue(E).get()||0;if(si.test(x)){const{projection:R}=this.visualElement;if(R&&R.layout){const L=R.layout.layoutBox[E];L&&(x=mn(L)*(parseFloat(x)/100))}}this.originPoint[E]=x}),y&&Fe.postRender(()=>y(f,d)),Bf(this.visualElement,"transform");const{animationState:T}=this.visualElement;T&&T.setActive("whileDrag",!0)},o=(f,d)=>{const{dragPropagation:m,dragDirectionLock:g,onDirectionLock:y,onDrag:T}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:E}=d;if(g&&this.currentDirection===null){this.currentDirection=XO(E),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",d.point,E),this.updateAxis("y",d.point,E),this.visualElement.render(),T&&T(f,d)},a=(f,d)=>this.stop(f,d),l=()=>Rn(f=>{var d;return this.getAnimationState(f)==="paused"&&((d=this.getAxisMotionValue(f).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new t_(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,contextWindow:u_(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&Fe.postRender(()=>s(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!wl(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=BO(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;t&&vs(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=UO(r.layoutBox,t):this.constraints=!1,this.elastic=HO(n),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Rn(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=GO(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!vs(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=jO(n,r.root,this.visualElement.getTransformPagePoint());let o=$O(r.layout.layoutBox,s);if(t){const a=t(KO(o));this.hasMutatedConstraints=!!a,a&&(o=s_(a))}return o}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=Rn(f=>{if(!wl(f,t,this.currentDirection))return;let d=l&&l[f]||{};o&&(d={min:0,max:0});const m=r?200:1e6,g=r?40:1e7,y={type:"inertia",velocity:n?e[f]:0,bounceStiffness:m,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(f,y)});return Promise.all(u).then(a)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return Bf(this.visualElement,e),n.start(Rm(e,n,0,t,this.visualElement,!1))}stopAnimation(){Rn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Rn(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Rn(t=>{const{drag:n}=this.getProps();if(!wl(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(t);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[t];s.set(e[t]-Qe(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!vs(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Rn(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=VO({min:l,max:l},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Rn(o=>{if(!wl(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:u}=this.constraints[o];a.set(Qe(l,u,r[o]))})}addListeners(){if(!this.visualElement.current)return;YO.set(this.visualElement,this);const e=this.visualElement.current,t=Mo(e,"pointerdown",l=>{const{drag:u,dragListener:f=!0}=this.getProps();u&&f&&this.start(l)}),n=()=>{const{dragConstraints:l}=this.getProps();vs(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Fe.read(n);const o=na(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(Rn(f=>{const d=this.getAxisMotionValue(f);d&&(this.originPoint[f]+=l[f].translate,d.set(d.get()+l[f].translate))}),this.visualElement.render())});return()=>{o(),t(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Wf,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function wl(i,e,t){return(e===!0||e===i)&&(t===null||t===i)}function XO(i,e=10){let t=null;return Math.abs(i.y)>e?t="y":Math.abs(i.x)>e&&(t="x"),t}class QO extends cr{constructor(e){super(e),this.removeGroupControls=Vt,this.removeListeners=Vt,this.controls=new qO(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Vt}unmount(){this.removeGroupControls(),this.removeListeners()}}const ov=i=>(e,t)=>{i&&Fe.postRender(()=>i(e,t))};class ZO extends cr{constructor(){super(...arguments),this.removePointerDownListener=Vt}onPointerDown(e){this.session=new t_(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:u_(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:ov(e),onStart:ov(t),onMove:n,onEnd:(s,o)=>{delete this.session,r&&Fe.postRender(()=>r(s,o))}}}mount(){this.removePointerDownListener=Mo(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const zl={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function av(i,e){return e.max===e.min?0:i/(e.max-e.min)*100}const vo={correct:(i,e)=>{if(!e.target)return i;if(typeof i=="string")if(ye.test(i))i=parseFloat(i);else return i;const t=av(i,e.target.x),n=av(i,e.target.y);return`${t}% ${n}%`}},JO={correct:(i,{treeScale:e,projectionDelta:t})=>{const n=i,r=lr.parse(i);if(r.length>5)return n;const s=lr.createTransformer(i),o=typeof r[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const u=Qe(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=u),typeof r[3+o]=="number"&&(r[3+o]/=u),s(r)}};class eM extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:s}=e;Ab(tM),s&&(t.group&&t.group.add(s),n&&n.register&&r&&n.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),zl.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:s}=this.props,o=n.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||Fe.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Jd.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function c_(i){const[e,t]=UC(),n=N.useContext(zS);return Xh.jsx(eM,{...i,layoutGroup:n,switchLayoutGroup:N.useContext(ZS),isPresent:e,safeToRemove:t})}const tM={borderRadius:{...vo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:vo,borderTopRightRadius:vo,borderBottomLeftRadius:vo,borderBottomRightRadius:vo,boxShadow:JO};function nM(i,e,t){const n=Mt(i)?i:ii(i);return n.start(Rm("",n,e,t)),n.animation}function iM(i){return i instanceof SVGElement&&i.tagName!=="svg"}const rM=(i,e)=>i.depth-e.depth;class sM{constructor(){this.children=[],this.isDirty=!1}add(e){dm(this.children,e),this.isDirty=!0}remove(e){mm(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(rM),this.isDirty=!1,this.children.forEach(e)}}function oM(i,e){const t=oi.now(),n=({timestamp:r})=>{const s=r-t;s>=e&&(Un(n),i(s-e))};return Fe.read(n,!0),()=>Un(n)}const h_=["TopLeft","TopRight","BottomLeft","BottomRight"],aM=h_.length,lv=i=>typeof i=="string"?parseFloat(i):i,uv=i=>typeof i=="number"||ye.test(i);function lM(i,e,t,n,r,s){r?(i.opacity=Qe(0,t.opacity!==void 0?t.opacity:1,uM(n)),i.opacityExit=Qe(e.opacity!==void 0?e.opacity:1,0,cM(n))):s&&(i.opacity=Qe(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,n));for(let o=0;o<aM;o++){const a=`border${h_[o]}Radius`;let l=cv(e,a),u=cv(t,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||uv(l)===uv(u)?(i[a]=Math.max(Qe(lv(l),lv(u),n),0),(si.test(u)||si.test(l))&&(i[a]+="%")):i[a]=u}(e.rotate||t.rotate)&&(i.rotate=Qe(e.rotate||0,t.rotate||0,n))}function cv(i,e){return i[e]!==void 0?i[e]:i.borderRadius}const uM=f_(0,.5,Dx),cM=f_(.5,.95,Vt);function f_(i,e,t){return n=>n<i?0:n>e?1:t(Kr(i,e,n))}function hv(i,e){i.min=e.min,i.max=e.max}function An(i,e){hv(i.x,e.x),hv(i.y,e.y)}function fv(i,e){i.translate=e.translate,i.scale=e.scale,i.originPoint=e.originPoint,i.origin=e.origin}function dv(i,e,t,n,r){return i-=e,i=Tu(i,1/t,n),r!==void 0&&(i=Tu(i,1/r,n)),i}function hM(i,e=0,t=1,n=.5,r,s=i,o=i){if(si.test(e)&&(e=parseFloat(e),e=Qe(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=Qe(s.min,s.max,n);i===s&&(a-=e),i.min=dv(i.min,e,t,a,r),i.max=dv(i.max,e,t,a,r)}function mv(i,e,[t,n,r],s,o){hM(i,e[t],e[n],e[r],e.scale,s,o)}const fM=["x","scaleX","originX"],dM=["y","scaleY","originY"];function pv(i,e,t,n){mv(i.x,e,fM,t?t.x:void 0,n?n.x:void 0),mv(i.y,e,dM,t?t.y:void 0,n?n.y:void 0)}function gv(i){return i.translate===0&&i.scale===1}function d_(i){return gv(i.x)&&gv(i.y)}function yv(i,e){return i.min===e.min&&i.max===e.max}function mM(i,e){return yv(i.x,e.x)&&yv(i.y,e.y)}function vv(i,e){return Math.round(i.min)===Math.round(e.min)&&Math.round(i.max)===Math.round(e.max)}function m_(i,e){return vv(i.x,e.x)&&vv(i.y,e.y)}function Tv(i){return mn(i.x)/mn(i.y)}function Ev(i,e){return i.translate===e.translate&&i.scale===e.scale&&i.originPoint===e.originPoint}class pM{constructor(){this.members=[]}add(e){dm(this.members,e),e.scheduleRender()}remove(e){if(mm(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){n=s;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function gM(i,e,t){let n="";const r=i.x.translate/e.x,s=i.y.translate/e.y,o=(t==null?void 0:t.z)||0;if((r||s||o)&&(n=`translate3d(${r}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:u,rotate:f,rotateX:d,rotateY:m,skewX:g,skewY:y}=t;u&&(n=`perspective(${u}px) ${n}`),f&&(n+=`rotate(${f}deg) `),d&&(n+=`rotateX(${d}deg) `),m&&(n+=`rotateY(${m}deg) `),g&&(n+=`skewX(${g}deg) `),y&&(n+=`skewY(${y}deg) `)}const a=i.x.scale*e.x,l=i.y.scale*e.y;return(a!==1||l!==1)&&(n+=`scale(${a}, ${l})`),n||"none"}const wr={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Lo=typeof window<"u"&&window.MotionDebug!==void 0,Kh=["","X","Y","Z"],yM={visibility:"hidden"},Sv=1e3;let vM=0;function zh(i,e,t,n){const{latestValues:r}=e;r[i]&&(t[i]=r[i],e.setStaticValue(i,0),n&&(n[i]=0))}function p_(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:e}=i.options;if(!e)return;const t=xx(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:s}=i.options;window.MotionCancelOptimisedAnimation(t,"transform",Fe,!(r||s))}const{parent:n}=i;n&&!n.hasCheckedOptimisedAppear&&p_(n)}function g_({attachResizeListener:i,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=vM++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Lo&&(wr.totalNodes=wr.resolvedTargetDeltas=wr.recalculatedProjection=0),this.nodes.forEach(SM),this.nodes.forEach(RM),this.nodes.forEach(IM),this.nodes.forEach(xM),Lo&&window.MotionDebug.record(wr)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new sM)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new pm),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=iM(o),this.instance=o;const{layoutId:l,layout:u,visualElement:f}=this.options;if(f&&!f.current&&f.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(u||l)&&(this.isLayoutDirty=!0),i){let d;const m=()=>this.root.updateBlockedByResize=!1;i(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=oM(m,250),zl.hasAnimatedSinceResize&&(zl.hasAnimatedSinceResize=!1,this.nodes.forEach(_v))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&f&&(l||u)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:m,hasRelativeTargetChanged:g,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const T=this.options.transition||f.getDefaultTransition()||bM,{onLayoutAnimationStart:E,onLayoutAnimationComplete:x}=f.getProps(),R=!this.targetLayout||!m_(this.targetLayout,y)||g,L=!m&&g;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||L||m&&(R||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,L);const P={...um(T,"layout"),onPlay:E,onComplete:x};(f.shouldReduceMotion||this.options.layoutRoot)&&(P.delay=0,P.type=!1),this.startAnimation(P)}else m||_v(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Un(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(PM),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&p_(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const d=this.path[f];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(xv);return}this.isUpdating||this.nodes.forEach(AM),this.isUpdating=!1,this.nodes.forEach(LM),this.nodes.forEach(TM),this.nodes.forEach(EM),this.clearAllSnapshots();const a=oi.now();vt.delta=ui(0,1e3/60,a-vt.timestamp),vt.timestamp=a,vt.isProcessing=!0,Fh.update.process(vt),Fh.preRender.process(vt),Fh.render.process(vt),vt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Jd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(_M),this.sharedNodes.forEach(DM)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Fe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Fe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=it(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const l=n(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!d_(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,f=u!==this.prevTransformTemplateValue;o&&(a||Dr(this.latestValues)||f)&&(r(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),kM(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return it();const l=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(OM))){const{scroll:f}=this.root;f&&(Ss(l.x,f.offset.x),Ss(l.y,f.offset.y))}return l}removeElementScroll(o){var a;const l=it();if(An(l,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let u=0;u<this.path.length;u++){const f=this.path[u],{scroll:d,options:m}=f;f!==this.root&&d&&m.layoutScroll&&(d.wasRoot&&An(l,o),Ss(l.x,d.offset.x),Ss(l.y,d.offset.y))}return l}applyTransform(o,a=!1){const l=it();An(l,o);for(let u=0;u<this.path.length;u++){const f=this.path[u];!a&&f.options.layoutScroll&&f.scroll&&f!==f.root&&xs(l,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Dr(f.latestValues)&&xs(l,f.latestValues)}return Dr(this.latestValues)&&xs(l,this.latestValues),l}removeTransform(o){const a=it();An(a,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!Dr(u.latestValues))continue;jf(u.latestValues)&&u.updateSnapshot();const f=it(),d=u.measurePageBox();An(f,d),pv(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,f)}return Dr(this.latestValues)&&pv(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(o||u&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:m}=this.options;if(!(!this.layout||!(d||m))){if(this.resolvedRelativeTargetAt=vt.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=it(),this.relativeTargetOrigin=it(),No(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),An(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=it(),this.targetWithTransforms=it()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),NO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):An(this.target,this.layout.layoutBox),a_(this.target,this.targetDelta)):An(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=it(),this.relativeTargetOrigin=it(),No(this.relativeTargetOrigin,this.target,g.target),An(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Lo&&wr.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||jf(this.parent.latestValues)||o_(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let u=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===vt.timestamp&&(u=!1),u)return;const{layout:f,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||d))return;An(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,g=this.treeScale.y;WO(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=it());const{target:y}=a;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(fv(this.prevProjectionDelta.x,this.projectionDelta.x),fv(this.prevProjectionDelta.y,this.projectionDelta.y)),Fo(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==g||!Ev(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ev(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y)),Lo&&wr.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Es(),this.projectionDelta=Es(),this.projectionDeltaWithTransform=Es()}setAnimationOrigin(o,a=!1){const l=this.snapshot,u=l?l.latestValues:{},f={...this.latestValues},d=Es();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const m=it(),g=l?l.source:void 0,y=this.layout?this.layout.source:void 0,T=g!==y,E=this.getStack(),x=!E||E.members.length<=1,R=!!(T&&!x&&this.options.crossfade===!0&&!this.path.some(CM));this.animationProgress=0;let L;this.mixTargetDelta=P=>{const I=P/1e3;Av(d.x,o.x,I),Av(d.y,o.y,I),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(No(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),wM(this.relativeTarget,this.relativeTargetOrigin,m,I),L&&mM(this.relativeTarget,L)&&(this.isProjectionDirty=!1),L||(L=it()),An(L,this.relativeTarget)),T&&(this.animationValues=f,lM(f,u,this.latestValues,I,R,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=I},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Un(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Fe.update(()=>{zl.hasAnimatedSinceResize=!0,this.currentAnimation=nM(0,Sv,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Sv),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:f}=o;if(!(!a||!l||!u)){if(this!==o&&this.layout&&u&&y_(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||it();const d=mn(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const m=mn(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+m}An(a,l),xs(a,f),Fo(this.projectionDeltaWithTransform,this.layoutCorrected,a,f)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new pM),this.sharedNodes.get(o).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&zh("z",o,u,this.animationValues);for(let f=0;f<Kh.length;f++)zh(`rotate${Kh[f]}`,o,u,this.animationValues),zh(`skew${Kh[f]}`,o,u,this.animationValues);o.render();for(const f in u)o.setStaticValue(f,u[f]),this.animationValues&&(this.animationValues[f]=u[f]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return yM;const u={visibility:""},f=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,u.opacity="",u.pointerEvents=Hl(o==null?void 0:o.pointerEvents)||"",u.transform=f?f(this.latestValues,""):"none",u;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const T={};return this.options.layoutId&&(T.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,T.pointerEvents=Hl(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Dr(this.latestValues)&&(T.transform=f?f({},""):"none",this.hasProjected=!1),T}const m=d.animationValues||d.latestValues;this.applyTransformsToTarget(),u.transform=gM(this.projectionDeltaWithTransform,this.treeScale,m),f&&(u.transform=f(m,u.transform));const{x:g,y}=this.projectionDelta;u.transformOrigin=`${g.origin*100}% ${y.origin*100}% 0`,d.animationValues?u.opacity=d===this?(l=(a=m.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:u.opacity=d===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const T in mu){if(m[T]===void 0)continue;const{correct:E,applyTo:x}=mu[T],R=u.transform==="none"?m[T]:E(m[T],d);if(x){const L=x.length;for(let P=0;P<L;P++)u[x[P]]=R}else u[T]=R}return this.options.layoutId&&(u.pointerEvents=d===this?Hl(o==null?void 0:o.pointerEvents)||"":"none"),u}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(xv),this.root.sharedNodes.clear()}}}function TM(i){i.updateLayout()}function EM(i){var e;const t=((e=i.resumeFrom)===null||e===void 0?void 0:e.snapshot)||i.snapshot;if(i.isLead()&&i.layout&&t&&i.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=i.layout,{animationType:s}=i.options,o=t.source!==i.layout.source;s==="size"?Rn(d=>{const m=o?t.measuredBox[d]:t.layoutBox[d],g=mn(m);m.min=n[d].min,m.max=m.min+g}):y_(s,t.layoutBox,n)&&Rn(d=>{const m=o?t.measuredBox[d]:t.layoutBox[d],g=mn(n[d]);m.max=m.min+g,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[d].max=i.relativeTarget[d].min+g)});const a=Es();Fo(a,n,t.layoutBox);const l=Es();o?Fo(l,i.applyTransform(r,!0),t.measuredBox):Fo(l,n,t.layoutBox);const u=!d_(a);let f=!1;if(!i.resumeFrom){const d=i.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:m,layout:g}=d;if(m&&g){const y=it();No(y,t.layoutBox,m.layoutBox);const T=it();No(T,n,g.layoutBox),m_(y,T)||(f=!0),d.options.layoutRoot&&(i.relativeTarget=T,i.relativeTargetOrigin=y,i.relativeParent=d)}}}i.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeTargetChanged:f})}else if(i.isLead()){const{onExitComplete:n}=i.options;n&&n()}i.options.transition=void 0}function SM(i){Lo&&wr.totalNodes++,i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function xM(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function _M(i){i.clearSnapshot()}function xv(i){i.clearMeasurements()}function AM(i){i.isLayoutDirty=!1}function LM(i){const{visualElement:e}=i.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),i.resetTransform()}function _v(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function RM(i){i.resolveTargetDelta()}function IM(i){i.calcProjection()}function PM(i){i.resetSkewAndRotation()}function DM(i){i.removeLeadSnapshot()}function Av(i,e,t){i.translate=Qe(e.translate,0,t),i.scale=Qe(e.scale,1,t),i.origin=e.origin,i.originPoint=e.originPoint}function Lv(i,e,t,n){i.min=Qe(e.min,t.min,n),i.max=Qe(e.max,t.max,n)}function wM(i,e,t,n){Lv(i.x,e.x,t.x,n),Lv(i.y,e.y,t.y,n)}function CM(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const bM={duration:.45,ease:[.4,0,.1,1]},Rv=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),Iv=Rv("applewebkit/")&&!Rv("chrome/")?Math.round:Vt;function Pv(i){i.min=Iv(i.min),i.max=Iv(i.max)}function kM(i){Pv(i.x),Pv(i.y)}function y_(i,e,t){return i==="position"||i==="preserve-aspect"&&!FO(Tv(e),Tv(t),.2)}function OM(i){var e;return i!==i.root&&((e=i.scroll)===null||e===void 0?void 0:e.wasRoot)}const MM=g_({attachResizeListener:(i,e)=>na(i,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Wh={current:void 0},v_=g_({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!Wh.current){const i=new MM({});i.mount(window),i.setOptions({layoutScroll:!0}),Wh.current=i}return Wh.current},resetTransform:(i,e)=>{i.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),FM={pan:{Feature:ZO},drag:{Feature:QO,ProjectionNode:v_,MeasureLayout:c_}};function Dv(i,e,t){const{props:n}=i;i.animationState&&n.whileHover&&i.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,s=n[r];s&&Fe.postRender(()=>s(e,ca(e)))}class NM extends cr{mount(){const{current:e}=this.node;e&&(this.unmount=Bb(e,t=>(Dv(this.node,t,"Start"),n=>Dv(this.node,n,"End"))))}unmount(){}}class BM extends cr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ua(na(this.node.current,"focus",()=>this.onFocus()),na(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function wv(i,e,t){const{props:n}=i;i.animationState&&n.whileTap&&i.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),s=n[r];s&&Fe.postRender(()=>s(e,ca(e)))}class UM extends cr{mount(){const{current:e}=this.node;e&&(this.unmount=Gb(e,t=>(wv(this.node,t,"Start"),(n,{success:r})=>wv(this.node,n,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const qf=new WeakMap,jh=new WeakMap,$M=i=>{const e=qf.get(i.target);e&&e(i)},VM=i=>{i.forEach($M)};function GM({root:i,...e}){const t=i||document;jh.has(t)||jh.set(t,{});const n=jh.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(VM,{root:i,...e})),n[r]}function HM(i,e,t){const n=GM(e);return qf.set(i,t),n.observe(i),()=>{qf.delete(i),n.unobserve(i)}}const KM={some:0,all:1};class zM extends cr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:s}=e,o={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:KM[r]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,s&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:f,onViewportLeave:d}=this.node.getProps(),m=u?f:d;m&&m(l)};return HM(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(WM(e,t))&&this.startObserver()}unmount(){}}function WM({viewport:i={}},{viewport:e={}}={}){return t=>i[t]!==e[t]}const jM={inView:{Feature:zM},tap:{Feature:UM},focus:{Feature:BM},hover:{Feature:NM}},YM={layout:{ProjectionNode:v_,MeasureLayout:c_}},Xf={current:null},T_={current:!1};function qM(){if(T_.current=!0,!!jd)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),e=()=>Xf.current=i.matches;i.addListener(e),e()}else Xf.current=!1}const XM=[...Hx,bt,lr],QM=i=>XM.find(Gx(i)),Cv=new WeakMap;function ZM(i,e,t){for(const n in e){const r=e[n],s=t[n];if(Mt(r))i.addValue(n,r);else if(Mt(s))i.addValue(n,ii(r,{owner:i}));else if(s!==r)if(i.hasValue(n)){const o=i.getValue(n);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=i.getStaticValue(n);i.addValue(n,ii(o!==void 0?o:r,{owner:i}))}}for(const n in t)e[n]===void 0&&i.removeValue(n);return e}const bv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class JM{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=xm,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=oi.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,Fe.render(this.render,!1,!0))};const{latestValues:l,renderState:u,onUpdate:f}=o;this.onUpdate=f,this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=Nu(t),this.isVariantNode=XS(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...m}=this.scrapeMotionValuesFromProps(t,{},this);for(const g in m){const y=m[g];l[g]!==void 0&&Mt(y)&&y.set(l[g],!1)}}mount(e){this.current=e,Cv.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,n)=>this.bindToMotionValue(n,t)),T_.current||qM(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Xf.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Cv.delete(this.current),this.projection&&this.projection.unmount(),Un(this.notifyUpdate),Un(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Yr.has(e),r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Fe.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),s=t.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),s(),o&&o(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Us){const t=Us[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):it()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<bv.length;n++){const r=bv[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,o=e[s];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=ZM(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ii(t===null?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&($x(r)||Cx(r))?r=parseFloat(r):!QM(r)&&lr.test(t)&&(r=Nx(e,t)),this.setBaseTarget(e,Mt(r)?r.get():r)),Mt(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=tm(this.props,n,(t=this.presenceContext)===null||t===void 0?void 0:t.custom);o&&(r=o[e])}if(n&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!Mt(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new pm),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class E_ extends JM{constructor(){super(...arguments),this.KeyframeResolver=Kx}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Mt(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function eF(i){return window.getComputedStyle(i)}class tF extends E_{constructor(){super(...arguments),this.type="html",this.renderInstance=sx}readValueFromInstance(e,t){if(Yr.has(t)){const n=Sm(t);return n&&n.default||0}else{const n=eF(e),r=(nx(t)?n.getPropertyValue(t):n[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return l_(e,t)}build(e,t,n){rm(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return lm(e,t,n)}}class nF extends E_{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=it}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Yr.has(t)){const n=Sm(t);return n&&n.default||0}return t=ox.has(t)?t:Zd(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return ux(e,t,n)}build(e,t,n){sm(e,t,this.isSVGTag,n.transformTemplate)}renderInstance(e,t,n,r){ax(e,t,n,r)}mount(e){this.isSVGTag=am(e.tagName),super.mount(e)}}const iF=(i,e)=>em(i)?new nF(e):new tF(e,{allowProjection:i!==N.Fragment}),rF=kb({...IO,...jM,...FM,...YM},iF),yN=YC(rF);function S_(i,e){let t;const n=()=>{const{currentTime:r}=e,o=(r===null?0:r.value)/100;t!==o&&i(o),t=o};return Fe.update(n,!0),()=>Un(n)}const Wl=new WeakMap;let Qi;function sF(i,e){if(e){const{inlineSize:t,blockSize:n}=e[0];return{width:t,height:n}}else return i instanceof SVGElement&&"getBBox"in i?i.getBBox():{width:i.offsetWidth,height:i.offsetHeight}}function oF({target:i,contentRect:e,borderBoxSize:t}){var n;(n=Wl.get(i))===null||n===void 0||n.forEach(r=>{r({target:i,contentSize:e,get size(){return sF(i,t)}})})}function aF(i){i.forEach(oF)}function lF(){typeof ResizeObserver>"u"||(Qi=new ResizeObserver(aF))}function uF(i,e){Qi||lF();const t=vx(i);return t.forEach(n=>{let r=Wl.get(n);r||(r=new Set,Wl.set(n,r)),r.add(e),Qi==null||Qi.observe(n)}),()=>{t.forEach(n=>{const r=Wl.get(n);r==null||r.delete(e),r!=null&&r.size||Qi==null||Qi.unobserve(n)})}}const jl=new Set;let Bo;function cF(){Bo=()=>{const i={width:window.innerWidth,height:window.innerHeight},e={target:window,size:i,contentSize:i};jl.forEach(t=>t(e))},window.addEventListener("resize",Bo)}function hF(i){return jl.add(i),Bo||cF(),()=>{jl.delete(i),!jl.size&&Bo&&(Bo=void 0)}}function fF(i,e){return typeof i=="function"?hF(i):uF(i,e)}const dF=50,kv=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),mF=()=>({time:0,x:kv(),y:kv()}),pF={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function Ov(i,e,t,n){const r=t[e],{length:s,position:o}=pF[e],a=r.current,l=t.time;r.current=i[`scroll${o}`],r.scrollLength=i[`scroll${s}`]-i[`client${s}`],r.offset.length=0,r.offset[0]=0,r.offset[1]=r.scrollLength,r.progress=Kr(0,r.scrollLength,r.current);const u=n-l;r.velocity=u>dF?0:gm(r.current-a,u)}function gF(i,e,t){Ov(i,"x",e,t),Ov(i,"y",e,t),e.time=t}function yF(i,e){const t={x:0,y:0};let n=i;for(;n&&n!==e;)if(n instanceof HTMLElement)t.x+=n.offsetLeft,t.y+=n.offsetTop,n=n.offsetParent;else if(n.tagName==="svg"){const r=n.getBoundingClientRect();n=n.parentElement;const s=n.getBoundingClientRect();t.x+=r.left-s.left,t.y+=r.top-s.top}else if(n instanceof SVGGraphicsElement){const{x:r,y:s}=n.getBBox();t.x+=r,t.y+=s;let o=null,a=n.parentNode;for(;!o;)a.tagName==="svg"&&(o=a),a=n.parentNode;n=o}else break;return t}const Qf={start:0,center:.5,end:1};function Mv(i,e,t=0){let n=0;if(i in Qf&&(i=Qf[i]),typeof i=="string"){const r=parseFloat(i);i.endsWith("px")?n=r:i.endsWith("%")?i=r/100:i.endsWith("vw")?n=r/100*document.documentElement.clientWidth:i.endsWith("vh")?n=r/100*document.documentElement.clientHeight:i=r}return typeof i=="number"&&(n=e*i),t+n}const vF=[0,0];function TF(i,e,t,n){let r=Array.isArray(i)?i:vF,s=0,o=0;return typeof i=="number"?r=[i,i]:typeof i=="string"&&(i=i.trim(),i.includes(" ")?r=i.split(" "):r=[i,Qf[i]?i:"0"]),s=Mv(r[0],t,n),o=Mv(r[1],e),s-o}const EF={All:[[0,0],[1,1]]},SF={x:0,y:0};function xF(i){return"getBBox"in i&&i.tagName!=="svg"?i.getBBox():{width:i.clientWidth,height:i.clientHeight}}function _F(i,e,t){const{offset:n=EF.All}=t,{target:r=i,axis:s="y"}=t,o=s==="y"?"height":"width",a=r!==i?yF(r,i):SF,l=r===i?{width:i.scrollWidth,height:i.scrollHeight}:xF(r),u={width:i.clientWidth,height:i.clientHeight};e[s].offset.length=0;let f=!e[s].interpolate;const d=n.length;for(let m=0;m<d;m++){const g=TF(n[m],u[o],l[o],a[s]);!f&&g!==e[s].interpolatorOffsets[m]&&(f=!0),e[s].offset[m]=g}f&&(e[s].interpolate=Am(e[s].offset,Qx(n),{clamp:!1}),e[s].interpolatorOffsets=[...e[s].offset]),e[s].progress=ui(0,1,e[s].interpolate(e[s].current))}function AF(i,e=i,t){if(t.x.targetOffset=0,t.y.targetOffset=0,e!==i){let n=e;for(;n&&n!==i;)t.x.targetOffset+=n.offsetLeft,t.y.targetOffset+=n.offsetTop,n=n.offsetParent}t.x.targetLength=e===i?e.scrollWidth:e.clientWidth,t.y.targetLength=e===i?e.scrollHeight:e.clientHeight,t.x.containerLength=i.clientWidth,t.y.containerLength=i.clientHeight}function LF(i,e,t,n={}){return{measure:()=>AF(i,n.target,t),update:r=>{gF(i,t,r),(n.offset||n.target)&&_F(i,t,n)},notify:()=>e(t)}}const To=new WeakMap,Fv=new WeakMap,Yh=new WeakMap,Nv=i=>i===document.documentElement?window:i;function Im(i,{container:e=document.documentElement,...t}={}){let n=Yh.get(e);n||(n=new Set,Yh.set(e,n));const r=mF(),s=LF(e,i,r,t);if(n.add(s),!To.has(e)){const a=()=>{for(const m of n)m.measure()},l=()=>{for(const m of n)m.update(vt.timestamp)},u=()=>{for(const m of n)m.notify()},f=()=>{Fe.read(a,!1,!0),Fe.read(l,!1,!0),Fe.update(u,!1,!0)};To.set(e,f);const d=Nv(e);window.addEventListener("resize",f,{passive:!0}),e!==document.documentElement&&Fv.set(e,fF(e,f)),d.addEventListener("scroll",f,{passive:!0})}const o=To.get(e);return Fe.read(o,!1,!0),()=>{var a;Un(o);const l=Yh.get(e);if(!l||(l.delete(s),l.size))return;const u=To.get(e);To.delete(e),u&&(Nv(e).removeEventListener("scroll",u),(a=Fv.get(e))===null||a===void 0||a(),window.removeEventListener("resize",u))}}function RF({source:i,container:e,axis:t="y"}){i&&(e=i);const n={value:0},r=Im(s=>{n.value=s[t].progress*100},{container:e,axis:t});return{currentTime:n,cancel:r}}const qh=new Map;function x_({source:i,container:e=document.documentElement,axis:t="y"}={}){i&&(e=i),qh.has(e)||qh.set(e,{});const n=qh.get(e);return n[t]||(n[t]=fx()?new ScrollTimeline({source:e,axis:t}):RF({source:e,axis:t})),n[t]}function IF(i){return i.length===2}function __(i){return i&&(i.target||i.offset)}function PF(i,e){return IF(i)||__(e)?Im(t=>{i(t[e.axis].progress,t)},e):S_(i,x_(e))}function DF(i,e){if(i.flatten(),__(e))return i.pause(),Im(t=>{i.time=i.duration*t[e.axis].progress},e);{const t=x_(e);return i.attachTimeline?i.attachTimeline(t,n=>(n.pause(),S_(r=>{n.time=n.duration*r},t))):Vt}}function wF(i,{axis:e="y",...t}={}){const n={axis:e,...t};return typeof i=="function"?PF(i,n):DF(i,n)}function Bv(i,e){$C(!!(!e||e.current))}const CF=()=>({scrollX:ii(0),scrollY:ii(0),scrollXProgress:ii(0),scrollYProgress:ii(0)});function vN({container:i,target:e,layoutEffect:t=!0,...n}={}){const r=Ou(CF);return(t?Yd:N.useEffect)(()=>(Bv("target",e),Bv("container",i),wF((o,{x:a,y:l})=>{r.scrollX.set(a.current),r.scrollXProgress.set(a.progress),r.scrollY.set(l.current),r.scrollYProgress.set(l.progress)},{...n,container:(i==null?void 0:i.current)||void 0,target:(e==null?void 0:e.current)||void 0})),[i,e,JSON.stringify(n.offset)]),r}function bF(i){const e=Ou(()=>ii(i)),{isStatic:t}=N.useContext(Wd);if(t){const[,n]=N.useState(i);N.useEffect(()=>e.on("change",n),[])}return e}function A_(i,e){const t=bF(e()),n=()=>t.set(e());return n(),Yd(()=>{const r=()=>Fe.preRender(n,!1,!0),s=i.map(o=>o.on("change",r));return()=>{s.forEach(o=>o()),Un(n)}}),t}const kF=i=>i&&typeof i=="object"&&i.mix,OF=i=>kF(i)?i.mix:void 0;function MF(...i){const e=!Array.isArray(i[0]),t=e?0:-1,n=i[0+t],r=i[1+t],s=i[2+t],o=i[3+t],a=Am(r,s,{mixer:OF(s[0]),...o});return e?a(n):a}function FF(i){ko.current=[],i();const e=A_(ko.current,i);return ko.current=void 0,e}function TN(i,e,t,n){if(typeof i=="function")return FF(i);const r=typeof e=="function"?e:MF(e,t,n);return Array.isArray(i)?Uv(i,r):Uv([i],([s])=>r(s))}function Uv(i,e){const t=Ou(()=>[]);return A_(i,()=>{t.length=0;const n=i.length;for(let r=0;r<n;r++)t[r]=i[r].get();return e(t)})}class ha{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}const NF=()=>{if(!(typeof localStorage>"u"))return{get:i=>Promise.resolve(localStorage.getItem(i)),set:(i,e)=>Promise.resolve(localStorage.setItem(i,e)),remove:i=>Promise.resolve(localStorage.removeItem(i))}},Lt={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:NF()},Pm=i=>i?typeof i=="string"?{publicKey:i}:i.toString()==="[object Object]"?i:{}:{},BF=(i,e="https://api.emailjs.com")=>{if(!i)return;const t=Pm(i);Lt.publicKey=t.publicKey,Lt.blockHeadless=t.blockHeadless,Lt.storageProvider=t.storageProvider,Lt.blockList=t.blockList,Lt.limitRate=t.limitRate,Lt.origin=t.origin||e},L_=async(i,e,t={})=>{const n=await fetch(Lt.origin+i,{method:"POST",headers:t,body:e}),r=await n.text(),s=new ha(n.status,r);if(n.ok)return s;throw s},R_=(i,e,t)=>{if(!i||typeof i!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},UF=i=>{if(i&&i.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},I_=i=>i.webdriver||!i.languages||i.languages.length===0,P_=()=>new ha(451,"Unavailable For Headless Browser"),$F=(i,e)=>{if(!Array.isArray(i))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},VF=i=>{var e;return!((e=i.list)!=null&&e.length)||!i.watchVariable},GF=(i,e)=>i instanceof FormData?i.get(e):i[e],D_=(i,e)=>{if(VF(i))return!1;$F(i.list,i.watchVariable);const t=GF(e,i.watchVariable);return typeof t!="string"?!1:i.list.includes(t)},w_=()=>new ha(403,"Forbidden"),HF=(i,e)=>{if(typeof i!="number"||i<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},KF=async(i,e,t)=>{const n=Number(await t.get(i)||0);return e-Date.now()+n},C_=async(i,e,t)=>{if(!e.throttle||!t)return!1;HF(e.throttle,e.id);const n=e.id||i;return await KF(n,e.throttle,t)>0?!0:(await t.set(n,Date.now().toString()),!1)},b_=()=>new ha(429,"Too Many Requests"),zF=async(i,e,t,n)=>{const r=Pm(n),s=r.publicKey||Lt.publicKey,o=r.blockHeadless||Lt.blockHeadless,a=r.storageProvider||Lt.storageProvider,l={...Lt.blockList,...r.blockList},u={...Lt.limitRate,...r.limitRate};return o&&I_(navigator)?Promise.reject(P_()):(R_(s,i,e),UF(t),t&&D_(l,t)?Promise.reject(w_()):await C_(location.pathname,u,a)?Promise.reject(b_()):L_("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:s,service_id:i,template_id:e,template_params:t}),{"Content-type":"application/json"}))},WF=i=>{if(!i||i.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},jF=i=>typeof i=="string"?document.querySelector(i):i,YF=async(i,e,t,n)=>{const r=Pm(n),s=r.publicKey||Lt.publicKey,o=r.blockHeadless||Lt.blockHeadless,a=Lt.storageProvider||r.storageProvider,l={...Lt.blockList,...r.blockList},u={...Lt.limitRate,...r.limitRate};if(o&&I_(navigator))return Promise.reject(P_());const f=jF(t);R_(s,i,e),WF(f);const d=new FormData(f);return D_(l,d)?Promise.reject(w_()):await C_(location.pathname,u,a)?Promise.reject(b_()):(d.append("lib_version","4.4.1"),d.append("service_id",i),d.append("template_id",e),d.append("user_id",s),L_("/api/v1.0/email/send-form",d))},EN={init:BF,send:zF,sendForm:YF,EmailJSResponseStatus:ha};var k_={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$v=Or.createContext&&Or.createContext(k_),qF=["attr","size","title"];function XF(i,e){if(i==null)return{};var t=QF(i,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}function QF(i,e){if(i==null)return{};var t={};for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){if(e.indexOf(n)>=0)continue;t[n]=i[n]}return t}function Eu(){return Eu=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Eu.apply(this,arguments)}function Vv(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Su(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vv(Object(t),!0).forEach(function(n){ZF(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Vv(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function ZF(i,e,t){return e=JF(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function JF(i){var e=eN(i,"string");return typeof e=="symbol"?e:e+""}function eN(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function O_(i){return i&&i.map((e,t)=>Or.createElement(e.tag,Su({key:t},e.attr),O_(e.child)))}function M_(i){return e=>Or.createElement(tN,Eu({attr:Su({},i.attr)},e),O_(i.child))}function tN(i){var e=t=>{var{attr:n,size:r,title:s}=i,o=XF(i,qF),a=r||t.size||"1em",l;return t.className&&(l=t.className),i.className&&(l=(l?l+" ":"")+i.className),Or.createElement("svg",Eu({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,o,{className:l,style:Su(Su({color:i.color||t.color},t.style),i.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&Or.createElement("title",null,s),i.children)};return $v!==void 0?Or.createElement($v.Consumer,null,t=>e(t)):e(k_)}function SN(i){return M_({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"},child:[]}]})(i)}function xN(i){return M_({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm100.7 364.9c-4.2 0-6.8-1.3-10.7-3.6-62.4-37.6-135-39.2-206.7-24.5-3.9 1-9 2.6-11.9 2.6-9.7 0-15.8-7.7-15.8-15.8 0-10.3 6.1-15.2 13.6-16.8 81.9-18.1 165.6-16.5 237 26.2 6.1 3.9 9.7 7.4 9.7 16.5s-7.1 15.4-15.2 15.4zm26.9-65.6c-5.2 0-8.7-2.3-12.3-4.2-62.5-37-155.7-51.9-238.6-29.4-4.8 1.3-7.4 2.6-11.9 2.6-10.7 0-19.4-8.7-19.4-19.4s5.2-17.8 15.5-20.7c27.8-7.8 56.2-13.6 97.8-13.6 64.9 0 127.6 16.1 177 45.5 8.1 4.8 11.3 11 11.3 19.7-.1 10.8-8.5 19.5-19.4 19.5zm31-76.2c-5.2 0-8.4-1.3-12.9-3.9-71.2-42.5-198.5-52.7-280.9-29.7-3.6 1-8.1 2.6-12.9 2.6-13.2 0-23.3-10.3-23.3-23.6 0-13.6 8.4-21.3 17.4-23.9 35.2-10.3 74.6-15.2 117.5-15.2 73 0 149.5 15.2 205.4 47.8 7.8 4.5 12.9 10.7 12.9 22.6 0 13.6-11 23.3-23.2 23.3z"},child:[]}]})(i)}export{A as E,_L as F,pN as H,VE as L,aN as R,Mg as _,N as a,lN as b,iN as c,oN as d,uN as e,Or as f,KS as g,GS as h,vN as i,Xh as j,TN as k,EN as l,yN as m,mN as n,KD as o,sN as p,xN as q,Zf as r,rN as s,SN as t,cN as u,dN as v};
